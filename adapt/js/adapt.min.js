require(["bowser","backbone","semver","react","react-dom","html-react-parser","libraries/mediaelement-and-player","libraries/rangeslider","handlebars","libraries/jquery.actual.min","libraries/SCORM_API_wrapper","underscore","libraries/lzma-min","libraries/lzma_worker-min.js","libraries/jquery-ui.slider","libraries/jquery.ui.touch-punch","libraries/simplebar/simplebar.min","libraries/jquery-ui.scrollParent.js"],function(Bowser,Backbone$1,semver,React,ReactDOM,HTMLReactParser,mediaelementAndPlayer,rangeslider,Handlebars$1,jquery_actual_min,pipwerks,_$1,lzmaMin,lzma_workerMin_js,jqueryUi_slider,jquery_ui_touchPunch,SimpleBar,jqueryUi_scrollParent_js){"use strict";function _interopDefaultLegacy(e){return e&&typeof e==="object"&&"default"in e?e:{"default":e}}var Bowser__default=_interopDefaultLegacy(Bowser);var Backbone__default=_interopDefaultLegacy(Backbone$1);var semver__default=_interopDefaultLegacy(semver);var React__default=_interopDefaultLegacy(React);var ReactDOM__default=_interopDefaultLegacy(ReactDOM);var HTMLReactParser__default=_interopDefaultLegacy(HTMLReactParser);var Handlebars__default=_interopDefaultLegacy(Handlebars$1);var pipwerks__default=_interopDefaultLegacy(pipwerks);var ___default=_interopDefaultLegacy(_$1);var SimpleBar__default=_interopDefaultLegacy(SimpleBar);class Wait extends Backbone.Controller{initialize(){this._waitCount=0;this._callbackHandle=null;this.being=this.begin.bind(this);this.end=this.end.bind(this)}isWaiting(){return this._waitCount!==0}begin(){if(!this.isWaiting())this.trigger("wait");this._waitCount++;if(this._callbackHandle){clearTimeout(this._callbackHandle);this._callbackHandle=null}return this}end(){if(!this.isWaiting())return this;this._waitCount--;if(this.isWaiting()||this._callbackHandle)return this;this._callbackHandle=setTimeout(function(){this._callbackHandle=null;this.trigger("ready")}.bind(this),0);return this}queue(callback){if(!callback){this.begin();return new Promise(resolve=>{this.once("ready",resolve);this.end()})}this.begin();this.once("ready",callback);this.end();return this}for(callback){this.begin();_.defer(()=>callback(_.once(this.end)));return this}}const wait=new Wait;var wait$1=__AMD("core/js/wait",wait);var LockingModel=__AMD("core/js/models/lockingModel",class LockingModel extends Backbone.Model{set(attrName,attrVal){let options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};const stopProcessing=typeof attrName==="object"||typeof attrVal!=="boolean"||!this.isLocking(attrName);if(stopProcessing)return super.set(...arguments);const isSettingValueForSpecificPlugin=options?.pluginName;if(!isSettingValueForSpecificPlugin){console.error("Must supply a pluginName to change a locked attribute");options.pluginName="compatibility"}const pluginName=options.pluginName;if(this.defaults[attrName]!==undefined){this._lockedAttributes[attrName]=!this.defaults[attrName]}const lockingValue=this._lockedAttributes[attrName];const isAttemptingToLock=lockingValue===attrVal;if(isAttemptingToLock){this.setLockState(attrName,true,{pluginName:pluginName,skipcheck:true});return super.set(attrName,lockingValue)}this.setLockState(attrName,false,{pluginName:pluginName,skipcheck:true});const totalLockValue=this.getLockCount(attrName,{skipcheck:true});if(totalLockValue===0){return super.set(attrName,!lockingValue)}return this}setLocking(attrName,defaultLockValue){if(this.isLocking(attrName))return;if(!this._lockedAttributes)this._lockedAttributes={};this._lockedAttributes[attrName]=defaultLockValue}unsetLocking(attrName){if(!this.isLocking(attrName))return;if(!this._lockedAttributes)return;delete this._lockedAttributes[attrName];delete this._lockedAttributesValues[attrName];if(Object.keys(this._lockedAttributes).length===0){delete this._lockedAttributes;delete this._lockedAttributesValues}}isLocking(attrName){const isCheckingGeneralLockingState=attrName===undefined;const isUsingLockedAttributes=Boolean(this.lockedAttributes||this._lockedAttributes);if(isCheckingGeneralLockingState){return isUsingLockedAttributes}if(!isUsingLockedAttributes)return false;if(!this._lockedAttributes){this._lockedAttributes=_.result(this,"lockedAttributes")}const isAttributeALockingAttribute=this._lockedAttributes.hasOwnProperty(attrName);if(!isAttributeALockingAttribute)return false;if(!this._lockedAttributesValues){this._lockedAttributesValues={}}if(!this._lockedAttributesValues[attrName]){this._lockedAttributesValues[attrName]={}}return true}isLocked(attrName,options){const shouldSkipCheck=options?.skipcheck;if(!shouldSkipCheck){const stopProcessing=!this.isLocking(attrName);if(stopProcessing)return}return this.getLockCount(attrName)>0}getLockCount(attrName,options){const shouldSkipCheck=options?.skipcheck;if(!shouldSkipCheck){const stopProcessing=!this.isLocking(attrName);if(stopProcessing)return}const isGettingValueForSpecificPlugin=options?.pluginName;if(isGettingValueForSpecificPlugin){return this._lockedAttributesValues[attrName][options.pluginName]?1:0}const lockingAttributeValues=Object.values(this._lockedAttributesValues[attrName]);const lockingAttributeValuesSum=lockingAttributeValues.reduce((sum,value)=>sum+(value?1:0),0);return lockingAttributeValuesSum}setLockState(attrName,value,options){const shouldSkipCheck=options?.skipcheck;if(!shouldSkipCheck){const stopProcessing=!this.isLocking(attrName);if(stopProcessing)return this}const isSettingValueForSpecificPlugin=options?.pluginName;if(!isSettingValueForSpecificPlugin){console.error("Must supply a pluginName to set a locked attribute lock value");options.pluginName="compatibility"}if(value){this._lockedAttributesValues[attrName][options.pluginName]=value}else{delete this._lockedAttributesValues[attrName][options.pluginName]}return this}});class AdaptSingleton extends LockingModel{initialize(){this.loadScript=window.__loadScript}defaults(){return{_canScroll:true,_outstandingCompletionChecks:0,_pluginWaitCount:0,_isStarted:false,_shouldDestroyContentObjects:true}}lockedAttributes(){return{_canScroll:false}}async init(){this.addDirection();this.disableAnimation();this.trigger("adapt:preInitialize");await wait$1.queue();this.deferUntilCompletionChecked(async()=>{this.trigger("adapt:start");await wait$1.queue();if(!Backbone.History.started){Backbone.history.start()}this.set("_isStarted",true);this.trigger("adapt:initialize");await wait$1.queue()})}checkingCompletion(){const outstandingChecks=this.get("_outstandingCompletionChecks");this.set("_outstandingCompletionChecks",outstandingChecks+1)}checkedCompletion(){const outstandingChecks=this.get("_outstandingCompletionChecks");this.set("_outstandingCompletionChecks",outstandingChecks-1)}async deferUntilCompletionChecked(){let callback=arguments.length>0&&arguments[0]!==undefined?arguments[0]:()=>{};if(this.get("_outstandingCompletionChecks")===0)return callback();return new Promise(resolve=>{const checkIfAnyChecksOutstanding=(model,outstandingChecks)=>{if(outstandingChecks!==0)return;this.off("change:_outstandingCompletionChecks",checkIfAnyChecksOutstanding);callback();resolve()};this.on("change:_outstandingCompletionChecks",checkIfAnyChecksOutstanding)})}isWaitingForPlugins(){this.log.deprecated("Use wait.isWaiting() as Adapt.isWaitingForPlugins() will be removed in the future");return wait$1.isWaiting()}checkPluginsReady(){this.log.deprecated("Use wait.isWaiting() as Adapt.checkPluginsReady() will be removed in the future");if(this.isWaitingForPlugins()){return}this.trigger("plugins:ready")}parseRelativeString(relativeString){let splitIndex=relativeString.search(/[ +\-\d]{1}/);if(splitIndex===-1)splitIndex=relativeString.length;const type=relativeString.slice(0,splitIndex).replace(/^@/,"");const offset=parseInt(relativeString.slice(splitIndex).trim()||0);return{type:type,offset:offset}}addDirection(){const defaultDirection=this.config.get("_defaultDirection");$("html").addClass("dir-"+defaultDirection).attr("dir",defaultDirection)}disableAnimation(){const disableAnimationArray=this.config.get("_disableAnimationFor");const disableAnimation=this.config.get("_disableAnimation");if(disableAnimationArray){for(let i=0,l=disableAnimationArray.length;i<l;i++){if(!$("html").is(disableAnimationArray[i]))continue;this.config.set("_disableAnimation",true);$("html").addClass("disable-animation");console.log("Animation disabled.")}return}$("html").toggleClass("disable-animation",disableAnimation===true)}async remove(){const currentView=this.parentView;if(currentView){currentView.model.setOnChildren({_isReady:false,_isRendered:false})}this.trigger("preRemove",currentView);await wait$1.queue();if(currentView&&this.get("_shouldDestroyContentObjects")){currentView.destroy()}this.trigger("remove",currentView);_.defer(this.trigger.bind(this),"postRemove",currentView)}get a11y(){}get componentStore(){}get data(){}get device(){}get drawer(){}get location(){}get notify(){}get offlineStorage(){}get router(){}get scrolling(){}get startController(){}get store(){}get tracking(){}get wait(){}async navigateToElement(){}async scrollTo(){}register(name,object){}getViewName(){}getViewClass(){}getModelName(){}getModelClass(){}findById(){}findViewByModelId(){}findByTrackingPosition(){}}const Adapt=new AdaptSingleton;var Adapt$1=__AMD("core/js/adapt",Adapt);class OfflineStorage$1 extends Backbone.Controller{initialize(handler){this.ready=true;this._handler=undefined;if(!handler){return}this.ready=false;this._handler=handler}hasHandler(){return this._handler!==undefined}save(){Adapt$1.trigger("tracking:save");return this._handler?.save?.(...arguments)}serialize(value){if(this._handler?.serialize){return this._handler.serialize(...arguments)}return JSON.stringify(value)}deserialize(value){if(this._handler?.deserialize){return this._handler.deserialize(...arguments)}return JSON.parse(value)}set(name,value){if(this._handler?.set){return this._handler.set(...arguments)}this[name]=value}get(name){if(this._handler?.get){return this._handler.get(...arguments)}return this[name]}clear(){if(this._handler?.clear){return this._handler.clear(...arguments)}return false}setReadyStatus(){this.ready=true;Adapt$1.trigger("offlineStorage:ready")}}const offlineStorage=new OfflineStorage$1;var offlineStorage$1=__AMD("core/js/offlineStorage",offlineStorage);class Device extends Backbone.Controller{initialize(){this.bowser=Bowser__default["default"].parse(window.navigator.userAgent);this.$html=$("html");this.$window=$(window);this.touch=Modernizr.touchevents;this.screenWidth=this.getScreenWidth();this.screenHeight=this.getScreenHeight();this.browser=(this.bowser.browser.name||"").toLowerCase();this.version=(this.bowser.browser.version||"").toLowerCase();this.OS=this.getOperatingSystem().toLowerCase();this.osVersion=this.bowser.os.version||"";this.renderingEngine=this.getRenderingEngine();this.onWindowResize=_.debounce(this.onWindowResize.bind(this),100);this.listenTo(Adapt$1,{"configModel:dataLoaded":this.onConfigDataLoaded});const browser=this.browser.toLowerCase();let browserString=browser.replace(/msie|internet explorer/,"ie");browserString+=` version-${this.version} OS-${this.OS} ${this.getAppleDeviceType()}`;browserString+=browserString.replace(".","-").toLowerCase();browserString+=` ${browserString.replace(/\./g,"-").toLowerCase()}`;browserString+=` pixel-density-${this.pixelDensity()}`;this.$html.addClass(browserString)}get orientation(){return this.screenWidth>=this.screenHeight?"landscape":"portrait"}get aspectRatio(){return this.screenWidth/this.screenHeight}onConfigDataLoaded(){this.screenSize=this.checkScreenSize();this.$html.addClass("size-"+this.screenSize);if(this.orientation){this.$html.addClass("orientation-"+this.orientation)}this.$window.on("resize orientationchange",this.onWindowResize)}checkScreenSize(){const screenSizeConfig=Adapt$1.config.get("screenSize");let screenSize;const screensizeEmThreshold=300;const baseFontSize=16;const mediumEmBreakpoint=screenSizeConfig.medium>screensizeEmThreshold?screenSizeConfig.medium/baseFontSize:screenSizeConfig.medium;const smallEmBreakpoint=screenSizeConfig.small>screensizeEmThreshold?screenSizeConfig.small/baseFontSize:screenSizeConfig.small;const fontSize=parseFloat($("html").css("font-size"));const screenSizeEmWidth=window.innerWidth/fontSize;if(screenSizeEmWidth>=mediumEmBreakpoint){screenSize="large"}else if(screenSizeEmWidth>=smallEmBreakpoint){screenSize="medium"}else{screenSize="small"}return screenSize}getScreenWidth(){return this.isAppleDevice()?this.getAppleScreenWidth():window.innerWidth||this.$window.width()}getScreenHeight(){return this.isAppleDevice()?this.getAppleScreenHeight():window.innerHeight||this.$window.height()}getOperatingSystem(){let os=this.bowser.os.name.toLowerCase()||"";if(os===""){const platform=navigator.platform.toLowerCase();const match=platform.match(/win|mac|linux/);if(match)os=match[0];if(os==="win")os="windows";if(!os)os=""}if(!os)os="platformunknown";return os}getRenderingEngine(){return this.bowser.engine.name||""}onWindowResize(){const previousWidth=this.screenWidth;const previousHeight=this.screenHeight;this.screenWidth=this.getScreenWidth();this.screenHeight=this.getScreenHeight();if(previousWidth===this.screenWidth&&previousHeight===this.screenHeight){return}if(this.orientation){this.$html.removeClass("orientation-landscape orientation-portrait").addClass("orientation-"+this.orientation)}const newScreenSize=this.checkScreenSize();if(newScreenSize!==this.screenSize){this.screenSize=newScreenSize;this.$html.removeClass("size-small size-medium size-large").addClass("size-"+this.screenSize);Adapt$1.trigger("device:changed",this.screenSize)}Adapt$1.trigger("device:preResize device:resize device:postResize",this.screenWidth)}isAppleDevice(){return /iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||navigator.userAgent.match(/Mac/)&&navigator?.maxTouchPoints>2}get shouldReportInvertedAppleScreenSize(){const windowRatio=window.innerWidth/window.innerHeight;const screenRatio=window.screen.width/window.screen.height;const isWindowPortrait=windowRatio<1;const isScreenPortrait=screenRatio<1;const isDeviceBadlyReportingScreenOrientation=isWindowPortrait!==isScreenPortrait;return isDeviceBadlyReportingScreenOrientation}getAppleScreenWidth(){return this.shouldReportInvertedAppleScreenSize?window.screen.height:window.screen.width}getAppleScreenHeight(){return this.shouldReportInvertedAppleScreenSize?window.screen.width:window.screen.height}getAppleDeviceType(){const platformType=this.bowser.platform.type?.toLowerCase()||"";const browserName=this.bowser.browser.name?.toLowerCase()||"";const isIPhone=platformType==="mobile"&&browserName==="safari";const isIPad=platformType==="tablet"&&browserName==="safari";if(isIPhone)return"iphone";if(isIPad)return"ipad";return""}pixelDensity(){const pixelDensity=window.devicePixelRatio||1;if(pixelDensity>=3){return"ultra-high"}else if(pixelDensity>=2){return"high"}else if(pixelDensity>=1.5){return"medium"}else{return"low"}}}const device=new Device;var device$1=__AMD("core/js/device",device);class Location extends Backbone__default["default"].Controller{initialize(){this._previousId=null;this._previousContentType=null;this._previousModel=null;this._previousClasses=null;this._lastVisitedType=null;this._lastVisitedMenu=null;this._lastVisitedPage=null;this._currentId=null;this._currentModel=null;this._currentLocation=null;this._contentType=null}}const location=new Location;var location$1=__AMD("core/js/location",location);var BrowserFocus=__AMD("core/js/a11y/browserFocus",class BrowserFocus extends Backbone.Controller{initialize(_ref){let{a11y}=_ref;this.a11y=a11y;this._onBlur=this._onBlur.bind(this);this._onClick=this._onClick.bind(this);this.$body=$("body");this.listenTo(Adapt$1,{"accessibility:ready":this._attachEventListeners})}_attachEventListeners(){this.$body.on("blur","*",this._onBlur).on("blur",this._onBlur);this.$body[0].addEventListener("click",this._onClick,true)}_onBlur(event){const config=this.a11y.config;if(!config._isEnabled||!config._options._isFocusNextOnDisabled){return}const $element=$(event.target);if($element.is("[data-a11y-force-focus]")){$element.removeAttr("tabindex data-a11y-force-focus")}if(event.target!==event.currentTarget){return}if(!$element.is("[disabled]")&&$element.css("display")!=="none"&&$element.css("visibility")!=="hidden"){return}this.a11y.focusNext($element)}_onClick(event){const $element=$(event.target);const isAriaDisabled=$element.closest("[aria-disabled=true]").length===1;if(isAriaDisabled){event.preventDefault();event.stopImmediatePropagation()}const config=this.a11y.config;if(!config._isEnabled||!config._options._isFocusOnClickEnabled){return}const $stack=$([...$element.toArray(),...$element.parents().toArray()]);const $focusable=$stack.filter(config._options._tabbableElements);if(!$focusable.length){return}$focusable[0].focus()}});var FocusOptions=__AMD("core/js/a11y/focusOptions",class FocusOptions{constructor(){let{preventScroll=false,defer=false}=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.preventScroll=preventScroll;this.defer=defer}});var KeyboardFocusOutline=__AMD("core/js/a11y/keyboardFocusOutline",class KeyboardFocusOutline extends Backbone.Controller{initialize(_ref){let{a11y}=_ref;this.a11y=a11y;this._onKeyDown=this._onKeyDown.bind(this);this.$html=$("html");this.showOnKeys={9:true,13:true,32:true,37:true,38:true,39:true,40:true};this.listenTo(Adapt$1,{"accessibility:ready":this._attachEventListeners})}_attachEventListeners(){document.addEventListener("keydown",this._onKeyDown);this._start()}_start(){const config=this.a11y.config;if(config._options._isFocusOutlineDisabled){this.$html.addClass("a11y-disable-focusoutline");return}if(!config._isEnabled||!config._options._isFocusOutlineKeyboardOnlyEnabled){return}this.$html.addClass("a11y-disable-focusoutline")}_onKeyDown(event){const config=this.a11y.config;if(config._options._isFocusOutlineDisabled){this.$html.addClass("a11y-disable-focusoutline");return}if(!config._isEnabled||!config._options._isFocusOutlineKeyboardOnlyEnabled||!this.showOnKeys[event.keyCode]){return}const $element=$(event.target);if(!$element.is(config._options._tabbableElements)||$element.is(config._options._focusOutlineKeyboardOnlyIgnore)){return}this.$html.removeClass("a11y-disable-focusoutline")}});const LOG_LEVEL=ENUM(["DEBUG","INFO","WARN","ERROR","FATAL"]);var LOG_LEVEL$1=__AMD("core/js/enums/logLevelEnum",LOG_LEVEL);class Logging extends Backbone.Controller{initialize(){this._config={_isEnabled:true,_level:LOG_LEVEL$1.INFO.asLowerCase,_console:true,_warnFirstOnly:true};this._warned={};this.listenToOnce(Adapt$1,"configModel:dataLoaded",this.onLoadConfigData)}onLoadConfigData(){this.loadConfig();this.debug("Logging config loaded");this.trigger("log:ready")}loadConfig(){if(Adapt$1.config.has("_logging")){this._config=Adapt$1.config.get("_logging")}this.checkQueryStringOverride()}checkQueryStringOverride(){const matches=window.location.search.match(/[?&]loglevel=([a-z]*)/i);if(!matches||matches.length<2)return;const override=LOG_LEVEL$1(matches[1].toUpperCase());if(!override)return;this._config._level=override.asLowerCase;this.debug("Loglevel override in query string:",this._config._level)}debug(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}this._log(LOG_LEVEL$1.DEBUG,args)}info(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}this._log(LOG_LEVEL$1.INFO,args)}warn(){for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3]}this._log(LOG_LEVEL$1.WARN,args)}error(){for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++){args[_key4]=arguments[_key4]}this._log(LOG_LEVEL$1.ERROR,args)}fatal(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++){args[_key5]=arguments[_key5]}this._log(LOG_LEVEL$1.FATAL,args)}removed(){for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++){args[_key6]=arguments[_key6]}args=["REMOVED"].concat(args);this.warnOnce(...args)}deprecated(){for(var _len7=arguments.length,args=new Array(_len7),_key7=0;_key7<_len7;_key7++){args[_key7]=arguments[_key7]}args=["DEPRECATED"].concat(args);this.warnOnce(...args)}warnOnce(){for(var _len8=arguments.length,args=new Array(_len8),_key8=0;_key8<_len8;_key8++){args[_key8]=arguments[_key8]}if(this._hasWarned(args)){return}this._log(LOG_LEVEL$1.WARN,args)}_log(level,data){const isEnabled=this._config._isEnabled;if(!isEnabled)return;const configLevel=LOG_LEVEL$1(this._config._level.toUpperCase());const isLogLevelAllowed=level>=configLevel;if(!isLogLevelAllowed)return;this._logToConsole(level,data);this.trigger("log",level,data);this.trigger("log:"+level.asLowerCase,level,data)}_logToConsole(level,data){const shouldLogToConsole=this._config._console;if(!shouldLogToConsole)return;const log=[level.asUpperCase+":"];data&&log.push(...data);if(console[level.asLowerCase]){console[level.asLowerCase](...log)}else{console.log(...log)}}_hasWarned(args){if(!this._config._warnFirstOnly){return false}const hash=args.map(String).join(":");if(this._warned[hash]){return true}this._warned[hash]=true;return false}}const logging=new Logging;var logging$1=__AMD("core/js/logging",logging);var Log=__AMD("core/js/a11y/log",class Log extends Backbone.Controller{initialize(_ref){let{a11y}=_ref;this.a11y=a11y;this._warned={}}_hasWarned(args){const config=this.a11y.config;if(!config._options._warnFirstOnly){return false}const hash=args.map(String).join(":");if(this._warned[hash]){return true}this._warned[hash]=true;return false}_canWarn(){const config=this.a11y.config;return Boolean(config._options._warn)}removed(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}if(!this._canWarn){return}args=["A11Y"].concat(args);if(this._hasWarned(args)){return}logging$1.removed(...args);return this}deprecated(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}if(!this._canWarn){return}args=["A11Y"].concat(args);if(this._hasWarned(args)){return}logging$1.deprecated(...args);return this}});var Scroll=__AMD("core/js/a11y/scroll",class Scroll extends Backbone.Controller{initialize(){this._onTouchStart=this._onTouchStart.bind(this);this._onTouchEnd=this._onTouchEnd.bind(this);this._onScrollEvent=this._onScrollEvent.bind(this);this._onKeyDown=this._onKeyDown.bind(this);this._scrollDisabledElements=$([]);this.$window=$(window);this.$body=$("body");this._preventScrollOnKeys={37:true,38:true,39:true,40:true};this._ignoreKeysOnElementsMatching="textarea, input, select";this._isRunning=false;this._touchStartEventObject=null}disable($elements){$elements=$($elements);this._scrollDisabledElements=this._scrollDisabledElements.add($elements);this._checkRunning();return this}enable($elements){$elements=$($elements);if(!$elements.length){this.clear();return this}this._scrollDisabledElements=this._scrollDisabledElements.not($elements);this._checkRunning();return this}clear(){this._scrollDisabledElements=$([]);this._checkRunning();return this}_checkRunning(){if(!this._scrollDisabledElements.length){this._stop();return}this._start()}_start(){if(this._isRunning){return}this._isRunning=true;window.addEventListener("touchstart",this._onTouchStart);window.addEventListener("touchend",this._onTouchEnd);window.addEventListener("touchmove",this._onScrollEvent,{passive:false});window.addEventListener("wheel",this._onScrollEvent,{passive:false});document.addEventListener("wheel",this._onScrollEvent,{passive:false});document.addEventListener("keydown",this._onKeyDown)}_onTouchStart(event){event=$.event.fix(event);this._touchStartEventObject=event;return true}_onTouchEnd(){this._touchStartEventObject=null;return true}_onScrollEvent(event){event=$.event.fix(event);return this._preventScroll(event)}_onKeyDown(event){event=$.event.fix(event);if(!this._preventScrollOnKeys[event.keyCode]){return}const $target=$(event.target);if($target.is(this._ignoreKeysOnElementsMatching)){return}return this._preventScroll(event)}_preventScroll(event){const isGesture=event.touches?.length>1;if(isGesture){return}const $target=$(event.target);if(this._scrollDisabledElements.length){const scrollingParent=this._getScrollingParent(event,$target);if(scrollingParent.filter(this._scrollDisabledElements).length===0){this.$window.scroll();return}}event.preventDefault();return false}_getScrollingParent(event,$target){const isTouchEvent=event.type==="touchmove";const hasTouchStartEvent=this._touchStartEventObject?.originalEvent;if(isTouchEvent&&!hasTouchStartEvent){return $target}const directionY=this._getScrollDirection(event);if(directionY==="none"){return this.$body}const parents=[$target[0],...$target.parents()];for(let i=0,l=parents.length;i<l;i++){const $parent=$(parents[i]);if($parent.is("body")){return this.$body}if(!this._isScrollable($parent)){continue}if(!this._isScrolling($parent,directionY)){continue}return $parent}return this.$body}_isScrollable($target){const scrollType=$target.css("overflow-y");if(scrollType!=="auto"&&scrollType!=="scroll"){return false}const pointerEvents=$target.css("pointer-events");if(pointerEvents==="none"){return false}return true}_isScrolling($target,directionY){const scrollTop=Math.ceil($target.scrollTop());const innerHeight=$target.outerHeight();const scrollHeight=$target[0].scrollHeight;let hasScrollingSpace=false;switch(directionY){case"down":hasScrollingSpace=scrollTop+innerHeight<scrollHeight;if(hasScrollingSpace){return true}break;case"up":hasScrollingSpace=scrollTop>0;if(hasScrollingSpace){return true}break;}return false}_getScrollDirection(event){const deltaY=this._getScrollDelta(event);if(deltaY===0){return"none"}return deltaY>0?"up":"down"}_getScrollDelta(event){let deltaY=0;const isTouchEvent=event.type==="touchmove";const originalEvent=event.originalEvent;if(isTouchEvent){const startOriginalEvent=this._touchStartEventObject.originalEvent;let currentY=originalEvent.pageY;let previousY=startOriginalEvent.pageY;if(currentY===0||currentY===previousY){currentY=originalEvent.touches[0].pageY;previousY=startOriginalEvent.touches[0].pageY}deltaY=currentY-previousY}else{const hasDeltaY=originalEvent.wheelDeltaY||originalEvent.deltaY!==undefined;if(hasDeltaY){deltaY=-originalEvent.deltaY}else{deltaY=originalEvent.wheelDelta||0}}return deltaY}_stop(){if(!this._isRunning){return}this._isRunning=false;window.removeEventListener("touchstart",this._onTouchStart);window.removeEventListener("touchend",this._onTouchEnd);window.removeEventListener("touchmove",this._onScrollEvent,{passive:false});window.removeEventListener("wheel",this._onScrollEvent,{passive:false});document.removeEventListener("wheel",this._onScrollEvent,{passive:false});document.removeEventListener("keydown",this._onKeyDown)}});var WrapFocus=__AMD("core/js/a11y/wrapFocus",class WrapFocus extends Backbone.Controller{initialize(_ref){let{a11y}=_ref;this.a11y=a11y;_.bindAll(this,"_onWrapAround");this.listenTo(Adapt$1,{"accessibility:ready":this._attachEventListeners})}_attachEventListeners(){const config=this.a11y.config;$("body").on("click focus",config._options._focusguard,this._onWrapAround)}_onWrapAround(event){const config=this.a11y.config;if(!config._isEnabled||!config._options._isPopupWrapFocusEnabled){return}event.preventDefault();event.stopPropagation();this.a11y.focusFirst("body",{defer:false})}});var Popup=__AMD("core/js/a11y/popup",class Popup extends Backbone.Controller{initialize(_ref){let{a11y}=_ref;this.a11y=a11y;this._floorStack=[$("body")];this._focusStack=[];this._tabIndexes={};this._ariaHiddens={};this._elementUIDIndex=0;this.listenTo(Adapt$1,{"popup:opened"($element,ignoreInternalTrigger){if(ignoreInternalTrigger){return}this.a11y.log.deprecated("Adapt.trigger(\"popup:opened\", $element) is replaced with a11y.popupOpened($element);");this.opened($element,true)},"popup:closed"($target,ignoreInternalTrigger){if(ignoreInternalTrigger){return}this.a11y.log.deprecated("Adapt.trigger(\"popup:closed\", $target) is replaced with a11y.popupClosed($target);");this.closed($target,true)}})}opened($popupElement,silent){$popupElement=$popupElement||$(document.activeElement);this._addPopupLayer($popupElement);if(!silent){Adapt$1.trigger("popup:opened",$popupElement,true)}return this}_addPopupLayer($popupElement){$popupElement=$($popupElement);const config=this.a11y.config;if(!config._isEnabled||!config._options._isPopupManagementEnabled||$popupElement.length===0){return $popupElement}this._floorStack.push($popupElement);this._focusStack.push($(document.activeElement));let $elements=$(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes);const $branch=$popupElement.add($popupElement.parents());const $siblings=$branch.siblings().filter(config._options._tabbableElementsExcludes);$elements=$elements.add($siblings);$elements.each((index,item)=>{const $item=$(item);if(typeof item.a11y_uid==="undefined"){item.a11y_uid="UID"+ ++this._elementUIDIndex}const elementUID=item.a11y_uid;if(this._tabIndexes[elementUID]===undefined){this._tabIndexes[elementUID]=[]}if(this._ariaHiddens[elementUID]===undefined){this._ariaHiddens[elementUID]=[]}const tabindex=$item.attr("tabindex");const ariaHidden=$item.attr("aria-hidden");this._tabIndexes[elementUID].push(tabindex===undefined?"":tabindex);this._ariaHiddens[elementUID].push(ariaHidden===undefined?"":ariaHidden);if(config._options._isPopupTabIndexManagementEnabled){$item.attr("tabindex",-1)}if(config._options._isPopupAriaHiddenManagementEnabled){$item.attr("aria-hidden",true)}});const $items=$popupElement.find(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes);if(config._options._isPopupTabIndexManagementEnabled){$items.attr("tabindex",0)}if(config._options._isPopupAriaHiddenManagementEnabled){$items.removeAttr("aria-hidden").removeClass("aria-hidden").parents(config._options._ariaHiddenExcludes).removeAttr("aria-hidden").removeClass("aria-hidden")}}closed($focusElement,silent){const $previousFocusElement=this._removeLastPopupLayer();$focusElement=$focusElement||$previousFocusElement||$("body");if(!silent){Adapt$1.trigger("popup:closed",$focusElement,true)}this.a11y.focusFirst($($focusElement),{preventScroll:true});return this}_removeLastPopupLayer(){const config=this.a11y.config;if(!config._isEnabled||!config._options._isPopupManagementEnabled){return $(document.activeElement)}if(this._floorStack.length<=1){return}this._floorStack.pop();$(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes).each((index,item)=>{const $item=$(item);let previousTabIndex="";let previousAriaHidden="";if(typeof item.a11y_uid==="undefined"){item.a11y_uid="UID"+ ++this._elementUIDIndex}const elementUID=item.a11y_uid;if(this._tabIndexes[elementUID]?.length){previousTabIndex=this._tabIndexes[elementUID].pop();previousAriaHidden=this._ariaHiddens[elementUID].pop()}if(this._tabIndexes[elementUID]?.length){delete this._tabIndexes[elementUID];delete this._ariaHiddens[elementUID]}if(config._options._isPopupTabIndexManagementEnabled){if(previousTabIndex===""){$item.removeAttr("tabindex")}else{$item.attr({tabindex:previousTabIndex})}}if(config._options._isPopupAriaHiddenManagementEnabled){if(previousAriaHidden===""){$item.removeAttr("aria-hidden")}else{$item.attr({"aria-hidden":previousAriaHidden})}}});return this._focusStack.pop()}setCloseTo($focusElement){const $original=this._focusStack.pop();this._focusStack.push($focusElement);return $original}});var defaultAriaLevels=__AMD("core/js/enums/defaultAriaLevels",{_menu:1,_menuGroup:2,_menuItem:2,_page:1,_article:2,_block:3,_component:4,_componentItem:5,_notify:1});var deprecated=__AMD("core/js/a11y/deprecated",function(a11y){Object.assign($.fn,{isFixedPostion(){a11y.log.removed("$(\"..\").isFixedPostion was unneeded and has been removed, let us know if you need it back.");return false},a11y_aria_label(){a11y.log.removed("$(\"..\").a11y_aria_label was incorrect behaviour.");return this},limitedScrollTo(){a11y.log.removed("$.limitedScrollTo had no impact on the screen reader cursor.");return this},a11y_text(){a11y.log.removed("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return this},a11y_selected(){a11y.log.removed("$(\"..\").a11y_selected is removed. Please use aria-live instead.");return this},a11y_on(isOn){a11y.log.deprecated("$(\"..\").a11y_on, use a11y.findTabbable($element); and a11y.toggleAccessible($elements, isAccessible); instead.");const $tabbable=a11y.findTabbable(this);a11y.toggleAccessible($tabbable,isOn);return this},a11y_only(){a11y.log.removed("$(\"..\").a11y_only, use a11y.popupOpened($popupElement); instead.");return this},scrollDisable(){if(a11y.config._options._isScrollDisableEnabled===false){return this}a11y.log.deprecated("$(\"..\").scrollDisable, use a11y.scrollDisable($elements); instead.");a11y.scrollDisable(this);return this},scrollEnable(){if(a11y.config._options._isScrollDisableEnabled===false){return this}a11y.log.deprecated("$(\"..\").scrollEnable, use a11y.scrollEnable($elements); instead.");a11y.scrollEnable(this);return this},a11y_popup(){a11y.log.deprecated("$(\"..\").a11y_popup, use a11y.popupOpened($popupElement); instead.");return a11y.popupOpened(this)},a11y_cntrl(isOn,withDisabled){a11y.log.deprecated("$(\"..\").a11y_cntrl, use a11y.toggleAccessible($elements, isAccessible); and if needed a11y.toggleEnabled($elements, isEnabled); instead.");a11y.toggleAccessible(this,isOn);if(withDisabled)a11y.toggleEnabled(this,isOn);return this},a11y_cntrl_enabled(isOn){a11y.log.deprecated("$(\"..\").a11y_cntrl_enabled, use a11y.toggleAccessibleEnabled($elements, isAccessibleEnabled); instead.");a11y.toggleAccessibleEnabled(this,isOn);return this},isReadable(){a11y.log.deprecated("$(\"..\").isReadable, use a11y.isReadable($element); instead.");return a11y.isReadable(this)},findForward(selector){a11y.log.removed("$(\"..\").findForward has been removed as the use cases are very small, let us know if you need it back.");return a11y._findFirstForward(this,selector)},findWalk(selector){a11y.log.removed("$(\"..\").findWalk has been removed as the use cases are very small, let us know if you need it back.");return a11y._findFindForwardDescendant(this,selector)},focusNoScroll(){a11y.log.deprecated("$(\"..\").focusNoScroll, use a11y.focus($element); instead.");return a11y.focus(this)},focusNext(returnOnly){a11y.log.deprecated("$(\"..\").focusNext, use a11y.focusNext($element); or if needed a11y.findFirstReadable($element); instead.");if(returnOnly){return a11y.findFirstReadable(this)}return a11y.focusNext(this)},focusOrNext(returnOnly){a11y.log.deprecated("$(\"..\").focusOrNext, use a11y.focusFirst($element); or if needed a11y.findFirstReadable($element); or a11y.isReadable($element); instead.");if(returnOnly){if(a11y.isReadable(this))return this;return a11y.findFirstReadable(this)}return a11y.focusFirst(this)},a11y_focus(dontDefer){a11y.log.deprecated("$(\"..\").a11y_focus, use a11y.focusFirst($element, { defer: true }); instead.");a11y.focusFirst(this,{defer:!dontDefer});return this}});Object.assign($,{a11y_alert(){a11y.log.removed("$.a11y_alert is removed. Please use aria-live instead.");return this},a11y_update(){a11y.log.removed("a11y_update is no longer required.");return this},a11y_text(text){a11y.log.removed("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return text},a11y_on(isOn,selector){a11y.log.deprecated("$(\"..\").a11y_on, use a11y.toggleHidden($elements, isHidden); instead.");return a11y.toggleHidden(selector,!isOn)},a11y_popdown($focusTarget){a11y.log.removed("$.a11y_popdown, use a11y.popupClosed($focusTarget); instead.");return a11y.popupClosed($focusTarget)},a11y_focus(dontDefer){a11y.log.deprecated("$.a11y_focus, use a11y.focusFirst(\"body\", { defer: true }); instead.");a11y.focusFirst("body",{defer:!dontDefer});return this},a11y_normalize(html){a11y.log.deprecated("$.a11y_normalize, use a11y.normalize(\"html\"); instead.");return a11y.normalize(html)},a11y_remove_breaks(html){a11y.log.deprecated("$.a11y_remove_breaks, use a11y.removeBreaks(\"html\"); instead.");return a11y.removeBreaks(html)}})});class A11y extends Backbone.Controller{defaults(){return{_isFocusOutlineKeyboardOnlyEnabled:true,_isFocusOutlineDisabled:false,_isFocusAssignmentEnabled:true,_isFocusOnClickEnabled:true,_isFocusNextOnDisabled:true,_isScrollDisableEnabled:true,_isAriaHiddenManagementEnabled:true,_isPopupManagementEnabled:true,_isPopupWrapFocusEnabled:true,_isPopupAriaHiddenManagementEnabled:true,_isPopupTabIndexManagementEnabled:true,_ariaHiddenExcludes:":not(#wrapper):not(body)",_tabbableElements:"a,button,input,select,textarea,[tabindex]:not([data-a11y-force-focus])",_focusOutlineKeyboardOnlyIgnore:"input,textarea",_tabbableElementsExcludes:":not(.a11y-ignore):not([data-a11y-force-focus])",_focusableElements:"a,button,input,select,textarea,[tabindex],label",_readableElements:"[role=heading],[aria-label],[aria-labelledby],[alt]",_focusForwardElementsExcludes:":not([aria-labelledby][role=dialog],[aria-labelledby][role=main],[aria-labelledby][role=region],[aria-labelledby][role=radiogroup],[aria-labelledby][role=group],[aria-labelledby][role=tablist],[aria-labelledby][role=list],[aria-labelledby][role=tree],[aria-labelledby][role=treegrid],[aria-labelledby][role=table],[aria-labelledby][role=grid][aria-labelledby],[role=menu],[aria-labelledby][role=rowgroup])",_focusguard:".a11y-focusguard",_wrapStyleElements:"b,i,abbr,strong,em,small,sub,sup,ins,del,mark,zw,nb",_warnFirstOnly:true,_warn:true}}initialize(){this.isFocusable=this.isFocusable.bind(this);this.isReadable=this.isReadable.bind(this);this.isTabbable=this.isTabbable.bind(this);this.$html=$("html");this._htmlCharRegex=/&.*;/g;this.config=null;this._browserFocus=new BrowserFocus({a11y:this});this._keyboardFocusOutline=new KeyboardFocusOutline({a11y:this});this._wrapFocus=new WrapFocus({a11y:this});this._popup=new Popup({a11y:this});this._scroll=new Scroll({a11y:this});this.log=new Log({a11y:this});deprecated(this);this._removeLegacyElements();this.listenToOnce(Adapt$1,{"configModel:dataLoaded":this._onConfigDataLoaded,"navigationView:postRender":this._removeLegacyElements},this);Adapt$1.on("device:changed",this._setupNoSelect);this.listenTo(Adapt$1,{"router:location":this._onNavigationStart,"contentObjectView:ready router:plugin":this._onNavigationEnd})}_onConfigDataLoaded(){this.config=Adapt$1.config.get("_accessibility");this.config._isActive=false;this.config._options=_.defaults(this.config._options||{},this.defaults());offlineStorage$1.set("a11y",false);this.$html.toggleClass("has-accessibility",this.isEnabled());this._setupNoSelect();this._addFocuserDiv();if(this._isReady){return}this._isReady=true;Adapt$1.trigger("accessibility:ready")}_setupNoSelect(){if(!this.config?._disableTextSelectOnClasses){return}const classes=this.config._disableTextSelectOnClasses.split(" ");const isMatch=classes.some(className=>this.$html.is(className));this.$html.toggleClass("u-no-select",isMatch)}_addFocuserDiv(){if($("#a11y-focuser").length){return}$("body").append($("<div id=\"a11y-focuser\" class=\"a11y-ignore\" tabindex=\"-1\">&nbsp;</div>"))}_removeLegacyElements(){const $legacyElements=$("body").children("#accessibility-toggle, #accessibility-instructions");const $navigationElements=$(".nav").find("#accessibility-toggle, #accessibility-instructions");if(!$legacyElements.length&&!$navigationElements.length){return}logging$1.warn("REMOVED: #accessibility-toggle and #accessibility-instructions have been removed. Please remove them from all of your .html files.");$legacyElements.remove();$navigationElements.remove()}_onNavigationStart(){if(!this.isEnabled()){return}_.defer(()=>this.toggleHidden(".contentobject",true))}_onNavigationEnd(view){if(view?.model?.get("_id")!==location$1._currentId||!this.isEnabled()){return}this.toggleHidden(".contentobject",false)}isActive(){this.log.removed("Accessibility is now always active when enabled. Please unify your user experiences.");return false}isEnabled(){return this.config?._isEnabled}ariaLevel(){let defaultLevelOrType=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;let overrideLevelOrType=arguments.length>1?arguments[1]:undefined;const cfg=Adapt$1.config.get("_accessibility");if(overrideLevelOrType){defaultLevelOrType=overrideLevelOrType}if(!isNaN(defaultLevelOrType)){return defaultLevelOrType}if(_.isString(defaultLevelOrType)){const ariaLevels=cfg._ariaLevels??defaultAriaLevels;return ariaLevels?.["_"+defaultLevelOrType]??defaultLevelOrType}return defaultLevelOrType}toggleHidden($elements){let isHidden=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;$elements=$($elements);const config=this.config;if(!config._isEnabled||!config._options._isAriaHiddenManagementEnabled){return this}if(isHidden===true){$elements.attr("aria-hidden",true)}else{$elements.removeAttr("aria-hidden")}return this}toggleAccessibleEnabled($elements,isAccessibleEnabled){this.toggleAccessible($elements,isAccessibleEnabled);this.toggleEnabled($elements,isAccessibleEnabled);return this}toggleAccessible($elements){let isReadable=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;$elements=$($elements);const config=this.config;if(!config._isEnabled||!config._options._isAriaHiddenManagementEnabled||$elements.length===0){return this}if(!isReadable){$elements.attr({tabindex:"-1","aria-hidden":"true"}).addClass("aria-hidden")}else{$elements.removeAttr("aria-hidden tabindex").removeClass("aria-hidden");$elements.parents(config._options._ariaHiddenExcludes).removeAttr("aria-hidden").removeClass("aria-hidden")}return this}toggleEnabled($elements){let isEnabled=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;$elements=$($elements);if($elements.length===0){return this}if(!isEnabled){$elements.attr({tabindex:"-1","aria-disabled":"true"}).addClass("is-disabled")}else{$elements.removeAttr("aria-disabled tabindex").removeClass("is-disabled")}return this}toggleTabbableDescendants($element){let isTabbable=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;const $tabbable=this.findTabbable($element);if(!isTabbable){$tabbable.each((index,element)=>{if(element.isAdaptTabHidden)return;const $element=$(element);element.isAdaptTabHidden=true;element.adaptPreviousTabIndex=$element.attr("tabindex")??null;$element.attr("tabindex",-1)});return this}$tabbable.each((index,element)=>{if(!element.isAdaptTabHidden)return;const $element=$(element);if(element.adaptPreviousTabIndex===null)$element.removeAttr("tabindex");else $element.attr("tabindex",element.adaptPreviousTabIndex);delete element.isAdaptTabHidden;delete element.adaptPreviousTabIndex});return this}findFirstTabbable($element){$element=$($element).first();return this._findFirstForward($element,this.isTabbable)}findFirstReadable($element){$element=$($element).first();return this._findFirstForward($element,this.isReadable)}findFirstFocusable($element){$element=$($element).first();return this._findFirstForward($element,this.isFocusable)}findTabbable($element){const config=this.config;return $($element).find(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes)}findReadable($element){return $($element).find("*").filter((index,element)=>this.isReadable(element))}findFocusable($element){return $($element).find("*").filter((index,element)=>this.isFocusable(element))}isTabbable($element){const config=this.config;const value=$($element).is(config._options._tabbableElements).is(config._options._tabbableElementsExcludes);if(!value){return null}return value}isReadable($element){let checkParents=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;const config=this.config;$element=$($element).first();const $branch=checkParents?$element.add($element.parents()):$element;const isNotVisible=$branch.toArray().some(item=>{const $item=$(item);return $item.css("display")==="none"||$item.css("visibility")==="hidden"||$item.attr("aria-hidden")==="true"});if(isNotVisible){return false}const hasReadableContent=!/^\s*$/.test($element.text())||!/^\s*$/.test($element.attr("aria-label")??"")||!/^\s*$/.test($element.attr("aria-labelledby")??"");const hasNativeFocusOrIsScreenReadable=($element.is(config._options._focusableElements)||$element.is(config._options._readableElements))&&hasReadableContent;if(hasNativeFocusOrIsScreenReadable){return true}const childNodes=$element[0].childNodes;for(let c=0,cl=childNodes.length;c<cl;c++){const childNode=childNodes[c];const isTextNode=childNode.nodeType===3;if(!isTextNode){continue}const isOnlyWhiteSpace=/^\s*$/.test(childNode.nodeValue);if(isOnlyWhiteSpace){continue}return true}return null}isFocusable($element){let checkParents=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;const config=this.config;$element=$($element).first();if(!$element.is(config._options._focusForwardElementsExcludes))return null;return this.isReadable($element,checkParents)}_findFirstForward($element,selector){$element=$($element).first();let iterator;switch(typeof selector){case"string":iterator=function($tag){return $tag.is(selector)||undefined};break;case"function":iterator=selector;break;case"undefined":iterator=Boolean;}if($element.length===0){return $element.not("*")}let $found=this._findFirstForwardDescendant($element,iterator);if($found.length){return $found}$element.nextAll().toArray().some(sibling=>{const $sibling=$(sibling);const value=iterator($sibling);if(value===false){return false}if(value){$found=$sibling;return true}$found=this._findFirstForwardDescendant($sibling,iterator);return Boolean($found.length)});if($found.length){return $found}$element.add($element.parents()).toArray().reverse().some(parent=>{const $parent=$(parent);if(iterator($parent)===false){return false}return $parent.nextAll().toArray().some(sibling=>{const $sibling=$(sibling);const value=iterator($sibling);if(value===false){return false}if(value){$found=$sibling;return true}$found=this._findFirstForwardDescendant($sibling,iterator);return Boolean($found.length)})});if(!$found.length){return $element.not("*")}return $found}_findFirstForwardDescendant($element,selector){$element=$($element).first();let iterator;switch(typeof selector){case"string":iterator=function($tag){return $tag.is(selector)||undefined};break;case"function":iterator=selector;break;case"undefined":iterator=Boolean;}const $notFound=$element.not("*");if($element.length===0){return $notFound}const stack=[{item:$element[0],value:undefined}];let stackIndexPosition=0;let childIndexPosition=stackIndexPosition+1;do{const stackEntry=stack[stackIndexPosition];const $stackItem=$(stackEntry.item);switch(stackEntry.value){case true:return $stackItem;case false:return $notFound;}$stackItem.children().toArray().forEach(item=>{const $item=$(item);const value=iterator($item);if(value===false){return}stack.splice(childIndexPosition++,0,{item:item,value:value})});stackIndexPosition++;childIndexPosition=stackIndexPosition+1}while(stackIndexPosition<stack.length);return $notFound}focusNext($element,options){options=new FocusOptions(options);$element=$($element).first();$element=this.findFirstFocusable($element);this.focus($element,options);return this}focusFirst($element,options){options=new FocusOptions(options);$element=$($element).first();if(this.isReadable($element)){this.focus($element,options);return $element}$element=this.findFirstFocusable($element);this.focus($element,options);return $element}focus($element,options){options=new FocusOptions(options);$element=$($element).first();const config=this.config;if(!config._isEnabled||!config._options._isFocusAssignmentEnabled||$element.length===0){return this}function perform(){if($element.attr("tabindex")===undefined){$element.attr({tabindex:"0","data-a11y-force-focus":"true"})}if(options.preventScroll){const y=$(window).scrollTop();try{$element[0].focus({preventScroll:true})}catch(e){}switch(device$1.browser){case"internet explorer":case"microsoft edge":case"safari":window.scrollTo(null,y);}}else{$element[0].focus()}}if(options.defer){_.defer(perform)}else{perform()}return this}normalize(htmls){htmls=[...arguments].filter(Boolean).filter(_.isString).join(" ");const text=$("<div>"+htmls+"</div>").text();return text.replace(this._htmlCharRegex,"")}removeBreaks(htmls){htmls=[...arguments].filter(Boolean).filter(_.isString).join(" ");const $div=$("<div>"+htmls+"</div>");const stack=[$div[0]];let stackIndex=0;const outputs=[];do{if(stack[stackIndex].childNodes.length){const nodes=stack[stackIndex].childNodes;const usable=nodes.filter(node=>{const isTextNode=node.nodeType===3;if(isTextNode){return true}const isStyleElement=$(node).is(this.config._options._wrapStyleElements);if(isStyleElement){return true}return false});outputs.push.apply(outputs,usable);stack.push.apply(stack,nodes)}stackIndex++}while(stackIndex<stack.length);let rtnText="";outputs.forEach(function(item){rtnText+=item.outerHTML||item.textContent});return rtnText}scrollEnable($elements){this._scroll.enable($elements);return this}scrollDisable($elements){this._scroll.disable($elements);return this}popupOpened($popupElement){this._popup.opened($popupElement);return this}popupClosed($focusElement){this._popup.closed($focusElement);return this}setPopupCloseTo($focusElement){return this._popup.setCloseTo($focusElement)}}const a11y=new A11y;var a11y$1=__AMD("core/js/a11y",a11y);class Components extends Backbone__default["default"].Controller{initialize(){this._register={};this.register=this.register.bind(this);this.getViewName=this.getViewName.bind(this);this.getViewClass=this.getViewClass.bind(this);this.getModelName=this.getModelName.bind(this);this.getModelClass=this.getModelClass.bind(this)}register(name,object){if(Array.isArray(name)){name.forEach(name=>this.register(name,object));return object}if(name.split(" ").length>1){this.register(name.split(" "),object);return object}if(!object.view&&!object.model||object instanceof Backbone__default["default"].View){logging$1.deprecated("View-only registrations are no longer supported");object={view:object}}if(object.view&&!object.view.template){object.view.template=name}const isModelSetAndInvalid=object.model&&!(object.model.prototype instanceof Backbone__default["default"].Model)&&!(object.model instanceof Function);if(isModelSetAndInvalid){throw new Error("The registered model is not a Backbone.Model or Function")}const isViewSetAndInvalid=object.view&&!(object.view.prototype instanceof Backbone__default["default"].View)&&!(object.view instanceof Function);if(isViewSetAndInvalid){throw new Error("The registered view is not a Backbone.View or Function")}this._register[name]=Object.assign({},this._register[name],object);return object}getViewName(nameModelViewOrData){if(typeof nameModelViewOrData==="string"){return nameModelViewOrData}if(nameModelViewOrData instanceof Backbone__default["default"].Model){nameModelViewOrData=nameModelViewOrData.toJSON()}if(nameModelViewOrData instanceof Backbone__default["default"].View){let foundName;Object.entries(this._register).forEach(_ref=>{let[key,entry]=_ref;if(!entry?.view)return;if(!(nameModelViewOrData instanceof entry.view))return;foundName=key;return true});return foundName}if(nameModelViewOrData instanceof Object){const names=[typeof nameModelViewOrData._view==="string"&&nameModelViewOrData._view,typeof nameModelViewOrData._component==="string"&&nameModelViewOrData._component,typeof nameModelViewOrData._type==="string"&&nameModelViewOrData._type].filter(Boolean);if(names.length){const name=names.find(name=>this._register[name]?.view);return name||names.pop()}}throw new Error("Cannot derive view class name from input")}getViewClass(nameModelViewOrData){const name=this.getViewName(nameModelViewOrData);const object=this._register[name];if(!object){logging$1.warnOnce(`A view for '${name}' isn't registered in your project`);return}const isBackboneView=object.view?.prototype instanceof Backbone__default["default"].View;if(!isBackboneView&&object.view instanceof Function){return object.view()}return object.view}getModelName(nameModelOrData){if(typeof nameModelOrData==="string"){return nameModelOrData}if(nameModelOrData instanceof Backbone__default["default"].Model){nameModelOrData=nameModelOrData.toJSON()}if(nameModelOrData instanceof Object){const name=nameModelOrData._component;const entry=this._register[name];const isViewOnlyQuestion=entry&&!entry.model&&entry.view?._isQuestionType;if(isViewOnlyQuestion){logging$1.deprecated(`Assuming a question model for a view-only question: ${name}`);return"question"}const names=[typeof nameModelOrData._model==="string"&&nameModelOrData._model,typeof nameModelOrData._component==="string"&&nameModelOrData._component,typeof nameModelOrData._type==="string"&&nameModelOrData._type].filter(Boolean);if(names.length){const name=names.find(name=>this._register[name]?.model);return name||names.pop()}}throw new Error("Cannot derive model class name from input")}getModelClass(nameModelOrData){const name=this.getModelName(nameModelOrData);const object=this._register[name];if(!object){logging$1.warnOnce(`A model for '${name}' isn't registered in your project`);return}const isBackboneModel=object.model?.prototype instanceof Backbone__default["default"].Model;if(!isBackboneModel&&object.model instanceof Function){return object.model()}return object.model}}const components=new Components;var components$1=__AMD("core/js/components",components);var AdaptCollection=__AMD("core/js/collections/adaptCollection",class AdaptCollection extends Backbone.Collection{initialize(models,options){this.once("reset",this.loadedData,this)}loadedData(){Adapt$1.trigger("adaptCollection:dataLoaded")}});var BuildModel=__AMD("core/js/models/buildModel",class BuildModel extends LockingModel{defaults(){return{jsonext:"json"}}initialize(attrs,options){this.url=options.url;this.fetch({success:()=>{this.isLoaded=true;Adapt$1.trigger("buildModel:dataLoaded")},error:()=>{console.log("Unable to load adapt/js/build.js");Adapt$1.trigger("buildModel:dataLoaded")}})}isFrameworkVersion(version){return semver__default["default"].satisfies(this.get("package").version,version,{includePrerelease:true})}isPluginInstalled(name){let version=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"*";const plugin=this.get("plugins").find(plugin=>{if(plugin.name!==name)return false;return semver__default["default"].satisfies(plugin.version,version,{includePrerelease:true})});return Boolean(plugin)}whenReady(){if(this.isLoaded)return Promise.resolve();return new Promise(resolve=>{Adapt$1.once("buildModel:dataLoaded",resolve)})}});var ConfigModel=__AMD("core/js/models/configModel",class ConfigModel extends LockingModel{defaults(){return{screenSize:{large:900,medium:760,small:520},_forceRouteLocking:false,_canLoadData:true,_disableAnimation:false}}setValuesFromURLParams(){const paramMappings={dir:"_defaultDirection",lang:"_defaultLanguage"};const params=new URLSearchParams(window.location.search);Object.entries(paramMappings).forEach(_ref=>{let[key,value]=_ref;const passedVal=params.get(key);if(!passedVal)return;if(key==="lang"&&Adapt$1.build.get("availableLanguageNames")?.includes(passedVal)===false)return;this.set(value,passedVal)})}initialize(attrs,options){this.url=options.url;this.fetch({success:()=>{this.setValuesFromURLParams();Adapt$1.trigger("offlineStorage:prepare");wait$1.queue(()=>{Adapt$1.trigger("configModel:dataLoaded");if(!this.get("_canLoadData"))return;Adapt$1.trigger("configModel:loadCourseData")})},error:()=>console.log("Unable to load course/config.json")})}loadData(){}});class Data$1 extends AdaptCollection{model(json){const ModelClass=components$1.getModelClass(json);if(!ModelClass){return new LockingModel(json)}return new ModelClass(json,{parse:true})}initialize(){super.initialize();this.findById=this.findById.bind(this);this.findViewByModelId=this.findViewByModelId.bind(this);this.findByTrackingPosition=this.findByTrackingPosition.bind(this);this.on({add:this.onAdded,remove:this.onRemoved})}async init(){this.reset();this._byAdaptID={};Adapt$1.build=new BuildModel(null,{url:"adapt/js/build.min.js",reset:true});await Adapt$1.build.whenReady();$("html").attr("data-adapt-framework-version",Adapt$1.build.get("package").version);this.loadConfigData()}onAdded(model){this._byAdaptID[model.get("_id")]=model}onRemoved(model){delete this._byAdaptID[model.get("_id")]}loadConfigData(){Adapt$1.config=new ConfigModel(null,{url:Adapt$1.build.get("coursedir")+"/config."+Adapt$1.build.get("jsonext"),reset:true});this.listenToOnce(Adapt$1,"configModel:loadCourseData",this.onLoadCourseData);this.listenTo(Adapt$1.config,{"change:_activeLanguage":this.onLanguageChange,"change:_defaultDirection":this.onDirectionChange})}onDirectionChange(model,direction){if(direction==="rtl"){$("html").removeClass("dir-ltr").addClass("dir-rtl").attr("dir","rtl")}else{$("html").removeClass("dir-rtl").addClass("dir-ltr").attr("dir","ltr")}}onLoadCourseData(){if(!Adapt$1.config.get("_activeLanguage")){Adapt$1.config.set("_activeLanguage",Adapt$1.config.get("_defaultLanguage"));return}this.loadCourseData()}async onLanguageChange(model,language){await wait$1.queue();offlineStorage$1.set("lang",language);if(Adapt$1.get("_isStarted")){Adapt$1.set("_isStarted",false)}this.loadCourseData(language)}async loadCourseData(newLanguage){const language=Adapt$1.config.get("_activeLanguage");const courseFolder=Adapt$1.build.get("coursedir")+"/"+language+"/";$("html").attr("lang",language);await this.loadManifestFiles(courseFolder);await this.triggerDataLoaded();await this.triggerDataReady(newLanguage);this.triggerInit()}getJSON(path){return new Promise((resolve,reject)=>{$.getJSON(path,data=>{data.__path__=path;resolve(data)}).fail(reject)})}async loadManifestFiles(languagePath){this.trigger("loading");this.reset();const manifestPath=languagePath+"language_data_manifest.js";let manifest;try{manifest=await this.getJSON(manifestPath)}catch(err){manifest=["course.json","contentObjects.json","articles.json","blocks.json","components.json"];logging$1.warnOnce(`Manifest path '${manifestPath} not found. Using traditional files: ${manifest.join(", ")}`)}const allFileData=await Promise.all(manifest.map(filePath=>{return this.getJSON(`${languagePath}${filePath}`)}));const allModelData=allFileData.reduce((result,fileData)=>{if(Array.isArray(fileData)){result.push(...fileData)}else if(fileData instanceof Object){result.push(fileData)}else{logging$1.warnOnce(`File data isn't an array or object: ${fileData.__path__}`)}return result},[]);const course=allModelData.find(modelData=>modelData._type==="course");if(!course){throw new Error("Expected a model data with \"_type\": \"course\", none found.")}Adapt$1.trigger("courseModel:dataLoading");Adapt$1.course=this.push(course);Adapt$1.trigger("courseModel:dataLoaded");allModelData.forEach(modelData=>{if(modelData._type==="course"){return}this.push(modelData)});this.trigger("reset");this.trigger("loaded");await wait$1.queue()}async triggerDataLoaded(){logging$1.debug("Firing app:dataLoaded");try{this.forEach(model=>model.setupModel?.());Adapt$1.trigger("app:dataLoaded")}catch(e){logging$1.error("Error during app:dataLoading trigger",e)}await wait$1.queue()}async triggerDataReady(newLanguage){if(newLanguage){Adapt$1.trigger("app:languageChanged",newLanguage);await wait$1.queue()}logging$1.debug("Firing app:dataReady");try{Adapt$1.trigger("app:dataReady")}catch(e){logging$1.error("Error during app:dataReady trigger",e)}await wait$1.queue()}triggerInit(){this.isReady=true;this.trigger("ready")}whenReady(){if(this.isReady)return Promise.resolve();return new Promise(resolve=>{this.once("ready",resolve)})}hasId(id){return Boolean(this._byAdaptID[id])}findById(id){const model=this._byAdaptID[id];if(!model){console.warn(`data.findById() unable to find id: ${id}`);return}return model}findViewByModelId(id){const model=this.findById(id);if(!model)return;if(model===Adapt$1.parentView.model)return Adapt$1.parentView;const idPathToView=[id];const currentLocationId=location$1._currentId;const currentLocationModel=model.getAncestorModels().find(model=>{const modelId=model.get("_id");if(modelId===currentLocationId)return true;idPathToView.unshift(modelId);return false});if(!currentLocationModel){return console.warn(`data.findViewByModelId() unable to find view for model id: ${id}`)}const foundView=idPathToView.reduce((view,currentId)=>{if(!view)return null;const childViews=view.getChildViews();return childViews?.find(view=>view.model.get("_id")===currentId)},Adapt$1.parentView);return foundView}findByTrackingPosition(trackingPosition){const[trackingId,indexInTrackingIdDescendants]=trackingPosition;const trackingIdModel=this.find(model=>model.get("_trackingId")===trackingId);if(!trackingIdModel){console.warn(`data.findByTrackingPosition() unable to find trackingPosition: ${trackingPosition}`);return}if(indexInTrackingIdDescendants>=0){const trackingIdDescendants=[trackingIdModel].concat(trackingIdModel.getAllDescendantModels(true));return trackingIdDescendants[indexInTrackingIdDescendants]}const trackingIdAncestors=trackingIdModel.getAncestorModels();const ancestorDistance=Math.abs(indexInTrackingIdDescendants)-1;return trackingIdAncestors[ancestorDistance]}}const data=new Data$1;var data$1=__AMD("core/js/data",data);class DrawerItemView extends Backbone.View{className(){return"drawer__menu drawer__item"}attributes(){return{role:"list"}}initialize(){this.listenTo(Adapt$1,"drawer:empty",this.remove);this.render()}events(){return{"click .drawer__item-btn":"onDrawerItemClicked"}}render(){const data=this.model.toJSON();const template=Handlebars.templates["drawerItem"];$(this.el).html(template(data)).appendTo(".drawer__holder");return this}onDrawerItemClicked(event){event.preventDefault();const eventCallback=this.model.get("eventCallback");Adapt$1.trigger(eventCallback)}}DrawerItemView.type="drawerItem";var DrawerItemView$1=__AMD("core/js/views/drawerItemView",DrawerItemView);class DrawerView extends Backbone.View{className(){return"drawer u-display-none"}attributes(){return{role:"dialog","aria-modal":"true","aria-labelledby":"drawer-heading","aria-hidden":"true"}}initialize(){this._isVisible=false;this.disableAnimation=Adapt$1.config.has("_disableAnimation")?Adapt$1.config.get("_disableAnimation"):false;this.drawerDir=Adapt$1.config.get("_defaultDirection")==="rtl"?"left":"right";this.drawerDuration=Adapt$1.config.get("_drawer")?._duration??400;this.setupEventListeners();this.render()}setupEventListeners(){this.listenTo(Adapt$1,{"navigation:toggleDrawer":this.toggleDrawer,"drawer:triggerCustomView":this.openCustomView,"drawer:closeDrawer":this.onCloseDrawer,remove:this.onRemove,"drawer:remove":this.remove});this.onKeyUp=this.onKeyUp.bind(this);this.setupEscapeKey()}setupEscapeKey(){$(window).on("keyup",this.onKeyUp)}onKeyUp(event){if(event.which!==27)return;event.preventDefault();this.onCloseDrawer()}events(){return{"click .drawer__back":"onBackButtonClicked","click .drawer__close":"onCloseClicked"}}render(){const template=Handlebars.templates.drawer;$(this.el).html(template({_globals:Adapt$1.course.get("_globals")})).prependTo("body");const shadowTemplate=Handlebars.templates.shadow;$(shadowTemplate()).prependTo("body");_.defer(this.postRender.bind(this));return this}postRender(){this.$("a, button, input, select, textarea").attr("tabindex",-1);this.checkIfDrawerIsAvailable()}openCustomView(view,hasBackButton){this._hasBackButton=hasBackButton;this._isCustomViewVisible=true;Adapt$1.trigger("drawer:empty");this.showDrawer();this.$(".drawer__holder").html(view)}checkIfDrawerIsAvailable(){const isEmptyDrawer=this.collection.length===0;$(".js-nav-drawer-btn").toggleClass("u-display-none",isEmptyDrawer);if(isEmptyDrawer){Adapt$1.trigger("drawer:noItems")}}onBackButtonClicked(event){event.preventDefault();this.showDrawer(true)}onCloseClicked(event){event.preventDefault();this.hideDrawer()}onCloseDrawer($toElement){this.hideDrawer($toElement)}onRemove(){this.hideDrawer()}toggleDrawer(){if(this._isVisible&&this._isCustomViewVisible===false){this.hideDrawer();return}this.showDrawer(true)}showDrawer(emptyDrawer){this.$el.removeClass("u-display-none").removeAttr("aria-hidden");if(!this._isVisible){a11y$1.popupOpened(this.$el);a11y$1.scrollDisable("body");this._isVisible=true}this.$("a, button, input, select, textarea").attr("tabindex",0);if(emptyDrawer){this.$(".drawer__back").addClass("u-display-none");this._isCustomViewVisible=false;this.emptyDrawer();if(this.collection.models.length===1){Adapt$1.trigger(this.collection.models[0].get("eventCallback"));this._isCustomViewVisible=false}else{this.renderItems();Adapt$1.trigger("drawer:openedItemView")}}else{const hideDrawerBackButton=!this._hasBackButton||this.collection.models.length<=1;this.$(".drawer__back").toggleClass("u-display-none",hideDrawerBackButton);Adapt$1.trigger("drawer:openedCustomView")}const complete=()=>{this.addShadowEvent();Adapt$1.trigger("drawer:opened");a11y$1.focusFirst(this.$el,{defer:true})};const direction={};if(this.disableAnimation){$(".js-shadow").removeClass("u-display-none");$(".js-drawer-holder").scrollTop(0);direction[this.drawerDir]=0;this.$el.css(direction);complete()}else{$(".js-shadow").velocity({opacity:1},{duration:this.drawerDuration,begin:()=>{$(".js-shadow").removeClass("u-display-none");$(".js-drawer-holder").scrollTop(0);complete()}});const easing=Adapt$1.config.get("_drawer")?._showEasing||"easeOutQuart";direction[this.drawerDir]=0;this.$el.velocity(direction,this.drawerDuration,easing)}}emptyDrawer(){this.$(".drawer__holder").empty()}renderItems(){Adapt$1.trigger("drawer:empty");this.emptyDrawer();this.collection.forEach(model=>new DrawerItemView$1({model}))}hideDrawer($toElement){if(!this._isVisible)return;const direction={};a11y$1.popupClosed($toElement);this._isVisible=false;a11y$1.scrollEnable("body");if(this.disableAnimation){direction[this.drawerDir]=-this.$el.width();this.$el.css(direction).addClass("u-display-none").attr("aria-hidden","true");$(".js-shadow").addClass("u-display-none");Adapt$1.trigger("drawer:closed")}else{const easing=Adapt$1.config.get("_drawer")?._hideEasing||"easeInQuart";direction[this.drawerDir]=-this.$el.width();this.$el.velocity(direction,this.drawerDuration,easing,()=>{this.$el.addClass("u-display-none").attr("aria-hidden","true");Adapt$1.trigger("drawer:closed")});$(".js-shadow").velocity({opacity:0},{duration:this.drawerDuration,complete(){$(".js-shadow").addClass("u-display-none")}})}this._isCustomViewVisible=false;this.removeShadowEvent()}addShadowEvent(){$(".js-shadow").one("click touchstart",()=>this.onCloseDrawer())}removeShadowEvent(){$(".js-shadow").off("click touchstart")}remove(){super.remove();$(window).off("keyup",this.onKeyUp);Adapt$1.trigger("drawer:empty");this.collection.reset();$(".js-shadow").remove()}}Object.assign(DrawerView,{childContainer:".js-drawer-holder",childView:DrawerItemView$1});var DrawerView$1=__AMD("core/js/views/drawerView",DrawerView);const DrawerCollection=new Backbone.Collection(null,{comparator:"drawerOrder"});const Drawer={};Drawer.addItem=function(drawerObject,eventCallback){drawerObject.eventCallback=eventCallback;DrawerCollection.add(drawerObject)};Drawer.triggerCustomView=function(view,hasBackButton){if(hasBackButton!==false){hasBackButton=true}Adapt$1.trigger("drawer:triggerCustomView",view,hasBackButton)};Adapt$1.on({"adapt:start"(){new DrawerView$1({collection:DrawerCollection})},"app:languageChanged"(){Adapt$1.trigger("drawer:remove")}});var drawer=__AMD("core/js/drawer",Drawer);var AdaptSubsetCollection=__AMD("core/js/collections/adaptSubsetCollection",class AdaptSubsetCollection extends AdaptCollection{initialize(models,options){super.initialize(models,options);this.parent=options.parent;this.listenTo(this.parent,"reset",this.loadSubset)}loadSubset(){this.set(this.parent.filter(model=>model instanceof this.model));this._byAdaptID=this.groupBy("_id")}});var ModelEvent=__AMD("core/js/modelEvent",class ModelEvent extends Backbone.Controller{initialize(type,target,value){this.type=type;this.target=target;this.value=value;this.canBubble=true;this.deepPath=[target];this.timeStamp=null}stopPropagation(){this.canBubble=false}addPath(target){this.deepPath.unshift(target)}});var AdaptModel=__AMD("core/js/models/adaptModel",class AdaptModel extends LockingModel{toJSON(){const json={...this.attributes};delete json._children;delete json._parent;return $.extend(true,{},json)}get(name){switch(name){case"_parent":case"_children":logging$1.deprecated("Use model.getChildren() or model.getParent() instead of model.get('_children') or model.get('_parent')");}return super.get(name)}defaults(){return{_canShowFeedback:true,_classes:"",_canReset:true,_canRequestChild:false,_isComplete:false,_isInteractionComplete:false,_isA11yRegionEnabled:false,_isA11yCompletionDescriptionEnabled:true,_requireCompletionOf:-1,_isEnabled:true,_isResetOnRevisit:false,_isAvailable:true,_isOptional:false,_isRendered:false,_isReady:false,_isVisible:true,_isVisited:false,_isLocked:false,_isHidden:false}}get trackingPosition(){const firstDescendant=this.getAllDescendantModels(false).concat([this])[0];const nearestTrackingIdModel=[firstDescendant].concat(firstDescendant.getAncestorModels()).find(model=>model.has("_trackingId"));if(!nearestTrackingIdModel)return;const trackingId=nearestTrackingIdModel.get("_trackingId");const trackingIdDescendants=[nearestTrackingIdModel].concat(nearestTrackingIdModel.getAllDescendantModels(true));const indexInTrackingIdDescendants=trackingIdDescendants.findIndex(descendant=>descendant===this);if(indexInTrackingIdDescendants>=0){return[trackingId,indexInTrackingIdDescendants]}const trackingIdAncestors=nearestTrackingIdModel.getAncestorModels();const ancestorDistance=trackingIdAncestors.findIndex(ancestor=>ancestor===this);return[trackingId,-(ancestorDistance+1)]}parse(data){if(data._isResetOnRevisit==="false"){data._isResetOnRevisit=false}return data}trackable(){return["_id","_isComplete","_isInteractionComplete","_isVisited"]}trackableType(){return[String,Boolean,Boolean,Boolean]}bubblingEvents(){return["change:_isComplete","change:_isInteractionComplete","change:_isActive","change:_isVisited"]}setupModel(){if(this.hasManagedChildren){this.setupChildListeners()}this.init();_.defer(()=>{if(this.hasManagedChildren){this.checkCompletionStatus();this.checkInteractionCompletionStatus();this.checkLocking();this.checkVisitedStatus()}this.setupTrackables()})}setupTrackables(){const originalTrackableStateFunction=this.triggerTrackableState;this.triggerTrackableState=_.compose(()=>{this.triggerTrackableState.isQueued=true},_.debounce(()=>{originalTrackableStateFunction.apply(this);this.triggerTrackableState.isQueued=false},17));this.listenTo(this,"change",_ref=>{let{changed}=_ref;if(this.triggerTrackableState.isQueued||!Adapt$1.attributes._isStarted){return}const trackablePropertyNames=_.result(this,"trackable",[]);const changedPropertyNames=Object.keys(changed);const isTrackable=changedPropertyNames.find(item=>{return trackablePropertyNames.includes(item)});if(isTrackable){this.triggerTrackableState()}})}setupChildListeners(){const children=this.getChildren();if(!children.length){return}this.listenTo(children,{all:this.onAll,bubble:this.bubble,"change:_isVisited":this.checkVisitedStatus,"change:_isReady":this.checkReadyStatus,"change:_isComplete":this.onIsComplete,"change:_isInteractionComplete":this.checkInteractionCompletionStatus})}init(){}getTrackableState(){const trackable=this.resultExtend("trackable",[]);const json=this.toJSON();const args=trackable;args.unshift(json);return _.pick(...args)}setTrackableState(state){const trackable=this.resultExtend("trackable",[]);const args=trackable;args.unshift(state);state=_.pick(...args);this.set(state);return this}triggerTrackableState(){Adapt$1.trigger("state:change",this,this.getTrackableState())}reset(){let type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"hard";let canReset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.get("_canReset");if(!canReset)return false;switch(type){case"hard":case true:this.set({_isEnabled:true,_isComplete:false,_isInteractionComplete:false});return true;case"soft":this.set({_isEnabled:true,_isInteractionComplete:false});return true;}return false}checkReadyStatus(model,value){if(value===false){return false}const children=this.getAvailableChildModels();if(children.find(child=>child.get("_isReady")===false&&child.get("_isRendered"))){return false}this.set("_isReady",true);return true}setReadyStatus(){this.set("_isReady",true)}checkVisitedStatus(){const children=this.getAvailableChildModels();const isVisited=children.some(child=>child.get("_isVisited")||child.get("_isComplete")||child.get("_isInteractionComplete"));if(isVisited)this.set("_isVisited",true);return isVisited}setVisitedStatus(){if(!this.get("_isReady")||!this.get("_isRendered"))return;this.set("_isVisited",true)}setCompletionStatus(){if(!this.get("_isVisible"))return;this.set({_isComplete:true,_isInteractionComplete:true,_isVisited:true})}checkCompletionStatus(){Adapt$1.checkingCompletion();_.defer(this.checkCompletionStatusFor.bind(this),"_isComplete")}checkInteractionCompletionStatus(){Adapt$1.checkingCompletion();_.defer(this.checkCompletionStatusFor.bind(this),"_isInteractionComplete")}checkCompletionStatusFor(){let completionAttribute=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"_isComplete";let completed=false;const children=this.getAvailableChildModels();const requireCompletionOf=this.get("_requireCompletionOf");if(requireCompletionOf===-1){completed=children.every(child=>{return child.get(completionAttribute)||child.get("_isOptional")})}else{completed=children.filter(child=>{return child.get(completionAttribute)&&!child.get("_isOptional")}).length>=requireCompletionOf}this.set(completionAttribute,completed);Adapt$1.checkedCompletion()}getTypeGroup(){}isTypeGroup(typeGroup){const hasUpperCase=/[A-Z]+/.test(typeGroup);const isPluralized=typeGroup.slice(-1)==="s";const lowerCased=typeGroup.toLowerCase();const singular=isPluralized&&lowerCased.slice(0,-1);const singularLowerCased=(singular||lowerCased).toLowerCase();if(isPluralized||hasUpperCase){logging$1.deprecated(`'${typeGroup}' appears pluralized or contains uppercase characters, suggest using the singular, lowercase type group '${singularLowerCased}'.`)}const pluralizedLowerCaseTypes=[singularLowerCased,!isPluralized&&`${lowerCased}s`].filter(Boolean);const typeGroups=this.getTypeGroups();if(_.intersection(pluralizedLowerCaseTypes,typeGroups).length){return true}return false}getTypeGroups(){if(this._typeGroups)return this._typeGroups;const typeGroups=[this.get("_type")];let parentClass=this;while(parentClass=Object.getPrototypeOf(parentClass)){if(!Object.prototype.hasOwnProperty.call(parentClass,"getTypeGroup"))continue;typeGroups.push(parentClass.getTypeGroup.call(this))}return this._typeGroups=_.uniq(typeGroups.filter(Boolean).map(s=>s.toLowerCase()))}findAncestor(ancestorType){const parent=this.getParent();if(!parent)return;if(!ancestorType||parent.isTypeGroup(ancestorType)){return parent}return parent.findAncestor(ancestorType)}findDescendantModels(descendants,options){const allDescendantsModels=this.getAllDescendantModels();const returnedDescendants=allDescendantsModels.filter(model=>{return model.isTypeGroup(descendants)});if(!options){return returnedDescendants}if(options.where){return returnedDescendants.filter(descendant=>{for(const property in options.where){const value=options.where[property];if(descendant.get(property)!==value){return false}}return true})}}getAllDescendantModels(isParentFirst){const descendants=[];if(!this.hasManagedChildren){return descendants}const children=this.getChildren();children.models.forEach(child=>{if(!child.hasManagedChildren){descendants.push(child);return}const subDescendants=child.getAllDescendantModels(isParentFirst);if(isParentFirst===true){descendants.push(child)}descendants.push(...subDescendants);if(isParentFirst!==true){descendants.push(child)}});return descendants}findRelativeModel(relativeString){let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const rootModel=options.limitParentId?data$1.findById(options.limitParentId):Adapt$1.course;const relativeDescriptor=Adapt$1.parseRelativeString(relativeString);const searchBackwards=relativeDescriptor.offset<0;let moveBy=Math.abs(relativeDescriptor.offset);let movementCount=0;const hasDescendantsOfType=Boolean(this.findDescendantModels(relativeDescriptor.type).length);if(hasDescendantsOfType){moveBy--}let pageDescendants;if(searchBackwards){pageDescendants=[rootModel];pageDescendants.push(...rootModel.getAllDescendantModels(true));pageDescendants.reverse()}else{pageDescendants=rootModel.getAllDescendantModels(false);pageDescendants.push(rootModel)}const modelId=this.get("_id");const modelIndex=pageDescendants.findIndex(pageDescendant=>{if(pageDescendant.get("_id")===modelId){return true}return false});const isFilterFunction=typeof options.filter==="function";if(options.loop){const totalOfType=pageDescendants.reduce((count,model)=>{if(!model.isTypeGroup(relativeDescriptor.type))return count;return++count},0);moveBy=moveBy%totalOfType;pageDescendants=pageDescendants.concat(pageDescendants.slice(0))}for(let i=modelIndex,l=pageDescendants.length;i<l;i++){const descendant=pageDescendants[i];if(!descendant.isTypeGroup(relativeDescriptor.type))continue;const isSelf=i===modelIndex;if(!isSelf&&isFilterFunction&&!options.filter(descendant))continue;if(movementCount>moveBy){break}if(movementCount===moveBy){return data$1.findById(descendant.get("_id"))}movementCount++}}get hasManagedChildren(){return true}getChildren(){if(this._childrenCollection){return this._childrenCollection}let childrenCollection;if(!this.hasManagedChildren){childrenCollection=new Backbone.Collection}else{const id=this.get("_id");const children=data$1.filter(model=>model.get("_parentId")===id);childrenCollection=new Backbone.Collection(children)}if(this.get("_type")==="block"&&childrenCollection.length===2&&childrenCollection.models[0].get("_layout")!=="left"){childrenCollection.comparator="_layout";childrenCollection.sort()}this.setChildren(childrenCollection);return this._childrenCollection}setChildren(children){this._childrenCollection=children;this.set("_children",children)}getAvailableChildModels(){return this.getChildren().where({_isAvailable:true})}getParent(){if(this._parentModel){return this._parentModel}const parentId=this.get("_parentId");if(!parentId)return;this.setParent(data$1.findById(parentId));return this._parentModel}setParent(parent){this._parentModel=parent;this.set("_parentId",this._parentModel.get("_id"));this.set("_parent",this._parentModel)}getAncestorModels(shouldIncludeChild){const parents=[];let context=this;if(shouldIncludeChild)parents.push(context);while(context.has("_parentId")){context=context.getParent();parents.push(context)}return parents.length?parents:null}getSiblings(passSiblingsAndIncludeSelf){const id=this.get("_id");const parentId=this.get("_parentId");let siblings;if(!passSiblingsAndIncludeSelf){if(this._hasSiblingsAndSelf===false){return this.get("_siblings")}siblings=data$1.filter(model=>{return model.get("_parentId")===parentId&&model.get("_id")!==id});this._hasSiblingsAndSelf=false}else{if(this._hasSiblingsAndSelf){return this.get("_siblings")}siblings=data$1.filter(model=>{return model.get("_parentId")===parentId});this._hasSiblingsAndSelf=true}const siblingsCollection=new Backbone.Collection(siblings);this.set("_siblings",siblingsCollection);return siblingsCollection}setOnChildren(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}this.set(...args);if(!this.hasManagedChildren)return;const children=this.getChildren();children.models.forEach(child=>child.setOnChildren(...args))}setOptional(value){logging$1.deprecated("Use model.set('_isOptional', value) as setOptional() may be removed in the future");this.set({_isOptional:value})}checkLocking(){const lockType=this.get("_lockType");if(!lockType)return;switch(lockType){case"sequential":this.setSequentialLocking();break;case"unlockFirst":this.setUnlockFirstLocking();break;case"lockLast":this.setLockLastLocking();break;case"custom":this.setCustomLocking();break;default:console.warn(`AdaptModel.checkLocking: unknown _lockType '${lockType}' found on ${this.get("_id")}`);}}setSequentialLocking(){const children=this.getAvailableChildModels();children.slice(1).forEach((child,index)=>{const previousChild=children[index];const isLockedByPreviousChild=previousChild.get("_isLocked")||!previousChild.get("_isComplete")&&!previousChild.get("_isOptional");child.set("_isLocked",isLockedByPreviousChild)},false)}setUnlockFirstLocking(){const children=this.getAvailableChildModels();const firstChild=children.shift();const isLockedByFirstChild=!firstChild.get("_isComplete")&&!firstChild.get("_isOptional");children.forEach(child=>child.set("_isLocked",isLockedByFirstChild))}setLockLastLocking(){const children=this.getAvailableChildModels();const lastChild=children.pop();const isLockedByChildren=children.some(child=>!child.get("_isComplete")&&!child.get("_isOptional"));lastChild.set("_isLocked",isLockedByChildren)}setCustomLocking(){const children=this.getAvailableChildModels();children.forEach(child=>child.set("_isLocked",this.shouldLock(child)))}shouldLock(child){const lockedBy=child.get("_lockedBy");if(!lockedBy)return false;return lockedBy.some(id=>{try{const anotherModel=data$1.findById(id);return anotherModel.get("_isAvailable")&&(anotherModel.get("_isLocked")||!anotherModel.get("_isComplete")&&!anotherModel.get("_isOptional"))}catch(e){console.warn(`AdaptModel.shouldLock: unknown _lockedBy ID '${id}' found on ${child.get("_id")}`);return false}})}onIsComplete(){this.checkCompletionStatus();this.checkLocking()}checkIfResetOnRevisit(){const isResetOnRevisit=this.get("_isResetOnRevisit");this.reset(isResetOnRevisit)}deepClone(){let modifier=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;const ModelClass=this.constructor;const clonedModel=new ModelClass(this.toJSON());if(modifier){modifier(clonedModel,this)}let clonedId=clonedModel.get("_id");const hasId=Boolean(clonedId);const shouldAssignUniqueId=this.get("_id")===clonedId;if(hasId&&shouldAssignUniqueId){const cid=_.uniqueId(ModelClass.prototype.cidPrefix||"c");clonedId=`${clonedId}_${cid}`;clonedModel.set("_id",clonedId)}if(hasId){data$1.add(clonedModel)}if(this.hasManagedChildren){this.getChildren().each(child=>{if(!child.deepClone){throw new Error("Cannot deepClone child.")}child.deepClone((clone,child)=>{if(hasId){clone.set("_parentId",clonedId)}if(modifier){modifier(clone,child)}})})}clonedModel.getParent().getChildren().add(clonedModel);clonedModel.setupModel();return clonedModel}onAll(type,model,value){if(!_.result(this,"bubblingEvents").includes(type))return;const event=new ModelEvent(type,model,value);this.bubble(event)}bubble(event){if(!event.canBubble)return;event.addPath(this);this.trigger(`bubble:${event.type} bubble`,event)}});var ContentObjectModel=__AMD("core/js/models/contentObjectModel",class ContentObjectModel extends AdaptModel{get _parent(){logging$1.deprecated("contentObjectModel._parent, use contentObjectModel.getParent() instead, parent models are defined by the JSON");const isParentCourse=this.get("_parentId")===Adapt$1.course.get("_id");if(isParentCourse){return"course"}return"contentObjects"}get _siblings(){logging$1.deprecated("contentObjectModel._siblings, use contentObjectModel.getSiblings() instead, sibling models are defined by the JSON");return"contentObjects"}get _children(){logging$1.deprecated("contentObjectModel._children, use contentObjectModel.hasManagedChildren instead, child models are defined by the JSON");return null}getTypeGroup(){return"contentobject"}});class ArticleModel extends AdaptModel{get _parent(){logging$1.deprecated("articleModel._parent, use articleModel.getParent() instead, parent models are defined by the JSON");return"contentObjects"}get _siblings(){logging$1.deprecated("articleModel._siblings, use articleModel.getSiblings() instead, sibling models are defined by the JSON");return"articles"}get _children(){logging$1.deprecated("articleModel._children, use articleModel.hasManagedChildren instead, child models are defined by the JSON");return"blocks"}getTypeGroup(){return"article"}}components$1.register("article",{model:ArticleModel});var ArticleModel$1=__AMD("core/js/models/articleModel",ArticleModel);class BlockModel extends AdaptModel{get _parent(){logging$1.deprecated("blockModel._parent, use blockModel.getParent() instead, parent models are defined by the JSON");return"articles"}get _siblings(){logging$1.deprecated("blockModel._siblings, use blockModel.getSiblings() instead, sibling models are defined by the JSON");return"blocks"}get _children(){logging$1.deprecated("blockModel._children, use blockModel.hasManagedChildren instead, child models are defined by the JSON");return"components"}getTypeGroup(){return"block"}}components$1.register("block",{model:BlockModel});var BlockModel$1=__AMD("core/js/models/blockModel",BlockModel);class ComponentModel extends AdaptModel{get _parent(){logging$1.deprecated("componentModel._parent, use componentModel.getParent() instead, parent models are defined by the JSON");return"blocks"}get _siblings(){logging$1.deprecated("componentModel._siblings, use componentModel.getSiblings() instead, sibling models are defined by the JSON");return"components"}getTypeGroup(){return"component"}defaults(){return AdaptModel.resultExtend("defaults",{_isA11yComponentDescriptionEnabled:true,_shouldStoreAttempts:true,_userAnswer:null,_attemptStates:null})}trackable(){return AdaptModel.resultExtend("trackable",["_userAnswer","_attemptStates"])}trackableType(){return AdaptModel.resultExtend("trackableType",[Array,Array])}get hasManagedChildren(){return false}init(){if(Adapt$1.get("_isStarted")){this.onAdaptInitialize();return}this.listenToOnce(Adapt$1,"adapt:initialize",this.onAdaptInitialize)}onAdaptInitialize(){this.restoreUserAnswers()}restoreUserAnswers(){}storeUserAnswer(){}resetUserAnswer(){this.set("_userAnswer",null)}reset(){let type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"hard";let canReset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.get("_canReset");const wasReset=super.reset(type,canReset);if(!wasReset)return false;this.resetUserAnswer();return true}getAttemptState(){let object=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.toJSON();const trackables=this.trackable();const types=this.trackableType();trackables.find((name,index)=>{if(name!=="_attemptStates")return false;trackables.splice(index,1);types.splice(index,1);return true});const values=trackables.map(n=>object[n]);const booleans=values.filter((v,i)=>types[i]===Boolean).map(Boolean);const numbers=values.filter((v,i)=>types[i]===Number).map(v=>Number(v)||0);const arrays=values.filter((v,i)=>types[i]===Array);return[numbers,booleans,arrays]}getAttemptObject(){let state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getAttemptState();const trackables=this.trackable();const types=this.trackableType();trackables.find((name,index)=>{if(name!=="_attemptStates")return false;trackables.splice(index,1);types.splice(index,1);return true});const numbers=(state[0]||[]).slice(0);const booleans=(state[1]||[]).slice(0);const arrays=(state[2]||[]).slice(0);const object={};trackables.forEach((n,i)=>{if(n==="_id")return;switch(types[i]){case Number:object[n]=numbers.shift();break;case Boolean:object[n]=booleans.shift();break;case Array:object[n]=arrays.shift();break;}});return object}setAttemptObject(object){let silent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this.set(object,{silent})}addAttemptObject(){let object=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getAttemptObject();const attemptStates=this.get("_attemptStates")||[];const state=this.getAttemptState(object);attemptStates.push(state);this.set("_attemptStates",attemptStates)}getAttemptObjects(){const states=this.get("_attemptStates")||[];return states.map(state=>this.getAttemptObject(state))}}components$1.register("component",{model:ComponentModel});var ComponentModel$1=__AMD("core/js/models/componentModel",ComponentModel);class MenuModel extends ContentObjectModel{get _children(){logging$1.deprecated("menuModel._children, use menuModel.hasManagedChildren instead, child models are defined by the JSON");return"contentObjects"}getTypeGroup(){return"menu"}setCustomLocking(){const children=this.getAvailableChildModels();children.forEach(child=>{child.set("_isLocked",this.shouldLock(child));if(!(child instanceof MenuModel))return;child.checkLocking()})}}components$1.register("menu",{model:MenuModel});var MenuModel$1=__AMD("core/js/models/menuModel",MenuModel);class CourseModel extends MenuModel$1{get _parent(){logging$1.deprecated("courseModel._parent, use courseModel.getParent() instead, parent models are defined by the JSON");return null}get _siblings(){logging$1.deprecated("courseModel._siblings, use courseModel.getSiblings() instead, sibling models are defined by the JSON");return null}getTypeGroup(){return"course"}}components$1.register("course",{model:CourseModel});var CourseModel$1=__AMD("core/js/models/courseModel",CourseModel);class PageModel extends ContentObjectModel{get _children(){logging$1.deprecated("pageModel._children, use menuModel.hasManagedChildren instead, child models are defined by the JSON");return"articles"}getTypeGroup(){return"page"}}components$1.register("page",{model:PageModel});__AMD("core/js/models/pageModel",PageModel);var ChildEvent=__AMD("core/js/childEvent",class ChildEvent extends Backbone.Controller{initialize(type,target,model){this.type=type;this.target=target;this.isForced=false;this.isStoppedImmediate=false;this.isStoppedNext=false;this.hasRequestChild=false;this._model=model}get model(){return this._model}set model(model){if(this.type!=="requestChild"){logging$1.warn(`Cannot change model in ${this.type} event.`);return}if(this._model){logging$1.warn(`Cannot inject two models in one sitting. ${model.get("_id")} attempts to overwrite ${this._model.get("_id")}`);return}this._model=model;this.hasRequestChild=true}reset(){this.isStoppedImmediate=false;this.isStoppedNext=false}force(){this.isForced=true}stop(){let immediate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(!immediate){return this.stopNext()}this.isStoppedImmediate=true}stopNext(){this.isStoppedNext=true}close(){this.trigger("closed")}});var TemplateRenderEvent=__AMD("core/js/templateRenderEvent",class TemplateRenderEvent extends Backbone.Controller{initialize(type,name,mode,value,args){this.type=type;this.name=name;this.mode=mode;this.value=value;this.args=args}});var register=__AMD("core/js/reactHelpers",function register(name,component){templates[name]=function(){const mode="reactTemplate";for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}const preRenderEvent=new TemplateRenderEvent(`${mode}:preRender`,name,mode,null,args);Adapt$1.trigger(preRenderEvent.type,preRenderEvent);const value=component(...preRenderEvent.args);const postRenderEvent=new TemplateRenderEvent(`${mode}:postRender`,name,mode,value,preRenderEvent.args);Adapt$1.trigger(postRenderEvent.type,postRenderEvent);return postRenderEvent.value}});(function(){const original=React__default["default"].createElement;React__default["default"].createElement=function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}const name=args[0];const mode="reactElement";const preRenderEvent=new TemplateRenderEvent(`${mode}:preRender`,name,mode,null,args);Adapt$1.trigger(preRenderEvent.type,preRenderEvent);const value=original(...preRenderEvent.args);const postRenderEvent=new TemplateRenderEvent(`${mode}:postRender`,name,mode,value,preRenderEvent.args);Adapt$1.trigger(postRenderEvent.type,postRenderEvent);return postRenderEvent.value}})();const templates={};function html(html){if(!html)return;logging$1.deprecated("reactHelpers.html please use react dangerouslySetInnerHTML instead: https://reactjs.org/docs/dom-elements.html#dangerouslysetinnerhtml");return{__html:html}}function compile(template){for(var _len3=arguments.length,args=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++){args[_key3-1]=arguments[_key3]}const output=Handlebars.compile(template)(...args);return output}function classes(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++){args[_key5]=arguments[_key5]}return _.uniq(_.flatten(args).filter(Boolean).join(" ").split(" ")).join(" ")}function prefixClasses(prefixes){for(var _len6=arguments.length,args=new Array(_len6>1?_len6-1:0),_key6=1;_key6<_len6;_key6++){args[_key6-1]=arguments[_key6]}const classes=_.flatten(args).filter(Boolean);const prefixed=_.flatten(prefixes.map(prefix=>classes.map(className=>`${prefix}${className}`)));return _.uniq(prefixed.join(" ").split(" ")).join(" ")}class AdaptView extends Backbone.View{attributes(){return{"data-adapt-id":this.model.get("_id")}}initialize(){this.listenTo(this.model,{"change:_isVisible":this.toggleVisibility,"change:_isHidden":this.toggleHidden,"change:_isComplete":this.onIsCompleteChange});this.isJSX=(this.constructor.template||"").includes(".jsx");if(this.isJSX){this._classSet=new Set(_.result(this,"className").trim().split(/\s+/));this.listenTo(this.model,"all",this.changed);const children=this.model?.getChildren?.();children&&this.listenTo(children,"all",this.changed);this.listenTo(Adapt$1,"device:changed",this.changed)}this.model.set({_globals:Adapt$1.course.get("_globals"),_isReady:false});this._isRemoved=false;if(location$1._currentId===this.model.get("_id")){Adapt$1.parentView=this}this.preRender();this.render();this.setupOnScreenHandler()}preRender(){}async postRender(){await this.addChildren()}render(){const type=this.constructor.type;Adapt$1.trigger(`${type}View:preRender view:preRender`,this);if(this.isJSX){this.changed()}else{const data=this.model.toJSON();data.view=this;const template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))}Adapt$1.trigger(`${type}View:render view:render`,this);_.defer(async()=>{if(this._isRemoved)return;await this.postRender();Adapt$1.trigger(`${type}View:postRender view:postRender`,this)});return this}changed(){let eventName=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!this.isJSX){throw new Error("Cannot call changed on a non-react view")}if(typeof eventName==="string"&&eventName.startsWith("bubble")){return}const props={...this,...this.model.toJSON(),_globals:Adapt$1.course.get("_globals")};const Template=templates[this.constructor.template.replace(".jsx","")];this.updateViewProperties();ReactDOM__default["default"].render(React__default["default"].createElement(Template,props),this.el)}updateViewProperties(){const classesToAdd=_.result(this,"className").trim().split(/\s+/);classesToAdd.forEach(i=>this._classSet.add(i));const classesToRemove=[...this._classSet].filter(i=>!classesToAdd.includes(i));classesToRemove.forEach(i=>this._classSet.delete(i));this._setAttributes({..._.result(this,"attributes"),id:_.result(this,"id")});this.$el.removeClass(classesToRemove).addClass(classesToAdd)}setupOnScreenHandler(){const onscreen=this.model.get("_onScreen");if(!onscreen?._isEnabled)return;this.$el.addClass(`has-animation ${onscreen._classes}-before`);this.$el.on("onscreen.adaptView",(e,m)=>{if(!m.onscreen)return;const minVerticalInview=onscreen._percentInviewVertical||33;if(m.percentInviewVertical<minVerticalInview)return;this.$el.addClass(`${onscreen._classes}-after`).off("onscreen.adaptView")})}async addChildren(){this.nthChild=this.nthChild||0;let addedCount=await this.addDescendants(false);while(true){const models=this.model.getAvailableChildModels();const event=this._getAddChildEvent(models[this.nthChild]);if(!event){break}if(event.isForced){event.reset()}if(event.isStoppedImmediate||!event.model){const subsequentModels=models.slice(this.nthChild);subsequentModels.forEach(model=>model.setOnChildren("_isRendered",false));break}const model=event.model;model.set({_isRendered:true,_nthChild:++this.nthChild});const ChildView=this.constructor.childView||components$1.getViewClass(model);if(!ChildView){throw new Error(`The component '${model.attributes._id}' ('${model.attributes._component}') has not been installed, and so is not available in your project.`)}const childView=new ChildView({model});this.addChildView(childView);addedCount++;if(event.isStoppedNext){break}}if(!addedCount){return addedCount}this.model.set("_isReady",false);return addedCount}addChildView(childView){const childViews=this.getChildViews()||[];childViews.push(childView);this.setChildViews(childViews);const $parentContainer=this.$(this.constructor.childContainer);switch(childView.model.get("_renderPosition")){case"outer-append":this.$el.append(childView.$el);break;case"inner-append":default:$parentContainer.append(childView.$el);break;}Adapt$1.trigger("view:childAdded",this,childView);return childView}async addDescendants(){let addedDescendantCount=0;const childViews=this.getChildViews();if(!childViews){return addedDescendantCount}for(let i=0,l=childViews.length;i<l;i++){const view=childViews[i];addedDescendantCount=view.addChildren?await view.addChildren():0;if(addedDescendantCount){break}}if(!addedDescendantCount){this.model.checkReadyStatus();return addedDescendantCount}this.model.set("_isReady",false);return addedDescendantCount}async whenReady(){if(this.model.get("_isReady"))return;return new Promise(resolve=>{const onReadyChange=(model,value)=>{if(!value)return;this.stopListening(this.model,"change:_isReady",onReadyChange);resolve()};this.listenTo(this.model,"change:_isReady",onReadyChange);this.model.checkReadyStatus()})}_getAddChildEvent(model){const isRequestChild=!model;const event=new ChildEvent(null,this,model);if(isRequestChild){const canRequestChild=this.model.get("_canRequestChild");if(!canRequestChild){return}event.type="requestChild";Adapt$1.trigger("view:requestChild",event);if(!event.hasRequestChild){event.close();return}}event.type="addChild";Adapt$1.trigger("view:addChild",event);event.close();return event}findDescendantViews(isParentFirst){const descendants=[];const childViews=this.getChildViews();childViews?.forEach(view=>{if(isParentFirst)descendants.push(view);const children=view.findDescendantViews?.(isParentFirst);if(children)descendants.push(...children);if(!isParentFirst)descendants.push(view)});return descendants}setReadyStatus(){this.model.setReadyStatus()}setCompletionStatus(){this.model.setCompletionStatus()}resetCompletionStatus(type){if(!this.model.get("_canReset"))return;const descendantComponents=this.model.findDescendantModels("component");if(descendantComponents.length===0){this.model.reset(type)}else{descendantComponents.forEach(model=>model.reset(type))}}preRemove(){const type=this.constructor.type;Adapt$1.trigger(`${type}View:preRemove view:preRemove`,this)}remove(){const type=this.constructor.type;this.preRemove();Adapt$1.trigger(`${type}View:remove view:remove`,this);this._isRemoved=true;this.stopListening();wait$1.for(end=>{if(this.isJSX){ReactDOM__default["default"].unmountComponentAtNode(this.el)}this.$el.off("onscreen.adaptView");super.remove();_.defer(()=>{Adapt$1.trigger(`${type}View:postRemove view:postRemove`,this)});end()});return this}setVisibility(){return this.model.get("_isVisible")?"":"u-visibility-hidden"}toggleVisibility(){this.$el.toggleClass("u-visibility-hidden",!this.model.get("_isVisible"))}setHidden(){return this.model.get("_isHidden")?"u-display-none":""}toggleHidden(){this.$el.toggleClass("u-display-none",this.model.get("_isHidden"))}onIsCompleteChange(model,isComplete){this.$el.toggleClass("is-complete",isComplete)}getChildViews(){if(!this._childViews)return this._childViews;return Object.entries(this._childViews).map(_ref=>{let[key,value]=_ref;return value})}setChildViews(value){this._childViews=value}get childViews(){logging$1.deprecated("view.childViews use view.getChildViews() and view.setChildViews([])");if(Array.isArray(this._childViews)){return _.indexBy(this._childViews,view=>view.model.get("_id"))}return this._childViews}set childViews(value){logging$1.deprecated("view.childViews use view.getChildViews() and view.setChildViews([])");this.setChildViews(value)}}AdaptView.className="";var AdaptView$1=__AMD("core/js/views/adaptView",AdaptView);var ContentObjectView=__AMD("core/js/views/contentObjectView",class ContentObjectView extends AdaptView$1{attributes(){return AdaptView$1.resultExtend("attributes",{role:"main","aria-labelledby":`${this.model.get("_id")}-heading`},this)}className(){return[this.constructor.type,"contentobject",this.constructor.className,this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].filter(Boolean).join(" ")}preRender(){$.inview.lock(this.constructor.type+"View");this.disableAnimation=Adapt$1.config.has("_disableAnimation")?Adapt$1.config.get("_disableAnimation"):false;this.$el.css("opacity",0);this.listenTo(this.model,"change:_isReady",this.isReady)}render(){const type=this.constructor.type;Adapt$1.trigger(`${type}View:preRender contentObjectView:preRender view:preRender`,this);if(this.isReact){this.changed()}else{const data=this.model.toJSON();data.view=this;const template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))}Adapt$1.trigger(`${type}View:render contentObjectView:render view:render`,this);_.defer(()=>{if(this._isRemoved)return;this.postRender();Adapt$1.trigger(`${type}View:postRender contentObjectView:postRender view:postRender`,this)});return this}async isReady(){if(!this.model.get("_isReady")||this._isTriggeredReady)return;this._isTriggeredReady=true;const type=this.constructor.type;const performIsReady=async()=>{Adapt$1.trigger(`${type}View:preReady contentObjectView:preReady view:preReady`,this);await wait$1.queue();$(".js-loading").hide();if(Adapt$1.get("_shouldContentObjectScrollTop")!==false){$(window).scrollTop(0)}Adapt$1.trigger(`${type}View:ready contentObjectView:ready view:ready`,this);$.inview.unlock(`${type}View`);const styleOptions={opacity:1};if(this.disableAnimation){this.$el.css(styleOptions);$.inview();_.defer(()=>{Adapt$1.trigger(`${type}View:postReady contentObjectView:postReady view:postReady`,this)})}else{this.$el.velocity(styleOptions,{duration:"fast",complete:()=>{$.inview();Adapt$1.trigger(`${type}View:postReady contentObjectView:postReady view:postReady`,this)}})}$(window).scroll()};_.defer(performIsReady)}async renderTo(id){const isRenderToSelf=id===this.model.get("_id");if(isRenderToSelf)return;let models=this.model.getAllDescendantModels(true).filter(model=>model.get("_isAvailable"));const index=models.findIndex(model=>model.get("_id")===id);if(index===-1){throw new Error(`Cannot renderTo "${id}" as it isn't a descendant.`)}const model=models[index];if(model.get("_isRendered")&&model.get("_isReady")){return}models=models.slice(0,index+1);const isLocked=models.some(model=>model.get("_isLocked"));if(isLocked)throw new Error(`Cannot renderTo ${id} as it is preceded by locked content`);const ids=_.indexBy(models,model=>model.get("_id"));const forceUntilId=event=>{const addingId=event.model.get("_id");if(!ids[addingId])return;event.force();if(addingId!==id)return;Adapt$1.off("view:addChild",forceUntilId)};Adapt$1.on("view:addChild",forceUntilId);await this.addChildren();await this.whenReady();if(!model.get("_isRendered")||!model.get("_isReady")){throw new Error(`Cannot renderTo "${id}".`)}}preRemove(){const type=this.constructor.type;Adapt$1.trigger(`${type}View:preRemove contentObjectView:preRemove view:preRemove`,this)}remove(){const type=this.constructor.type;this.preRemove();Adapt$1.trigger(`${type}View:remove contentObjectView:remove view:remove`,this);this._isRemoved=true;wait$1.for(end=>{if(this.isReact){ReactDOM__default["default"].unmountComponentAtNode(this.el)}this.$el.off("onscreen.adaptView");this.findDescendantViews().reverse().forEach(view=>{view.remove()});this.setChildViews(null);super.remove();_.defer(()=>{Adapt$1.trigger(`${type}View:postRemove contentObjectView:postRemove view:postRemove`,this);this.trigger("postRemove")});end()});return this}destroy(){this.remove();if(Adapt$1.parentView===this){Adapt$1.parentView=null}}});class PageView extends ContentObjectView{remove(){if(this.$pageLabel){this.$pageLabel.remove()}super.remove()}}Object.assign(PageView,{childContainer:".article__container",type:"page",template:"page"});components$1.register("page",{view:PageView});__AMD("core/js/views/pageView",PageView);class ArticleView extends AdaptView$1{className(){return["article",this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}}Object.assign(ArticleView,{childContainer:".block__container",type:"article",template:"article"});components$1.register("article",{view:ArticleView});var ArticleView$1=__AMD("core/js/views/articleView",ArticleView);class BlockView extends AdaptView$1{className(){return["block",this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}}Object.assign(BlockView,{childContainer:".component__container",type:"block",template:"block"});components$1.register("block",{view:BlockView});__AMD("core/js/views/blockView",BlockView);class MPABC extends Backbone.Controller{initialize(){this.listenTo(data$1,{loading:this.waitForDataLoaded,loaded:this.onDataLoaded});this.setupSubsetCollections()}waitForDataLoaded(){wait$1.begin()}onDataLoaded(){wait$1.end()}setupSubsetCollections(){Adapt$1.contentObjects=new AdaptSubsetCollection(null,{parent:data$1,model:ContentObjectModel});Adapt$1.articles=new AdaptSubsetCollection(null,{parent:data$1,model:ArticleModel$1});Adapt$1.blocks=new AdaptSubsetCollection(null,{parent:data$1,model:BlockModel$1});Adapt$1.components=new AdaptSubsetCollection(null,{parent:data$1,model:ComponentModel$1})}}const mpabc=new MPABC;var mpabc$1=__AMD("core/js/mpabc",mpabc);var NotifyPushView=__AMD("core/js/views/notifyPushView",class NotifyPushView extends Backbone.View{className(){let classes="notify-push ";classes+=this.model.get("_classes")||"";return classes}attributes(){return{role:"dialog","aria-labelledby":"notify-push-heading","aria-modal":"false"}}initialize(){this.listenTo(Adapt$1,{"notify:pushShown notify:pushRemoved":this.updateIndexPosition,remove:this.remove});this.listenTo(this.model.collection,{remove:this.updateIndexPosition,"change:_index":this.updatePushPosition});this.preRender();this.render()}events(){return{"click .js-notify-push-close-btn":"closePush","click .js-notify-push-inner":"triggerEvent"}}preRender(){this.hasBeenRemoved=false}render(){const data=this.model.toJSON();const template=Handlebars.templates.notifyPush;this.$el.html(template(data)).appendTo(".notify__push-container");_.defer(this.postRender.bind(this));return this}postRender(){this.$el.addClass("is-active");_.delay(this.closePush.bind(this),this.model.get("_timeout"));Adapt$1.trigger("notify:pushShown")}closePush(event){if(event){event.preventDefault()}if(this.hasBeenRemoved===false){this.hasBeenRemoved=true;this.$el.removeClass("is-active");_.delay(()=>{this.model.collection.remove(this.model);Adapt$1.trigger("notify:pushRemoved",this);this.remove()},600)}}triggerEvent(event){Adapt$1.trigger(this.model.get("_callbackEvent"));this.closePush()}updateIndexPosition(){if(this.hasBeenRemoved)return;const models=this.model.collection.models;models.forEach((model,index)=>{if(!model.get("_isActive"))return;model.set("_index",index);this.updatePushPosition()})}updatePushPosition(){if(this.hasBeenRemoved){return}if(typeof this.model.get("_index")!=="undefined"){const elementHeight=this.$el.height();const offset=20;const navigationHeight=$(".nav").height();const currentIndex=this.model.get("_index");let flippedIndex=currentIndex===0?1:0;if(this.model.collection.where({_isActive:true}).length===1){flippedIndex=0}const positionLowerPush=(elementHeight+offset)*flippedIndex+navigationHeight+offset;this.$el.css("top",positionLowerPush)}}});var NotifyModel=__AMD("core/js/models/notifyModel",class NotifyModel extends LockingModel{defaults(){return{_isActive:false,_showIcon:false,_timeout:3000}}});var NotifyPushCollection=__AMD("core/js/collections/notifyPushCollection",class NotifyPushCollection extends Backbone.Collection{initialize(){this.model=NotifyModel;this.listenTo(this,"add",this.onPushAdded);this.listenTo(Adapt$1,"notify:pushRemoved",this.onRemovePush)}onPushAdded(model){this.checkPushCanShow(model)}checkPushCanShow(model){if(!this.canShowPush())return;model.set("_isActive",true);this.showPush(model)}canShowPush(){const availablePushNotifications=this.where({_isActive:true});return availablePushNotifications.length<2}showPush(model){new NotifyPushView({model:model})}onRemovePush(view){const inactivePushNotifications=this.where({_isActive:false});if(inactivePushNotifications.length>0){this.checkPushCanShow(inactivePushNotifications[0])}}});var NotifyPopupView=__AMD("core/js/views/notifyPopupView",class NotifyPopupView extends Backbone__default["default"].View{className(){return`notify ${this.model.get("_classes")||""}`}attributes(){return Object.assign({role:"dialog","aria-labelledby":"notify-heading","aria-modal":"true"},this.model.get("_attributes"))}events(){return{"click .js-notify-btn-alert":"onAlertButtonClicked","click .js-notify-btn-prompt":"onPromptButtonClicked","click .js-notify-close-btn":"onCloseButtonClicked","click .js-notify-shadow-click":"onShadowClicked"}}initialize(_ref){let{notify}=_ref;this.notify=notify;_.bindAll(this,"resetNotifySize","onKeyUp");this.disableAnimation=Adapt$1.config.get("_disableAnimation")||false;this.isOpen=false;this.hasOpened=false;this.setupEventListeners();this.render()}setupEventListeners(){this.listenTo(Adapt$1,{remove:this.closeNotify,"notify:resize":this.resetNotifySize,"notify:cancel":this.cancelNotify,"notify:close":this.closeNotify,"device:resize":this.resetNotifySize});this.setupEscapeKey()}setupEscapeKey(){$(window).on("keyup",this.onKeyUp)}onKeyUp(event){if(event.which!==27)return;event.preventDefault();this.cancelNotify()}render(){const data=this.model.toJSON();const template=Handlebars.templates.notifyPopup;this.$el.css("visibility","hidden");this.$el.html(template(data)).appendTo(".notify__popup-container");this.$(".notify__popup").css("visibility","hidden");this.$el.css("visibility","visible");this.showNotify();return this}onAlertButtonClicked(event){event.preventDefault();this.closeNotify();Adapt$1.trigger(this.model.get("_callbackEvent"),this)}onPromptButtonClicked(event){event.preventDefault();this.closeNotify();Adapt$1.trigger($(event.currentTarget).attr("data-event"),this)}onCloseButtonClicked(event){event.preventDefault();this.cancelNotify()}onShadowClicked(event){event.preventDefault();if(this.model.get("_closeOnShadowClick")===false)return;this.cancelNotify()}cancelNotify(){if(this.model.get("_isCancellable")===false)return;this.closeNotify();Adapt$1.trigger("notify:cancelled",this)}resetNotifySize(){if(!this.hasOpened)return;this.resizeNotify()}resizeNotify(){const windowHeight=$(window).height();const notifyHeight=this.$(".notify__popup-inner").outerHeight();const isFullWindow=notifyHeight>=windowHeight;this.$(".notify__popup").css({height:isFullWindow?"100%":"auto",top:isFullWindow?0:"","margin-top":isFullWindow?"":-(notifyHeight/2),"overflow-y":isFullWindow?"scroll":"","-webkit-overflow-scrolling":isFullWindow?"touch":""})}async showNotify(){this.isOpen=true;await this.addSubView();this.notify.stack.push(this);this.$previousActiveElement=$(document.activeElement);Adapt$1.trigger("notify:opened",this);this.$el.imageready(this.onLoaded.bind(this))}onLoaded(){if(this.disableAnimation){this.$(".notify__shadow").css("display","block")}else{this.$(".notify__shadow").velocity({opacity:0},{duration:0}).velocity({opacity:1},{duration:400,begin:()=>{this.$(".notify__shadow").css("display","block")}})}this.resizeNotify();if(this.disableAnimation){this.$(".notify__popup").css("visibility","visible");this.onOpened()}else{this.$(".notify__popup").velocity({opacity:0},{duration:0}).velocity({opacity:1},{duration:400,begin:()=>{this.$(".notify__popup").css("visibility","visible");this.onOpened()}})}}onOpened(){$.inview();this.hasOpened=true;a11y$1.popupOpened(this.$(".notify__popup"));a11y$1.scrollDisable("body");$("html").addClass("notify");a11y$1.focusFirst(this.$(".notify__popup"),{defer:false})}async addSubView(){this.subView=this.model.get("_view");if(this.model.get("_id")){const model=data$1.findById(this.model.get("_id"));const View=components$1.getViewClass(model);this.subView=new View({model})}if(!this.subView)return;this.subView.$el.on("resize",this.resetNotifySize);this.$(".notify__content-inner").prepend(this.subView.$el);if(!(this.subView instanceof AdaptView$1)||this.subView.model.get("_isReady"))return;return new Promise(resolve=>{const check=(model,value)=>{if(!value)return;this.subView.model.off("change:_isReady",check);resolve()};this.subView.model.on("change:_isReady",check)})}closeNotify(){const stackItem=this.notify.stack[this.notify.stack.length-1];if(this!==stackItem)return;this.notify.stack.pop();if(!this.isOpen)return;this.isOpen=false;if(this.hasOpened){this.onCloseReady();return}this.listenToOnce(Adapt$1,"popup:opened",()=>{_.defer(this.onCloseReady.bind(this))})}onCloseReady(){if(this.disableAnimation){this.$(".notify__popup").css("visibility","hidden");this.$el.css("visibility","hidden");this.remove()}else{this.$(".notify__popup").velocity({opacity:0},{duration:400,complete:()=>{this.$(".notify__popup").css("visibility","hidden")}});this.$(".notify__shadow").velocity({opacity:0},{duration:400,complete:()=>{this.$el.css("visibility","hidden");this.remove()}})}a11y$1.scrollEnable("body");$("html").removeClass("notify");a11y$1.popupClosed(this.$previousActiveElement);Adapt$1.trigger("notify:closed",this)}remove(){this.removeSubView();$(window).off("keyup",this.onKeyUp);super.remove(...arguments)}removeSubView(){if(!this.subView)return;this.subView.$el.off("resize",this.resetNotifySize);if(this.subView instanceof AdaptView$1){const views=[...this.subView.findDescendantViews(),this.subView];views.forEach(view=>{view.model.set("_isReady",false);view.remove()})}else{this.subView.remove()}this.subView=null}});var NotifyView=__AMD("core/js/views/notifyView",class NotifyView extends Backbone.View{className(){return"notify__container"}initialize(){this._stack=[];this.notifyPushes=new NotifyPushCollection;this.listenTo(Adapt$1,{"notify:popup":this._deprecated.bind(this,"popup"),"notify:alert":this._deprecated.bind(this,"alert"),"notify:prompt":this._deprecated.bind(this,"prompt"),"notify:push":this._deprecated.bind(this,"push")});this.render()}get stack(){return this._stack}get isOpen(){return this.stack.length>0}_deprecated(type,notifyObject){logging$1.deprecated(`NOTIFY DEPRECATED: Adapt.trigger('notify:${type}', notifyObject); is no longer supported, please use notify.${type}(notifyObject);`);return this.create(notifyObject,{_type:type})}render(){const notifyTemplate=Handlebars.templates.notify;this.$el.html(notifyTemplate());this.$el.appendTo("body")}create(notifyObject,defaults){notifyObject=_.defaults({},notifyObject,defaults,{_type:"popup",_isCancellable:true,_showCloseButton:true,_closeOnShadowClick:true});if(notifyObject._type==="push"){this.notifyPushes.push(notifyObject);return}return new NotifyPopupView({model:new NotifyModel(notifyObject),notify:this})}popup(notifyObject){return this.create(notifyObject,{_type:"popup"})}alert(notifyObject){return this.create(notifyObject,{_type:"alert"})}prompt(notifyObject){return this.create(notifyObject,{_type:"prompt"})}push(notifyObject){return this.create(notifyObject,{_type:"push"})}});const notify=new NotifyView;var notify$1=__AMD("core/js/notify",notify);var RouterModel=__AMD("core/js/models/routerModel",class RouterModel extends LockingModel{defaults(){return{_canNavigate:true,_shouldNavigateFocus:true}}lockedAttributes(){return{_canNavigate:false,_shouldNavigateFocus:false}}});class Router extends Backbone.Router{routes(){return{"":"handleRoute","id/:id":"handleRoute",":pluginName(/*location)(/*action)":"handleRoute"}}initialize(_ref){let{model}=_ref;this.navigateToElement=this.navigateToElement.bind(this);this._isBackward=false;this.model=model;this._navigationRoot=null;this._isCircularNavigationInProgress=false;this.showLoading();this.$wrapper=$("#wrapper");this.$html=$("html");this.listenToOnce(Adapt$1,"app:dataReady",this.setDocumentTitle);this.listenTo(Adapt$1,"router:navigateTo",this.navigateToArguments)}get rootModel(){return this._navigationRoot||Adapt$1.course}set rootModel(model){this._navigationRoot=model}showLoading(){$(".js-loading").show()}hideLoading(){$(".js-loading").hide()}setDocumentTitle(){const currentModel=location$1._currentModel;const hasSubTitle=currentModel&&currentModel!==router.rootModel&&currentModel.get("title");const title=[this.rootModel.get("title"),hasSubTitle&&currentModel.get("title")].filter(Boolean).join(" | ");this.listenToOnce(Adapt$1,"contentObjectView:preRender",()=>{const escapedTitle=$(`<div>${title}</div>`).text();document.title=escapedTitle})}navigateToArguments(args){args=args.filter(v=>v!==null);const options={trigger:false,replace:false};if(args.length===1&&data$1.findById(args[0])){this.navigate("#/id/"+args[0],options);return}if(args.length<=3){this.navigate("#/"+args.join("/"),options);return}logging$1.deprecated("Use Backbone.history.navigate or window.location.href instead of Adapt.trigger('router:navigateTo')");this.handleRoute(...args)}handleRoute(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}args=args.filter(v=>v!==null);if(this.model.get("_canNavigate")){this._isCircularNavigationInProgress=false}if(this._isCircularNavigationInProgress===false){Adapt$1.trigger("router:navigate",args)}if(this.model.get("_canNavigate")){this.model.set("_canNavigate",false,{pluginName:"adapt"});this._isBackward=false;if(args.length<=1){return this.handleId(...args)}return this.handlePluginRouter(...args)}if(this._isCircularNavigationInProgress){this._isCircularNavigationInProgress=false;return}this._isCircularNavigationInProgress=true;Adapt$1.trigger("router:navigationCancelled",args);Backbone.history.history[this._isBackward?"forward":"back"]();this._isBackward=false}async handlePluginRouter(pluginName,location,action){const pluginLocation=[pluginName,location&&`-${location}`,action&&`-${action}`].filter(Boolean).join("");await this.updateLocation(pluginLocation,null,null,null);Adapt$1.trigger("router:plugin:"+pluginName,pluginName,location,action);Adapt$1.trigger("router:plugin",pluginName,location,action);this.model.set("_canNavigate",true,{pluginName:"adapt"})}async handleId(id){const rootModel=router.rootModel;let model=!id?rootModel:data$1.findById(id);if(!model){this.model.set("_canNavigate",true,{pluginName:"adapt"});return}const isContentObject=model.isTypeGroup?.("contentobject");const navigateToId=model.get("_id");model=isContentObject?model:model.findAncestor("contentobject");id=model.get("_id");const isRoot=model===rootModel;if(isRoot&&Adapt$1.course.has("_start")){const startController=Adapt$1.course.get("_start");if(startController._isEnabled===true&&startController._isMenuDisabled===true){return}}if(model.get("_isLocked")&&Adapt$1.config.get("_forceRouteLocking")){logging$1.warn("Unable to navigate to locked id: "+id);this.model.set("_canNavigate",true,{pluginName:"adapt"});if(location$1._previousId===undefined){return this.navigate("#/",{trigger:true,replace:true})}return this.navigateBack()}this.showLoading();await Adapt$1.remove();const isCourse=model.isTypeGroup?.("course");const type=isCourse?"menu":model.get("_type");const newLocation=isCourse?"course":`${type}-${id}`;model.set("_isVisited",true);await this.updateLocation(newLocation,type,id,model);Adapt$1.once("contentObjectView:ready",()=>{this.model.set("_canNavigate",true,{pluginName:"adapt"});this.handleNavigationFocus()});Adapt$1.trigger(`router:${type} router:contentObject`,model);const ViewClass=components$1.getViewClass(model);const isMenu=model.isTypeGroup?.("menu");if(!ViewClass&&isMenu){logging$1.deprecated(`Using event based menu view instantiation for '${components$1.getViewName(model)}'`);return}if(!isMenu){_.invoke(model.getAllDescendantModels(),"checkIfResetOnRevisit");await Adapt$1.deferUntilCompletionChecked()}this.$wrapper.append(new ViewClass({model}).$el);if(!isContentObject&&!this.isScrolling){await this.navigateToElement("."+navigateToId,{replace:true,duration:400})}}async updateLocation(currentLocation,type,id,currentModel){location$1._previousModel=location$1._currentModel;location$1._previousId=location$1._currentId;location$1._previousContentType=location$1._contentType;location$1._currentModel=currentModel;location$1._currentId=id;location$1._contentType=type;location$1._currentLocation=currentLocation;if(type==="menu"){location$1._lastVisitedType="menu";location$1._lastVisitedMenu=id}else if(type==="page"){location$1._lastVisitedType="page";location$1._lastVisitedPage=id}this.setDocumentTitle();this.setGlobalClasses();Adapt$1.trigger("router:location",location$1);await wait$1.queue()}setGlobalClasses(){const currentModel=location$1._currentModel;const htmlClasses=currentModel?.get("_htmlClasses")||"";const classes=location$1._currentId?`location-${location$1._contentType} location-id-${location$1._currentId}`:`location-${location$1._currentLocation}`;const currentClasses=`${classes} ${htmlClasses}`;this.$html.removeClass(location$1._previousClasses).addClass(currentClasses).attr("data-location",location$1._currentLocation);this.$wrapper.removeClass().addClass(classes).attr("data-location",location$1._currentLocation);location$1._previousClasses=currentClasses}handleNavigationFocus(){if(!this.model.get("_shouldNavigateFocus"))return;a11y$1.focus("body")}navigateBack(){this._isBackward=true;Backbone.history.history.back()}navigateToCurrentRoute(force){if(!this.model.get("_canNavigate")&&!force){return}if(!location$1._currentId){return}const currentId=location$1._currentModel.get("_id");const isRoot=location$1._currentModel===this.rootModel;const route=isRoot?"#/":"#/id/"+currentId;this.navigate(route,{trigger:true,replace:true})}navigateToPreviousRoute(force){if(!this.model.get("_canNavigate")&&!force){return}const currentModel=location$1._currentModel;const previousModel=location$1._previousModel;if(!currentModel){return this.navigateBack()}if(location$1._currentModel?.isTypeGroup("menu")){return this.navigateToParent()}if(previousModel){return this.navigateBack()}this.navigateToParent()}navigateToParent(force){if(!this.model.get("_canNavigate")&&!force){return}const parentId=location$1._currentModel.get("_parentId");const parentModel=data$1.findById(parentId);const isRoot=parentModel===this.rootModel;const route=isRoot?"#/":"#/id/"+parentId;this.navigate(route,{trigger:true})}navigateToHomeRoute(force){if(!this.model.get("_canNavigate")&&!force){return}this.navigate("#/",{trigger:true})}async navigateToElement(selector){let settings=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const currentModelId=selector.replace(/\./g,"").split(" ")[0];const isSelectorAnId=data$1.hasId(currentModelId);if(isSelectorAnId){const currentModel=data$1.findById(currentModelId);const contentObject=currentModel.isTypeGroup?.("contentobject")?currentModel:currentModel.findAncestor("contentobject");const contentObjectId=contentObject.get("_id");const isNotInCurrentContentObject=contentObjectId!==location$1._currentId;if(currentModel&&(!currentModel.get("_isRendered")||!currentModel.get("_isReady")||isNotInCurrentContentObject)){const shouldReplace=settings.replace||false;if(isNotInCurrentContentObject){this.isScrolling=true;this.navigate(`#/id/${currentModelId}`,{trigger:true,replace:shouldReplace});this.model.set("_shouldNavigateFocus",false,{pluginName:"adapt"});await new Promise(resolve=>Adapt$1.once("contentObjectView:ready",_.debounce(()=>{this.model.set("_shouldNavigateFocus",true,{pluginName:"adapt"});resolve()},1)));this.isScrolling=false}await Adapt$1.parentView.renderTo(currentModelId)}if(currentModel&&selector===currentModel.get("_id")){selector=`.${selector}`}}const isElementUnavailable=!$(selector).length;if(isElementUnavailable){logging$1.warn(`router.navigateToElement, selector not found in document: ${selector}`);return}const newLocation=location$1._contentType?location$1._contentType:location$1._currentLocation;Adapt$1.trigger(`${newLocation}:scrollTo`,selector);const disableScrollToAnimation=Adapt$1.config.has("_disableAnimation")?Adapt$1.config.get("_disableAnimation"):false;if(disableScrollToAnimation){settings.duration=0}else if(!settings.duration){settings.duration=$.scrollTo.defaults.duration}const $wrapper=$("#wrapper");let offsetTop=-parseInt($wrapper.css("padding-top"));if($(selector).hasClass("component")){offsetTop-=$(selector).find(".aria-label").height()||0}if(!settings.offset)settings.offset={top:offsetTop,left:0};if(settings.offset.top===undefined)settings.offset.top=offsetTop;if(settings.offset.left===undefined)settings.offset.left=0;if(settings.offset.left===0)settings.axis="y";if(Adapt$1.get("_canScroll")!==false){$.scrollTo(selector,settings)}await new Promise(resolve=>{_.delay(()=>{a11y$1.focusNext(selector);Adapt$1.trigger(`${location$1}:scrolledTo`,selector);resolve()},settings.duration+300)})}get(){logging$1.deprecated("router.get, please use router.model.get");return this.model.get(...arguments)}set(){logging$1.deprecated("router.set, please use router.model.set");return this.model.set(...arguments)}}const router=new Router({model:new RouterModel(null,{reset:true})});var router$1=__AMD("core/js/router",router);class Scrolling extends Backbone.Controller{initialize(){this.scrollTo=this.scrollTo.bind(this);this.$html=$("html");this.isLegacyScrolling=true;Adapt$1.once("configModel:dataLoaded",this._loadConfig.bind(this))}_loadConfig(){const config=Adapt$1.config.get("_scrollingContainer");if(!config?._isEnabled)return;const limitTo=config._limitToSelector;const isIncluded=!limitTo||this.$html.is(limitTo)||this.$html.hasClass(limitTo);if(!isIncluded)return;this.isLegacyScrolling=false;this._windowScrollFix();this._addStyling();this._updateScrollbarWidth();this.listenTo(Adapt$1,"device:resize",this._updateScrollbarWidth)}_addStyling(){this.$html.addClass("adapt-scrolling")}_updateScrollbarWidth(){const $tester=$("<div class=\"outer\" style=\"overflow:scroll; visibility: hidden; position:fixed; top: 0; left: 0;\"><div class=\"inner\"> </div></div>\"");$("body").append($tester);const scrollBarWidth=$tester.outerWidth()-$tester.find(".inner").outerWidth();$tester.remove();const documentStyle=document.documentElement.style;documentStyle.setProperty("--adapt-scrollbar-width",`${scrollBarWidth}px`)}_windowScrollFix(){const body=document.body;const html=Adapt$1.scrolling.$html[0];const scrollY={get:()=>body.scrollTop,set:value=>body.scrollTop=value};const scrollX={get:()=>body.scrollLeft,set:value=>body.scrollLeft=value};const scrollHeight={get:()=>body.scrollHeight,set:value=>body.scrollHeight=value};const scrollWidth={get:()=>body.scrollWidth,set:value=>body.scrollWidth=value};Object.defineProperties(window,{scrollY,scrollX,pageYOffset:scrollY,pageXOffset:scrollX});Object.defineProperties(html,{scrollHeight,scrollWidth});window.scrollTo=function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}const isObject=args.length===1&&typeof args[0]==="object"&&args[0]!==null;const left=(isObject?args[0].left:args[0])??null;const top=(isObject?args[0].top:args[1])??null;left!==null&&(body.scrollLeft=left);top!==null&&(body.scrollTop=top)};const MouseEvent=window.MouseEvent;Object.defineProperties(MouseEvent.prototype,{pageX:{get:function(){return this.clientX+scrollX.get()}},pageY:{get:function(){return this.clientY+scrollY.get()}}});const $window=$(window);$(document.body).on("scroll",()=>$window.scroll())}async scrollTo(selector){let settings=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};logging$1.deprecated("Adapt.scrollTo and Adapt.scrolling.scrollTo, use router.navigateToElement instead.");return router$1.navigateToElement(selector,settings)}}const scrolling=new Scrolling;var scrolling$1=__AMD("core/js/scrolling",scrolling);class StartController extends Backbone.Controller{initialize(){super.initialize(...arguments);this.model=null}loadCourseData(){this.model=new LockingModel(Adapt$1.course.get("_start"))}setStartLocation(){if(!this.isEnabled())return;window.history.replaceState("","",this.getStartHash())}returnToStartLocation(){const startIds=this.model.get("_startIds");if(startIds){startIds.forEach(startId=>startId._skipIfComplete=false)}window.location.hash=this.getStartHash(true)}getStartHash(alwaysForce){const startId=this.getStartId();const isRouteSpecified=window.location.href.indexOf("#")>-1;const shouldForceStartId=alwaysForce||this.model.get("_force");const shouldNavigateToStartId=startId&&(!isRouteSpecified||shouldForceStartId);if(shouldNavigateToStartId&&startId!==Adapt$1.course.get("_id")){return"#/id/"+startId}return window.location.hash||"#/"}isEnabled(){return Boolean(this.model?.get("_isEnabled"))}getStartId(){let startId=this.model.get("_id");const startIds=this.model.get("_startIds");if(!startIds?.length)return startId;const $html=$("html");for(let i=0,l=startIds.length;i<l;i++){const item=startIds[i];const className=item._className;const skipIfComplete=item._skipIfComplete;const model=data$1.findById(item._id);if(!model){console.log("startController: cannot find id",item._id);continue}if(skipIfComplete){if(model.get("_isComplete"))continue}if(!className||$html.is(className)||$html.hasClass(className)){startId=item._id;break}}return startId}}Adapt$1.once("adapt:start",()=>{startController.loadCourseData();startController.setStartLocation()});Adapt$1.on("navigation:returnToStart",()=>{startController.returnToStartLocation()});Adapt$1.on("app:languageChanged",()=>{wait$1.for(done=>{startController.loadCourseData();const hash=startController.isEnabled()?startController.getStartHash(false):"#/";router$1.navigate(hash,{trigger:true,replace:true});done()})});const startController=new StartController;var startController$1=__AMD("core/js/startController",startController);const COMPLETION_STATE=ENUM(["INCOMPLETE","COMPLETED","PASSED","FAILED"]);var COMPLETION_STATE$1=__AMD("core/js/enums/completionStateEnum",COMPLETION_STATE);class Tracking extends Backbone.Controller{initialize(){this._config={_requireContentCompleted:true,_requireAssessmentCompleted:false,_shouldSubmitScore:false};this._assessmentState=null;Adapt$1.once("configModel:dataLoaded",this.loadConfig.bind(this));Adapt$1.on("app:dataReady",this.setupEventListeners.bind(this))}setupEventListeners(){this.listenTo(Adapt$1,{"assessment:complete":this.onAssessmentComplete,"assessment:restored":this.onAssessmentRestored});if(this._config._requireContentCompleted){this.listenTo(Adapt$1.course,"change:_isComplete",this.checkCompletion)}}onAssessmentComplete(assessmentState){this._assessmentState=assessmentState;this.submitScore();if(this._config._requireAssessmentCompleted){this.checkCompletion()}}submitScore(){if(!this._config._shouldSubmitScore)return;if(this._assessmentState.isPercentageBased){offlineStorage$1.set("score",this._assessmentState.scoreAsPercent,0,100);return}offlineStorage$1.set("score",this._assessmentState.score,this._assessmentState.minScore,this._assessmentState.maxScore)}onAssessmentRestored(assessmentState){this._assessmentState=assessmentState}checkCompletion(){const completionData=this.getCompletionData();if(completionData.status===COMPLETION_STATE$1.INCOMPLETE){return}const canRetry=completionData.assessment?.canRetry===true;if(completionData.status===COMPLETION_STATE$1.FAILED&&canRetry){return}Adapt$1.trigger("tracking:complete",completionData);logging$1.debug("tracking:complete",completionData)}getCompletionData(){const completionData={status:COMPLETION_STATE$1.INCOMPLETE,assessment:null};if(this._config._requireContentCompleted&&!Adapt$1.course.get("_isComplete")){return completionData}if(this._config._requireAssessmentCompleted){if(!this._assessmentState){return completionData}completionData.status=this._assessmentState.isPass?COMPLETION_STATE$1.PASSED:COMPLETION_STATE$1.FAILED;completionData.assessment=this._assessmentState;return completionData}completionData.status=COMPLETION_STATE$1.COMPLETED;return completionData}loadConfig(){this._config=Adapt$1.config.get("_completionCriteria")??this._config;const newShouldSubmitScore=this._config._shouldSubmitScore;const legacyShouldSubmitScore=Adapt$1.config.get("_spoor")?._tracking?._shouldSubmitScore;if(legacyShouldSubmitScore!==undefined)logging$1.deprecated("config.json:_spoor._tracking._shouldSubmitScore, please use only config.json:_completionCriteria._shouldSubmitScore");this._config._shouldSubmitScore=legacyShouldSubmitScore??newShouldSubmitScore??true}}const tracking=new Tracking;var tracking$1=__AMD("core/js/tracking",tracking);const beginWait=()=>{logging$1.deprecated("Use wait.begin() as Adapt.trigger('plugin:beginWait') will be removed in the future");wait$1.begin()};const endWait=()=>{logging$1.deprecated("Use wait.end() as Adapt.trigger('plugin:endWait') will be removed in the future");wait$1.end()};const ready=()=>{if(wait$1.isWaiting()){return}const isEventListening=Adapt$1._events["plugins:ready"];if(!isEventListening){return}logging$1.deprecated("Use wait.queue(callback) as Adapt.on('plugins:ready', callback) will be removed in the future");Adapt$1.trigger("plugins:ready")};Adapt$1.listenTo(wait$1,"ready",ready);Adapt$1.on({"plugin:beginWait":beginWait,"plugin:endWait":endWait});Object.defineProperties(Adapt$1,{accessibility:{get(){a11y$1.log.deprecated("Adapt.accessibility has moved to a11y");return a11y$1}},a11y:{get(){logging$1.deprecated("Adapt.a11y, please use core/js/a11y directly");return a11y$1}},componentStore:{get(){logging$1.deprecated("Adapt.componentStore, please use core/js/components directly");return components$1._register}},data:{get(){logging$1.deprecated("Adapt.data, please use core/js/data directly");return data$1}},device:{get(){logging$1.deprecated("device, please use core/js/device directly");return device$1}},drawer:{get(){logging$1.deprecated("Adapt.drawer, please use core/js/drawer directly");return drawer}},findById:{get(){logging$1.deprecated("Adapt.findById, please use data.findById directly");return data$1.findById}},findViewByModelId:{get(){logging$1.deprecated("Adapt.findViewByModelId, please use data.findViewByModelId directly");return data$1.findViewByModelId}},findByTrackingPosition:{get(){logging$1.deprecated("Adapt.findByTrackingPosition, please use data.findByTrackingPosition directly");return data$1.findByTrackingPosition}},getViewName:{get(){logging$1.deprecated("Adapt.getViewName, please use components.getViewName instead");return components$1.getViewName}},getViewClass:{get(){logging$1.deprecated("Adapt.getViewClass, please use components.getViewClass instead");return components$1.getViewClass}},getModelName:{get(){logging$1.deprecated("Adapt.getModelName, please use components.getModelName instead");return components$1.getModelName}},getModelClass:{get(){logging$1.deprecated("Adapt.getModelClass, please use components.getModelClass instead");return components$1.getModelClass}},location:{get(){logging$1.deprecated("Adapt.location, please use core/js/location directly");return location$1}},log:{get(){logging$1.deprecated("Adapt.log, please use core/js/logging directly");return logging$1}},mpabc:{get(){logging$1.deprecated("Adapt.mpabc, please use core/js/mpabc directly");return mpabc$1}},notify:{get(){logging$1.deprecated("Adapt.notify, please use core/js/notify directly");return notify$1}},offlineStorage:{get(){logging$1.deprecated("offlineStorage, please use src/core/offlineStorage instead");return offlineStorage$1}},navigateToElement:{get(){logging$1.deprecated("Adapt.navigateToElement, please use router.navigateToElement");return router$1.navigateToElement}},register:{get(){logging$1.deprecated("Adapt.register, please use components.register instead");return components$1.register}},router:{get(){logging$1.deprecated("Adapt.router, please use core/js/router directly");return router$1}},scrolling:{get(){logging$1.deprecated("Adapt.scrolling, please use core/js/scrolling directly");return scrolling$1}},scrollTo:{get(){logging$1.deprecated("Adapt.scrollTo, please use router.navigateToElement");return scrolling$1.scrollTo}},startController:{get(){logging$1.deprecated("Adapt.startController, please use core/js/startController directly");return startController$1}},store:{get(){logging$1.deprecated("Adapt.store, please use core/js/components directly");return components$1._register}},tracking:{get(){logging$1.deprecated("Adapt.tracking, please use core/js/tracking directly");return tracking$1}},wait:{get(){logging$1.deprecated("Adapt.wait, please use src/core/wait instead");return wait$1}}});function onRender(cb){const intercept=(object,name,mode,cb)=>{return object[name]=cb.bind(object,object[name],name,mode)};Object.keys(Handlebars.templates).forEach(name=>{intercept(Handlebars.templates,name,"template",cb)});Object.keys(Handlebars.partials).forEach(name=>{intercept(Handlebars.partials,name,"partial",cb)})}onRender(function(template,name,mode){for(var _len=arguments.length,args=new Array(_len>3?_len-3:0),_key=3;_key<_len;_key++){args[_key-3]=arguments[_key]}const preRenderEvent=new TemplateRenderEvent(`${mode}:preRender`,name,mode,null,args);Adapt$1.trigger(preRenderEvent.type,preRenderEvent);const value=template(...preRenderEvent.args);const postRenderEvent=new TemplateRenderEvent(`${mode}:postRender`,name,mode,value,preRenderEvent.args);Adapt$1.trigger(postRenderEvent.type,postRenderEvent);return postRenderEvent.value});Adapt$1.on("app:dataReady",()=>{const config=Adapt$1.config.get("_fixes");if(config?._imgLazyLoad===false)return;applyImgLoadingFix()});function applyImgLoadingFix(){const findImgTag=/<img([^>]*)>/gi;const hasLoadingAttr=/ loading=/gi;Adapt$1.on("template:postRender partial:postRender",event=>{const imgTagsFound=event.value.match(findImgTag);if(!imgTagsFound){return}event.value=imgTagsFound.reduce((value,img)=>{if(hasLoadingAttr.test(img)){return value}return value.replace(img,img.replace(findImgTag,"<img loading=\"eager\"$1>"))},event.value)});Adapt$1.on("reactElement:preRender",event=>{if(event.name!=="img")return;const options=event.args[1]=event.args[1]||{};if(options&&options.hasOwnProperty("loading"))return;options.loading="eager"})}Adapt$1.on("app:dataReady",()=>{const config=Adapt$1.config.get("_fixes");if(config?._jsxReactHelpersHTML===false)return;applyReactHelpersHTML()});function applyReactHelpersHTML(){Adapt$1.on("reactElement:preRender",event=>{let[tagName,props,...children]=event.args;if(!children)return;if(!Array.isArray(children))children=[children];children=children.filter(Boolean);const hasSomeUnsafeConversions=children.some(c=>c?.__html);if(!hasSomeUnsafeConversions)return;const hasManyChildren=children.length>1;if(hasManyChildren){event.args=event.args.map(child=>{if(!child||!child.__html)return child;const attributes=Object.entries(props).map(_ref=>{let[name,value]=_ref;return`${name}="${value}"`}).join(" ");logging$1.warnOnce(`html() call should be the only child in its parent <${tagName} ${attributes}>`);return child.__html?HTMLReactParser__default["default"](child.__html):undefined});return}props=event.args[1]=event.args[1]||{};props.dangerouslySetInnerHTML=children[0];event.args.length=2})}const helpers$6={lowercase(text){return text.toLowerCase()},capitalise(text){return text.charAt(0).toUpperCase()+text.slice(1)},inc(index){return index+1},dec(index){return index-1},odd(index){return(index+1)%2===0?"even":"odd"},equals(value,text,block){return helpers$6.compare.call(this,value,"==",text,block)},compare(value,operator,text,block){switch(operator){case"===":if(value===text)return block.fn(this);break;case"=":case"==":if(value==text)return block.fn(this);break;case">=":if(value>=text)return block.fn(this);break;case"<=":if(value<=text)return block.fn(this);break;case">":if(value>text)return block.fn(this);break;case"<":if(value<text)return block.fn(this);break;}return block.inverse(this)},math(lvalue,operator,rvalue,options){lvalue=parseFloat(lvalue);rvalue=parseFloat(rvalue);switch(operator){case"+":return lvalue+rvalue;case"-":return lvalue-rvalue;case"*":return lvalue*rvalue;case"/":return lvalue/rvalue;case"%":return lvalue%rvalue;}},any(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}const specified=args.slice(0,-1);const block=args.slice(-1)[0];return specified.some(Boolean)?block.fn?block.fn(this):true:block.inverse?block.inverse(this):false},all(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}const specified=args.slice(0,-1);const block=args.slice(-1)[0];return specified.every(Boolean)?block.fn?block.fn(this):true:block.inverse?block.inverse(this):false},none(){for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3]}const specified=args.slice(0,-1);const block=args.slice(-1)[0];return!specified.some(Boolean)?block.fn?block.fn(this):true:block.inverse?block.inverse(this):false},compile(template,context){if(!template)return"";if(template instanceof Object)template=template.toString();const data=context?.data?.root?this:context;return Handlebars.compile(template)(data)},compile_a11y_text(template,context){a11y$1.log.deprecated("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return helpers$6.compile.call(this,template,context)},compile_a11y_normalize(template,context){if(!template){return""}if(template instanceof Object)template=template.toString();return Handlebars.helpers.a11y_normalize.call(this,helpers$6.compile.call(this,template,context))},compile_a11y_remove_breaks(template,context){if(!template){return""}return Handlebars.helpers.a11y_remove_breaks.call(this,helpers$6.compile.call(this,template,context))},import_globals(context){if(context.data.root._globals){return""}context.data.root._globals=Adapt$1.course.get("_globals");return""},import_adapt(context){if(context.data.root.Adapt){return}const adapt=context.data.root.Adapt={};let i,l,name;const directImport=["config","course"];for(i=0,l=directImport.length;i<l;i++){name=directImport[i];adapt[name]=Adapt$1[name].toJSON()}const indexedImport=["contentObjects","articles","blocks","components"];for(i=0,l=indexedImport.length;i<l;i++){name=indexedImport[i];const importArray=Adapt$1[name].toJSON();const importIndex={};for(let i1=0,l1=importArray.length;i1<l1;i1++){const item=importArray[i1];importIndex[item._id]=item}adapt[name]=importIndex}return""},component_description(override,context){if(!this._isA11yComponentDescriptionEnabled){return}const isNotDefined=!this._globals._components?.["_"+this._component];if(isNotDefined){return}const hasOverride=arguments.length>1;let description;if(hasOverride){description=override;description=helpers$6.compile(description,context)}else{description=this._globals._components["_"+this._component].ariaRegion;description=helpers$6.compile(description,override)}if(!description){return}return new Handlebars.SafeString("<div class=\"aria-label\">"+description+"</div>")},a11y_text(text){a11y$1.log.deprecated("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return text},a11y_normalize(htmls){return a11y$1.normalize.apply(a11y$1,arguments)},a11y_remove_breaks(htmls){return a11y$1.removeBreaks.apply(a11y$1,arguments)},a11y_aria_label(htmls){let values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<div class=\"aria-label\">"+values.join(" ")+"</div>")},a11y_aria_label_relative(htmls){let values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<div class=\"aria-label relative\">"+values.join(" ")+"</div>")},a11y_aria_image(texts){let values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<div class=\"aria-label\" role=\"img\" aria-label=\""+values.join(" ")+"\"></div>")},a11y_wrap_focus(){const cfg=Adapt$1.config.get("_accessibility");if(cfg._isPopupWrapFocusEnabled===false)return"";return new Handlebars.SafeString("<a class=\"a11y-focusguard a11y-ignore a11y-ignore-focus\" tabindex=\"0\" role=\"presentation\">&nbsp;</a>")},a11y_attrs_heading(levelOrType){const level=a11y$1.ariaLevel(levelOrType,this._ariaLevel);return new Handlebars.SafeString(" role=\"heading\" aria-level=\""+level+"\" ")},a11y_attrs_tabbable(){a11y$1.log.deprecated("a11y_attrs_tabbable should not be used. tabbable elements should be natively tabbable.");return new Handlebars.SafeString(" role=\"region\" tabindex=\"0\" ")},a11y_alt_text(visible,alternatives){let values=Array.prototype.slice.call(arguments,1,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<span aria-hidden=\"true\">"+visible+"</span><span class=\"aria-label\">"+values.join(" ")+"</span>")}};Object.assign(helpers$6,{if_value_equals(){a11y$1.log.deprecated("if_value_equals, use equals instead.");return helpers$6.equals.apply(this,arguments)},numbers(){a11y$1.log.deprecated("numbers, use inc instead.");return helpers$6.inc.apply(this,arguments)},lowerCase(){a11y$1.log.deprecated("lowerCase, use lowercase instead.");return helpers$6.lowercase.apply(this,arguments)}});for(const name in helpers$6){Handlebars.registerHelper(name,helpers$6[name])}__AMD("core/js/helpers",helpers$6);class HeadingView extends Backbone.View{initialize(){this.listenTo(Adapt$1.parentView,"postRemove",this.remove);this.listenTo(this.model,"change:_isComplete",this.updateAria);this.render()}render(){const template=Handlebars.templates[this.constructor.template];const data=this.model.toJSON();const customHeadingType=this.$el.attr("data-a11y-heading-type");if(customHeadingType)data._type=customHeadingType;if(data._type==="course")data._type="menu";this.$el.html(template(data));this.checkCompletion()}updateAria(){const template=Handlebars.templates[this.constructor.template];const data=this.model.toJSON();const $rendered=$(`<div>${template(data)}</div>`);this.$(".aria-label").html($rendered.find(".aria-label").html());this.checkCompletion()}checkCompletion(){const isComplete=this.model.get("_isComplete");this.$el.toggleClass("is-complete",isComplete).toggleClass("is-incomplete",!isComplete)}}HeadingView.template="heading";var HeadingView$1=__AMD("core/js/views/headingView",HeadingView);class Headings extends Backbone.Controller{initialize(){this.listenTo(Adapt$1,"view:render",this.onViewRender)}onViewRender(view){const $headingSeats=view.$(".js-heading");$headingSeats.each((index,el)=>new HeadingView$1({el,model:view.model}))}}__AMD("core/js/headings",new Headings);class NavigationView$1 extends Backbone.View{className(){return"nav"}events(){return{"click [data-event]":"triggerEvent"}}attributes(){return{role:"navigation"}}initialize(){this.sortNavigationButtons=_.debounce(this.sortNavigationButtons.bind(this),1);this.listenToOnce(Adapt$1,{"courseModel:dataLoading":this.remove});this.listenTo(Adapt$1,"router:menu router:page",this.onNavigate);this.preRender()}preRender(){Adapt$1.trigger("navigationView:preRender",this);this.render()}render(){const template=Handlebars.templates[this.constructor.template];this.$el.html(template({_globals:Adapt$1.course.get("_globals"),_accessibility:Adapt$1.config.get("_accessibility")})).insertBefore("#app");_.defer(()=>{Adapt$1.trigger("navigationView:postRender",this)});return this}triggerEvent(event){event.preventDefault();const currentEvent=$(event.currentTarget).attr("data-event");Adapt$1.trigger("navigation:"+currentEvent);switch(currentEvent){case"backButton":router$1.navigateToPreviousRoute();break;case"homeButton":router$1.navigateToHomeRoute();break;case"parentButton":router$1.navigateToParent();break;case"skipNavigation":this.skipNavigation();break;case"returnToStart":startController$1.returnToStartLocation();break;}}skipNavigation(){a11y$1.focusFirst("."+location$1._contentType)}onNavigate(model){this.hideNavigationButton(model);this.sortNavigationButtons()}hideNavigationButton(model){const shouldHide=model.get("_type")==="course";this.$(".nav__back-btn, .nav__home-btn").toggleClass("u-display-none",shouldHide)}sortNavigationButtons(){const container=this.$(".nav__inner")[0];const items=[...container.children];items.sort((a,b)=>parseFloat($(a).attr("data-order")||0)-parseFloat($(b).attr("data-order")||0)).forEach(item=>container.appendChild(item))}showNavigationButton(){this.$(".nav__back-btn, .nav__home-btn").removeClass("u-display-none")}}NavigationView$1.template="nav";var NavigationView$2=__AMD("core/js/views/navigationView",NavigationView$1);class NavigationController extends Backbone.Controller{initialize(){this.listenTo(Adapt$1,"adapt:preInitialize",this.addNavigationBar)}addNavigationBar(){const adaptConfig=Adapt$1.course.get("_navigation");if(adaptConfig?._isDefaultNavigationDisabled){Adapt$1.trigger("navigation:initialize");return}Adapt$1.navigation=new NavigationView$2}}__AMD("core/js/navigation",new NavigationController);var ItemModel=__AMD("core/js/models/itemModel",class ItemModel extends LockingModel{defaults(){return{_isActive:false,_isVisited:false,_score:0}}reset(){this.set({_isActive:false,_isVisited:false})}toggleActive(){let isActive=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!this.get("_isActive");this.set("_isActive",isActive)}toggleVisited(){let isVisited=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!this.get("_isVisited");this.set("_isVisited",isVisited)}});var ItemsComponentModel=__AMD("core/js/models/itemsComponentModel",class ItemsComponentModel extends ComponentModel$1{toJSON(){const json=super.toJSON();json._items=this.getChildren().toJSON();return json}init(){this.setUpItems();this.listenTo(this.getChildren(),{all:this.onAll,"change:_isActive":this.setVisitedStatus,"change:_isVisited":this.checkCompletionStatus});super.init()}restoreUserAnswers(){const booleanArray=this.get("_userAnswer");if(!booleanArray)return;this.getChildren().forEach((child,index)=>child.set("_isVisited",booleanArray[index]))}storeUserAnswer(){const booleanArray=this.getChildren().map(child=>child.get("_isVisited"));this.set("_userAnswer",booleanArray)}setUpItems(){const items=this.get("_items")||[];items.forEach((item,index)=>item._index=index);this.setChildren(new Backbone.Collection(items,{model:ItemModel}))}getItem(index){return this.getChildren().findWhere({_index:index})}getVisitedItems(){return this.getChildren().where({_isVisited:true})}getActiveItems(){return this.getChildren().where({_isActive:true})}getActiveItem(){return this.getChildren().findWhere({_isActive:true})}areAllItemsCompleted(){return this.getVisitedItems().length===this.getChildren().length}checkCompletionStatus(){this.setVisitedStatus();this.storeUserAnswer();if(!this.areAllItemsCompleted())return;this.setCompletionStatus()}reset(){let type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"hard";let canReset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.get("_canReset");const wasReset=super.reset(type,canReset);if(!wasReset)return false;this.getChildren().each(item=>item.reset());return true}resetActiveItems(){this.getChildren().each(item=>item.toggleActive(false))}setActiveItem(index){const item=this.getItem(index);if(!item)return;const activeItem=this.getActiveItem();if(activeItem)activeItem.toggleActive(false);item.toggleActive(true)}});var AccordionModel=__AMD("components/adapt-contrib-accordion/js/AccordionModel",class AccordionModel extends ItemsComponentModel{defaults(){return ItemsComponentModel.resultExtend("defaults",{_shouldCollapseItems:true,_shouldExpandFirstItem:false,_toggleSpeed:200})}checkIfResetOnRevisit(){this.resetActiveItems();super.checkIfResetOnRevisit();this.checkExpandFirstItem()}toggleItemsState(index){const item=this.getItem(index);const previousActiveItem=this.getActiveItem();item.toggleActive();item.toggleVisited(true);if(!previousActiveItem||!this.get("_shouldCollapseItems"))return;previousActiveItem.toggleActive(false)}checkExpandFirstItem(){if(!this.get("_shouldExpandFirstItem"))return;this.toggleItemsState(0)}});class ComponentView extends AdaptView$1{attributes(){if(!this.model.get("_isA11yRegionEnabled")){return AdaptView$1.resultExtend("attributes",{},this)}return AdaptView$1.resultExtend("attributes",{"aria-labelledby":this.model.get("_id")+"-heading",role:"region"},this)}className(){return["component",this.model.get("_component").toLowerCase(),this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),"is-"+this.model.get("_layout"),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}renderState(){logging$1.removed("renderState is removed and moved to item title")}setupInviewCompletion(){let inviewElementSelector=arguments.length>0&&arguments[0]!==undefined?arguments[0]:".component__inner";let callback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.setCompletionStatus;this.$inviewElement=this.$(inviewElementSelector);this.inviewCallback=callback;this.$inviewElement.on("inview.componentView",this.onInview.bind(this))}removeInviewListener(){if(!this.$inviewElement)return;this.$inviewElement.off("inview.componentView");this.$inviewElement=null}onInview(event,visible,visiblePartX,visiblePartY){if(!visible)return;switch(visiblePartY){case"top":this.hasSeenTop=true;break;case"bottom":this.hasSeenBottom=true;break;case"both":this.hasSeenTop=this.hasSeenBottom=true;}if(!this.hasSeenTop||!this.hasSeenBottom)return;this.inviewCallback();if(this.model.get("_isComplete")){this.removeInviewListener()}}postRender(){}remove(){this.removeInviewListener();super.remove()}}ComponentView.type="component";var ComponentView$1=__AMD("core/js/views/componentView",ComponentView);class AccordionView extends ComponentView$1{preRender(){this.onClick=this.onClick.bind(this);this.listenTo(this.model.getChildren(),"change:_isActive",this.onItemsActiveChange)}postRender(){this.getItemElement(this.model.getActiveItem())?.find(".js-accordion-item-content")?.css("display","block");this.setReadyStatus();if(this.model.get("_setCompletionOn")!=="inview")return;this.setupInviewCompletion()}onClick(event){this.model.toggleItemsState($(event.currentTarget).parents(".js-accordion-item").data("index"))}onItemsActiveChange(item,isActive){this.toggleItem(item,isActive)}toggleItem(item,shouldExpand){const $item=this.getItemElement(item);const $body=$item.children(".js-accordion-item-content").stop(true,true);if(!shouldExpand){$body.slideUp(this.model.get("_toggleSpeed"));return}$body.slideDown(this.model.get("_toggleSpeed"))}getItemElement(item){if(!item)return;const index=item.get("_index");return this.$(".js-accordion-item").filter(`[data-index="${index}"]`)}}AccordionView.template="accordion.jsx";var AccordionView$1=__AMD("components/adapt-contrib-accordion/js/AccordionView",AccordionView);__AMD("components/adapt-contrib-accordion/js/adapt-contrib-accordion",components$1.register("accordion",{model:AccordionModel,view:AccordionView$1}));var AssessmentResultsModel=__AMD("components/adapt-contrib-assessmentResults/js/assessmentResultsModel",class AssessmentResultsModel extends ComponentModel$1{init(){this.set("originalBody",this.get("body"));this.listenTo(Adapt$1,{"assessments:complete":this.onAssessmentComplete,"assessments:reset":this.onAssessmentReset});super.init(...arguments)}checkIfAssessmentComplete(){if(!Adapt$1.assessment||this.get("_assessmentId")===undefined){return}const assessmentModel=Adapt$1.assessment.get(this.get("_assessmentId"));if(!assessmentModel||assessmentModel.length===0)return;const state=assessmentModel.getState();const isResetOnRevisit=assessmentModel.get("_assessment")._isResetOnRevisit;if(state.isComplete&&(!state.allowResetIfPassed||!isResetOnRevisit)){this.onAssessmentComplete(state);return}this.setVisibility()}onAssessmentComplete(state){if(this.get("_assessmentId")===undefined||this.get("_assessmentId")!==state.id)return;this._state=state;this.set({attempts:state.attempts,attemptsSpent:state.attemptsSpent,attemptsLeft:state.attemptsLeft,score:state.score,scoreAsPercent:state.scoreAsPercent,maxScore:state.maxScore,isPass:state.isPass});this.setFeedbackBand(state);this.checkRetryEnabled(state);this.setFeedbackText();this.toggleVisibility(true)}setFeedbackBand(state){const scoreProp=state.isPercentageBased?"scoreAsPercent":"score";const bands=_.sortBy(this.get("_bands"),"_score");for(let i=bands.length-1;i>=0;i--){const isScoreInBandRange=state[scoreProp]>=bands[i]._score;if(!isScoreInBandRange)continue;this.set("_feedbackBand",bands[i]);break}}checkRetryEnabled(state){const assessmentModel=Adapt$1.assessment.get(state.id);if(!assessmentModel.canResetInPage())return false;const feedbackBand=this.get("_feedbackBand");const isRetryEnabled=(feedbackBand&&feedbackBand._allowRetry)!==false;const isAttemptsLeft=state.attemptsLeft>0||state.attemptsLeft==="infinite";const showRetry=isRetryEnabled&&isAttemptsLeft&&(!state.isPass||state.allowResetIfPassed);this.set({_isRetryEnabled:showRetry,retryFeedback:showRetry?this.get("_retry").feedback:""})}setFeedbackText(){const feedbackBand=this.get("_feedbackBand");const feedback=feedbackBand?Handlebars.compile(feedbackBand.feedback)(this.toJSON()):"";this.set({feedback,body:this.get("_completionBody")})}setVisibility(){if(!Adapt$1.assessment)return;const assessmentModel=Adapt$1.assessment.get(this.get("_assessmentId"));if(!assessmentModel||assessmentModel.length===0)return;const state=assessmentModel.getState();const isAttemptInProgress=state.attemptInProgress;const isComplete=!isAttemptInProgress&&state.isComplete;const isVisibleBeforeCompletion=this.get("_isVisibleBeforeCompletion")||false;const isVisible=isVisibleBeforeCompletion||isComplete;this.toggleVisibility(isVisible)}toggleVisibility(isVisible){if(isVisible===undefined){isVisible=!this.get("_isVisible")}this.set("_isVisible",isVisible,{pluginName:"assessmentResults"})}checkCompletion(){if(this.get("_setCompletionOn")==="pass"&&!this.get("isPass")){return}this.setCompletionStatus()}onAssessmentReset(state){if(this.get("_assessmentId")===undefined||this.get("_assessmentId")!==state.id)return;let resetType=this.get("_resetType");if(!resetType||resetType==="inherit"){resetType=state.resetType||"hard"}this.reset(resetType,true)}reset(){this.set({body:this.get("originalBody"),state:null,feedback:"",_feedbackBand:null,retryFeedback:"",_isRetryEnabled:false});super.reset(...arguments)}});class AssessmentResultsView extends ComponentView$1{events(){return{"click .js-assessment-retry-btn":"onRetryClicked"}}preRender(){this.model.setLocking("_isVisible",false);this.listenTo(Adapt$1.parentView,"preRemove",()=>{this.model.unsetLocking("_isVisible")});this.listenTo(this.model,{"change:_feedbackBand":this.addClassesToArticle,"change:body":this.render})}postRender(){this.model.checkIfAssessmentComplete();this.setReadyStatus();this.setupInviewCompletion(".component__inner",this.model.checkCompletion.bind(this.model))}onRetryClicked(){const state=this.model._state;Adapt$1.assessment.get(state.id).reset(null,wasReset=>{if(!wasReset)return;if(this.model.get("_retry")._routeToAssessment!==true)return;router$1.navigateToElement(`.${state.articleId}`)})}addClassesToArticle(model,value){if(!value?._classes)return;this.$el.parents(".article").addClass(value._classes)}}AssessmentResultsView.template="assessmentResults";var AssessmentResultsView$1=__AMD("components/adapt-contrib-assessmentResults/js/assessmentResultsView",AssessmentResultsView);__AMD("components/adapt-contrib-assessmentResults/js/adapt-contrib-assessmentResults",components$1.register("assessmentResults",{model:AssessmentResultsModel,view:AssessmentResultsView$1}));var BlankView=__AMD("components/adapt-contrib-blank/js/blankView",class BlankView extends ComponentView$1{get template(){return"blank"}postRender(){this.setReadyStatus();this.setupInviewCompletion()}});__AMD("components/adapt-contrib-blank/js/adapt-contrib-blank",components$1.register("blank",{model:ComponentModel$1.extend({}),view:BlankView}));const BUTTON_STATE=ENUM(["SUBMIT","CORRECT","INCORRECT","SHOW_CORRECT_ANSWER","HIDE_CORRECT_ANSWER","SHOW_FEEDBACK","RESET"]);var BUTTON_STATE$1=__AMD("core/js/enums/buttonStateEnum",BUTTON_STATE);const textPropertyName={SUBMIT:"submit",CORRECT:"correct",INCORRECT:"incorrect",SHOW_CORRECT_ANSWER:"showCorrectAnswer",HIDE_CORRECT_ANSWER:"hideCorrectAnswer",SHOW_FEEDBACK:"showFeedback",RESET:"reset"};var ButtonsView=__AMD("core/js/views/buttonsView",class ButtonsView extends Backbone.View{initialize(options){this.parent=options.parent;this.listenTo(Adapt$1.parentView,"postRemove",this.remove);this.listenTo(this.model,{"change:_buttonState":this.onButtonStateChanged,"change:feedbackMessage":this.onFeedbackMessageChanged,"change:_attemptsLeft":this.onAttemptsChanged,"change:_canSubmit":this.onCanSubmitChange});this.render()}events(){return{"click .js-btn-action":"onActionClicked","click .js-btn-feedback":"onFeedbackClicked"}}render(){const data=this.model.toJSON();const template=Handlebars.templates.buttons;_.defer(()=>{this.postRender();Adapt$1.trigger("buttonsView:postRender",this)});this.$el.html(template(data))}postRender(){this.refresh()}checkResetSubmittedState(){const isSubmitted=this.model.get("_isSubmitted");if(isSubmitted){this.$el.addClass("is-submitted");return}this.$(".js-btn-marking, .js-btn-marking-label").removeClass("is-incorrect is-correct").addClass("u-display-none");this.$el.removeClass("is-submitted");this.model.set("feedbackMessage",undefined);a11y$1.toggleEnabled(this.$(".js-btn-feedback"),false)}onActionClicked(){const buttonState=BUTTON_STATE$1(this.model.get("_buttonState"));this.trigger("buttons:stateUpdate",buttonState);this.checkResetSubmittedState();if(buttonState===BUTTON_STATE$1.SHOW_CORRECT_ANSWER){const correctAnswer=this.model.getCorrectAnswerAsText?.();this.updateAnswerLiveRegion(correctAnswer)}if(buttonState===BUTTON_STATE$1.HIDE_CORRECT_ANSWER){const userAnswer=this.model.getUserAnswerAsText?.();this.updateAnswerLiveRegion(userAnswer)}}onFeedbackClicked(){this.trigger("buttons:stateUpdate",BUTTON_STATE$1.SHOW_FEEDBACK)}onFeedbackMessageChanged(model,changedAttribute){if(changedAttribute&&this.model.get("_canShowFeedback")){a11y$1.toggleEnabled(this.$(".js-btn-feedback"),true);return}a11y$1.toggleEnabled(this.$(".js-btn-feedback"),false)}onCanSubmitChange(){this.onButtonStateChanged(this.model,this.model.get("_buttonState"))}onButtonStateChanged(model,changedAttribute){this.updateAttemptsCount();const $buttonsAction=this.$(".js-btn-action");const buttonState=BUTTON_STATE$1(changedAttribute);if(changedAttribute===BUTTON_STATE$1.CORRECT||changedAttribute===BUTTON_STATE$1.INCORRECT){a11y$1.toggleEnabled($buttonsAction,false);return}const propertyName=textPropertyName[buttonState.asString];const ariaLabel=this.model.get("_buttons")["_"+propertyName].ariaLabel;const buttonText=this.model.get("_buttons")["_"+propertyName].buttonText;a11y$1.toggleEnabled($buttonsAction,this.model.get("_canSubmit"));$buttonsAction.html(buttonText).attr("aria-label",ariaLabel)}checkFeedbackState(){const canShowFeedback=this.model.get("_canShowFeedback");this.$(".js-btn-action").toggleClass("is-full-width",!canShowFeedback);this.$(".js-btn-feedback").toggleClass("u-display-none",!canShowFeedback);this.$(".js-btn-marking, .js-btn-marking-label").toggleClass("is-full-width u-display-none",!canShowFeedback)}updateAttemptsCount(){const isInteractionComplete=this.model.get("_isInteractionComplete");const attemptsLeft=this.model.get("_attemptsLeft")?this.model.get("_attemptsLeft"):this.model.get("_attempts");const shouldDisplayAttempts=this.model.get("_shouldDisplayAttempts");let attemptsString;this.checkResetSubmittedState();if(!isInteractionComplete&&attemptsLeft>=0){attemptsString=attemptsLeft+" ";attemptsString+=attemptsLeft===1?this.model.get("_buttons").remainingAttemptText:this.model.get("_buttons").remainingAttemptsText}else{this.$(".js-display-attempts").addClass("u-visibility-hidden");this.showMarking()}if(shouldDisplayAttempts){this.$(".js-insert-attempts-string").html(attemptsString)}}updateAnswerLiveRegion(answer){if(!answer)return;this.$(".js-answer-live-region").html(answer)}showMarking(){if(!this.model.shouldShowMarking)return;const isCorrect=this.model.get("_isCorrect");const ariaLabels=Adapt$1.course.get("_globals")._accessibility._ariaLabels;const $marking=this.$(".js-btn-marking, .js-btn-marking-label").removeClass("u-display-none").addClass(isCorrect?"is-correct":"is-incorrect");const $ariaLabel=this.$(".js-btn-marking-label");const hasSpanAriaLabel=Boolean($ariaLabel.length);if(!hasSpanAriaLabel){$marking.attr("aria-label",isCorrect?ariaLabels.answeredCorrectly:ariaLabels.answeredIncorrectly);return}$ariaLabel.html(isCorrect?ariaLabels.answeredCorrectly:ariaLabels.answeredIncorrectly)}refresh(){this.updateAttemptsCount();this.checkResetSubmittedState();this.checkFeedbackState();this.onButtonStateChanged(null,this.model.get("_buttonState"));this.onFeedbackMessageChanged(null,this.model.get("feedbackMessage"))}});class QuestionModel extends ComponentModel$1{defaults(){return ComponentModel$1.resultExtend("defaults",{_isQuestionType:true,_shouldDisplayAttempts:false,_shouldShowMarking:false,_canShowModelAnswer:true,_canShowFeedback:true,_canShowMarking:true,_canSubmit:true,_isSubmitted:false,_isCorrectAnswerShown:false,_questionWeight:Adapt$1.config.get("_questionWeight"),_hasItemScoring:false,_items:[]})}trackable(){return ComponentModel$1.resultExtend("trackable",["_isSubmitted","_score","_isCorrect","_attemptsLeft"])}trackableType(){return ComponentModel$1.resultExtend("trackableType",[Boolean,Number,Boolean,Number])}getTypeGroup(){return"question"}init(){this.setupDefaultSettings();this.setLocking("_canSubmit",true);this.updateRawScore();super.init()}setupDefaultSettings(){this.setupWeightSettings();this.setupButtonSettings()}setupButtonSettings(){const globalButtons=Adapt$1.course.get("_buttons");if(!this.has("_buttons")){this.set("_buttons",globalButtons)}else{const componentButtons=this.get("_buttons");for(const key in componentButtons){if(typeof componentButtons[key]==="object"){if(!componentButtons[key].buttonText&&globalButtons[key].buttonText){componentButtons[key].buttonText=globalButtons[key].buttonText}if(!componentButtons[key].ariaLabel&&globalButtons[key].ariaLabel){componentButtons[key].ariaLabel=globalButtons[key].ariaLabel}}if(!componentButtons[key]&&globalButtons[key]){componentButtons[key]=globalButtons[key]}}}}setupWeightSettings(){}canSubmit(){}checkCanSubmit(){this.set("_canSubmit",this.canSubmit(),{pluginName:"adapt"})}updateAttempts(){const attemptsLeft=this.get("_attemptsLeft")||this.get("_attempts");this.set("_attemptsLeft",attemptsLeft-1)}setQuestionAsSubmitted(){this.set({_isEnabled:false,_isSubmitted:true,_shouldShowMarking:this.shouldShowMarking})}markQuestion(){if(this.isCorrect()){this.set("_isCorrect",true)}else{this.set("_isCorrect",false)}this.updateRawScore()}isCorrect(){}setScore(){const questionWeight=this.get("_questionWeight");const answeredCorrectly=this.get("_isCorrect");const score=answeredCorrectly?questionWeight:0;this.set("_score",score)}updateRawScore(){this.set({_rawScore:this.score,_maxScore:this.maxScore,_minScore:this.minScore})}get score(){return this.get("_isCorrect")?this.maxScore:0}get maxScore(){return this.get("_questionWeight")}get minScore(){return 0}checkQuestionCompletion(){const isComplete=this.get("_isCorrect")||this.get("_attemptsLeft")===0;if(isComplete){this.setCompletionStatus()}return isComplete}updateButtons(){const isInteractionComplete=this.get("_isInteractionComplete");const isCorrect=this.get("_isCorrect");const isEnabled=this.get("_isEnabled");const buttonState=this.get("_buttonState");const canShowModelAnswer=this.get("_canShowModelAnswer");if(isInteractionComplete){if(isCorrect||!canShowModelAnswer){this.set("_buttonState",BUTTON_STATE$1.CORRECT)}else{switch(buttonState){case BUTTON_STATE$1.SUBMIT:case BUTTON_STATE$1.HIDE_CORRECT_ANSWER:this.set("_buttonState",BUTTON_STATE$1.SHOW_CORRECT_ANSWER);break;default:this.set("_buttonState",BUTTON_STATE$1.HIDE_CORRECT_ANSWER);}}}else{if(isEnabled){this.set("_buttonState",BUTTON_STATE$1.SUBMIT)}else{this.set("_buttonState",BUTTON_STATE$1.RESET)}}}setupFeedback(){if(!this.has("_feedback"))return;if(this.get("_isCorrect")){this.setupCorrectFeedback()}else if(this.isPartlyCorrect()){this.setupPartlyCorrectFeedback()}else{this.setupIncorrectFeedback()}}isPartlyCorrect(){}setupCorrectFeedback(){this.set({feedbackTitle:this.getFeedbackTitle(),feedbackMessage:Handlebars.compile(this.get("_feedback").correct)(this.toJSON())})}setupPartlyCorrectFeedback(){const feedback=this.get("_feedback")._partlyCorrect;if(feedback?.final){this.setAttemptSpecificFeedback(feedback)}else{this.setupIncorrectFeedback()}}setupIncorrectFeedback(){this.setAttemptSpecificFeedback(this.get("_feedback")._incorrect)}setAttemptSpecificFeedback(feedback){const body=this.get("_attemptsLeft")&&feedback.notFinal||feedback.final;this.set({feedbackTitle:this.getFeedbackTitle(),feedbackMessage:Handlebars.compile(body)(this.toJSON())})}getFeedbackTitle(){const title=this.get("_feedback").title||this.get("displayTitle")||this.get("title")||"";return Handlebars.compile(title)(this.toJSON())}isInteractive(){return!this.get("_isComplete")||this.get("_isEnabled")&&!this.get("_isSubmitted")}checkIfResetOnRevisit(){super.checkIfResetOnRevisit();this.set("_buttonState",this.get("_isInteractionComplete")?BUTTON_STATE$1.HIDE_CORRECT_ANSWER:BUTTON_STATE$1.SUBMIT)}reset(){let type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"hard";let canReset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.get("_canReset");const wasReset=super.reset(type,canReset);if(!wasReset)return false;const attempts=this.get("_attempts");this.set({_attemptsLeft:attempts,_isCorrect:undefined,_isCorrectAnswerShown:false,_isSubmitted:false,_buttonState:BUTTON_STATE$1.SUBMIT,_shouldShowMarking:this.shouldShowMarking});return true}setQuestionAsReset(){this.set({_isEnabled:true,_isSubmitted:false,_shouldShowMarking:this.shouldShowMarking});this.resetQuestion()}resetQuestion(){}refresh(){this.trigger("question:refresh")}getButtonState(){if(this.get("_isCorrect")){return BUTTON_STATE$1.CORRECT}if(this.get("_attemptsLeft")===0){return this.get("_canShowModelAnswer")?BUTTON_STATE$1.SHOW_CORRECT_ANSWER:BUTTON_STATE$1.INCORRECT}return this.get("_isSubmitted")?BUTTON_STATE$1.RESET:BUTTON_STATE$1.SUBMIT}getInteractionObject(){return{}}getResponse(){}getResponseType(){}onSubmitted(){if(this.get("_shouldStoreAttempts"))this.addAttemptObject();this.set("_shouldShowMarking",this.shouldShowMarking)}get shouldShowMarking(){return!this.isInteractive()&&this.get("_canShowMarking")&&this.get("_isInteractionComplete")}}components$1.register("question",{model:QuestionModel});var QuestionModel$1=__AMD("core/js/models/questionModel",QuestionModel);class QuestionView extends ComponentView$1{className(){return["component","is-question",this.model.get("_component").toLowerCase(),this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),"is-"+this.model.get("_layout"),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":"",this.model.get("_canShowModelAnswer")?"can-show-model-answer":"",this.model.get("_canShowFeedback")?"can-show-feedback":"",this.model.get("_canShowMarking")?"can-show-marking":""].join(" ")}initialize(){this.isInteractive=this.isInteractive.bind(this);super.initialize(...arguments)}isInteractive(){logging$1.deprecated("questionView.isInteractive please use this.model.isInteractive, this.model.get('_shouldShowMarking') or this.model.shouldShowMarking");return this.model.isInteractive()}preRender(){this.listenTo(this.model,"change:_isEnabled",this.onEnabledChanged);this.listenTo(this.model,"question:refresh",this.refresh);if(this.checkIfResetOnRevisit!==QuestionView.prototype.checkIfResetOnRevisit){logging$1.deprecated("QuestionView.checkIfResetOnRevisit, please use QuestionModel.checkIfResetOnRevisit")}this.checkIfResetOnRevisit();_.defer(()=>this.ensureLegacyLifecycleState());this._runModelCompatibleFunction("setupDefaultSettings");this.setupQuestion()}onEnabledChanged(model,changedAttribute){if(!changedAttribute){this.$(".component__widget").addClass("is-disabled");this.disableQuestion()}else{this.$(".component__widget").removeClass("is-disabled");this.enableQuestion()}}disableQuestion(){}enableQuestion(){}checkIfResetOnRevisit(){const canReset=this.model.get("_canReset")!==false;const isResetOnRevisit=this.model.get("_isResetOnRevisit");if(!canReset||!isResetOnRevisit)return;if(this.resetQuestionOnRevisit===QuestionView.prototype.resetQuestionOnRevisit)return;logging$1.deprecated("QuestionView.resetQuestionOnRevisit, please QuestionModel.reset");_.defer(()=>{this.resetQuestionOnRevisit(isResetOnRevisit)})}ensureLegacyLifecycleState(){const isInteractionComplete=this.model.get("_isInteractionComplete");if(isInteractionComplete){this.onHideCorrectAnswerClicked();return}this.onResetClicked()}resetQuestionOnRevisit(type){}setupQuestion(){}postRender(){this.addButtonsView();this.onQuestionRendered()}addButtonsView(){this.buttonsView=new ButtonsView({model:this.model,el:this.$(".btn__container")});this.listenTo(this.buttonsView,"buttons:stateUpdate",this.onButtonStateUpdate)}onButtonStateUpdate(buttonState){switch(buttonState){case BUTTON_STATE$1.SUBMIT:this.onSubmitClicked();break;case BUTTON_STATE$1.RESET:this.onResetClicked();break;case BUTTON_STATE$1.SHOW_CORRECT_ANSWER:this.onShowCorrectAnswerClicked();break;case BUTTON_STATE$1.HIDE_CORRECT_ANSWER:this.onHideCorrectAnswerClicked();break;case BUTTON_STATE$1.SHOW_FEEDBACK:this.showFeedback();break;}}onQuestionRendered(){}onSubmitClicked(){const canSubmit=this._runModelCompatibleFunction("canSubmit");if(!canSubmit){this.showInstructionError();this.onCannotSubmit();return}this._runModelCompatibleFunction("updateAttempts");this._runModelCompatibleFunction("setQuestionAsSubmitted");this._runModelCompatibleFunction("storeUserAnswer");this._runModelCompatibleFunction("markQuestion","isCorrect");this._runModelCompatibleFunction("setScore");this._runModelCompatibleFunction("checkQuestionCompletion");if(this.model.shouldShowMarking){this.showMarking()}this.recordInteraction();this._runModelCompatibleFunction("setupFeedback");this.showFeedback();$(window).resize();this._runModelCompatibleFunction("updateButtons");this.model.onSubmitted();this.onSubmitted()}showInstructionError(){Adapt$1.trigger("questionView:showInstructionError",this)}onCannotSubmit(){}onSubmitted(){}setQuestionAsSubmitted(){this.model.setQuestionAsSubmitted();this.$(".component__widget").addClass("is-submitted")}showMarking(){}checkQuestionCompletion(){const isComplete=this.model.checkQuestionCompletion();if(isComplete){this.$(".component__widget").addClass("is-complete show-user-answer")}}recordInteraction(){if(this.model.get("_recordInteraction")===true||!this.model.has("_recordInteraction")){Adapt$1.trigger("questionView:recordInteraction",this)}}showFeedback(){if(this.model.get("_canShowFeedback")){Adapt$1.trigger("questionView:showFeedback",this)}else{Adapt$1.trigger("questionView:disabledFeedback",this)}}onResetClicked(){this.setQuestionAsReset();this._runModelCompatibleFunction("resetUserAnswer");this.model.checkCanSubmit();this._runModelCompatibleFunction("updateButtons");if(!this.model.get("_isReady"))return;const currentModel=data$1.findById(location$1._currentId);if(!currentModel?.get("_isReady"))return;a11y$1.focusNext(this.$el,{preventScroll:true})}setQuestionAsReset(){this.model.setQuestionAsReset();this.resetQuestion();this.$(".component__widget").removeClass("is-submitted")}resetQuestion(){}refresh(){this.model.set("_buttonState",this.model.getButtonState());if(this.model.shouldShowMarking){this.showMarking()}if(this.buttonsView){_.defer(this.buttonsView.refresh.bind(this.buttonsView))}}onShowCorrectAnswerClicked(){this.setQuestionAsShowCorrect();this._runModelCompatibleFunction("updateButtons");this.showCorrectAnswer()}setQuestionAsShowCorrect(){this.$(".component__widget").addClass("is-submitted show-correct-answer").removeClass("show-user-answer")}showCorrectAnswer(){this.model.set("_isCorrectAnswerShown",true)}onHideCorrectAnswerClicked(){this.setQuestionAsHideCorrect();this._runModelCompatibleFunction("updateButtons");this.hideCorrectAnswer()}setQuestionAsHideCorrect(){this.$(".component__widget").addClass("is-submitted show-user-answer").removeClass("show-correct-answer")}hideCorrectAnswer(){this.model.set("_isCorrectAnswerShown",false)}getLatency(){return null}_runModelCompatibleFunction(name,lookForViewOnlyFunction){return this.model[name]()}}QuestionView._isQuestionType=true;class ViewOnlyQuestionViewCompatibilityLayer extends QuestionView{getInteractionObject(){logging$1.deprecated("QuestionView.getInteractionObject, please use QuestionModel.getInteractionObject");return this.model.getInteractionObject()}getResponse(){logging$1.deprecated("QuestionView.getInteractionObject, please use QuestionModel.getInteractionObject");return this.model.getResponse()}getResponseType(){logging$1.deprecated("QuestionView.getResponseType, please use QuestionModel.getResponseType");return this.model.getResponseType()}setupDefaultSettings(){logging$1.deprecated("QuestionView.setupDefaultSettings, please use QuestionModel.setupDefaultSettings");return this.model.setupDefaultSettings()}setupButtonSettings(){logging$1.deprecated("QuestionView.setupButtonSettings, please use QuestionModel.setupButtonSettings");return this.model.setupButtonSettings()}setupWeightSettings(){logging$1.deprecated("QuestionView.setupWeightSettings, please use QuestionModel.setupWeightSettings");return this.model.setupWeightSettings()}canSubmit(){logging$1.deprecated("QuestionView.canSubmit, please use QuestionModel.canSubmit");return this.model.canSubmit()}updateAttempts(){logging$1.deprecated("QuestionView.updateAttempts, please use QuestionModel.updateAttempts");return this.model.updateAttempts()}storeUserAnswer(){logging$1.deprecated("QuestionView.storeUserAnswer, please use QuestionModel.storeUserAnswer");return this.model.storeUserAnswer()}resetUserAnswer(){logging$1.deprecated("QuestionView.resetUserAnswer, please use QuestionModel.resetUserAnswer");return this.model.resetUserAnswer()}markQuestion(){if(this._isInViewOnlyCompatibleMode("isCorrect")){if(this.isCorrect()){this.model.set("_isCorrect",true)}else{this.model.set("_isCorrect",false)}this.model.set({_rawScore:this.model.get("_isCorrect")?this.model.get("_questionWeight"):0,_maxScore:this.model.get("_questionWeight"),_minScore:0})}else{return this.model.markQuestion()}}isCorrect(){logging$1.deprecated("QuestionView.isCorrect, please use QuestionModel.isCorrect");return this.model.isCorrect()}setScore(){logging$1.deprecated("QuestionView.setScore, please use QuestionModel.setScore");return this.model.setScore()}updateButtons(){logging$1.deprecated("QuestionView.updateButtons, please use QuestionModel.updateButtons");return this.model.updateButtons()}setupFeedback(){if(this._isInViewOnlyCompatibleMode("isPartlyCorrect")){if(this.model.get("_isCorrect")){this._runModelCompatibleFunction("setupCorrectFeedback")}else if(this.isPartlyCorrect()){this._runModelCompatibleFunction("setupPartlyCorrectFeedback")}else{this._runModelCompatibleFunction("setupIncorrectFeedback")}}else{this.model.setupFeedback()}}isPartlyCorrect(){logging$1.deprecated("QuestionView.isPartlyCorrect, please use QuestionModel.isPartlyCorrect");return this.model.isPartlyCorrect()}setupCorrectFeedback(){logging$1.deprecated("QuestionView.setupCorrectFeedback, please use QuestionModel.setupCorrectFeedback");return this.model.setupCorrectFeedback()}setupPartlyCorrectFeedback(){logging$1.deprecated("QuestionView.setupPartlyCorrectFeedback, please use QuestionModel.setupPartlyCorrectFeedback");return this.model.setupPartlyCorrectFeedback()}setupIncorrectFeedback(){logging$1.deprecated("QuestionView.setupIncorrectFeedback, please use QuestionModel.setupIncorrectFeedback");return this.model.setupIncorrectFeedback()}_runModelCompatibleFunction(name,lookForViewOnlyFunction){if(this._isInViewOnlyCompatibleMode(name,lookForViewOnlyFunction)){return this[name]()}else{return this.model[name]()}}_isInViewOnlyCompatibleMode(name,lookForViewOnlyFunction){const checkForFunction=lookForViewOnlyFunction||name;if(!this.constructor.prototype[checkForFunction])return false;const hasCompatibleVersion=Object.prototype.hasOwnProperty.call(ViewOnlyQuestionViewCompatibilityLayer.prototype,checkForFunction);const usingCompatibleVersion=this.constructor.prototype[checkForFunction]===ViewOnlyQuestionViewCompatibilityLayer.prototype[checkForFunction];if(hasCompatibleVersion&&usingCompatibleVersion){switch(checkForFunction){case"setupFeedback":case"markQuestion":return true;}return false}return true}}var QuestionView$1=__AMD("core/js/views/questionView",ViewOnlyQuestionViewCompatibilityLayer);class McqView extends QuestionView$1{initialize(){this.onKeyPress=this.onKeyPress.bind(this);this.onItemSelect=this.onItemSelect.bind(this);this.onItemFocus=this.onItemFocus.bind(this);this.onItemBlur=this.onItemBlur.bind(this);super.initialize(...arguments)}setupQuestion(){this.model.setupRandomisation()}onQuestionRendered(){this.setReadyStatus()}onKeyPress(event){if(event.which!==13)return;this.onItemSelect(event)}onItemFocus(event){if(!this.model.isInteractive())return;const index=parseInt($(event.currentTarget).data("adapt-index"));const item=this.model.getChildren().findWhere({_index:index});item.set("_isHighlighted",true)}onItemBlur(event){const index=$(event.currentTarget).data("adapt-index");const item=this.model.getChildren().findWhere({_index:index});item.set("_isHighlighted",false)}onItemSelect(event){if(!this.model.isInteractive())return;const index=$(event.currentTarget).data("adapt-index");const itemModel=this.model.getItem(index);let shouldSelect=!itemModel.get("_isActive");if(this.model.isSingleSelect()){shouldSelect=true;this.model.resetActiveItems()}else if(shouldSelect&&this.model.isAtActiveLimit()){this.model.getLastActiveItem().toggleActive(false)}itemModel.toggleActive(shouldSelect)}resetQuestion(){this.model.resetItems()}}McqView.template="mcq.jsx";var McqView$1=__AMD("components/adapt-contrib-mcq/js/McqView",McqView);class GmcqView extends McqView$1{onQuestionRendered(){this.$(".js-item-label").imageready(()=>this.setReadyStatus())}}GmcqView.template="gmcq.jsx";var GmcqView$1=__AMD("components/adapt-contrib-gmcq/js/GmcqView",GmcqView);class BlendedItemsComponentQuestionModel extends QuestionModel$1{init(){ItemsComponentModel.prototype.init.call(this);super.init()}reset(){let type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"hard";let canReset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.get("_canReset");ItemsComponentModel.prototype.reset.call(this,type,canReset);return super.reset(type,canReset)}}Object.getOwnPropertyNames(ItemsComponentModel.prototype).forEach(name=>{if(name==="constructor"||name==="init"||name==="reset")return;Object.defineProperty(BlendedItemsComponentQuestionModel.prototype,name,{value:ItemsComponentModel.prototype[name]})});var ItemsQuestionModel=__AMD("core/js/models/itemsQuestionModel",class ItemsQuestionModel extends BlendedItemsComponentQuestionModel{init(){super.init();this.set("_isRadio",this.isSingleSelect());this.listenTo(this.getChildren(),"change:_isActive",this.checkCanSubmit);this.checkCanSubmit()}restoreUserAnswers(){if(!this.get("_isSubmitted"))return;const itemModels=this.getChildren();const userAnswer=this.get("_userAnswer");itemModels.each(item=>{item.toggleActive(userAnswer[item.get("_index")])});this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.setupFeedback()}setupRandomisation(){if(!this.get("_isRandom")||!this.get("_isEnabled"))return;const children=this.getChildren();children.set(children.shuffle())}canSubmit(){const activeItems=this.getActiveItems();return activeItems.length>0}storeUserAnswer(){const items=this.getChildren().slice(0);items.sort((a,b)=>a.get("_index")-b.get("_index"));const userAnswer=items.map(itemModel=>itemModel.get("_isActive"));this.set("_userAnswer",userAnswer)}isCorrect(){const allChildren=this.getChildren();const activeChildren=allChildren.filter(itemModel=>itemModel.get("_isActive"));const isItemCorrect=itemModel=>itemModel.get("_shouldBeSelected")&&!itemModel.get("_isPartlyCorrect");const isItemPartlyCorrect=itemModel=>itemModel.get("_isPartlyCorrect");const isItemIncorrect=itemModel=>!itemModel.get("_shouldBeSelected")&&!itemModel.get("_isPartlyCorrect");const sum=(list,predicate)=>list.reduce((sum,item)=>sum+(predicate(item)?1:0),0);const props={_numberOfRequiredAnswers:sum(allChildren,isItemCorrect),_numberOfCorrectAnswers:sum(activeChildren,isItemCorrect),_numberOfPartlyCorrectAnswers:sum(activeChildren,isItemPartlyCorrect),_numberOfIncorrectAnswers:sum(activeChildren,isItemIncorrect)};activeChildren.forEach(itemModel=>itemModel.set("_isCorrect",itemModel.get("_shouldBeSelected")));props._isAtLeastOneCorrectSelection=props._numberOfCorrectAnswers||props._numberOfPartlyCorrectAnswers;const numberOfSelectableAnswers=this.get("_selectable");const hasSelectableCorrectAnswers=props._numberOfCorrectAnswers===numberOfSelectableAnswers;const hasAllCorrectAnswers=props._numberOfCorrectAnswers===props._numberOfRequiredAnswers;const hasCorrectAnswers=hasSelectableCorrectAnswers||hasAllCorrectAnswers;const hasIncorrectAnswers=props._numberOfIncorrectAnswers;const hasPartlyCorrectAnswers=props._numberOfPartlyCorrectAnswers;this.set(props);return hasCorrectAnswers&&!hasIncorrectAnswers&&!hasPartlyCorrectAnswers}setScore(){const questionWeight=this.get("_questionWeight");const answeredCorrectly=this.get("_isCorrect");const score=answeredCorrectly?questionWeight:0;this.set("_score",score)}get score(){if(!this.get("_hasItemScoring"))return super.score;const children=this.getChildren()?.toArray()||[];return children.reduce((score,child)=>score+=child.get("_isActive")?child.get("_score")||0:0,0)}get maxScore(){if(!this.get("_hasItemScoring"))return super.maxScore;const children=this.getChildren()?.toArray()||[];const scores=children.map(child=>child.get("_score")||0);scores.sort((a,b)=>a-b);return scores.reverse().slice(0,this.get("_selectable")).filter(score=>score>0).reduce((maxScore,score)=>maxScore+=score,0)}get minScore(){if(!this.get("_hasItemScoring"))return super.minScore;const children=this.getChildren()?.toArray()||[];const scores=children.map(child=>child.get("_score")||0);scores.sort((a,b)=>a-b);return scores.slice(0,this.get("_selectable")).filter(score=>score<0).reduce((minScore,score)=>minScore+=score,0)}setupFeedback(){if(!this.has("_feedback"))return;if(this.get("_isCorrect")){this.setupCorrectFeedback();return}if(this.isPartlyCorrect()){this.setupPartlyCorrectFeedback();return}const activeItem=this.getActiveItem();if(this.isSingleSelect()&&activeItem.get("feedback")){this.setupIndividualFeedback(activeItem);return}this.setupIncorrectFeedback()}setupIndividualFeedback(selectedItem){const json=this.toJSON();this.set({feedbackTitle:Handlebars.compile(this.getFeedbackTitle(this.get("_feedback")))(json),feedbackMessage:Handlebars.compile(selectedItem.get("feedback"))(json)})}isPartlyCorrect(){return this.get("_isAtLeastOneCorrectSelection")}resetUserAnswer(){this.set("_userAnswer",[])}isAtActiveLimit(){const selectedItems=this.getActiveItems();return selectedItems.length===this.get("_selectable")}isSingleSelect(){return this.get("_selectable")===1}getLastActiveItem(){const selectedItems=this.getActiveItems();return selectedItems[selectedItems.length-1]}resetQuestion(){this.resetItems()}resetItems(){this.resetActiveItems();this.set("_isAtLeastOneCorrectSelection",false)}getInteractionObject(){const interactions={correctResponsesPattern:[],choices:[]};interactions.choices=this.getChildren().map(itemModel=>{return{id:(itemModel.get("_index")+1).toString(),description:itemModel.get("text")}});const correctItems=this.getChildren().filter(itemModel=>{return itemModel.get("_shouldBeSelected")});interactions.correctResponsesPattern=[correctItems.map(itemModel=>{return String(itemModel.get("_index")+1)}).join("[,]")];return interactions}getResponse(){const activeItems=this.getActiveItems();const activeIndexes=activeItems.map(itemModel=>{return itemModel.get("_index")+1});return activeIndexes.join(",")}getResponseType(){return"choice"}getCorrectAnswerAsText(){const globals=Adapt$1.course.get("_globals")._components["_"+this.get("_component")];const isSingleSelect=this.isSingleSelect();const ariaAnswer=isSingleSelect?globals?.ariaCorrectAnswer:globals?.ariaCorrectAnswers;if(!ariaAnswer)return;const correctOptions=this.getChildren().where({_shouldBeSelected:true});const correctAnswer=isSingleSelect?correctOptions[0]?.get("text"):correctOptions.map(correctOption=>correctOption.get("text")).join("<br>");return Handlebars.compile(ariaAnswer)({correctAnswer})}getUserAnswerAsText(){const globals=Adapt$1.course.get("_globals")._components["_"+this.get("_component")];const isSingleSelect=this.isSingleSelect();const ariaAnswer=isSingleSelect?globals?.ariaUserAnswer:globals?.ariaUserAnswers;if(!ariaAnswer)return;const selectedItems=this.getActiveItems();const userAnswer=isSingleSelect?selectedItems[0].get("text"):selectedItems.map(selectedItem=>selectedItem.get("text")).join("<br>");return Handlebars.compile(ariaAnswer)({userAnswer})}});var McqModel=__AMD("components/adapt-contrib-mcq/js/McqModel",class McqModel extends ItemsQuestionModel{});var GmcqModel=__AMD("components/adapt-contrib-gmcq/js/GmcqModel",class GmcqModel extends McqModel{});__AMD("components/adapt-contrib-gmcq/js/adapt-contrib-gmcq",components$1.register("gmcq",{model:GmcqModel,view:GmcqView$1}));class GraphicView extends ComponentView$1{events(){return{"click .js-graphic-link":"onClick"}}postRender(){this.$(".graphic__widget").imageready(()=>{this.setReadyStatus();this.setupInviewCompletion(".graphic__widget")})}onClick(event){if(event)event.preventDefault();const item=this.model.get("_graphic");const{_url:url,_target:target="_blank"}=item;const isNewWindow=target!=="_self";if(isNewWindow)return window.open(url,target);const isRouterNavigation=url.substr(0,1)==="#";if(isRouterNavigation)return Backbone.history.navigate(url,{trigger:true});window.location.href=url}}GraphicView.template="graphic.jsx";var GraphicView$1=__AMD("components/adapt-contrib-graphic/js/GraphicView",GraphicView);var GraphicModel=__AMD("components/adapt-contrib-graphic/js/GraphicModel",class GraphicModel extends ComponentModel$1{});__AMD("components/adapt-contrib-graphic/js/adapt-contrib-graphic",components$1.register("graphic",{model:GraphicModel,view:GraphicView$1}));class HotgraphicPopupView extends Backbone.View{className(){return"hotgraphic-popup"}events(){return{"click .js-hotgraphic-popup-close":"closePopup","click .js-hotgraphic-controls-click":"onControlClick"}}initialize(){super.initialize(...arguments);this.onControlClick=_.debounce(this.onControlClick.bind(this),100);this.listenToOnce(Adapt$1,"notify:opened",this.onOpened);this.listenTo(this.model.getChildren(),{"change:_isActive":this.onItemsActiveChange,"change:_isVisited":this.onItemsVisitedChange});this.render()}onOpened(){this.applyNavigationClasses(this.model.getActiveItem().get("_index"));this.updatePageCount();this.handleTabs()}applyNavigationClasses(index){const itemCount=this.model.get("_items").length;const canCycleThroughPagination=this.model.get("_canCycleThroughPagination");const shouldEnableBack=index>0||canCycleThroughPagination;const shouldEnableNext=index<itemCount-1||canCycleThroughPagination;const $controls=this.$(".hotgraphic-popup__controls");this.$("hotgraphic-popup__nav").toggleClass("first",!shouldEnableBack).toggleClass("last",!shouldEnableNext);a11y$1.toggleAccessibleEnabled($controls.filter(".back"),shouldEnableBack);a11y$1.toggleAccessibleEnabled($controls.filter(".next"),shouldEnableNext)}updatePageCount(){const template=Adapt$1.course.get("_globals")._components._hotgraphic.popupPagination||"{{itemNumber}} / {{totalItems}}";const labelText=Handlebars.compile(template)({itemNumber:this.model.getActiveItem().get("_index")+1,totalItems:this.model.get("_items").length});this.$(".hotgraphic-popup__count").html(labelText)}handleTabs(){a11y$1.toggleHidden(this.$(".hotgraphic-popup__item:not(.is-active)"),true);a11y$1.toggleHidden(this.$(".hotgraphic-popup__item.is-active"),false)}onItemsActiveChange(item,_isActive){if(!_isActive)return;const index=item.get("_index");this.updatePageCount();this.applyItemClasses(index);this.handleTabs();this.handleFocus(index)}applyItemClasses(index){this.$(`.hotgraphic-popup__item[data-index="${index}"]`).addClass("is-active").removeAttr("aria-hidden");this.$(`.hotgraphic-popup__item[data-index="${index}"] .hotgraphic-popup__item-title`).attr("id","notify-heading");this.$(`.hotgraphic-popup__item:not([data-index="${index}"])`).removeClass("is-active").attr("aria-hidden","true");this.$(`.hotgraphic-popup__item:not([data-index="${index}"]) .hotgraphic-popup__item-title`).removeAttr("id")}handleFocus(index){a11y$1.focusFirst(this.$(".hotgraphic-popup__inner .is-active"));this.applyNavigationClasses(index)}onItemsVisitedChange(item,_isVisited){if(!_isVisited)return;this.$(".hotgraphic-popup__item").filter(`[data-index="${item.get("_index")}"]`).addClass("is-visited")}render(){const data=this.model.toJSON();data.view=this;const template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))}closePopup(){Adapt$1.trigger("notify:close")}onControlClick(event){const direction=$(event.currentTarget).data("direction");const index=this.getNextIndex(direction);if(index===-1)return;this.setItemState(index)}getNextIndex(direction){let index=this.model.getActiveItem().get("_index");const lastIndex=this.model.get("_items").length-1;switch(direction){case"back":if(index>0)return--index;if(this.model.get("_canCycleThroughPagination"))return lastIndex;break;case"next":if(index<lastIndex)return++index;if(this.model.get("_canCycleThroughPagination"))return 0;}return-1}setItemState(index){this.model.getActiveItem().toggleActive();const nextItem=this.model.getItem(index);nextItem.toggleActive();nextItem.toggleVisited(true)}}HotgraphicPopupView.template="hotgraphicPopup";var HotgraphicPopupView$1=__AMD("components/adapt-contrib-hotgraphic/js/hotgraphicPopupView",HotgraphicPopupView);class HotGraphicView extends ComponentView$1{events(){return{"click .js-hotgraphic-item-click":"onPinClicked"}}initialize(){super.initialize(...arguments);this.setUpViewData();this.setUpModelData();this.setUpEventListeners()}setUpViewData(){this.popupView=null;this._isPopupOpen=false}setUpModelData(){if(this.model.get("_canCycleThroughPagination")!==undefined)return;this.model.set("_canCycleThroughPagination",false)}setUpEventListeners(){this.listenTo(Adapt$1,"device:changed",this.reRender);this.listenTo(this.model.getChildren(),{"change:_isActive":this.onItemsActiveChange,"change:_isVisited":this.onItemsVisitedChange})}reRender(){if(device$1.screenSize==="large"||this.model.get("_isNarrativeOnMobile")===false)return;this.replaceWithNarrative()}replaceWithNarrative(){const NarrativeView=components$1.getViewClass("narrative");if(!NarrativeView)return;const model=this.prepareNarrativeModel();const newNarrative=new NarrativeView({model});const $container=data$1.findViewByModelId(model.get("_parentId")).$el.find(".component__container");$container.append(newNarrative.$el);this.remove();_.defer(()=>{Adapt$1.trigger("device:resize")})}prepareNarrativeModel(){this.model.set({_component:"narrative",_wasHotgraphic:true,originalBody:this.model.get("body"),originalInstruction:this.model.get("instruction")});const activeItem=this.model.getActiveItem();if(!activeItem){this.model.getItem(0).toggleActive(true)}if(this.model.get("mobileBody")){this.model.set("body",this.model.get("mobileBody"))}if(this.model.get("mobileInstruction")){this.model.set("instruction",this.model.get("mobileInstruction"))}return this.model}onItemsActiveChange(model,_isActive){this.getItemElement(model).toggleClass("is-active",_isActive)}getItemElement(model){const index=model.get("_index");return this.$(".js-hotgraphic-item-click").filter(`[data-index="${index}"]`)}onItemsVisitedChange(model,_isVisited){if(!_isVisited)return;const $pin=this.getItemElement(model);const visitedLabel=` ${this.model.get("_globals")._accessibility._ariaLabels.visited}.`;$pin.find(".aria-label").each((index,el)=>{el.innerHTML+=visitedLabel});$pin.addClass("is-visited")}preRender(){if(device$1.screenSize==="large"){this.render();return}this.reRender()}postRender(){this.$(".hotgraphic__widget").imageready(this.setReadyStatus.bind(this));if(this.model.get("_setCompletionOn")!=="inview")return;this.setupInviewCompletion(".component__widget")}onPinClicked(event){const item=this.model.getItem($(event.currentTarget).data("index"));item.toggleActive(true);item.toggleVisited(true);this.openPopup()}openPopup(){if(this._isPopupOpen)return;this._isPopupOpen=true;this.popupView=new HotgraphicPopupView$1({model:this.model});notify$1.popup({_attributes:{"data-adapt-id":this.model.get("_id")},_view:this.popupView,_isCancellable:true,_showCloseButton:false,_classes:"hotgraphic is-component is-hotgraphic "+this.model.get("_classes")});this.listenToOnce(Adapt$1,{"popup:closed":this.onPopupClosed})}onPopupClosed(){this.model.getActiveItem().toggleActive();this._isPopupOpen=false}}HotGraphicView.template="hotgraphic";var HotgraphicView=__AMD("components/adapt-contrib-hotgraphic/js/hotgraphicView",HotGraphicView);__AMD("components/adapt-contrib-hotgraphic/js/adapt-contrib-hotgraphic",components$1.register("hotgraphic",{model:ItemsComponentModel.extend({}),view:HotgraphicView}));class MatchingView extends QuestionView$1{preinitialize(){var _this=this;this.setActiveOption=function(){return _this.model.setActiveOption(...arguments)};this.setHighlightedOption=function(){return _this.model.setHighlightedOption(...arguments)}}setupQuestion(){this.model.setupRandomisation();this.model.setupInitialHighlighted()}onQuestionRendered(){this.setReadyStatus()}}MatchingView.template="matching.jsx";var MatchingView$1=__AMD("components/adapt-contrib-matching/js/MatchingView",MatchingView);var MatchingItemModel=__AMD("components/adapt-contrib-matching/js/MatchingItemModel",class MatchingItemModel extends ItemModel{defaults(){return ItemModel.resultExtend("defaults",{_isHighlighted:false})}toggleHighlighted(){let isHighlighted=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!this.get("_isHighlighted");this.set("_isHighlighted",isHighlighted)}});var MatchingModel=__AMD("components/adapt-contrib-matching/js/MatchingModel",class MatchingModel extends ItemsQuestionModel{toJSON(){const json=super.toJSON();json._items=this.get("_items");json._options=this.getChildren().toJSON();return json}setUpItems(){let index=0;const items=this.get("_items")||[];const options=items.reduce((options,item,itemIndex)=>{item._index=itemIndex;const itemOptions=item._options||[];itemOptions.forEach((option,optionIndex)=>{option._index=index++;option._optionIndex=optionIndex;option._itemIndex=item._index;option._shouldBeSelected=Boolean(option._isCorrect)});options.push(...itemOptions);return options},[]);this.set({_items:items,_selectable:items.length});this.setChildren(new Backbone.Collection(options,{model:MatchingItemModel}))}setupInitialHighlighted(){this.get("_items")?.forEach(_ref=>{let{_index}=_ref;const selectOption=this.getActiveItemOption(_index)||this.getFirstItemOption(_index);selectOption?.toggleHighlighted(true)})}resetItems(){super.resetItems();this.resetHighlightedItems();this.setupInitialHighlighted()}resetHighlightedItems(){this.getChildren().forEach(option=>option.toggleHighlighted(false))}canSubmit(){const options=this.getChildren().models;const activeCount=options.reduce((count,option)=>count+(option.get("_isActive")?1:0),0);const canSubmit=activeCount===this.get("_selectable");return canSubmit}getItemOptions(itemIndex){return this.getChildren().filter(option=>option.get("_itemIndex")===itemIndex)}getActiveItemOption(itemIndex){return this.getItemOptions(itemIndex).find(option=>option.get("_isActive"))}getFirstItemOption(itemIndex){return this.getItemOptions(itemIndex)[0]}getCorrectItemOption(itemIndex){const activeOption=this.getActiveItemOption(itemIndex);return activeOption.get("_shouldBeSelected")?activeOption:this.getItemOptions(itemIndex).find(option=>option.get("_shouldBeSelected"))}setHighlightedOption(optionIndex){const itemIndex=this.getItem(optionIndex).get("_itemIndex");const itemOptions=this.getItemOptions(itemIndex);itemOptions.forEach(option=>{const isHighlighted=option.get("_index")===optionIndex;option.toggleHighlighted(isHighlighted)})}setActiveOption(optionIndex){const itemIndex=this.getItem(optionIndex).get("_itemIndex");const itemOptions=this.getItemOptions(itemIndex);itemOptions.forEach(option=>{const isActive=option.get("_index")===optionIndex;option.toggleHighlighted(isActive);option.toggleActive(isActive)});this.unsetDuplicateOptions(optionIndex)}unsetDuplicateOptions(optionIndex){const allowOnlyUniqueAnswers=this.get("_allowOnlyUniqueAnswers");if(!allowOnlyUniqueAnswers)return;const itemIndex=this.getItem(optionIndex).get("_itemIndex");const activeItemOption=this.getActiveItemOption(itemIndex);const activeItemOptionText=activeItemOption.get("text");const otherActiveOptions=this.getChildren().filter(option=>option!==activeItemOption&&option.get("_isActive"));otherActiveOptions.forEach(option=>{const optionText=option.get("text");const hasMatchingText=activeItemOptionText===optionText;if(!hasMatchingText)return;option.toggleHighlighted(false);option.toggleActive(false)})}get maxScore(){if(!this.get("_hasItemScoring"))return super.maxScore;const items=this.get("_items")||[];const maxItemScores=items.map(_ref2=>{let{_index}=_ref2;const itemOptions=this.getItemOptions(_index);const optionScores=itemOptions.map(child=>child.get("_score")||0);optionScores.sort((a,b)=>a-b);return optionScores[optionScores.length-1]||0});maxItemScores.sort((a,b)=>a-b);return maxItemScores.reverse().filter(score=>score>0).reduce((maxScore,score)=>maxScore+=score,0)}get minScore(){if(!this.get("_hasItemScoring"))return super.minScore;const items=this.get("_items")||[];const minItemScores=items.map(_ref3=>{let{_index}=_ref3;const itemOptions=this.getItemOptions(_index);const optionScores=itemOptions.map(child=>child.get("_score")||0);optionScores.sort((a,b)=>a-b);return optionScores[0]||0});minItemScores.sort((a,b)=>a-b);return minItemScores.filter(score=>score<0).reduce((minScore,score)=>minScore+=score,0)}getInteractionObject(){const items=this.get("_items");const interactions={correctResponsesPattern:null,source:null,target:null};interactions.correctResponsesPattern=[items.map(item=>{const itemPosition=item._index+1;const itemOptions=this.getItemOptions(item._index).sort((a,b)=>a.get("_index")-b.get("_index"));return[itemPosition,itemOptions.filter(option=>option.get("_shouldBeSelected")).map(option=>{const optionPosition=option.get("_optionIndex")+1;return`${itemPosition}_${optionPosition}`})].join("[.]")}).join("[,]")];interactions.source=items.map(item=>{const itemPosition=item._index+1;return{id:`${itemPosition}`,description:item.text}}).flat(Infinity);interactions.target=items.map(item=>{const itemPosition=item._index+1;const itemOptions=this.getItemOptions(item._index).sort((a,b)=>a.get("_index")-b.get("_index"));return itemOptions.map(option=>{const optionPosition=option.get("_optionIndex")+1;return{id:`${itemPosition}_${optionPosition}`,description:option.get("text")}})}).flat(Infinity);return interactions}getResponse(){const items=this.get("_items");const responses=items.map(_ref4=>{let{_index}=_ref4;const activeOption=this.getActiveItemOption(_index);const itemIndex=_index+1;const optionIndex=activeOption.get("_optionIndex")+1;return`${itemIndex}.${optionIndex}`});return responses.join("#")}getResponseType(){return"matching"}getCorrectAnswerAsText(){const correctAnswerTemplate=Adapt$1.course.get("_globals")._components._matching.ariaCorrectAnswer;const ariaAnswer=this.get("_items").map(item=>{const correctOption=this.getCorrectItemOption(item._index);return Handlebars.compile(correctAnswerTemplate)({itemText:item.text,correctAnswer:correctOption.get("text")})}).join("<br>");return ariaAnswer}getUserAnswerAsText(){const userAnswerTemplate=Adapt$1.course.get("_globals")._components._matching.ariaUserAnswer;const items=this.get("_items");const ariaAnswer=items.map(item=>{const activeOption=this.getActiveItemOption(item._index);return Handlebars.compile(userAnswerTemplate)({itemText:item.text,userAnswer:activeOption.get("text")})}).join("<br>");return ariaAnswer}});__AMD("components/adapt-contrib-matching/js/adapt-contrib-matching",components$1.register("matching",{view:MatchingView$1,model:MatchingModel}));__AMD("components/adapt-contrib-mcq/js/adapt-contrib-mcq",components$1.register("mcq",{model:McqModel,view:McqView$1}));var mepPrototype=$.extend({},window.mejs.MediaElementPlayer.prototype);$.extend(window.mejs.MediaElementPlayer.prototype,{detectFullscreenMode:function(){var vendorPrefix=this.getVendorPrefix();var fsEventName="on"+vendorPrefix+"fullscreenchange";if(document[fsEventName]===null){document[fsEventName]=function fullScreenEventHandler(){var elementName=vendorPrefix===""?"fullscreenElement":vendorPrefix+"FullscreenElement";if(document[elementName]!==null){$.inview.lock("mediaelement");Adapt$1.trigger("media:fullscreen:enter")}else{$.inview.unlock("mediaelement");Adapt$1.trigger("media:fullscreen:exit")}}}return mepPrototype.detectFullscreenMode.apply(this,arguments)},getVendorPrefix:function(){var browser=device$1.browser;if(browser==="internet explorer"){return"ms"}if(browser==="microsoft edge"||browser==="safari"){return"webkit"}return""}});Object.assign(window.mejs.MepDefaults,{keyActions:[],defaultSeekForwardInterval:duration=>{if(typeof duration==="object")return duration.duration*0.05;return duration*0.05},defaultSeekBackwardInterval:duration=>{if(typeof duration==="object")return duration.duration*0.05;return duration*0.05}});const purge=function(d){let a=d.attributes;if(a){for(let i=a.length-1;i>=0;i-=1){const n=a[i].name;if(typeof d[n]==="function"){d[n]=null}}}a=d.childNodes;if(a){for(let i=0,count=a.length;i<count;i+=1){purge(d.childNodes[i])}}};window.mejs.i18n.locale.language="en-US";window.mejs.i18n.locale.strings["en-US"]={};const ariaLabelMappings={playText:"Play",pauseText:"Pause",stopText:"Stop",audioPlayerText:"Audio Player",videoPlayerText:"Video Player",tracksText:"Captions/Subtitles",timeSliderText:"Time Slider",muteText:"Mute Toggle",unmuteStatusText:"Unmute",muteStatusText:"Mute",volumeSliderText:"Volume Slider",fullscreenText:"Fullscreen",goFullscreenText:"Go Fullscreen",turnOffFullscreenText:"Turn off Fullscreen",noneText:"None",skipBackText:"Skip back %1 seconds",allyVolumeControlText:"Use Up/Down Arrow keys to increase or decrease volume.",progessHelpText:"Use Left/Right Arrow keys to advance one second, Up/Down arrows to advance ten seconds."};Adapt$1.on("app:dataReady",()=>{const dynamicLabels=window.mejs.i18n.locale.strings["en-US"];const fixedDefaults=window.mejs.MepDefaults;const globals=Adapt$1.course.get("_globals")?._components?._media;for(const k in ariaLabelMappings){dynamicLabels[ariaLabelMappings[k]]=globals[k]??ariaLabelMappings[k];fixedDefaults[k]=dynamicLabels[ariaLabelMappings[k]]}});class MediaView extends ComponentView$1{events(){return{"click .js-media-inline-transcript-toggle":"onToggleInlineTranscript","click .js-media-external-transcript-click":"onExternalTranscriptClicked","click .js-skip-to-transcript":"onSkipToTranscript"}}className(){let classes=super.className();const playerOptions=this.model.get("_playerOptions");if(playerOptions?.toggleCaptionsButtonWhenOnlyOne){classes+=" toggle-captions"}return classes}preRender(){this.listenTo(Adapt$1,{"device:resize":this.onScreenSizeChanged,"device:changed":this.onDeviceChanged,"media:stop":this.onMediaStop});_.bindAll(this,"onMediaElementPlay","onMediaElementPause","onMediaElementEnded","onMediaElementTimeUpdate","onMediaElementSeeking","onOverlayClick","onMediaElementClick","onWidgetInview");this.model.set({_isMediaEnded:false,_isMediaPlaying:false});if(!this.model.get("_media").source)return;const media=this.model.get("_media");if(window.location.protocol==="https:"&&media.source.indexOf("http:")===0){media.source=media.source.replace(/^http:/,"https:")}this.model.set("_media",media)}postRender(){this.setupPlayer();this.addMejsButtonClass()}addMejsButtonClass(){this.$(".mejs-overlay-button").addClass("icon")}setupPlayer(){if(!this.model.get("_playerOptions"))this.model.set("_playerOptions",{});const modelOptions=this.model.get("_playerOptions");if(modelOptions.pluginPath===undefined){_.extend(modelOptions,{pluginPath:"https://cdnjs.cloudflare.com/ajax/libs/mediaelement/2.21.2/",flashName:"flashmediaelement-cdn.swf",flashScriptAccess:"always"})}if(modelOptions.features===undefined){modelOptions.features=["playpause","progress","current","duration"];if(this.model.get("_useClosedCaptions")){modelOptions.features.unshift("tracks")}if(this.model.get("_allowFullScreen")){modelOptions.features.push("fullscreen")}if(this.model.get("_showVolumeControl")){modelOptions.features.push("volume")}}modelOptions.success=_.debounce(this.onPlayerReady.bind(this),100);if(this.model.get("_useClosedCaptions")){const startLanguage=this.model.get("_startLanguage")||"en";if(!offlineStorage$1.get("captions")){offlineStorage$1.set("captions",startLanguage)}modelOptions.startLanguage=this.checkForSupportedCCLanguage(offlineStorage$1.get("captions"))}if(modelOptions.alwaysShowControls===undefined){modelOptions.alwaysShowControls=false}if(modelOptions.hideVideoControlsOnLoad===undefined){modelOptions.hideVideoControlsOnLoad=true}this.addMediaTypeClass();this.addThirdPartyFixes(modelOptions,()=>{this.$("audio, video").mediaelementplayer(modelOptions);this.cleanUpPlayer();const _media=this.model.get("_media");if(!_media.mp3&&!_media.mp4&&!_media.ogv&&!_media.webm&&!_media.source){logging$1.warn("ERROR! No media is selected in components.json for component "+this.model.get("_id"));this.setReadyStatus();return}if(!_media.source)return;this.$(".media__widget").addClass("external-source")})}addMediaTypeClass(){const media=this.model.get("_media");if(!media?.type)return;const typeClass=media.type.replace(/\//,"-");this.$(".media__widget").addClass(typeClass)}addThirdPartyFixes(modelOptions,callback){const media=this.model.get("_media");if(!media)return callback();if(media.mp3||media.ogg){modelOptions.alwaysShowControls=true}switch(media.type){case"video/vimeo":modelOptions.alwaysShowControls=false;modelOptions.hideVideoControlsOnLoad=true;modelOptions.features=[];if(MediaView.froogaloopAdded)return callback();$.getScript("assets/froogaloop.js").done(()=>{MediaView.froogaloopAdded=true;callback()}).fail(()=>{MediaView.froogaloopAdded=false;logging$1.error("Could not load froogaloop.js")});break;default:callback();}}cleanUpPlayer(){const containerLabel=this.model.get("displayTitle")||this.model.get("title");this.$(".media__widget").children(".mejs-offscreen").remove();this.$("[role=application]").removeAttr("role tabindex");this.$(".mejs-container").attr({role:"region","aria-label":containerLabel});this.$("[aria-controls]").removeAttr("aria-controls");this.$(".mejs-overlay-play").attr("aria-hidden","true")}setupEventListeners(){this.completionEvent=this.model.get("_setCompletionOn")||"play";if(this.completionEvent==="inview"){this.setupInviewCompletion(".component__widget")}if(this.model.get("_preventForwardScrubbing")&&!this.model.get("_isComplete")){$(this.mediaElement).on({seeking:this.onMediaElementSeeking,timeupdate:this.onMediaElementTimeUpdate})}$(this.mediaElement).on({play:this.onMediaElementPlay,pause:this.onMediaElementPause,ended:this.onMediaElementEnded});_.delay(this.listenForCaptionsChange.bind(this),250)}listenForCaptionsChange(){if(!this.model.get("_useClosedCaptions"))return;const selector=this.model.get("_playerOptions").toggleCaptionsButtonWhenOnlyOne?".mejs-captions-button button":".mejs-captions-selector";this.$(selector).on("click.mediaCaptionsChange",_.debounce(()=>{const srclang=this.mediaElement.player.selectedTrack?this.mediaElement.player.selectedTrack.srclang:"none";offlineStorage$1.set("captions",srclang);Adapt$1.trigger("media:captionsChange",this,srclang)},250));this.listenTo(Adapt$1,"media:captionsChange",this.onCaptionsChanged)}onCaptionsChanged(view,lang){if(view?.cid===this.cid)return;lang=this.checkForSupportedCCLanguage(lang);this.mediaElement.player.setTrack(lang);const $inputs=this.$(".mejs-captions-selector input");$inputs.filter(":checked").prop("checked",false);$inputs.filter(`[value="${lang}"]`).prop("checked",true)}checkForSupportedCCLanguage(lang){if(!lang||lang==="none")return"none";if(_.findWhere(this.model.get("_media").cc,{srclang:lang}))return lang;return this.model.get("_startLanguage")||"none"}onMediaElementPlay(event){this.queueGlobalEvent("play");Adapt$1.trigger("media:stop",this);if(this.model.get("_pauseWhenOffScreen")){this.$(".mejs-container").on("inview",this.onWidgetInview)}this.model.set({_isMediaPlaying:true,_isMediaEnded:false});if(this.completionEvent!=="play")return;this.setCompletionStatus()}onMediaElementPause(event){this.queueGlobalEvent("pause");this.$(".mejs-container").off("inview",this.onWidgetInview);this.model.set("_isMediaPlaying",false)}onMediaElementEnded(event){this.queueGlobalEvent("ended");this.model.set("_isMediaEnded",true);if(this.completionEvent==="ended"){this.setCompletionStatus()}}onWidgetInview(event,isInView){if(!isInView&&!this.mediaElement.paused)this.mediaElement.player.pause()}onMediaElementSeeking(event){let maxViewed=this.model.get("_maxViewed");if(!maxViewed){maxViewed=0}if(event.target.currentTime<=maxViewed)return;event.target.currentTime=maxViewed}onMediaElementTimeUpdate(event){let maxViewed=this.model.get("_maxViewed");if(!maxViewed){maxViewed=0}if(event.target.currentTime<=maxViewed)return;this.model.set("_maxViewed",event.target.currentTime)}setupPlayPauseToggle(){const player=this.mediaElement.player;if(!player){logging$1.warn("MediaView.setupPlayPauseToggle: OOPS! there is no player reference.");return}player.options.clickToPlayPause=false;this.$(".mejs-overlay-button").on("click",this.onOverlayClick);this.$(".mejs-mediaelement").on("click",this.onMediaElementClick)}onMediaStop(view){if(view?.cid===this.cid)return;if(!this.mediaElement||!this.mediaElement.player)return;this.mediaElement.player.pause()}onOverlayClick(){const player=this.mediaElement.player;if(!player)return;player.play()}onMediaElementClick(event){const player=this.mediaElement.player;if(!player)return;const isPaused=player.media.paused;if(!isPaused)player.pause()}remove(){this.$(".mejs-overlay-button").off("click",this.onOverlayClick);this.$(".mejs-mediaelement").off("click",this.onMediaElementClick);this.$(".mejs-container").off("inview",this.onWidgetInview);if(this.model.get("_useClosedCaptions")){const selector=this.model.get("_playerOptions").toggleCaptionsButtonWhenOnlyOne?".mejs-captions-button button":".mejs-captions-selector";this.$(selector).off("click.mediaCaptionsChange")}const modelOptions=this.model.get("_playerOptions");delete modelOptions.success;const media=this.model.get("_media");if(media){switch(media.type){case"video/vimeo":this.$("iframe")[0].isRemoved=true;}}if(this.mediaElement&&this.mediaElement.player){const playerId=this.mediaElement.player.id;purge(this.$el[0]);this.mediaElement.player.remove();if(window.mejs.players[playerId]){delete window.mejs.players[playerId]}}if(this.mediaElement){$(this.mediaElement).off({play:this.onMediaElementPlay,pause:this.onMediaElementPause,ended:this.onMediaElementEnded,seeking:this.onMediaElementSeeking,timeupdate:this.onMediaElementTimeUpdate});this.mediaElement.src="";$(this.mediaElement.pluginElement).remove();delete this.mediaElement}super.remove()}onDeviceChanged(){if(!this.model.get("_media").source)return;this.$(".mejs-container").width(this.$(".component__widget").width())}onPlayerReady(mediaElement,domObject){this.mediaElement=mediaElement;let player=this.mediaElement.player;if(!player)player=window.mejs.players[this.$(".mejs-container").attr("id")];const hasTouch=window.mejs.MediaFeatures.hasTouch;if(hasTouch){this.setupPlayPauseToggle()}this.addThirdPartyAfterFixes();this.cleanUpPlayerAfter();if(player&&this.model.has("_startVolume")){player.setVolume(parseInt(this.model.get("_startVolume"))/100)}this.setReadyStatus();this.setupEventListeners()}addThirdPartyAfterFixes(){const media=this.model.get("_media");switch(media.type){case"video/vimeo":this.$(".mejs-container").attr("tabindex",0);}}cleanUpPlayerAfter(){this.$("[aria-valuemax='NaN']").attr("aria-valuemax",0)}onScreenSizeChanged(){this.$("audio, video").width(this.$(".component__widget").width())}onSkipToTranscript(){_.delay(()=>{a11y$1.focus(this.$(".media__transcript-btn"))},250)}onToggleInlineTranscript(event){if(event)event.preventDefault();const $transcriptBodyContainer=this.$(".media__transcript-body-inline");const $button=this.$(".media__transcript-btn-inline");const $buttonText=this.$(".media__transcript-btn-inline .media__transcript-btn-text");if($transcriptBodyContainer.hasClass("inline-transcript-open")){$transcriptBodyContainer.stop(true,true).slideUp(()=>{$(window).resize()}).removeClass("inline-transcript-open");$button.attr("aria-expanded",false);$buttonText.html(this.model.get("_transcript").inlineTranscriptButton);return}$transcriptBodyContainer.stop(true,true).slideDown(()=>{$(window).resize()}).addClass("inline-transcript-open");$button.attr("aria-expanded",true);$buttonText.html(this.model.get("_transcript").inlineTranscriptCloseButton);if(this.model.get("_transcript")._setCompletionOnView!==false){this.setCompletionStatus()}}onExternalTranscriptClicked(event){if(this.model.get("_transcript")._setCompletionOnView===false)return;this.setCompletionStatus()}queueGlobalEvent(eventType){const time=Date.now();const lastEvent=this.lastEvent||{time:0};const timeSinceLastEvent=time-lastEvent.time;const debounceTime=500;this.lastEvent={time,type:eventType};clearTimeout(this.eventTimeout);if(eventType==="ended"){return this.triggerGlobalEvent(eventType)}if(timeSinceLastEvent<=debounceTime)return;this.eventTimeout=setTimeout(this.triggerGlobalEvent.bind(this,eventType),debounceTime)}triggerGlobalEvent(eventType){const player=this.mediaElement.player;const eventObj={type:eventType,src:this.mediaElement.src,platform:this.mediaElement.pluginType};if(player)eventObj.isVideo=player.isVideo;Adapt$1.trigger("media",eventObj)}}MediaView.froogaloopAdded=false;var MediaView$1=__AMD("components/adapt-contrib-media/js/mediaView",MediaView);__AMD("components/adapt-contrib-media/js/adapt-contrib-media",components$1.register("media",{model:ComponentModel$1.extend({}),view:MediaView$1}));var NarrativeModel=__AMD("components/adapt-contrib-narrative/js/NarrativeModel",class NarrativeModel extends ItemsComponentModel{});var MODE=__AMD("components/adapt-contrib-narrative/js/modeEnum",new ENUM(["SMALL","LARGE"]));class NarrativeView extends ComponentView$1{events(){return{"click .js-narrative-strapline-open-popup":"openPopup","click .js-narrative-controls-click":"onNavigationClicked","click .js-narrative-progress-click":"onProgressClicked","swipeleft .js-narrative-swipe":"onSwipeLeft","swiperight .js-narrative-swipe":"onSwipeRight"}}initialize(){super.initialize(...arguments);this._isInitial=true}preRender(){this.listenTo(Adapt$1,{"device:changed device:resize":this.reRender,"notify:closed":this.closeNotify});this.renderMode();this.listenTo(this.model.getChildren(),{"change:_isActive":this.onItemsActiveChange,"change:_isVisited":this.onItemsVisitedChange});this.calculateWidths()}onItemsActiveChange(item,_isActive){if(!_isActive)return;if(this.isTextBelowImage()){item.toggleVisited(true)}this.setStage(item);this.setFocus(item.get("_index"))}setFocus(itemIndex){if(this._isInitial)return;const $straplineHeaderElm=this.$(".narrative__strapline-header-inner");const hasStraplineTransition=!this.isLargeMode()&&$straplineHeaderElm.css("transitionDuration")!=="0s";if(hasStraplineTransition){$straplineHeaderElm.one("transitionend",()=>{this.focusOnNarrativeElement(itemIndex)});return}this.focusOnNarrativeElement(itemIndex)}focusOnNarrativeElement(itemIndex){const dataIndexAttr=`[data-index='${itemIndex}']`;const $elementToFocus=this.isLargeMode()?this.$(`.narrative__content-item${dataIndexAttr}`):this.$(`.narrative__strapline-btn${dataIndexAttr}`);a11y$1.focusFirst($elementToFocus)}onItemsVisitedChange(item,_isVisited){if(!_isVisited)return;this.$(`[data-index="${item.get("_index")}"]`).addClass("is-visited")}calculateMode(){const mode=device$1.screenSize==="large"?MODE.LARGE:MODE.SMALL;this.model.set("_mode",mode)}renderMode(){this.calculateMode();const isLargeMode=this.isLargeMode();const isTextBelowImage=this.isTextBelowImage();this.$el.toggleClass("mode-large",isLargeMode).toggleClass("mode-small",!isLargeMode).toggleClass("items-are-full-width",isTextBelowImage)}isLargeMode(){return this.model.get("_mode")===MODE.LARGE}isTextBelowImage(){const isTextBelowImage=device$1.screenSize==="large"?this.model.get("_isTextBelowImage"):this.model.get("_isMobileTextBelowImage");return Boolean(isTextBelowImage)}postRender(){this.renderMode();this.setupNarrative();this.$(".narrative__slider").imageready(this.setReadyStatus.bind(this));if(Adapt$1.config.get("_disableAnimation")){this.$el.addClass("disable-animation")}}setupNarrative(){this.renderMode();const items=this.model.getChildren();if(!items||!items.length)return;let activeItem=this.model.getActiveItem();if(!activeItem){activeItem=this.model.getItem(0);activeItem.toggleActive(true)}else{items.trigger("change:_isActive",activeItem,true)}this.calculateWidths();if(!this.isLargeMode()&&!this.model.get("_wasHotgraphic")){this.replaceInstructions()}this.setupEventListeners();this._isInitial=false}calculateWidths(){const itemCount=this.model.getChildren().length;this.model.set({_totalWidth:100*itemCount,_itemWidth:100/itemCount})}resizeControl(){const previousMode=this.model.get("_mode");this.renderMode();if(previousMode!==this.model.get("_mode"))this.replaceInstructions();this.evaluateNavigation();const activeItem=this.model.getActiveItem();if(activeItem)this.setStage(activeItem)}reRender(){if(this.model.get("_wasHotgraphic")&&this.isLargeMode()){this.replaceWithHotgraphic();return}this.resizeControl()}closeNotify(){this.evaluateCompletion()}replaceInstructions(){if(this.isLargeMode()){this.$(".narrative__instruction-inner").html(this.model.get("instruction"));return}if(this.model.get("mobileInstruction")&&!this.model.get("_wasHotgraphic")){this.$(".narrative__instruction-inner").html(this.model.get("mobileInstruction"))}}replaceWithHotgraphic(){const HotgraphicView=components$1.getViewClass("hotgraphic");if(!HotgraphicView)return;const model=this.prepareHotgraphicModel();const newHotgraphic=new HotgraphicView({model});this.$el.parents(".component__container").append(newHotgraphic.$el);this.remove();_.defer(()=>{Adapt$1.trigger("device:resize")})}prepareHotgraphicModel(){const model=this.model;model.resetActiveItems();model.set({_isPopupOpen:false,_component:"hotgraphic",body:model.get("originalBody"),instruction:model.get("originalInstruction")});return model}moveSliderToIndex(itemIndex){let offset=this.model.get("_itemWidth")*itemIndex;if(Adapt$1.config.get("_defaultDirection")==="ltr"){offset*=-1}const cssValue=`translateX(${offset}%)`;const $sliderElm=this.$(".narrative__slider");const $straplineHeaderElm=this.$(".narrative__strapline-header-inner");$sliderElm.css("transform",cssValue);$straplineHeaderElm.css("transform",cssValue)}setStage(item){const index=item.get("_index");const indexSelector=`[data-index="${index}"]`;if(this.isLargeMode()){item.toggleVisited(true)}this.$(".narrative__progress").removeClass("is-selected").filter(indexSelector).addClass("is-selected");const $slideGraphics=this.$(".narrative__slider-image-container");a11y$1.toggleAccessibleEnabled($slideGraphics,false);a11y$1.toggleAccessibleEnabled($slideGraphics.filter(indexSelector),true);const $narrativeItems=this.$(".narrative__content-item");$narrativeItems.addClass("u-visibility-hidden u-display-none");a11y$1.toggleAccessible($narrativeItems,false);a11y$1.toggleAccessible($narrativeItems.filter(indexSelector).removeClass("u-visibility-hidden u-display-none"),true);const $narrativeStraplineButtons=this.$(".narrative__strapline-btn");a11y$1.toggleAccessibleEnabled($narrativeStraplineButtons,false);a11y$1.toggleAccessibleEnabled($narrativeStraplineButtons.filter(indexSelector),true);this.evaluateNavigation();this.evaluateCompletion();this.shouldShowInstructionError();this.moveSliderToIndex(index)}evaluateNavigation(){const active=this.model.getActiveItem();if(!active)return;const index=active.get("_index");const itemCount=this.model.getChildren().length;const isAtStart=index===0;const isAtEnd=index===itemCount-1;const $left=this.$(".narrative__controls-left");const $right=this.$(".narrative__controls-right");const globals=Adapt$1.course.get("_globals");const ariaLabelsGlobals=globals._accessibility._ariaLabels;const narrativeGlobals=globals._components._narrative;const ariaLabelPrevious=narrativeGlobals.previous||ariaLabelsGlobals.previous;const ariaLabelNext=narrativeGlobals.next||ariaLabelsGlobals.next;const prevTitle=isAtStart?"":this.model.getItem(index-1).get("title");const nextTitle=isAtEnd?"":this.model.getItem(index+1).get("title");$left.toggleClass("u-visibility-hidden",isAtStart);$right.toggleClass("u-visibility-hidden",isAtEnd);$left.attr("aria-label",Handlebars.helpers.compile_a11y_normalize(ariaLabelPrevious,{title:prevTitle,_globals:globals,itemNumber:isAtStart?null:index,totalItems:itemCount}));$right.attr("aria-label",Handlebars.helpers.compile_a11y_normalize(ariaLabelNext,{title:nextTitle,_globals:globals,itemNumber:isAtEnd?null:index+2,totalItems:itemCount}))}evaluateCompletion(){if(this.model.areAllItemsCompleted()){this.trigger("allItems");this.$(".narrative__instruction-inner").removeClass("instruction-error")}}openPopup(){const currentItem=this.model.getActiveItem();notify$1.popup({title:currentItem.get("title"),body:currentItem.get("body")});Adapt$1.on("popup:opened",function(){currentItem.toggleVisited(true)})}onNavigationClicked(event){const $btn=$(event.currentTarget);let index=this.model.getActiveItem().get("_index");$btn.data("direction")==="right"?index++:index--;this.model.setActiveItem(index)}onSwipeLeft(){let index=this.model.getActiveItem().get("_index");this.model.setActiveItem(++index)}onSwipeRight(){let index=this.model.getActiveItem().get("_index");this.model.setActiveItem(--index)}onProgressClicked(event){const index=$(event.target).data("index");this.model.setActiveItem(index)}shouldShowInstructionError(){const prevItemIndex=this.model.getActiveItem().get("_index")-1;if(prevItemIndex<0||this.model.getItem(prevItemIndex).get("_isVisited"))return;this.$(".narrative__instruction-inner").addClass("instruction-error")}setupEventListeners(){if(this.model.get("_setCompletionOn")==="inview"){this.setupInviewCompletion(".component__widget")}}}NarrativeView.template="narrative";var NarrativeView$1=__AMD("components/adapt-contrib-narrative/js/NarrativeView",NarrativeView);__AMD("components/adapt-contrib-narrative/js/adapt-contrib-narrative",components$1.register("narrative",{model:NarrativeModel,view:NarrativeView$1}));var SliderView=__AMD("components/adapt-contrib-slider/js/sliderView",class SliderView extends QuestionView$1{events(){return{"click .js-slider-number-click":"onNumberSelected","focus .js-slider-item-input":"onHandleFocus","blur .js-slider-item-input":"onHandleBlur"}}setupQuestion(){if(this.model.get("_isSubmitted"))return;this.selectItem(this.getIndexFromValue(this.model.get("_selectedItem").value))}setupRangeslider(){this.$sliderScaleMarker=this.$(".js-slider-number-selection");this.$slider=this.$(".js-slider-item-input");if(this.model.has("_scaleStep")){this.$slider.attr({step:this.model.get("_scaleStep")})}this.$slider.rangeslider({polyfill:false,onSlide:this.handleSlide.bind(this)});this.oldValue=0;if(this._deferEnable){this.setAllItemsEnabled()}}handleSlide(position,value){if(this.oldValue===value){return}const itemIndex=this.getIndexFromValue(value);const pixels=this.mapIndexToPixels(itemIndex);this.selectItem(itemIndex);this.animateToPosition(pixels);this.oldValue=value}disableQuestion(){this.setAllItemsEnabled()}enableQuestion(){this.setAllItemsEnabled()}setAllItemsEnabled(){const isEnabled=this.model.get("_isEnabled");if(!this.$slider){this._deferEnable=true;return}this.$(".slider__widget").toggleClass("is-disabled",!isEnabled);this.$slider.prop("disabled",!isEnabled).rangeslider("update",true)}onQuestionRendered(){this.setupRangeslider();this.setScalePositions();this.onScreenSizeChanged();this.showScaleMarker(true);this.listenTo(Adapt$1,"device:resize",this.onScreenSizeChanged);this.setReadyStatus()}animateToPosition(newPosition){if(!this.$sliderScaleMarker)return;this.$sliderScaleMarker.velocity("stop").velocity({left:newPosition},{duration:200,easing:"linear",mobileHA:false})}getIndexFromValue(itemValue){const scaleStart=this.model.get("_scaleStart");const scaleEnd=this.model.get("_scaleEnd");return Math.round(this.mapValue(itemValue,scaleStart,scaleEnd,0,this.model.get("_items").length-1))}mapIndexToPixels(value,$widthObject){const numberOfItems=this.model.get("_items").length;const width=$widthObject?$widthObject.width():this.$(".js-slider-scale").width();return Math.round(this.mapValue(value,0,numberOfItems-1,0,width))}mapPixelsToIndex(value){const numberOfItems=this.model.get("_items").length;const width=this.$(".slider-sliderange").width();return Math.round(this.mapValue(value,0,width,0,numberOfItems-1))}normalise(value,low,high){const range=high-low;return(value-low)/range}mapValue(value,inputLow,inputHigh,outputLow,outputHigh){const normal=this.normalise(value,inputLow,inputHigh);return normal*(outputHigh-outputLow)+outputLow}onHandleFocus(event){event.preventDefault();this.$slider.on("keydown",this.onKeyDown.bind(this))}onHandleBlur(event){event.preventDefault();this.$slider.off("keydown")}onKeyDown(event){if(event.which===9)return;event.preventDefault();let newItemIndex=this.getIndexFromValue(this.model.get("_selectedItem").value);switch(event.which){case 40:case 37:newItemIndex=Math.max(newItemIndex-1,0);break;case 38:case 39:newItemIndex=Math.min(newItemIndex+1,this.model.get("_items").length-1);break;}this.selectItem(newItemIndex);if(typeof newItemIndex==="number")this.showScaleMarker(true);this.animateToPosition(this.mapIndexToPixels(newItemIndex));this.setSliderValue(this.getValueFromIndex(newItemIndex))}onNumberSelected(event){event.preventDefault();if(this.model.get("_isInteractionComplete")){return}if(this.$slider.prop("disabled")){return}const itemValue=parseFloat($(event.currentTarget).attr("data-id"));const index=this.getIndexFromValue(itemValue);this.selectItem(index);this.animateToPosition(this.mapIndexToPixels(index));this.setSliderValue(itemValue)}getValueFromIndex(index){return this.model.get("_items")[index].value}resetControlStyles(){this.$(".slider-handle").empty();this.showScaleMarker(false);this.$(".slider-bar").animate({width:"0"});this.setSliderValue(this.model.get("_items")[0].value)}onCannotSubmit(){}setSliderValue(value){if(!this.$slider)return;this.$slider.val(value).change()}showMarking(){if(!this.model.get("_canShowMarking"))return;this.$(".slider__widget").removeClass("is-correct is-incorrect").addClass(this.model.get("_selectedItem").correct?"is-correct":"is-incorrect")}resetQuestion(){this.selectItem(0);this.animateToPosition(0);this.resetControlStyles();this.showScaleMarker(true)}setScalePositions(){const numberOfItems=this.model.get("_items").length;this.model.get("_items").forEach((item,index)=>{const normalisedPosition=this.normalise(index,0,numberOfItems-1);this.$(".js-slider-number").eq(index).data("normalisedPosition",normalisedPosition)})}showScale(){const $markers=this.$(".js-slider-scale-notch-container").empty();if(this.model.get("_showScale")===false){$markers.eq(0).addClass("u-display-none");this.$(".js-slider-number").addClass(this.model.get("_showScaleIndicator")?"u-visibility-hidden":"u-display-none");return}const $scaler=this.$(".js-slider-scale");for(let i=1,count=this.model.get("_items").length-1;i<count;i++){$markers.append(`<div class="slider__scale-notch" style="left: ${this.mapIndexToPixels(i,$scaler)}px">`)}this.showScaleNumbers()}showScaleNumbers(){const $scaler=this.$(".js-slider-scale");const $numbers=this.$(".js-slider-number");if(this.model.get("_showScaleNumbers")===false){$numbers.addClass("u-display-none");return}const scaleWidth=$scaler.width();this.model.get("_items").forEach((item,index)=>{const $number=$numbers.eq(index);const newLeft=Math.round($number.data("normalisedPosition")*scaleWidth);$number.css({left:newLeft})})}showLabels(){if(this.model.get("labelStart")||this.model.get("labelEnd"))return;this.$(".js-slider-label-container").eq(0).addClass("u-display-none")}remapSliderBar(){const $scaler=this.$(".js-slider-scale");const currentIndex=this.getIndexFromValue(this.model.get("_selectedItem").value);const left=this.mapIndexToPixels(currentIndex,$scaler);this.$(".slider-handle").css({left:`${left}px`});this.$(".js-slider-number-selection").css({left:`${left}px`});this.$(".slider-bar").width(left)}onScreenSizeChanged(){this.showScale();this.showLabels();this.remapSliderBar();if(this.$(".slider__widget").hasClass("show-user-answer")){this.hideCorrectAnswer()}else if(this.$(".slider__widget").hasClass("show-correct-answer")){this.showCorrectAnswer()}}showCorrectAnswer(){this.showScaleMarker(false);const answers=this.model.getCorrectAnswers();if(answers.length===0){console.log("adapt-contrib-slider::WARNING: no correct answer or correct range set in JSON");return}const middleAnswer=answers[Math.floor(answers.length/2)];this.animateToPosition(this.mapIndexToPixels(this.getIndexFromValue(middleAnswer)));this.showModelAnswers(answers);this.setSliderValue(middleAnswer)}showModelAnswers(correctAnswerArray){const $parentDiv=this.$(".js-slider-model-range");correctAnswerArray.forEach((correctAnswer,index)=>{$parentDiv.append($("<div class=\"slider__number-model-answer\">"));const $element=this.$(".js-slider-model-range .slider__number-model-answer").eq(index);const startingLeft=this.mapIndexToPixels(this.getIndexFromValue(this.model.get("_selectedItem").value));if(this.model.get("_showNumber"))$element.html(correctAnswer);$element.css({left:startingLeft}).fadeIn(0,()=>{$element.animate({left:this.mapIndexToPixels(this.getIndexFromValue(correctAnswer))})})})}hideCorrectAnswer(){const userAnswerIndex=this.getIndexFromValue(this.model.get("_userAnswer"));this.$(".js-slider-model-range").empty();this.showScaleMarker(true);this.selectItem(userAnswerIndex);this.animateToPosition(this.mapIndexToPixels(userAnswerIndex));this.setSliderValue(this.model.get("_userAnswer"))}selectItem(itemIndex){this.model.deselectAllItems();const item=this.model.get("_items")[itemIndex];if(!item)return;item.selected=true;this.model.set("_selectedItem",item);this.$(".js-slider-item-input").attr({value:item.value,"aria-valuenow":item.value});this.showNumber(true)}showScaleMarker(show){const $scaleMarker=this.$(".js-slider-number-selection");if(this.model.get("_showScaleIndicator")){this.showNumber(show);$scaleMarker.toggleClass("display-block",show)}}showNumber(show){const $scaleMarker=this.$(".js-slider-number-selection");if(this.model.get("_showNumber")){if(show){$scaleMarker.html(this.model.get("_selectedItem").value)}else{$scaleMarker.html=""}}}});var SliderModel=__AMD("components/adapt-contrib-slider/js/sliderModel",class SliderModel extends QuestionModel$1{init(){QuestionModel$1.prototype.init.call(this);this.setupModelItems();this.selectDefaultItem()}reset(){let type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"hard";let canReset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.get("_canReset");const wasReset=super.reset(type,canReset);if(!wasReset)return false;this.deselectAllItems();this.selectDefaultItem();return true}selectDefaultItem(){this.set("_selectedItem",this.get("_items")[0])}getDecimalPlaces(num){return(num.toString().split(".")[1]||[]).length}setupModelItems(){const items=[];const answer=this.get("_correctAnswer");const range=this.get("_correctRange");const start=this.get("_scaleStart");const end=this.get("_scaleEnd");const step=this.get("_scaleStep")||1;const dp=this.getDecimalPlaces(step);for(let i=start;i<=end;i+=step){if(dp!==0){i=parseFloat(i.toFixed(dp))}items.push({value:i,selected:false,correct:answer?i===Number(answer):i>=range._bottom&&i<=range._top})}this.set({_items:items,_marginDir:Adapt$1.config.get("_defaultDirection")==="rtl"?"right":"left"})}canSubmit(){return true}restoreUserAnswers(){if(!this.get("_isSubmitted")){this.set({_userAnswer:undefined});this.selectDefaultItem();return}const items=this.get("_items");const userAnswer=this.get("_userAnswer");const selectedItem=items.find(_ref=>{let{value}=_ref;return value===userAnswer});if(selectedItem){selectedItem.selected=true;this.set("_selectedItem",selectedItem)}this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.setupFeedback()}storeUserAnswer(){this.set("_userAnswer",this.get("_selectedItem").value)}resetUserAnswer(){this.set({_isAtLeastOneCorrectSelection:false,_userAnswer:undefined});this.selectDefaultItem()}deselectAllItems(){this.get("_items").forEach(item=>item.selected=false)}isCorrect(){const numberOfCorrectAnswers=this.get("_items").filter(_ref2=>{let{selected,correct}=_ref2;return selected&&correct}).length;this.set("_isAtLeastOneCorrectSelection",numberOfCorrectAnswers>0);this.set("_numberOfCorrectAnswers",numberOfCorrectAnswers);return this.get("_isAtLeastOneCorrectSelection")}isPartlyCorrect(){return this.get("_isAtLeastOneCorrectSelection")}setScore(){const numberOfCorrectAnswers=this.get("_numberOfCorrectAnswers");const questionWeight=this.get("_questionWeight");const score=questionWeight*numberOfCorrectAnswers;this.set("_score",score)}getResponse(){return this.get("_userAnswer").toString()}getResponseType(){return"numeric"}getCorrectAnswers(){const answerSingle=this.get("_correctAnswer");const answers=[];if(answerSingle){return[answerSingle]}const answerMultiple=this.get("_correctRange");if(!answerMultiple){return answers}const bottom=answerMultiple._bottom;const top=answerMultiple._top;if(bottom===undefined||top===undefined){return answers}let answer=bottom;const step=this.get("_scaleStep")||1;while(answer<=top){answers.push(answer);answer+=step}return answers}getCorrectAnswerAsText(){const globals=Adapt$1.course.get("_globals")._components._slider;const answers=this.getCorrectAnswers();if(answers.length>1){return Handlebars.compile(globals.ariaCorrectAnswerRange)({bottom:answers.shift(),top:answers.pop()})}return Handlebars.compile(globals.ariaCorrectAnswer)({correctAnswer:answers[0]})}getUserAnswerAsText(){const answerTemplate=Adapt$1.course.get("_globals")._components._slider.ariaUserAnswer;return Handlebars.compile(answerTemplate)({userAnswer:this.get("_userAnswer")})}});__AMD("components/adapt-contrib-slider/js/adapt-contrib-slider",components$1.register("slider",{view:SliderView,model:SliderModel}));var TextView=ComponentView$1.extend({preRender:function(){this.checkIfResetOnRevisit()},postRender:function(){this.setReadyStatus();this.setupInview()},setupInview:function(){var selector=this.getInviewElementSelector();if(!selector){this.setCompletionStatus();return}this.setupInviewCompletion(selector)},getInviewElementSelector:function(){if(this.model.get("body"))return".component__body";if(this.model.get("instruction"))return".component__instruction";if(this.model.get("title")||this.model.get("displayTitle"))return".component__title";return null},checkIfResetOnRevisit:function(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}}},{template:"text"});__AMD("components/adapt-contrib-text/js/adapt-contrib-text",Adapt$1.register("text",{model:ComponentModel$1.extend({}),view:TextView}));class TextInputView extends QuestionView$1{events(){return{"focus .js-textinput-textbox":"clearValidationError","change .js-textinput-textbox":"onInputChanged","keyup .js-textinput-textbox":"onInputChanged"}}setupQuestion(){this.model.setupRandomisation()}disableQuestion(){this.setAllItemsEnabled(false)}enableQuestion(){this.setAllItemsEnabled(true)}setAllItemsEnabled(isEnabled){this.model.get("_items").forEach((item,index)=>{const $itemInput=this.$(".js-textinput-textbox").eq(index);$itemInput.prop("disabled",!isEnabled)})}onQuestionRendered(){this.setReadyStatus()}clearValidationError(){this.$(".js-textinput-textbox").removeClass("has-error")}onCannotSubmit(){this.showValidationError()}showValidationError(){this.$(".js-textinput-textbox").addClass("has-error")}showMarking(){if(!this.model.get("_canShowMarking"))return;this.model.get("_items").forEach((item,i)=>{const $item=this.$(".js-textinput-item").eq(i);$item.removeClass("is-correct is-incorrect").addClass(item._isCorrect?"is-correct":"is-incorrect")})}resetQuestion(){this.$(".js-textinput-textbox").prop("disabled",!this.model.get("_isEnabled")).val("");this.model.set({_isAtLeastOneCorrectSelection:false,_isCorrect:undefined})}showCorrectAnswer(){const correctAnswers=this.model.get("_answers");this.model.get("_items").forEach((item,index)=>{const correctAnswer=correctAnswers?correctAnswers[index][0]:item._answers[0];this.$(".js-textinput-textbox").eq(index).val(correctAnswer)})}hideCorrectAnswer(){this.model.get("_items").forEach((item,index)=>{this.$(".js-textinput-textbox").eq(index).val(item.userAnswer)})}onInputChanged(e){const $input=$(e.target);this.model.setItemUserAnswer($input.parents(".js-textinput-item").index(),$input.val())}}TextInputView.template="textinput.jsx";var TextInputView$1=__AMD("components/adapt-contrib-textInput/js/textInputView",TextInputView);class TextInputModel extends QuestionModel$1{init(){super.init();this.set("_genericAnswerIndexOffset",TextInputModel.genericAnswerIndexOffset);this.setupQuestionItemIndexes();this.checkCanSubmit()}reset(){let type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"hard";let canReset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.get("_canReset");const wasReset=super.reset(type,canReset);if(!wasReset)return false;this.set({_isAtLeastOneCorrectSelection:false,_isCorrect:null});return true}setupQuestionItemIndexes(){this.get("_items").forEach((item,index)=>{if(item._index===undefined)item._index=index;if(item._answerIndex===undefined)item._answerIndex=-1})}restoreUserAnswers(){if(!this.get("_isSubmitted"))return;const userAnswer=this.get("_userAnswer");const genericAnswers=this.get("_answers");this.get("_items").forEach(item=>{const answerIndex=userAnswer[item._index];if(answerIndex>=TextInputModel.genericAnswerIndexOffset){item.userAnswer=genericAnswers[answerIndex-TextInputModel.genericAnswerIndexOffset];item._answerIndex=answerIndex}else if(answerIndex>-1){item.userAnswer=item._answers[answerIndex];item._answerIndex=answerIndex}else{if(item.userAnswer===undefined)item.userAnswer="******";item._answerIndex=-1}if(item.userAnswer instanceof Array)item.userAnswer=item.userAnswer[0]});this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.setupFeedback()}setupRandomisation(){if(!this.get("_isRandom")||!this.get("_isEnabled"))return;this.set("_items",_.shuffle(this.get("_items")))}canSubmit(){return this.get("_items").every(_ref=>{let{userAnswer}=_ref;return userAnswer})}setItemUserAnswer(itemIndex,userAnswer){const item=this.get("_items")[itemIndex];item.userAnswer=userAnswer;this.checkCanSubmit()}storeUserAnswer(){const items=this.get("_items");this.isCorrect();const userAnswer=new Array(items.length);items.forEach(_ref2=>{let{_index,_answerIndex}=_ref2;return userAnswer[_index]=_answerIndex});this.set("_userAnswer",userAnswer)}isCorrect(){if(this.get("_answers")){this.markGenericAnswers()}else{this.markSpecificAnswers()}return this.get("_items").every(_ref3=>{let{_isCorrect}=_ref3;return _isCorrect})}isPartlyCorrect(){return this.get("_isAtLeastOneCorrectSelection")}markGenericAnswers(){let numberOfCorrectAnswers=0;const correctAnswers=this.get("_answers").slice();const usedAnswerIndexes=[];this.get("_items").forEach(item=>{correctAnswers.forEach((answerGroup,answerIndex)=>{if(usedAnswerIndexes.includes(answerIndex))return;if(this.checkAnswerIsCorrect(answerGroup,item.userAnswer)===false)return;usedAnswerIndexes.push(answerIndex);item._isCorrect=true;item._answerIndex=answerIndex+TextInputModel.genericAnswerIndexOffset;this.set({_numberOfCorrectAnswers:++numberOfCorrectAnswers,_isAtLeastOneCorrectSelection:true})});if(!item._isCorrect)item._isCorrect=false})}markSpecificAnswers(){let numberOfCorrectAnswers=0;this.get("_items").forEach(item=>{const answers=item._answers;if(!answers)return;const userAnswer=item.userAnswer||"";const isCorrect=this.checkAnswerIsCorrect(answers,userAnswer);item._isCorrect=isCorrect;item._answerIndex=answers.indexOf(this.cleanupUserAnswer(userAnswer));if(!isCorrect)return;this.set({_numberOfCorrectAnswers:++numberOfCorrectAnswers,_isAtLeastOneCorrectSelection:true})})}checkAnswerIsCorrect(possibleAnswers,userAnswer){const uAnswer=this.cleanupUserAnswer(userAnswer);const answerIsCorrect=possibleAnswers.some(cAnswer=>{return this.cleanupUserAnswer(cAnswer)===uAnswer});return answerIsCorrect}cleanupUserAnswer(userAnswer){if(this.get("_allowsAnyCase")){userAnswer=userAnswer.toLowerCase()}if(this.get("_allowsPunctuation")){userAnswer=userAnswer.replace(/[.,-/#!$%^&*;:{}=\-_`~()]/g,"");userAnswer=userAnswer.replace(/(  +)+/g," ")}return userAnswer.trim()}setScore(){const numberOfCorrectAnswers=this.get("_numberOfCorrectAnswers");const questionWeight=this.get("_questionWeight");const itemLength=this.get("_items").length;const score=questionWeight*numberOfCorrectAnswers/itemLength;this.set("_score",score)}resetUserAnswer(){this.get("_items").forEach(item=>{item._isCorrect=false;item.userAnswer=""})}getResponse(){return this.get("_items").map(_ref4=>{let{userAnswer}=_ref4;return userAnswer}).join("[,]")}getResponseType(){return"fill-in"}}TextInputModel.genericAnswerIndexOffset=65536;var TextInputModel$1=__AMD("components/adapt-contrib-textInput/js/textInputModel",TextInputModel);__AMD("components/adapt-contrib-textInput/js/adapt-contrib-textInput",components$1.register("textinput",{view:TextInputView$1,model:TextInputModel$1}));class ShowcaseView extends ComponentView$1{events(){return{"click .js-showcase-item-btn":"onItemBtnClick"}}initialize(){super.initialize()}preRender(){this.listenTo(this.model.getChildren(),{"change:_isActive":this.onItemActiveChange})}postRender(){this.setReadyStatus();this.setupInviewCompletion()}onItemBtnClick(event){const idx=$(event.currentTarget).parent().data("index");this.model.getChildren().at(idx).toggleActive()}onItemActiveChange(itemModel,isActive){let $item=this.$(`.js-showcase-item[data-index=${itemModel.get("_index")}]`);let $content=$item.find(".js-showcase-item-content");if(isActive){$content.slideDown(500)}else{$content.slideUp(500)}$item.find(".js-showcase-item-btn").toggleClass("is-closed",!isActive).toggleClass("is-open",isActive).toggleClass("is-visited",true)}}ShowcaseView.template="showcase";var ShowcaseView$1=__AMD("components/adapt-showcase/js/showcaseView",ShowcaseView);var ShowcaseModel=__AMD("components/adapt-showcase/js/showcaseModel",class ShowcaseModel extends ItemsComponentModel{initialize(){super.initialize()}});__AMD("components/adapt-showcase/js/adapt-showcase",components$1.register("showcase",{model:ShowcaseModel,view:ShowcaseView$1}));class AnnotationView extends Backbone.View{className(){let classNames=["annotation","js-annotation-click",this.model.get("_hasIcon")?"has-icon":"",this.model.get("_tooltip")?"has-tooltip":""];return classNames.join(" ")}tagName(){return"span"}events(){return{"click":"onClick"}}attributes(){let attributes={"data-annotation-num":this.model.get("_number")};return attributes}initialize(){this.setupEventListeners();_.debounce(this.initTargets.bind(this))();this.render()}setupEventListeners(){this.listenTo(this.model,"change:_isActive",this.onActiveChange);this.listenTo(this.model,"change:_isVisited",this.onVisitedChange);Adapt$1.on("annotation:toggle",this.onAdaptAnnotationToggle.bind(this))}initTargets(){let $targets=this.$getForTargets();$targets.addClass("is-annotation-target").attr("data-annotation-num",this.model.get("_number"));if(Adapt$1.isPDFMode()){$targets.addClass("is-active")}}render(){let template=Handlebars.templates["annotation"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);if(Adapt$1.isPDFMode())this.renderTooltipFallback()}async renderTooltipFallback(){let tooltip=this.model.get("_tooltip");if(!tooltip)return;_.debounce(()=>{let componentView=Adapt$1.findViewByModelId(this.model.get("_parent").get("_id"));let $tooltipFallback=componentView.$(".tooltip-fallback");if(!$tooltipFallback.length){throw"AnnotationView: Could not find a {{{tooltipFallback}}} element in component \""+this.model.get("_parent").get("_id")+"\" (required for PDF mode)."}$tooltipFallback.append("<div class='tooltip-fallback__item' data-annotation-num='"+this.model.get("_number")+"'>"+tooltip+"</div>")},0)()}onClick(){this.toggle();if(!this.model.get("_isActive"))return;let tooltip=this.model.get("_tooltip");if(tooltip){let tooltipPopupView=Adapt$1.createTooltip(this.$el,{content:tooltip,_type:"annotation"});this.tooltipPopupView=tooltipPopupView;this.listenToOnce(tooltipPopupView.model,"change:_isActive",()=>{this.model.set("_isActive",false)})}}toggle(){this.model.set("_isActive",!this.model.get("_isActive"));Adapt$1.trigger("annotation:toggle",this.model)}onAdaptAnnotationToggle(model){if(model==this.model)return;this.model.set("_isActive",false)}onVisitedChange(model,isVisited){if(!isVisited)return;this.$el.addClass("is-visited")}$getForTargets(){var _for=this.model.get("_for");var $for=$();if(_for){let $container=this.$el.closest(".block, .notify");if(!$container.length){Adapt$1.log.error("adapt-annotation: could not find closest .block / .notify element.","Content: "+this.model.get("content"));return $for}_.each(_for,forName=>{let $f=$for.add($container.find("[name='"+forName+"']"));if(!$f.length){Adapt$1.log.error("adapt-annotation: Could not find element with name=\""+forName+"\" inside its componentView ("+this.model.get("_parent").get("_id")+").")}$for=$for.add($f)})}return $for}onActiveChange(model,isActive){this.$el.toggleClass("is-active",isActive);if(isActive){this.model.set("_isVisited",true)}let $forTargets=this.$getForTargets();if(!$forTargets.length)return;Adapt$1.annotation.toggleEl($forTargets,isActive);if(!isActive){if(this.tooltipPopupView)this.tooltipPopupView.remove();$(document).off("click touch",this.onClickAnywhereEvent);return}_.debounce(()=>{this.onClickAnywhereEvent=this.onClickAnywhere.bind(this);$(document).one("click touch",this.onClickAnywhereEvent)})()}onClickAnywhere(event){let $target=$(event.target);if($target.closest(".is-annotation-target.is-active").length)return;this.model.set("_isActive",false)}}var AnnotationView$1=__AMD("extensions/adapt-annotation/js/annotationView",AnnotationView);class Annotation extends Backbone.Controller{initialize(){Adapt$1.on("router:page",this.onRouterPage);this.initHelpers()}onRouterPage(){let annotationNum=1;Handlebars__default["default"].registerHelperEl("annotation",function(){let context=arguments[arguments.length-1];let hash=context.hash;if(!hash.for){if(!hash.tooltip){throw"Annotation must have the \"for\" and/or \"tooltip\" parameter defined."}if(hash.hasIcon===undefined){hash.hasIcon=false}}else{if(hash.hasIcon===undefined){hash.hasIcon=true}}let modelJSON={content:context?.fn?context.fn(this):"",_for:hash.for?hash.for.split(","):undefined,_tooltip:hash.tooltip,_hasIcon:hash.hasIcon!==false,_number:annotationNum,_parent:Handlebars__default["default"].getComponentModelFromContext(context)};annotationNum++;return new AnnotationView$1({model:new Backbone.Model(modelJSON)}).$el})}initHelpers(){var helpers={mark:function(){let context=arguments[arguments.length-1];let data=context.hash||{};if(data.absolute){let vals=data.absolute.split(",");if(vals.length<2){throw"{{#mark}} helper: the \"absolute\" property must have a string value formatted as follows: \"LEFT,TOP,WIDTH,HEIGHT\".\n\nFor example: absolute=\"10,10,20,20\".\n\nYou entered: absolute=\""+absolute+"\""}data.absolute={left:vals[0].trim()+"%",top:vals[1].trim()+"%"};if(vals.length>=3)data.absolute.width=vals[2].trim()+"%";if(vals.length>=4)data.absolute.height=vals[3].trim()+"%"}data._tag="mark";data=_.extend({},{content:context.fn?.apply(this)},data);let template=Handlebars__default["default"].templates["mark"];return new Handlebars__default["default"].SafeString(template(data)).string},markBlock:function(){let context=arguments[arguments.length-1];let data=_.extend({content:context.fn(this)},context.hash||{},{_tag:"div"});let template=Handlebars__default["default"].templates["mark"];return new Handlebars__default["default"].SafeString(template(data)).string},fade:function(){let context=arguments[arguments.length-1];let data=_.extend({content:context.fn(this)},context.hash||{},{_tag:"span"});let template=Handlebars__default["default"].templates["fade"];return new Handlebars__default["default"].SafeString(template(data)).string},fadeBlock:function(){let context=arguments[arguments.length-1];let data=_.extend({content:context.fn(this)},context.hash||{},{_tag:"div"});let template=Handlebars__default["default"].templates["fade"];return new Handlebars__default["default"].SafeString(template(data)).string},tooltipFallback:function(){let template=Handlebars__default["default"].templates["tooltipFallback"];return new Handlebars__default["default"].SafeString(template({})).string}};for(var name in helpers){if(helpers.hasOwnProperty(name)){Handlebars__default["default"].registerHelper(name,helpers[name])}}}toggleEl($el,isActive){$el.addClass("is-annotation-target").each((i,e)=>{if(!isActive){$(e).toggleClass("is-active",false).trigger("annotation:inactive")}else{_.debounce(()=>{$(e).toggleClass("is-active",true).trigger("annotation:active")})()}});if(!isActive)return;Adapt$1.navigateToElement($el,{align:"inview",scrollNested:true})}}Adapt$1.annotation=new Annotation;class CodeBoxFadeBlockView extends Backbone.View{events(){return{"click .fadeblock__header":"onClick"}}initialize(){this.$(".fadeblock__content").toggle(this.model.get("_isActive"));this.update();this.setupEventListeners()}setupEventListeners(){this.listenTo(this.model,"change:_isActive",this.onActiveChange)}onClick(){this.model.set("_isActive",!Boolean(this.model.get("_isActive")))}onActiveChange(model,isActive){this.update();if(isActive){this.$(".fadeblock__content").slideDown()}else{this.$(".fadeblock__content").slideUp()}}update(){let isActive=this.model.get("_isActive");this.$el.toggleClass("is-active",isActive);this.$(".fadeblock__header").toggleClass("is-active",isActive)}}var CodeBoxFadeBlockView$1=__AMD("extensions/adapt-codeBox/js/codeBoxFadeBlockView",CodeBoxFadeBlockView);require.config({shim:{"libraries/google-code-prettify/prettify":{exports:"PR"}}});const DESKTOP_BOOKSHELF_TAB_STRING="&nbsp;&nbsp;";const LANG_SCRIPTS=["css","lua","basic","apollo"];class CodeBoxView extends Backbone.View{className(){let sizingClasses=this.model.get("_sizing");let classes=["codebox",this.model.get("_classes")||"",sizingClasses||"",sizingClasses?"has-sizing":"","is-"+this.model.get("_type"),"lang-"+this.model.get("_lang"),this.model.get("_wrappingEnabled")?"wrapping-enabled":"",this.model.get("_hasLineNumbers")?"has-linenumbers":"",this.model.get("_scroll")?"":"no-scroll"];return classes.join(" ")}attributes(){return{"data-codebox-lang":this.model.get("_lang")||"auto","style":this.model.get("_style")||""}}tagName(){return"div"}events(){}initialize(){this.escapeHTMLContent();this.setupEventListeners();this.render()}setupEventListeners(){}renderContent(){let template=Handlebars.templates["codeBox"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string)}render(){this.renderContent();_.debounce(()=>{this.$el.closest(".figure").addClass("is-figure-codebox")},0)();if(Adapt$1.config.get("_isDesktopBookshelf")){this.$(".tab").html(DESKTOP_BOOKSHELF_TAB_STRING)}this.renderPrettify()}escapeHTMLContent(){let lang=this.model.get("_lang");if(lang!="html"&&lang!="xml"&&lang!="xhtml")return;let _type=this.model.get("_type");let content=this.model.get("content");if(_type=="console"){this.model.set("content",content.replace(Adapt$1.codeBox.BR_REGEX,""));return}}renderPrettify(){if(this.model.get("_type")!=="code")return;let lang=this.model.get("_lang");if(lang=="none")return;if(lang=="pseudo"||lang=="pseudocode")return;let langRequired=[];if(LANG_SCRIPTS.includes(lang))langRequired.push("libraries/google-code-prettify/lang-"+lang);require(["libraries/google-code-prettify/prettify"],Prettify=>{require(langRequired,()=>{let $content=this.$(".js-codebox-content");$content.html(PR.prettyPrintOne($content.html(),lang||undefined));this.renderLineContainers()})})}_getLinesHTMLArray(blockHTML){let html=blockHTML;let htmlLines;htmlLines=html.split(Adapt$1.codeBox.BR_REGEX);let arr=[];if(htmlLines.length&&!htmlLines[0].trim())htmlLines.shift();if(htmlLines.length>=1&&!htmlLines[htmlLines.length-1].trim())htmlLines.pop();_.each(htmlLines,(htmlLine,idx)=>{let h=htmlLine;let isEmpty=false;if($(h).text().trim().length==0){if(h.trim().length==0){h="\n";isEmpty=true}else{h.replace(/(<\/)(?!.*<\/)/g,"\n</");isEmpty=true}}arr.push("<div class=\"codebox__line"+(isEmpty?" is-empty":"")+"\">"+h+"</div>")});return arr}renderLineContainers(){let $codeBoxInner=this.$(".js-codebox-content");let htmlLines=[];let $divs=$codeBoxInner.children("div");if(!$divs.length){htmlLines=this._getLinesHTMLArray($codeBoxInner.html())}else{let $first=$($divs.first().prevUntil("div").get().reverse());if($first.length){htmlLines=htmlLines.concat(this._getLinesHTMLArray($first.wrapAll("<div>").parent().html()))}$divs.each((i,e)=>{let openingTagHtml=e.outerHTML.match(/^<div(>|.*?[^?]>)/);if(!openingTagHtml){Adapt$1.log.error("codeBoxView.js: could not determine opening <div> tag HTML for the following element:",$(e))}openingTagHtml=openingTagHtml[0];htmlLines.push(openingTagHtml);htmlLines=htmlLines.concat(this._getLinesHTMLArray($(e).html()));htmlLines.push("</div>");let $next=$(e).nextUntil("div");if($next.length){htmlLines=htmlLines.concat(this._getLinesHTMLArray($next.wrapAll("<div>").parent().html()))}})}let $codeBoxLines=$("<div class=\"codebox__lines\">");$codeBoxLines.html(htmlLines.join(""));$codeBoxLines.find(".codebox__line").each((i,e)=>{$(e).attr("data-line-num",i+1)});this.$(".js-codebox-content").empty().append($codeBoxLines);this.renderFadeBlocks()}renderFadeBlocks(){let $fadeBlocks=this.$(".fade.is-accordion");if(!$fadeBlocks.length)return;$fadeBlocks.each((i,e)=>{$(e).addClass("fadeblock");let $headerLine=$(e).find(".codebox__line:first-child");let $contentLines=$(e).find(".codebox__line:not(:first-child)");$headerLine.wrapAll("<div class='fadeblock__header' title='View omitted code'>");$contentLines.wrapAll("<div class='fadeblock__content'>");new CodeBoxFadeBlockView$1({el:$(e),model:new Backbone.Model({_isActive:false})})})}}var CodeBoxView$1=__AMD("extensions/adapt-codeBox/js/codeBoxView",CodeBoxView);class CodeBoxIframeView extends CodeBoxView$1{events(){return _.extend({},super.events,{})}setupEventListeners(){super.setupEventListeners.apply(this,arguments);Adapt$1.on("device:resize",this.updateIframeSize.bind(this))}renderContent(){let template=Handlebars.templates["codeBoxIframe"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);this.$(".js-codebox-iframe").on("load",this.onIframeLoad.bind(this))}waitUpdateIframeContent($iframe){return new Promise(resolve=>{let doc=$iframe[0].contentWindow.document;let content=this.model.get("content");let scripts=[];content=content.replace(/<script.*?src=(['"]).*?\1.*?(<\/script>|\/>)/g,function(match){let src=match.match(/src=(['"])(.*?)\1/)[2];scripts.push(src);return""});let inlineScripts=[];content=content.replace(/<script.*?>*.?>((.|\n)*)<\/\s*?script>/gm,function(match,$1){inlineScripts.push($1);return""});if(Adapt$1.isEpubMode()){content="<!--!IGNORE-XHTML!-->"+content}doc.body.innerHTML=content;doc.documentElement.className=$("html")[0].className;_.each(scripts,src=>{let s=doc.createElement("script");s.src=src;doc.body.appendChild(s)});_.each(inlineScripts,code=>{let s=doc.createElement("script");s.type="text/javascript";try{s.appendChild(doc.createTextNode(code));doc.body.appendChild(s)}catch(e){s.text=code;doc.body.appendChild(s)}});$iframe.contents().ready(()=>{$iframe.contents().off("ready");if(doc.readyState==="complete"||doc.readyState==="loaded"){resolve();return}doc.addEventListener("DOMContentLoaded",()=>{resolve()},{once:true})})})}async onIframeLoad(){let $iframe=this.$(".js-codebox-iframe");await this.waitUpdateIframeContent($iframe);let codeBox=Adapt$1.course.get("_codeBox");if(codeBox._formSubmitMessageEnabled===true){$iframe.contents().find("form").off("submit").on("submit",event=>{event.preventDefault();alert("Form submitted!")})}this.updateIframeSize()}waitIframeImgLoad($iframe){return new Promise(resolve=>{let $imgs=$iframe.contents().find("img");let remainingImages=$imgs.length;if(remainingImages==0){resolve();return}let decrementCounter=function(){remainingImages--;if(remainingImages==0)resolve()};$imgs.each((i,e)=>{if(e.complete)decrementCounter();else $(e).one("load",()=>{decrementCounter()})})})}async updateIframeSize(){let $iframe=this.$(".js-codebox-iframe");$iframe.css("height","");if($iframe.is(":hidden")){let $clone=$iframe.clone();$clone.off("load");$clone.css({"height":"0px","max-height":"0px"});$clone.on("load",async()=>{let width=$iframe.actual("outerWidth");$clone.width(width);await this.waitUpdateIframeContent($clone);await this.waitIframeImgLoad($clone);let height=$clone[0].contentWindow.document.body.scrollHeight;$iframe.height(height);$clone.remove()});$("body").append($clone)}else{await this.waitIframeImgLoad($iframe);$iframe.css({"height":"0px"});try{let height=$iframe[0].contentWindow.document.body.scrollHeight;$iframe.height(height)}catch(err){Adapt$1.log.error(err,$iframe)}}}}var CodeBoxIframeView$1=__AMD("extensions/adapt-codeBox/js/codeBoxIframeView",CodeBoxIframeView);Adapt$1.on("router:page",()=>{Handlebars__default["default"].registerHelperEl("code",function(){let context=arguments[arguments.length-1];let hash=Handlebars__default["default"].getContextHash.apply(this,arguments);let _default=Adapt$1.course.get("_codeBox");let _lang=hash.lang?hash.lang:_default?_default._lang:"";if(!_lang&&!_default?._lang){throw`adapt-tryHtml: A default language MUST be defined in course.json.

'_codeBox._lang' must be set.`}let modelJSON={content:context.fn(this),_classes:hash.class,_style:hash.style,_filename:hash.filename,_scroll:hash.scroll===false?false:true,_type:"code",_lang:_lang,_wrappingEnabled:Boolean(hash.wrapping||hash.wrap),_hasLineNumbers:Boolean(hash.lineNumbers)};return new CodeBoxView$1({model:new Backbone.Model(modelJSON)}).$el});Handlebars__default["default"].registerHelperEl("console",function(){let context=arguments[arguments.length-1];let hash=context.hash;let _default=Adapt$1.course.get("_codeBox");let _lang=hash.lang?hash.lang:_default?_default._lang:"";if(!_lang&&!_default?._lang){throw`adapt-tryHtml: A default language MUST be defined in course.json.

'_codeBox._lang' must be set.`}let modelJSON={content:context.fn(this),_classes:hash.class,_style:hash.style,_type:"console",_lang:_lang,_wrappingEnabled:Boolean(hash.wrapping||hash.wrap)};let view=_lang=="html"?CodeBoxIframeView$1:CodeBoxView$1;return new view({model:new Backbone.Model(modelJSON)}).$el})});var helpers$5={pseudocode:function(){let context=arguments[arguments.length-1];return"<span class='codebox__pseudocode'>"+context.fn(this)+"</span>"}};for(var name$4 in helpers$5){if(!helpers$5.hasOwnProperty(name$4))continue;Handlebars__default["default"].registerHelper(name$4,helpers$5[name$4])}Adapt$1.codeBox={BR_REGEX:new RegExp(/<br\s+[^>]*?class="br"\s*.*?\/?>/,"g"),TAB_REGEX:new RegExp(/<span[^>]*?class="tab"\s*.*?>.*?<\/span>/,"g"),toString:function(codeString){if(typeof codeString!=="string")throw"adapt-codeBox: codeString must be a valid string.";let s=codeString;s=s.replace(this.BR_REGEX,"\n");s=s.replace(this.TAB_REGEX,"\t");return s},getLines:function(codeString){if(typeof codeString!=="string")throw"adapt-codeBox: codeString must be a valid string.";let lines=codeString.split(this.BR_REGEX);return lines}};const AssessmentView={postRender(){ArticleView$1.prototype.postRender.call(this);if(this.model.isAssessmentEnabled()){this._setupEventListeners();const config=this.model.getConfig();if(config?._questions?._canShowMarking===false){this.$el.addClass("has-no-marking")}}this.$el.addClass("is-assessment")},_setupEventListeners(){this.listenTo(Adapt$1,{"assessments:complete":this._onAssessmentComplete,"assessments:reset":this._onAssessmentReset,remove:this._onRemove})},_removeEventListeners(){this.stopListening(Adapt$1,{"assessments:complete":this._onAssessmentComplete,"assessments:reset":this._onAssessmentReset})},_onAssessmentComplete(state,model){if(state.id!==this.model.get("_assessment")._id)return;logging$1.info("assessment complete",state,model)},_onAssessmentReset(state,model){if(state.id!==this.model.get("_assessment")._id)return;logging$1.info("assessment reset",state,model)},_onRemove(){this._removeEventListeners()}};var AdaptAssessmentArticleView=__AMD("extensions/adapt-contrib-assessment/js/adapt-assessmentArticleView",AssessmentView);class QuestionBank{constructor(quizBankId,articleId){this._bankId=quizBankId;this._articleId=articleId;this._unusedQuestionBlocks=null;this._count=null}calculateAvailableQuestionBlocks(count){this._count=parseInt(count);const articleModel=data$1.findById(this._articleId);const children=articleModel.getAvailableChildModels();this._availableQuestionBlocks=children.map(blockModel=>{if(blockModel.get("_assessment")?._quizBankID!==this._bankId)return null;return blockModel}).filter(Boolean);const availableQuestionBlockIds=this._availableQuestionBlocks?.map(block=>block.get("_id"))||[];const unusedQuestionBlockIds=this._unusedQuestionBlocks?.map(block=>block.get("_id"))||[];const haveBlocksChanged=Boolean(_.difference(unusedQuestionBlockIds,availableQuestionBlockIds).length);if(!haveBlocksChanged)return;this._unusedQuestionBlocks=null}getRandomQuestionBlocks(){const questionBlocks=[];let i=0;while(i++<this._count){const nextBlock=this.unusedQuestionBlocks.shift();questionBlocks.push(nextBlock)}return questionBlocks}get unusedQuestionBlocks(){const hasUnusedQuestion=Boolean(this._unusedQuestionBlocks?.length);if(!hasUnusedQuestion){this._unusedQuestionBlocks=_.shuffle(this._availableQuestionBlocks.slice(0))}return this._unusedQuestionBlocks}}var QuestionBank$1=__AMD("extensions/adapt-contrib-assessment/js/adapt-assessmentQuestionBank",QuestionBank);let givenIdCount=0;const assessmentConfigDefaults={_isEnabled:true,_questions:{_resetType:"soft",_canShowFeedback:false,_canShowMarking:false,_canShowModelAnswer:false},_suppressMarking:false,_isPercentageBased:true,_scoreToPass:100,_correctToPass:100,_includeInTotalScore:true,_assessmentWeight:1,_isResetOnRevisit:true,_reloadPageOnReset:true,_attempts:"infinite",_allowResetIfPassed:false};const AssessmentModel={_getCurrentQuestionComponents(){return this.findDescendantModels("block").filter(block=>block.get("_isAvailable")).reduce((questions,block)=>questions.concat(block.findDescendantModels("question")),[])},_getAllQuestionComponents(){return this.findDescendantModels("question")},_postInitialize(){if(!this.isAssessmentEnabled())return;const assessmentConfig=this.getConfig();Object.assign(this,{_originalChildModels:null,_questionBanks:null,_forceResetOnRevisit:false});let attemptsLeft;switch(assessmentConfig._attempts){case"infinite":case 0:case undefined:case-1:case null:attemptsLeft="infinite";break;default:attemptsLeft=assessmentConfig._attempts;break;}this.set({_assessmentCompleteInSession:false,_attemptInProgress:false,_isAssessmentComplete:false,_numberOfQuestionsAnswered:0,_lastAttemptScoreAsPercent:0,_attempts:attemptsLeft,_attemptsLeft:attemptsLeft,_attemptsSpent:0});this.listenToOnce(Adapt$1,"app:dataReady",this._onDataReady);this.listenTo(Adapt$1,"remove",this._onRemove)},init(){this._originalChildModels=this.getChildren().models;this.setupCurrentQuestionComponents();this._setAssessmentOwnershipOnChildrenModels();this._updateQuestionsState()},setupCurrentQuestionComponents(){const assessmentQuestionsConfig=this.getConfig()._questions;this._getAllQuestionComponents().forEach(component=>{component.set({_canShowFeedback:assessmentQuestionsConfig._canShowFeedback,_canShowMarking:assessmentQuestionsConfig._canShowMarking,_canShowModelAnswer:assessmentQuestionsConfig._canShowModelAnswer})})},_setAssessmentOwnershipOnChildrenModels(){const assessmentConfig=this.get("_assessment");const childConfig={_isPartOfAssessment:true,_assessmentId:assessmentConfig._id};for(const blockModel of this._originalChildModels){blockModel.set(childConfig);blockModel.setOnChildren(childConfig)}},checkIfResetOnRevisit(){},_onDataReady(){Adapt$1.assessment.register(this)},_setupAssessmentData(force,callback){const assessmentConfig=this.getConfig();const state=this.getState();const hasAttemptsLeft=state.attemptsLeft>0||state.attemptsLeft==="infinite";const isFirstAttempt=state.attemptsSpent===0;const shouldResetOnRevisit=(isFirstAttempt||assessmentConfig._isResetOnRevisit)&&!this.get("_attemptInProgress");const shouldResetAssessment=shouldResetOnRevisit&&!state.isPass&&hasAttemptsLeft||force===true;const shouldResetQuestions=shouldResetOnRevisit&&(state.allowResetIfPassed||!state.isPass)||force===true;if(shouldResetAssessment||shouldResetQuestions){Adapt$1.trigger("assessments:preReset",this.getState(),this)}let quizModels;if(shouldResetAssessment){if(isFirstAttempt||assessmentConfig?._questions?._resetType==="hard"){this.set({_numberOfQuestionsAnswered:0,_isAssessmentComplete:false,_assessmentCompleteInSession:false,_score:0})}else{this.set({_assessmentCompleteInSession:false})}this.getChildren().models=this._originalChildModels;if(assessmentConfig?._banks._isEnabled&&assessmentConfig?._banks._split.length>1){quizModels=this._setupBankedAssessment()}else if(assessmentConfig?._randomisation._isEnabled){quizModels=this._setupRandomisedAssessment()}}if(!quizModels){quizModels=this.getChildren().models}else if(quizModels.length===0){quizModels=this.getChildren().models;logging$1.warn("assessment: Not enough unique questions to create a fresh assessment, using last selection")}this.getChildren().models=quizModels;this.setupCurrentQuestionComponents();if(shouldResetAssessment||shouldResetQuestions){this._resetQuestions();this.set("_attemptInProgress",true);Adapt$1.trigger("assessments:reset",this.getState(),this)}if(!state.isComplete){this.set("_attemptInProgress",true)}this._overrideQuestionComponentSettings();this._setupQuestionListeners();this._checkNumberOfQuestionsAnswered();this._updateQuestionsState();Adapt$1.assessment.saveState();this.trigger("reset");if(shouldResetAssessment||shouldResetQuestions){Adapt$1.trigger("assessments:postReset",this.getState(),this)}},_setupBankedAssessment(){const assessmentConfig=this.getConfig();this._setupBanks();let questionModels=this._questionBanks.flatMap(questionBank=>questionBank.getRandomQuestionBlocks());if(assessmentConfig._banks._randomisation){questionModels=_.shuffle(questionModels)}return questionModels},_setupBanks(){const assessmentConfig=this.getConfig();const bankSplits=assessmentConfig._banks._split.split(",");const hasBankSplitsChanged=bankSplits.length!==this._questionBanks?.length;if(hasBankSplitsChanged){this._questionBanks=[]}bankSplits.forEach((count,index)=>{const bankId=index+1;const articleId=this.get("_id");this._questionBanks[bankId]=this._questionBanks[bankId]||new QuestionBank$1(bankId,articleId);this._questionBanks[bankId].calculateAvailableQuestionBlocks(count)})},_setupRandomisedAssessment(){const assessmentConfig=this.getConfig();const randomisationModel=assessmentConfig._randomisation;const blockModels=this.getChildren().models;let questionModels=_.shuffle(blockModels);if(randomisationModel._blockCount>0){questionModels=questionModels.slice(0,randomisationModel._blockCount)}return questionModels},_overrideQuestionComponentSettings(){const newSettings=this._getMarkingSettings();const questionConfig=this.getConfig()._questions;if(Object.prototype.hasOwnProperty.call(questionConfig,"_canShowFeedback")){newSettings._canShowFeedback=questionConfig._canShowFeedback}if(!_.isEmpty(newSettings)){const questionComponents=this._getAllQuestionComponents();questionComponents.forEach(model=>model.set(newSettings,{pluginName:"_assessment"}))}},_setupQuestionListeners(){this._removeQuestionListeners();this.listenTo(this,"bubble:change:_isInteractionComplete",this._onCompletionEvent)},_checkNumberOfQuestionsAnswered(){const questionComponents=this._getCurrentQuestionComponents();const numberOfQuestionsAnswered=questionComponents.filter(model=>model.get("_isInteractionComplete")).length;this.set("_numberOfQuestionsAnswered",numberOfQuestionsAnswered)},_removeQuestionListeners(){this.stopListening(this,"bubble:change:_isInteractionComplete",this._onCompletionEvent)},_onCompletionEvent(event){if(event.target?.isTypeGroup("block"))return this._onBlockCompleted(event.target,event.value);if(event.target?.isTypeGroup("questions"))return this._onQuestionCompleted(event.target,event.value)},_onBlockCompleted(blockModel,value){if(value===false)return;const questionModels=blockModel.findDescendantModels("question");questionModels.forEach(questionModel=>{this._onQuestionCompleted(questionModel,value)});if(!blockModel.get("_isInteractionComplete"))return;this._checkAssessmentComplete()},_onQuestionCompleted(questionModel,value){if(value===false)return;if(!questionModel.get("_isInteractionComplete"))return;const numberOfQuestionsAnswered=this._getCurrentQuestionComponents().reduce((count,question)=>count+=question.get("_isSubmitted")?1:0,0);this.set("_numberOfQuestionsAnswered",numberOfQuestionsAnswered);this._updateQuestionsState();Adapt$1.assessment.saveState();this._checkAssessmentComplete()},_checkAssessmentComplete(){const allQuestionsAdded=this.get("_requireCompletionOf")!==Number.POSITIVE_INFINITY;if(!allQuestionsAdded)return;const numberOfQuestionsAnswered=this.get("_numberOfQuestionsAnswered");const allQuestionsAnswered=numberOfQuestionsAnswered>=this._getCurrentQuestionComponents().length;if(!allQuestionsAnswered)return;this._onAssessmentComplete()},_onAssessmentComplete(){const wasAttemptInProgess=this.get("_attemptInProgress");if(!wasAttemptInProgess)return;this.set("_attemptInProgress",false);this._spendAttempt();const _scoreAsPercent=this._getScoreAsPercent();const _score=this._getScore();const _maxScore=this._getMaxScore();const _minScore=this._getMinScore();const _correctCount=this._getCorrectCount();const _correctAsPercent=this._getCorrectAsPercent();const _questionCount=this._getQuestionCount();this.set({_scoreAsPercent,_score,_maxScore,_minScore,_correctAsPercent,_correctCount,_questionCount,_lastAttemptScoreAsPercent:_scoreAsPercent,_assessmentCompleteInSession:true,_isAssessmentComplete:true});this._updateQuestionsState();this._checkIsPass();this._removeQuestionListeners();if(this._isMarkingSuppressionEnabled()&&(!this._isAttemptsLeft()||this._isPassed())){_.defer(()=>{this._overrideMarkingSettings();this._refreshQuestions()})}Adapt$1.trigger("assessments:complete",this.getState(),this)},_updateQuestionsState(){const questionComponents=this._getCurrentQuestionComponents();const questions=questionComponents.map(model=>({_id:model.get("_id"),_isCorrect:model.get("_isCorrect")??null}));this.set("_questions",questions)},_checkIsPass(){const assessmentConfig=this.getConfig();const isPercentageBased=assessmentConfig._isPercentageBased;const scoreToPass=assessmentConfig._scoreToPass;const correctToPass=assessmentConfig._correctToPass||0;const scoreAsPercent=this.get("_scoreAsPercent");const score=this.get("_score");const correctAsPercent=this.get("_correctAsPercent");const correctCount=this.get("_correctCount");const isPass=isPercentageBased?scoreAsPercent>=scoreToPass&&correctAsPercent>=correctToPass:score>=scoreToPass&&correctCount>=correctToPass;this.set("_isPass",isPass)},_getMarkingSettings(){let markingSettings={};if(this._shouldSuppressMarking()){markingSettings={_canShowMarking:false,_canShowModelAnswer:false}}else{const questionConfig=this.getConfig()._questions;if(Object.prototype.hasOwnProperty.call(questionConfig,"_canShowModelAnswer")){markingSettings._canShowModelAnswer=questionConfig._canShowModelAnswer}if(Object.prototype.hasOwnProperty.call(questionConfig,"_canShowMarking")){markingSettings._canShowMarking=questionConfig._canShowMarking}}return markingSettings},_overrideMarkingSettings(){const newMarkingSettings=this._getMarkingSettings();const questionComponents=this._getAllQuestionComponents();questionComponents.forEach(model=>model.set(newMarkingSettings,{pluginName:"_assessment"}))},_refreshQuestions(){const questionComponents=this._getCurrentQuestionComponents();questionComponents.forEach(model=>model.refresh())},_shouldSuppressMarking(){return this._isMarkingSuppressionEnabled()&&this._isAttemptsLeft()&&!this._isPassed()},_isMarkingSuppressionEnabled(){const assessmentConfig=this.getConfig();return assessmentConfig._suppressMarking},_isAttemptsLeft(){if(this.get("_attemptsLeft")===0)return false;return true},_isPassed(){return this.get("_isAssessmentComplete")&&this.get("_isPass")},_spendAttempt(){if(!this._isAttemptsLeft())return false;let attemptsSpent=this.get("_attemptsSpent");this.set("_attemptsSpent",++attemptsSpent);if(this.get("_attempts")==="infinite")return true;let attemptsLeft=this.get("_attemptsLeft");this.set("_attemptsLeft",--attemptsLeft);return true},_getScore(){const questionComponents=this._getCurrentQuestionComponents();const score=questionComponents.reduce((score,model)=>score+=model.score||0,0);return score},_getMaxScore(){const questionComponents=this._getCurrentQuestionComponents();const maxScore=questionComponents.reduce((maxScore,model)=>maxScore+=model.maxScore||0,0);return maxScore},_getMinScore(){const questionComponents=this._getCurrentQuestionComponents();const minScore=questionComponents.reduce((minScore,model)=>minScore+=model.minScore||0,0);return minScore},_getScoreAsPercent(){const minScore=this._getMinScore();const maxScore=this._getMaxScore();const score=this._getScore();const range=maxScore-minScore;return range===0?0:Math.round((score-minScore)/range*100)},_getCorrectCount(){return this._getCurrentQuestionComponents().reduce((count,model)=>count+=model.get("_isCorrect")?1:0,0)},_getQuestionCount(){return this._getCurrentQuestionComponents().length},_getCorrectAsPercent(){const questionCount=this._getQuestionCount();return questionCount===0?0:Math.round(this._getCorrectCount()/questionCount*100)},_getLastAttemptScoreAsPercent(){return this.get("_lastAttemptScoreAsPercent")},_checkReloadPage(){if(!this.canResetInPage())return false;const parentId=this.getParent().get("_id");const currentLocation=location$1._currentId;if(currentLocation!==parentId)return false;if(!this.get("_isReady"))return false;return true},_reloadPage(callback){const assessmentConfig=this.getConfig();this._forceResetOnRevisit=true;this.listenToOnce(Adapt$1,"pageView:ready",async()=>{if(assessmentConfig._scrollToOnReset){await router$1.navigateToElement(this.get("_id"))}callback()});_.delay(()=>{Backbone.history.navigate("#/id/"+location$1._currentId,{replace:true,trigger:true})},250)},_resetQuestions(){const assessmentConfig=this.getConfig();const questionModels=this._getCurrentQuestionComponents();questionModels.forEach(model=>model.reset(assessmentConfig._questions._resetType,true))},_onRemove(){this._removeQuestionListeners()},_setCompletionStatus(){this.set({_isComplete:true,_isInteractionComplete:true})},_checkIfQuestionsWereRestored(){if(this.get("_assessmentCompleteInSession"))return;if(!this.get("_isAssessmentComplete"))return;let wereQuestionsRestored=true;const questions=this.get("_questions");for(const question of questions){const questionModel=data$1.findById(question._id);if(questionModel.get("_isAvailable")&&!questionModel.get("_isSubmitted")){wereQuestionsRestored=false;break}}if(!wereQuestionsRestored){this.set("_assessmentCompleteInSession",true);return true}return false},isAssessmentEnabled(){if(this.get("_assessment")?._isEnabled)return true;return false},canResetInPage(){const assessmentConfig=this.getConfig();if(assessmentConfig._reloadPageOnReset===false)return false;return true},reset(force,callback){const assessmentConfig=this.getConfig();force=this._forceResetOnRevisit||force===true;this._forceResetOnRevisit=false;const isPageReload=this._checkReloadPage();if(this.get("_assessmentCompleteInSession")&&!assessmentConfig._isResetOnRevisit&&!isPageReload&&!force){if(typeof callback==="function")callback(false);return false}const wereQuestionsRestored=this._checkIfQuestionsWereRestored();force=force||wereQuestionsRestored;if(force&&!this._isAttemptsLeft()){this.set({_attemptsLeft:this.get("_attempts"),_attemptsSpent:0})}const allowResetIfPassed=this.get("_assessment")._allowResetIfPassed;if(!this._isAttemptsLeft()&&!force&&!allowResetIfPassed){if(typeof callback==="function")callback(false);return false}if(!isPageReload){this._setupAssessmentData(force);if(typeof callback==="function")callback(true)}else{this._reloadPage(()=>{if(typeof callback==="function")callback(true)})}return true},getSaveState(){const state=this.getState();let blocks;const cfg=this.getConfig();const banksActive=cfg._banks?._isEnabled&&cfg._banks._split.length>1;const randomisationActive=cfg._randomisation?._isEnabled;if(!banksActive&&!randomisationActive){blocks=this.findDescendantModels("block")}else{blocks=state.questions.map(question=>data$1.findById(question._id).getParent())}blocks=[...new Set(blocks)].filter(block=>block.trackingPosition);const blockTrackingPositions=blocks.map(block=>block.trackingPosition);const blockCompletion=blocks.map(block=>{const questions=block.findDescendantModels("question");return questions.map(question=>question.get("_isCorrect")||false)});const blockData=[blockTrackingPositions,blockCompletion];const saveState=[state.isComplete?1:0,state.attemptsSpent,state.maxScore||0,state.score,state.attemptInProgress?1:0,state.minScore||0,state.correctAsPercent||0,state.correctCount||0,state.questionCount||0];const dataPackage=[saveState,blockData];return dataPackage},setRestoreState(dataPackage){const restoreState=dataPackage[0];const blockData=dataPackage[1];const _isAssessmentComplete=restoreState[0]===1;const attempts=this.get("_attempts");const _attemptsSpent=restoreState[1];const maxScore=restoreState[2];const score=restoreState[3];const _scoreAsPercent=score?Math.round(score/maxScore*100):0;const _attemptInProgress=restoreState[4]===1;const minScore=restoreState[5];const correctAsPercent=restoreState[6];const correctCount=restoreState[7];const questionCount=restoreState[8];const blocks=blockData[0].map(trackingPosition=>{if(typeof trackingPosition==="number"){return data$1.findWhere({_trackingId:trackingPosition})}return data$1.findByTrackingPosition(trackingPosition)});if(blocks.length){const nonBlockChildren=this.getChildren().models.filter(model=>!model.isTypeGroup("block"));this.getChildren().models=blocks.concat(nonBlockChildren)}const _questions=[];blocks.forEach((block,blockIndex)=>{const blockQuestions=block.findDescendantModels("question");blockQuestions.forEach((question,questionIndex)=>{_questions.push({_id:question.get("_id"),_isCorrect:blockData[1][blockIndex][questionIndex]})})});this.set({_isAssessmentComplete,_assessmentCompleteInSession:false,_attemptsSpent,_attemptInProgress,_attemptsLeft:attempts==="infinite"?attempts:attempts-_attemptsSpent,_maxScore:maxScore||this._getMaxScore(),_minScore:minScore||this._getMinScore(),_score:score||0,_scoreAsPercent,_correctAsPercent:correctAsPercent||0,_correctCount:correctCount||0,_questions,_questionCount:questionCount||0,_lastAttemptScoreAsPercent:_scoreAsPercent});if(_isAssessmentComplete)this._checkIsPass();Adapt$1.trigger("assessments:restored",this.getState(),this)},getState(){const assessmentConfig=this.getConfig();const state={id:assessmentConfig._id,type:"article-assessment",pageId:this.getParent().get("_id"),articleId:this.get("_id"),isEnabled:assessmentConfig._isEnabled,isComplete:this.get("_isAssessmentComplete"),isPercentageBased:assessmentConfig._isPercentageBased,scoreToPass:assessmentConfig._scoreToPass,score:this.get("_score"),scoreAsPercent:this.get("_scoreAsPercent"),maxScore:this.get("_maxScore"),minScore:this.get("_minScore"),correctCount:this.get("_correctCount"),correctAsPercent:this.get("_correctAsPercent"),correctToPass:assessmentConfig._correctToPass,questionCount:this.get("_questionCount"),isPass:this.get("_isPass"),includeInTotalScore:assessmentConfig._includeInTotalScore,assessmentWeight:assessmentConfig._assessmentWeight,attempts:this.get("_attempts"),attemptsSpent:this.get("_attemptsSpent"),attemptsLeft:this.get("_attemptsLeft"),attemptInProgress:this.get("_attemptInProgress"),lastAttemptScoreAsPercent:this.get("_lastAttemptScoreAsPercent"),questions:this.get("_questions"),resetType:assessmentConfig._questions._resetType,allowResetIfPassed:assessmentConfig._allowResetIfPassed,questionModels:new Backbone.Collection(this._getCurrentQuestionComponents())};return state},getConfig(){let assessmentConfig=this.get("_assessment");if(!assessmentConfig){assessmentConfig=$.extend(true,{},assessmentConfigDefaults)}else{assessmentConfig=$.extend(true,{},assessmentConfigDefaults,assessmentConfig)}if(assessmentConfig._id===undefined){assessmentConfig._id="givenId"+givenIdCount++}this.set("_assessment",assessmentConfig);return assessmentConfig}};var AdaptAssessmentArticleModel=__AMD("extensions/adapt-contrib-assessment/js/adapt-assessmentArticleModel",AssessmentModel);const assessmentsConfigDefaults={_isPercentageBased:true,_scoreToPass:100,_isDefaultsLoaded:true};class Assessment extends Backbone.Controller{initialize(){this._assessments=Object.assign([],{_byPageId:{},_byAssessmentId:{}});this.listenTo(Adapt$1,{"assessments:complete":this._onAssessmentsComplete,"router:location":this._checkResetAssessmentsOnRevisit,"router:plugin":this._handleRoute,"app:dataReady":this._onDataReady})}_onAssessmentsComplete(state){const assessmentId=state.id;state.isComplete=true;if(assessmentId===undefined)return;if(!this._getStateByAssessmentId(assessmentId)){logging$1.warn("assessments: state was not registered when assessment was created")}this.saveState();this._setPageProgress();this._checkAssessmentsComplete()}_restoreModelState(assessmentModel){if(!this._saveStateModel){this._saveStateModel=offlineStorage$1.get("a")}if(this._saveStateModel){const state=assessmentModel.getState();if(this._saveStateModel[state.id]){assessmentModel.setRestoreState(offlineStorage$1.deserialize(this._saveStateModel[state.id]))}}}_handleRoute(plugin,id){if(plugin!=="assessment"&&plugin!=="article-assessment"||id===undefined){return}if(!data$1.findById(id)){const assessment=Adapt$1.assessment._assessments._byAssessmentId[id];if(assessment){id=assessment.get("_id")}else{logging$1.warn("Assessment not found with _id: "+id);return}}_.defer(()=>{Backbone.history.navigate("#/id/"+id,{trigger:true,replace:true})})}_checkResetAssessmentsOnRevisit(toObject){if(toObject._contentType!=="page")return;const pageAssessmentModels=this._getAssessmentByPageId(toObject._currentId);if(pageAssessmentModels===undefined)return;wait$1.for(function resetAllAssessments(allAssessmentHaveReset){const numberOfAssessments=pageAssessmentModels.length;let numberOfResetAssessments=0;const forceAssessmentReset=false;pageAssessmentModels.forEach(model=>{model.reset(forceAssessmentReset,()=>{numberOfResetAssessments++;const haveAllModelsReset=numberOfResetAssessments===numberOfAssessments;if(!haveAllModelsReset){return}allAssessmentHaveReset()})})});this._setPageProgress()}_onDataReady(){this._assessments=Object.assign([],{_byPageId:{},_byAssessmentId:{}});this._restoredCount=0}_checkAssessmentsComplete(){let allAssessmentsComplete=true;let assessmentToPostBack=0;const states=this._getStatesByAssessmentId();const assessmentStates=[];for(const id in states){const state=states[id];if(!state.includeInTotalScore)continue;if(!state.isComplete){allAssessmentsComplete=false;break}assessmentToPostBack++;assessmentStates.push(state)}if(!allAssessmentsComplete||assessmentToPostBack===0)return false;if(assessmentToPostBack===1){this._setupSingleAssessmentConfiguration(assessmentStates[0])}_.defer(()=>Adapt$1.trigger("assessment:complete",this.getState()));return true}_setupSingleAssessmentConfiguration(assessmentState){const assessmentsConfig=Adapt$1.course.get("_assessment");$.extend(true,assessmentsConfig,{_isPercentageBased:assessmentState.isPercentageBased,_scoreToPass:assessmentState.scoreToPass});Adapt$1.course.set("_assessment",assessmentsConfig)}_getAssessmentByPageId(pageId){return this._assessments._byPageId[pageId]}_getStateByAssessmentId(assessmentId){if(assessmentId===undefined){return null}return this._assessments._byAssessmentId[assessmentId].getState()}_getStatesByAssessmentId(){const states={};for(const assessmentModel of this._assessments){if(!assessmentModel.get("_isAvailable"))continue;const state=assessmentModel.getState();states[state.id]=state}return states}_setPageProgress(){for(const[id,assessments]of Object.entries(this._assessments._byPageId)){const assessmentsTotal=assessments.length;let assessmentsPassed=0;for(const assessment of assessments){const assessmentState=assessment.getState();if(assessmentState.includeInTotalScore&&!assessmentState.isPass)continue;if(assessmentState.isComplete){assessmentsPassed++}}const pageModel=data$1.findById(id);pageModel?.set({_subProgressTotal:assessmentsTotal,_subProgressComplete:assessmentsPassed})}}_addToAssessmentIdMap(id,model){if(id===undefined){logging$1.warn("An assessment has been registered with an undefined value for \"_id\"");return}if(id===""){logging$1.warn("An assessment has been registered with an empty value for \"_id\"")}if(!this._assessments._byAssessmentId[id]){this._assessments._byAssessmentId[id]=model}else{logging$1.warn("An assessment with an _id of \""+id+"\" already exists!")}}_setupQuestionNumbering(){const getRelatedQuestions=data=>{const currentAssessmentId=data._assessmentId;const currentAssessment=Adapt$1.assessment.get(currentAssessmentId);return currentAssessment.getState().questions};Handlebars.registerHelper("questionNumber",function getQuestionNumber(){const data=this.view?.model.toJSON()||this;if(!data._isPartOfAssessment)return;const related=_.pluck(getRelatedQuestions(data),"_id");return related.indexOf(data._id)+1});Handlebars.registerHelper("questionCount",function getTotalQuestions(){const data=this.view?this.view.model.toJSON():this;if(!data._isPartOfAssessment)return;return getRelatedQuestions(data).length})}register(assessmentModel){const state=assessmentModel.getState();const assessmentId=state.id;const pageId=state.pageId;if(this._assessments._byPageId[pageId]===undefined){this._assessments._byPageId[pageId]=[]}this._assessments._byPageId[pageId].push(assessmentModel);this._addToAssessmentIdMap(assessmentId,assessmentModel);this._assessments.push(assessmentModel);this._restoreModelState(assessmentModel);this._restoredCount++;Adapt$1.trigger("assessments:register",state,assessmentModel);this._setPageProgress();this._setupQuestionNumbering();if(this._restoredCount===this._assessments.length){Adapt$1.trigger("assessment:restored",this.getState())}}get(id){return id===undefined?this._assessments.slice(0):this._assessments._byAssessmentId[id]}saveState(){this._saveStateModel={};for(const assessmentModel of this._assessments){const state=assessmentModel.getState();this._saveStateModel[state.id]=offlineStorage$1.serialize(assessmentModel.getSaveState())}offlineStorage$1.set("a",this._saveStateModel)}getConfig(){let assessmentsConfig=Adapt$1.course.get("_assessment");if(assessmentsConfig?._isDefaultsLoaded){return assessmentsConfig}if(assessmentsConfig===undefined){assessmentsConfig=$.extend(true,{},assessmentsConfigDefaults)}else{assessmentsConfig=$.extend(true,{},assessmentsConfigDefaults,assessmentsConfig)}Adapt$1.course.set("_assessment",assessmentsConfig);return assessmentsConfig}getState(){const assessmentsConfig=this.getConfig();let score=0;let maxScore=0;let minScore=0;let correctCount=0;let questionCount=0;let assessments=0;const states=this._getStatesByAssessmentId();let assessmentsComplete=0;for(const id in states){const state=states[id];if(!state.includeInTotalScore)continue;if(state.isComplete)assessmentsComplete++;assessments++;maxScore+=state.maxScore/state.assessmentWeight;minScore+=state.minScore/state.assessmentWeight;score+=state.score/state.assessmentWeight;correctCount+=state.correctCount/state.assessmentWeight;questionCount+=state.questionCount/state.assessmentWeight}const isComplete=assessmentsComplete===assessments;const scoreRange=maxScore-minScore;const scoreAsPercent=scoreRange===0?0:Math.round((score-minScore)/scoreRange*100);const correctAsPercent=questionCount===0?0:Math.round(correctCount/questionCount*100);if(assessmentsConfig._correctToPass===undefined){logging$1.warnOnce("Assessment course config is missing _correctToPass")}const scoreToPass=assessmentsConfig._scoreToPass;const correctToPass=assessmentsConfig._correctToPass||scoreToPass;const isPercentageBased=assessmentsConfig._isPercentageBased;const isPass=isComplete&&(isPercentageBased?scoreAsPercent>=scoreToPass&&correctAsPercent>=correctToPass:score>=scoreToPass&&correctCount>=correctToPass);const canRetry=Object.values(states).some(state=>{const isFailed=!state.isPass;const hasAttemptsLeft=state.attemptsLeft>0||state.attemptsLeft==="infinite";return isFailed&&hasAttemptsLeft});return{isComplete,isPercentageBased,isPass,maxScore,minScore,score,scoreToPass,scoreAsPercent,correctCount,correctAsPercent,correctToPass,questionCount,assessmentsComplete,assessments,canRetry}}}__AMD("extensions/adapt-contrib-assessment/js/assessment",Adapt$1.assessment=new Assessment);const ArticleViewInitialize=ArticleView$1.prototype.initialize;ArticleView$1.prototype.initialize=function(options){if(this.model.get("_assessment")?._isEnabled===true){Object.assign(this,AdaptAssessmentArticleView)}return ArticleViewInitialize.apply(this,arguments)};const ArticleModelInitialize=ArticleModel$1.prototype.initialize;ArticleModel$1.prototype.initialize=function(options){if(this.get("_assessment")?._isEnabled===true){Object.assign(this,AdaptAssessmentArticleModel);const returnValue=ArticleModelInitialize.apply(this,arguments);this._postInitialize();return returnValue}return ArticleModelInitialize.apply(this,arguments)};class Bookmarking extends Backbone.Controller{initialize(){this.bookmarkLevel=null;this.restoredLocationID=null;this.currentLocationID=null;this.listenToOnce(Adapt$1,"router:location",this.onAdaptInitialize)}onAdaptInitialize(){if(!this.checkCourseIsEnabled())return;this.setupEventListeners();this.checkRestoreLocation()}checkCourseIsEnabled(){const courseBookmarkModel=Adapt$1.course.get("_bookmarking");if(!courseBookmarkModel||!courseBookmarkModel._isEnabled)return false;return true}setupEventListeners(){this._onScroll=_.debounce(this.checkLocation.bind(this),250);this.listenTo(Adapt$1,{"menuView:ready":this.setupMenu,"pageView:preRender":this.setupPage,"view:childAdded":this.checkLocation})}checkRestoreLocation(){this.restoredLocationID=offlineStorage$1.get("location");if(!this.restoredLocationID||this.restoredLocationID==="undefined"||!data$1.findById(this.restoredLocationID)){return}this.listenToOnce(Adapt$1,"pageView:ready menuView:ready",this.restoreLocation)}restoreLocation(){this.stopListening(Adapt$1,"pageView:ready menuView:ready",this.restoreLocation);_.delay(()=>{if(this.isAlreadyOnScreen(this.restoredLocationID)){return}if(Adapt$1.course.get("_bookmarking")._showPrompt===false){this.navigateToPrevious();return}this.showPrompt()},500)}isAlreadyOnScreen(id){if(id===location$1._currentId)return true;const type=data$1.findById(id).getTypeGroup();if(type==="menu"||type==="page"){return false}const locationOnscreen=$("."+id).onscreen();const isLocationOnscreen=locationOnscreen&&locationOnscreen.percentInview>0;const isLocationFullyInview=locationOnscreen&&locationOnscreen.percentInview===100;if(isLocationOnscreen&&isLocationFullyInview){return true}return false}showPrompt(){const courseBookmarkModel=Adapt$1.course.get("_bookmarking");const buttons=courseBookmarkModel._buttons||{yes:"Yes",no:"No"};this.listenToOnce(Adapt$1,{"bookmarking:continue":this.navigateToPrevious,"bookmarking:cancel":this.navigateCancel});notify$1.prompt({_classes:"is-bookmarking",_showIcon:true,title:courseBookmarkModel.title,body:courseBookmarkModel.body,_prompts:[{promptText:buttons.yes||"Yes",_callbackEvent:"bookmarking:continue"},{promptText:buttons.no||"No",_callbackEvent:"bookmarking:cancel"}]})}navigateToPrevious(){_.defer(async()=>{const isSinglePage=Adapt$1.contentObjects.models.length===1;try{await router$1.navigateToElement(this.restoredLocationID,{trigger:true,replace:isSinglePage,duration:400})}catch(err){logging$1.warn(`Bookmarking cannot navigate to id: ${this.restoredLocationID}\n`,err)}});this.stopListening(Adapt$1,"bookmarking:cancel")}navigateCancel(){this.stopListening(Adapt$1,"bookmarking:continue")}resetLocationID(){this.setLocationID("")}setupMenu(menuView){const menuModel=menuView.model;if(!menuModel.get("_parentId")){this.resetLocationID();return}this.setLocationID(menuModel.get("_id"))}getBookmarkLevel(pageModel){const defaultLevel=Adapt$1.course.get("_bookmarking")._level||"component";const bookmarkModel=pageModel.get("_bookmarking");const isInherit=!bookmarkModel||!bookmarkModel._level||bookmarkModel._level==="inherit";return isInherit?defaultLevel:bookmarkModel._level}setupPage(pageView){const pageBookmarkModel=pageView.model.get("_bookmarking");if(pageBookmarkModel?._isEnabled===false){this.resetLocationID();return}this.setLocationID(pageView.model.get("_id"));this.bookmarkLevel=this.getBookmarkLevel(pageView.model);if(this.bookmarkLevel==="page"){return}this.listenToOnce(Adapt$1,"remove",this.releaseViews);$(window).on("scroll",this._onScroll)}setLocationID(id){if(this.currentLocationID===id)return;offlineStorage$1.set("location",id);this.currentLocationID=id}releaseViews(){this.stopListening(Adapt$1,"remove",this.releaseViews);$(window).off("scroll",this._onScroll)}checkLocation(){const contentObjectBookmarkModel=Adapt$1.parentView?.model?.get("_bookmarking");if(contentObjectBookmarkModel?._isEnabled===false){this.resetLocationID();return}const currentModel=location$1._currentModel;if(!currentModel||!this.bookmarkLevel)return;const possibleViewIds=currentModel.findDescendantModels(this.bookmarkLevel).filter(desc=>desc.get("_isTrackable")!==false).map(desc=>desc.get("_id"));let highestOnscreen=0;let highestOnscreenLocation="";possibleViewIds.forEach(id=>{const element=$(`[data-adapt-id=${id}]`);if(!element.length)return;const measurements=element.onscreen();if(!measurements.onscreen)return;if(measurements.percentInview<=highestOnscreen)return;highestOnscreen=measurements.percentInview;highestOnscreenLocation=id});if(highestOnscreenLocation)this.setLocationID(highestOnscreenLocation)}}__AMD("extensions/adapt-contrib-bookmarking/js/adapt-contrib-bookmarking",new Bookmarking);var NavigationView=__AMD("extensions/adapt-contrib-languagePicker/js/languagePickerNavigationView",class NavigationView extends Backbone.View{className(){return"nav"}attributes(){return{role:"navigation"}}initialize(){this.template="languagePickerNavigation";this.setupHelpers();this.preRender()}preRender(){Adapt$1.trigger("navigationView:preRender",this);this.render()}render(){const template=Handlebars.templates[this.template];this.$el.html(template({_config:this.model.get("_accessibility"),_accessibility:Adapt$1.config.get("_accessibility")})).insertBefore("#app");_.defer(()=>Adapt$1.trigger("navigationView:postRender",this));return this}setupHelpers(){Handlebars.registerHelper("a11y_aria_label",text=>{return`<div class="aria-label">${text}</div>`})}});var LanguagePickerView=__AMD("extensions/adapt-contrib-languagePicker/js/languagePickerView",class LanguagePickerView extends Backbone.View{get template(){return"languagePickerView"}events(){return{"click .js-languagepicker-btn-click":"onLanguageClick"}}className(){return"languagepicker"}initialize(){this.initializeNavigation();$("html").addClass("in-languagepicker");this.listenTo(Adapt$1,"remove",this.remove);this.render()}render(){const data=this.model.toJSON();const template=Handlebars.templates[this.template];this.$el.html(template(data));this.$el.addClass(data._classes);document.title=this.model.get("title")||"";_.defer(this.postRender.bind(this))}postRender(){$(".js-loading").hide()}onLanguageClick(event){this.destroyNavigation();const lang=event.currentTarget.value;this.model.setLanguage(lang)}initializeNavigation(){this.navigationView=new NavigationView({model:this.model})}destroyNavigation(){this.navigationView.remove()}remove(){$("html").removeClass("in-languagepicker");super.remove()}});var LanguagePickerDrawerView=__AMD("extensions/adapt-contrib-languagePicker/js/languagePickerDrawerView",class LanguagePickerDrawerView extends Backbone.View{get template(){return"languagePickerDrawerView"}events(){return{"click .js-languagepicker-item-btn":"onButtonClick"}}initialize(){this.listenTo(Adapt$1,"remove",this.remove);this.render()}render(){const data=this.model.toJSON();const template=Handlebars.templates[this.template];this.$el.html(template(data))}onButtonClick(event){const newLanguage=this.$(event.currentTarget).attr("data-language");this.model.set("newLanguage",newLanguage);this.promptObject=this.getPromptObject(newLanguage);this.listenToOnce(Adapt$1,"drawer:closed",this.onDrawerClosed);Adapt$1.trigger("drawer:closeDrawer")}onDrawerClosed(){_.delay(()=>{this.listenToOnce(Adapt$1,{"popup:opened":this.onPopupOpened,"languagepicker:changelanguage:yes":this.onDoChangeLanguage,"languagepicker:changelanguage:no":this.onDontChangeLanguage});notify$1.prompt(this.promptObject)},250)}onPopupOpened(){this.$finishFocus=a11y$1.setPopupCloseTo($("#a11y-focuser"))}onDoChangeLanguage(){const newLanguage=this.model.get("newLanguage");this.model.setTrackedData();this.model.setLanguage(newLanguage);this.remove()}onDontChangeLanguage(){this.remove();_.delay(()=>a11y$1.focusFirst(this.$finishFocus),500)}getPromptObject(newLanguage){const data=this.model.getLanguageDetails(newLanguage);return{_attributes:{lang:newLanguage},_classes:`is-lang-${newLanguage} ${data._direction==="rtl"?"is-rtl":"is-ltr"}`,title:data.warningTitle,body:data.warningMessage,_prompts:[{promptText:data._buttons.yes,_callbackEvent:"languagepicker:changelanguage:yes"},{promptText:data._buttons.no,_callbackEvent:"languagepicker:changelanguage:no"}],_showIcon:true}}});var LanguagePickerNavView=__AMD("extensions/adapt-contrib-languagePicker/js/languagePickerNavView",class LanguagePickerNavView extends Backbone.View{tagName(){return"button"}className(){const classNames="btn-icon nav__btn nav__languagepicker-btn js-languagepicker-nav-btn icon";const customClass=this.model.get("_languagePickerIconClass")||"icon-language-2";return`${classNames} ${customClass}`}events(){return{click:"onClick"}}initialize(){this.listenTo(Adapt$1,"remove",this.remove)}onClick(event){drawer.triggerCustomView(new LanguagePickerDrawerView({model:this.model}).$el,false)}});var LanguagePickerModel=__AMD("extensions/adapt-contrib-languagePicker/js/languagePickerModel",class LanguagePickerModel extends Backbone.Model{preinitialize(){this.trackedData={components:[],blocks:[]};this.locationId=null}defaults(){return{_isEnabled:false,displayTitle:"",body:"",_languages:[]}}initialize(){this.listenTo(Adapt$1.config,"change:_activeLanguage",this.markLanguageAsSelected);this.listenTo(Adapt$1,"app:dataLoaded",this.onDataLoaded)}getLanguageDetails(language){return this.get("_languages").find(_ref=>{let{_language}=_ref;return _language===language})}setLanguage(language){let{canReset=true}=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};Adapt$1.config.set({_activeLanguage:language,_defaultDirection:this.getLanguageDetails(language)._direction});if(canReset)this.checkResetOnLanguageChange()}checkResetOnLanguageChange(){const shouldReset=!this.get("_restoreStateOnLanguageChange");const hasOfflineStorageClear=Boolean(offlineStorage$1.clear);if(!shouldReset||!hasOfflineStorageClear)return;offlineStorage$1.clear()}markLanguageAsSelected(model,language){this.get("_languages").forEach(item=>{item._isSelected=item._language===language})}onDataLoaded(){const shouldReset=!this.get("_restoreStateOnLanguageChange");const hasOfflineStorageClear=Boolean(Adapt$1.offlineStorage.clear);if(hasOfflineStorageClear||shouldReset)return;_.defer(()=>{this.locationId=offlineStorage$1.get("location")||null;this.restoreState()})}restoreLocation(){if(!data$1.findById(this.locationId))return;_.defer(()=>router$1.navigateToElement("."+this.locationId))}restoreState(){if(this.isTrackedDataEmpty())return;this.trackedData.components?.forEach(this.setTrackableState);this.trackedData.blocks?.forEach(this.setTrackableState)}isTrackedDataEmpty(){return _.isEqual(this.trackedData,{components:[],blocks:[]})}getTrackableState(){return{components:this.getState(Adapt$1.components.models).filter(Boolean),blocks:this.getState(Adapt$1.blocks.models).filter(Boolean)}}getState(models){return models.map(model=>model.get("_isComplete")&&model.getTrackableState())}setTrackedData(){if(!this.get("_restoreStateOnLanguageChange")){return}this.listenToOnce(Adapt$1,"contentObjectView:ready",this.restoreLocation);this.trackedData=this.getTrackableState()}setTrackableState(stateObject){const restoreModel=data$1.findById(stateObject._id);if(!restoreModel){logging$1.warn("LanguagePicker unable to restore state for: "+stateObject._id);return}restoreModel.setTrackableState(stateObject)}});class LanguagePicker extends Backbone.Controller{initialize(){this.listenTo(Adapt$1,"configModel:dataLoaded",this.onConfigLoaded)}onConfigLoaded(){const config=Adapt$1.config.get("_languagePicker");if(!config?._isEnabled)return;this.languagePickerModel=new LanguagePickerModel(config);this.listenTo(Adapt$1,"router:menu router:page",this.setupNavigationView);const params=new URLSearchParams(window.location.search);const paramLang=params.get("lang");if(paramLang&&Adapt$1.build.get("availableLanguageNames").includes(paramLang))return;Adapt$1.config.set("_canLoadData",false);if(offlineStorage$1.ready){this.onOfflineStorageReady();return}this.listenToOnce(Adapt$1,"offlineStorage:ready",this.onOfflineStorageReady)}async onOfflineStorageReady(){await Adapt$1.wait.queue();const storedLanguage=offlineStorage$1.get("lang");if(storedLanguage){this.languagePickerModel.setLanguage(storedLanguage,{canReset:false});return}if(this.languagePickerModel.get("_showOnCourseLoad")===false){this.languagePickerModel.setLanguage(Adapt$1.config.get("_defaultLanguage"),{canReset:false});return}this.showLanguagePickerView()}showLanguagePickerView(){const languagePickerView=new LanguagePickerView({model:this.languagePickerModel});languagePickerView.$el.appendTo("#wrapper")}setupNavigationView(){const courseGlobals=Adapt$1.course.get("_globals")._extensions;let navigationBarLabel="";if(courseGlobals._languagePicker){navigationBarLabel=courseGlobals._languagePicker.navigationBarLabel}const languagePickerNavView=new LanguagePickerNavView({model:this.languagePickerModel,attributes:{"aria-label":navigationBarLabel}});languagePickerNavView.$el.appendTo(".nav__inner")}}__AMD("extensions/adapt-contrib-languagePicker/js/adapt-languagePicker",new LanguagePicker);var ResourcesView=__AMD("extensions/adapt-contrib-resources/js/ResourcesView",class ResourcesView extends Backbone.View{className(){return"resources"}initialize(){this.listenTo(Adapt$1,"remove",this.remove);this.render()}events(){return{"click .js-resources-filter-btn-click":"onFilterClicked"}}render(){this.$el.html(Handlebars.templates.resources({model:this.model.toJSON(),resources:this.collection.toJSON()}));_.defer(()=>{this.listenTo(Adapt$1,"drawer:triggerCustomView",this.remove)});return this}onFilterClicked(e){if(e&&e.preventDefault)e.preventDefault();this.$(".js-resources-filter-btn-click").removeClass("is-selected").attr("aria-selected",false);this.$(e.currentTarget).attr("aria-selected",true);let items;const filter=$(e.currentTarget).addClass("is-selected").attr("data-filter");if(filter==="all"){items=this.$(".js-resources-item").removeClass("u-display-none")}else{this.$(".js-resources-item").removeClass("u-display-none").not(".is-"+filter).addClass("u-display-none");items=this.$(".js-resources-item.is-"+filter)}if(items.length<0)return;a11y$1.focusFirst($(items[0]))}});const helpers$4={resources_has_type(resources,type,block){const hasType=resources.some(_.matcher({_type:type}));return hasType?block.fn(this):block.inverse(this)},resources_has_multiple_types(resources,block){if(resources.length===1)return block.inverse(this);const allSameType=resources.every(_.matcher({_type:resources[0]._type}));return allSameType?block.inverse(this):block.fn(this)},resources_get_column_count(resources){return _.uniq(_.pluck(resources,"_type")).length+1},resources_force_download(resource,block){if(device$1.browser==="internet explorer"||device$1.OS==="ios"){return block.inverse(this)}return resource._forceDownload||resource.filename?block.fn(this):block.inverse(this)}};for(const name in helpers$4){Handlebars__default["default"].registerHelper(name,helpers$4[name])}__AMD("extensions/adapt-contrib-resources/js/ResourcesHelpers",helpers$4);class Resources extends Backbone.Controller{initialize(){this.listenTo(Adapt$1,"adapt:start",this.initResources)}initResources(){const courseResources=Adapt$1.course.get("_resources");if(!courseResources||courseResources._isEnabled===false)return;const drawerObject={title:courseResources.title,description:courseResources.description,className:"is-resources",drawerOrder:courseResources._drawerOrder||0};drawer.addItem(drawerObject,"resources:showResources");this.setupResources(courseResources)}setupResources(resourcesData){const model=new Backbone.Model(resourcesData);const collection=new Backbone.Collection(model.get("_resourcesItems"));this.listenTo(Adapt$1,"resources:showResources",()=>{drawer.triggerCustomView(new ResourcesView({model,collection}).$el)})}}__AMD("extensions/adapt-contrib-resources/js/adapt-contrib-resources",new Resources);class Logger{constructor(){this.logArr=[];this.registeredViews=[]}static getInstance(){if(Logger.instance===null){Logger.instance=new Logger}return Logger.instance}getEntries(){return this.logArr}getLastEntry(){return this.logArr[this.logArr.length-1]}info(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_INFO,time:Date.now()};this.updateViews()}warn(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_WARN,time:Date.now()};this.updateViews()}error(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_ERROR,time:Date.now()};this.updateViews()}debug(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_DEBUG,time:Date.now()};this.updateViews()}registerView(_view){this.registeredViews[this.registeredViews.length]=_view}unregisterView(_view){for(let i=0,l=this.registeredViews.length;i<l;i++){if(this.registeredViews[i]!==_view)continue;this.registeredViews.splice(i,1);i--}}updateViews(){for(let i=0,l=this.registeredViews.length;i<l;i++){if(!this.registeredViews[i])continue;this.registeredViews[i].update(this)}}}Logger.instance=null;Logger.LOG_TYPE_INFO=0;Logger.LOG_TYPE_WARN=1;Logger.LOG_TYPE_ERROR=2;Logger.LOG_TYPE_DEBUG=3;var Logger$1=__AMD("extensions/adapt-contrib-spoor/js/scorm/logger",window.Logger=Logger);class ScormError{constructor(name){let data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this.name=name;this.data=data}}ScormError.CLIENT_COULD_NOT_CONNECT="CLIENT_COULD_NOT_CONNECT";ScormError.SERVER_STATUS_UNSUPPORTED="SERVER_STATUS_UNSUPPORTED";ScormError.CLIENT_STATUS_UNSUPPORTED="CLIENT_STATUS_UNSUPPORTED";ScormError.CLIENT_COULD_NOT_COMMIT="CLIENT_COULD_NOT_COMMIT";ScormError.CLIENT_NOT_CONNECTED="CLIENT_NOT_CONNECTED";ScormError.CLIENT_COULD_NOT_FINISH="CLIENT_COULD_NOT_FINISH";ScormError.CLIENT_COULD_NOT_GET_PROPERTY="CLIENT_COULD_NOT_GET_PROPERTY";ScormError.CLIENT_COULD_NOT_SET_PROPERTY="CLIENT_COULD_NOT_SET_PROPERTY";ScormError.CLIENT_INVALID_CHOICE_VALUE="CLIENT_INVALID_CHOICE_VALUE";ScormError.defaultMessages={title:"An error has occurred",pressOk:"Press 'OK' to view detailed debug information to send to technical support.",CLIENT_COULD_NOT_CONNECT:"The course could not connect to the Learning Management System",SERVER_STATUS_UNSUPPORTED:"An invalid lesson status of '{{{status}}}' was received from Learning Management System",CLIENT_STATUS_UNSUPPORTED:"The status '{{{status}}}' is not supported.",CLIENT_COULD_NOT_COMMIT:"There was a problem saving data to the Learning Management System\n\nError: {{errorCode}} - {{{errorInfo}}}\nLMS Error Info: {{{diagnosticInfo}}}",CLIENT_NOT_CONNECTED:"The course is not connected to the Learning Management System",CLIENT_COULD_NOT_FINISH:"The course was unable to terminate the learning session\n\nError: {{errorCode}} - {{{errorInfo}}}\nLMS Error Info: {{{diagnosticInfo}}}",CLIENT_COULD_NOT_GET_PROPERTY:"Unable to get the value of {{property}} from the Learning Management System\n\nError: {{errorCode}} - {{{errorInfo}}}\nLMS Error Info: {{{diagnosticInfo}}}",CLIENT_COULD_NOT_SET_PROPERTY:"Unable to set {{property}} to: '{{{value}}}'\n\nError: {{errorCode}} - {{{errorInfo}}}\nLMS Error Info: {{{diagnosticInfo}}}",CLIENT_INVALID_CHOICE_VALUE:"Numeric choice/matching response elements must use a value from 0 to 35 in SCORM 1.2"};var ScormError$1=__AMD("extensions/adapt-contrib-spoor/js/scorm/error",ScormError);const{CLIENT_COULD_NOT_CONNECT,SERVER_STATUS_UNSUPPORTED,CLIENT_STATUS_UNSUPPORTED,CLIENT_COULD_NOT_COMMIT,CLIENT_NOT_CONNECTED,CLIENT_COULD_NOT_FINISH,CLIENT_COULD_NOT_GET_PROPERTY,CLIENT_COULD_NOT_SET_PROPERTY,CLIENT_INVALID_CHOICE_VALUE}=ScormError$1;class ScormWrapper{constructor(){this.setCompletedWhenFailed=true;this.commitOnStatusChange=true;this.commitOnAnyChange=false;this.timedCommitFrequency=10;this.maxCommitRetries=5;this.commitRetryDelay=1000;this.commitRetryPending=false;this.commitRetries=0;this.lastCommitSuccessTime=null;this.exitStateIfIncomplete="auto";this.exitStateIfComplete="auto";this.timedCommitIntervalID=null;this.retryCommitTimeoutID=null;this.logOutputWin=null;this.startTime=null;this.endTime=null;this.lmsConnected=false;this.finishCalled=false;this.logger=Logger$1.getInstance();this.scorm=pipwerks__default["default"].SCORM;this.scorm.handleExitMode=false;this.suppressErrors=false;this.debouncedCommit=_.debounce(this.commit.bind(this),100);if(window.__debug){this.showDebugWindow()}if(!(window.API?.__offlineAPIWrapper&&window?.API_1484_11?.__offlineAPIWrapper))return;this.logger.error("Offline SCORM API is being used. No data will be reported to the LMS!")}static getInstance(){if(ScormWrapper.instance===null){ScormWrapper.instance=new ScormWrapper}return ScormWrapper.instance}getVersion(){return this.scorm.version}setVersion(value){this.logger.debug(`ScormWrapper::setVersion: ${value}`);this.scorm.version=value}initialize(){this.logger.debug("ScormWrapper::initialize");this.lmsConnected=this.scorm.init();if(!this.lmsConnected){this.handleError(new ScormError$1(CLIENT_COULD_NOT_CONNECT));return this.lmsConnected}this.startTime=new Date;this.initTimedCommit();return this.lmsConnected}isFirstSession(){return this.getValue(this.isSCORM2004()?"cmi.entry":"cmi.core.entry")==="ab-initio"}setIncomplete(){this.setValue(this.isSCORM2004()?"cmi.completion_status":"cmi.core.lesson_status","incomplete");if(this.commitOnStatusChange&&!this.commitOnAnyChange)this.commit()}setCompleted(){this.setValue(this.isSCORM2004()?"cmi.completion_status":"cmi.core.lesson_status","completed");if(this.commitOnStatusChange&&!this.commitOnAnyChange)this.commit()}setPassed(){if(this.isSCORM2004()){this.setValue("cmi.completion_status","completed");this.setValue("cmi.success_status","passed")}else{this.setValue("cmi.core.lesson_status","passed")}if(this.commitOnStatusChange&&!this.commitOnAnyChange)this.commit()}setFailed(){if(this.isSCORM2004()){this.setValue("cmi.success_status","failed");if(this.setCompletedWhenFailed){this.setValue("cmi.completion_status","completed")}}else{this.setValue("cmi.core.lesson_status","failed")}if(this.commitOnStatusChange&&!this.commitOnAnyChange)this.commit()}getStatus(){const status=this.getValue(this.isSCORM2004()?"cmi.completion_status":"cmi.core.lesson_status");switch(status.toLowerCase()){case"passed":case"completed":case"incomplete":case"failed":case"browsed":case"not attempted":case"not_attempted":case"unknown":return status;default:this.handleError(new ScormError$1(SERVER_STATUS_UNSUPPORTED,{status}));return null;}}setStatus(status){switch(status.toLowerCase()){case"incomplete":this.setIncomplete();break;case"completed":this.setCompleted();break;case"passed":this.setPassed();break;case"failed":this.setFailed();break;default:this.handleError(new ScormError$1(CLIENT_STATUS_UNSUPPORTED,{status}));}}getScore(){return this.getValue(this.isSCORM2004()?"cmi.score.raw":"cmi.core.score.raw")}setScore(score){let minScore=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;let maxScore=arguments.length>2&&arguments[2]!==undefined?arguments[2]:100;if(this.isSCORM2004()){this.setValue("cmi.score.raw",score);this.setValue("cmi.score.min",minScore);this.setValue("cmi.score.max",maxScore);const range=maxScore-minScore;const scaledScore=((score-minScore)/range).toFixed(7);this.setValue("cmi.score.scaled",scaledScore);return}this.setValue("cmi.core.score.raw",score);if(this.isSupported("cmi.core.score.min"))this.setValue("cmi.core.score.min",minScore);if(this.isSupported("cmi.core.score.max"))this.setValue("cmi.core.score.max",maxScore)}getLessonLocation(){return this.getValue(this.isSCORM2004()?"cmi.location":"cmi.core.lesson_location")}setLessonLocation(location){this.setValue(this.isSCORM2004()?"cmi.location":"cmi.core.lesson_location",location)}getSuspendData(){return this.getValue("cmi.suspend_data")}setSuspendData(data){this.setValue("cmi.suspend_data",data)}getStudentName(){return this.getValue(this.isSCORM2004()?"cmi.learner_name":"cmi.core.student_name")}getStudentId(){return this.getValue(this.isSCORM2004()?"cmi.learner_id":"cmi.core.student_id")}setLanguage(lang){if(this.isSCORM2004()){this.setValue("cmi.learner_preference.language",lang);return}if(!this.isSupported("cmi.student_preference.language"))return;this.setValue("cmi.student_preference.language",lang)}commit(){this.logger.debug("ScormWrapper::commit");if(!this.lmsConnected){this.handleError(new ScormError$1(ScormError$1.CLIENT_NOT_CONNECTED));return}if(this.commitRetryPending){this.logger.debug("ScormWrapper::commit: skipping this commit call as one is already pending.");return}if(this.scorm.save()){this.commitRetries=0;this.lastCommitSuccessTime=new Date;Adapt$1.trigger("spoor:commit",this);return}if(this.commitRetries<this.maxCommitRetries&&!this.finishCalled){this.commitRetries++;this.initRetryCommit();return}const errorCode=this.scorm.debug.getCode();this.handleError(new ScormError$1(CLIENT_COULD_NOT_COMMIT,{errorCode,errorInfo:this.scorm.debug.getInfo(errorCode),diagnosticInfo:this.scorm.debug.getDiagnosticInfo(errorCode)}))}finish(){this.logger.debug("ScormWrapper::finish");if(!this.lmsConnected||this.finishCalled){this.handleError(new ScormError$1(CLIENT_NOT_CONNECTED));return}this.finishCalled=true;if(this.timedCommitIntervalID!==null){window.clearInterval(this.timedCommitIntervalID)}if(this.commitRetryPending){window.clearTimeout(this.retryCommitTimeoutID);this.commitRetryPending=false}if(this.logOutputWin&&!this.logOutputWin.closed){this.logOutputWin.close()}this.endTime=new Date;if(this.isSCORM2004()){this.scorm.set("cmi.session_time",this.convertToSCORM2004Time(this.endTime.getTime()-this.startTime.getTime()));this.scorm.set("cmi.exit",this.getExitState())}else{this.scorm.set("cmi.core.session_time",this.convertToSCORM12Time(this.endTime.getTime()-this.startTime.getTime()));this.scorm.set("cmi.core.exit",this.getExitState())}this.lmsConnected=false;if(this.scorm.quit())return;const errorCode=this.scorm.debug.getCode();this.handleError(new ScormError$1(CLIENT_COULD_NOT_FINISH,{errorCode,errorInfo:this.scorm.debug.getInfo(errorCode),diagnosticInfo:this.scorm.debug.getDiagnosticInfo(errorCode)}))}recordInteraction(id,response,correct,latency,type){if(!this.isSupported("cmi.interactions._count")){this.logger.info("ScormWrapper::recordInteraction: cmi.interactions are not supported by this LMS...");return}switch(type){case"choice":this.recordInteractionMultipleChoice.apply(this,arguments);break;case"matching":this.recordInteractionMatching.apply(this,arguments);break;case"numeric":this.isSCORM2004()?this.recordInteractionScorm2004.apply(this,arguments):this.recordInteractionScorm12.apply(this,arguments);break;case"fill-in":case"long-fill-in":this.recordInteractionFillIn.apply(this,arguments);break;case"sequencing":this.recordInteractionSequencing.apply(this,arguments);break;default:console.error(`ScormWrapper.recordInteraction: unknown interaction type of '${type}' encountered...`);}}getValue(property){this.logger.debug(`ScormWrapper::getValue: _property=${property}`);if(this.finishCalled){this.logger.debug("ScormWrapper::getValue: ignoring request as 'finish' has been called");return}if(!this.lmsConnected){this.handleError(new ScormError$1(CLIENT_NOT_CONNECTED));return}const value=this.scorm.get(property);const errorCode=this.scorm.debug.getCode();switch(errorCode){case 0:break;case 403:this.logger.warn("ScormWrapper::getValue: data model element not initialized");break;default:this.handleError(new ScormError$1(CLIENT_COULD_NOT_GET_PROPERTY,{property,errorCode,errorInfo:this.scorm.debug.getInfo(errorCode),diagnosticInfo:this.scorm.debug.getDiagnosticInfo(errorCode)}));}this.logger.debug(`ScormWrapper::getValue: returning ${value}`);return value+""}setValue(property,value){this.logger.debug(`ScormWrapper::setValue: _property=${property} _value=${value}`);if(this.finishCalled){this.logger.debug("ScormWrapper::setValue: ignoring request as 'finish' has been called");return}if(!this.lmsConnected){this.handleError(new ScormError$1(CLIENT_NOT_CONNECTED));return}const success=this.scorm.set(property,value);if(!success){const errorCode=this.scorm.debug.getCode();if(errorCode!==0){this.handleError(new ScormError$1(CLIENT_COULD_NOT_SET_PROPERTY,{property,value,errorCode,errorInfo:this.scorm.debug.getInfo(errorCode),diagnosticInfo:this.scorm.debug.getDiagnosticInfo(errorCode)}));return success}this.logger.warn("ScormWrapper::setValue: LMS reported that the 'set' call failed but then said there was no error!")}if(this.commitOnAnyChange)this.debouncedCommit();return success}isSupported(property){this.logger.debug(`ScormWrapper::isSupported: _property=${property}`);if(this.finishCalled){this.logger.debug("ScormWrapper::isSupported: ignoring request as 'finish' has been called");return}if(!this.lmsConnected){this.handleError(new ScormError$1(CLIENT_NOT_CONNECTED));return false}this.scorm.get(property);return this.scorm.debug.getCode()!==401}initTimedCommit(){this.logger.debug("ScormWrapper::initTimedCommit");if(!this.commitOnAnyChange&&this.timedCommitFrequency>0){const delay=this.timedCommitFrequency*(60*1000);this.timedCommitIntervalID=window.setInterval(this.commit.bind(this),delay)}}initRetryCommit(){this.logger.debug(`ScormWrapper::initRetryCommit ${this.commitRetries} out of ${this.maxCommitRetries}`);this.commitRetryPending=true;this.retryCommitTimeoutID=window.setTimeout(this.doRetryCommit.bind(this),this.commitRetryDelay)}doRetryCommit(){this.logger.debug("ScormWrapper::doRetryCommit");this.commitRetryPending=false;this.commit()}handleError(error){if(!Adapt$1.get("_isStarted")){Adapt$1.once("contentObjectView:ready",this.handleError.bind(this,error));return}if("value"in error.data){if(error.data.value.length&&error.data.value.length>80)error.data.value=error.data.value.slice(0,80)+"...";if(error.data.value==="")error.data.value="''"}const config=Adapt$1.course.get("_spoor");const messages=Object.assign({},ScormError$1.defaultMessages,config&&config._messages);const message=Handlebars.compile(messages[error.name])(error.data);switch(error.name){case CLIENT_COULD_NOT_CONNECT:notify$1.popup({_isCancellable:false,title:messages.title,body:message});return;}this.logger.error(message);if(!this.suppressErrors&&(!this.logOutputWin||this.logOutputWin.closed)&&confirm(`${messages.title}:\n\n${message}\n\n${messages.pressOk}`)){this.showDebugWindow()}}getInteractionCount(){const count=this.getValue("cmi.interactions._count");return count===""?0:count}recordInteractionScorm12(id,response,correct,latency,type){id=id.trim();const cmiPrefix=`cmi.interactions.${this.getInteractionCount()}`;this.setValue(`${cmiPrefix}.id`,id);this.setValue(`${cmiPrefix}.type`,type);this.setValue(`${cmiPrefix}.student_response`,response);this.setValue(`${cmiPrefix}.result`,correct?"correct":"wrong");if(latency!==null&&latency!==undefined)this.setValue(`${cmiPrefix}.latency`,this.convertToSCORM12Time(latency));this.setValue(`${cmiPrefix}.time`,this.getCMITime())}recordInteractionScorm2004(id,response,correct,latency,type){id=id.trim();const cmiPrefix=`cmi.interactions.${this.getInteractionCount()}`;this.setValue(`${cmiPrefix}.id`,id);this.setValue(`${cmiPrefix}.type`,type);this.setValue(`${cmiPrefix}.learner_response`,response);this.setValue(`${cmiPrefix}.result`,correct?"correct":"incorrect");if(latency!==null&&latency!==undefined)this.setValue(`${cmiPrefix}.latency`,this.convertToSCORM2004Time(latency));this.setValue(`${cmiPrefix}.timestamp`,this.getISO8601Timestamp())}recordInteractionMultipleChoice(id,response,correct,latency,type){if(this.isSCORM2004()){response=response.replace(/,|#/g,"[,]")}else{response=response.replace(/#/g,",");response=this.checkResponse(response,"choice")}const scormRecordInteraction=this.isSCORM2004()?this.recordInteractionScorm2004:this.recordInteractionScorm12;scormRecordInteraction.call(this,id,response,correct,latency,type)}recordInteractionSequencing(id,response,correct,latency,type){if(this.isSCORM2004()){response=response.replace(/,|#/g,"[,]")}else{response=response.replace(/#/g,",")}const scormRecordInteraction=this.isSCORM2004()?this.recordInteractionScorm2004:this.recordInteractionScorm12;scormRecordInteraction.call(this,id,response,correct,latency,type)}recordInteractionMatching(id,response,correct,latency,type){response=response.replace(/#/g,",");if(this.isSCORM2004()){response=response.replace(/,/g,"[,]");response=response.replace(/\./g,"[.]")}else{response=this.checkResponse(response,"matching")}const scormRecordInteraction=this.isSCORM2004()?this.recordInteractionScorm2004:this.recordInteractionScorm12;scormRecordInteraction.call(this,id,response,correct,latency,type)}recordInteractionFillIn(id,response,correct,latency,type){const maxLength=type==="long-fill-in"?5000:this.isSCORM2004()?250:255;if(response.length>maxLength){response=response.substr(0,maxLength);this.logger.warn(`ScormWrapper::recordInteractionFillIn: response data for ${id} is longer than the maximum allowed length of ${maxLength} characters; data will be truncated to avoid an error.`)}const scormRecordInteraction=this.isSCORM2004()?this.recordInteractionScorm2004:this.recordInteractionScorm12;scormRecordInteraction.call(this,id,response,correct,latency,type)}showDebugWindow(){if(this.logOutputWin&&!this.logOutputWin.closed){this.logOutputWin.close()}this.logOutputWin=window.open("log_output.html","Log","width=600,height=300,status=no,scrollbars=yes,resizable=yes,menubar=yes,toolbar=yes,location=yes,top=0,left=0");if(!this.logOutputWin)return;this.logOutputWin.focus()}convertToSCORM12Time(msConvert){const msPerSec=1000;const msPerMin=msPerSec*60;const msPerHour=msPerMin*60;const ms=msConvert%msPerSec;msConvert=msConvert-ms;let secs=msConvert%msPerMin;msConvert=msConvert-secs;secs=secs/msPerSec;let mins=msConvert%msPerHour;msConvert=msConvert-mins;mins=mins/msPerMin;const hrs=msConvert/msPerHour;if(hrs>9999){return"9999:99:99.99"}const str=[this.padWithZeroes(hrs,4),this.padWithZeroes(mins,2),this.padWithZeroes(secs,2)].join(":");return`${str}.${Math.floor(ms/10)}`}convertToSCORM2004Time(msConvert){let csConvert=Math.floor(msConvert/10);const csPerSec=100;const csPerMin=csPerSec*60;const csPerHour=csPerMin*60;const csPerDay=csPerHour*24;let days=Math.floor(csConvert/csPerDay);csConvert-=days*csPerDay;days=days?days+"D":"";let hours=Math.floor(csConvert/csPerHour);csConvert-=hours*csPerHour;hours=hours?hours+"H":"";let mins=Math.floor(csConvert/csPerMin);csConvert-=mins*csPerMin;mins=mins?mins+"M":"";let secs=Math.floor(csConvert/csPerSec);csConvert-=secs*csPerSec;secs=secs||"0";let cs=csConvert;cs=cs?"."+cs:"";const seconds=secs+cs+"S";const hms=[hours,mins,seconds].join("");return"P"+days+"T"+hms}getCMITime(){const date=new Date;const hours=this.padWithZeroes(date.getHours(),2);const min=this.padWithZeroes(date.getMinutes(),2);const sec=this.padWithZeroes(date.getSeconds(),2);return[hours,min,sec].join(":")}getISO8601Timestamp(){const date=new Date().toISOString();return date.replace(/.\d\d\dZ/,"")}padWithZeroes(numToPad,padBy){let len=padBy;while(--len){numToPad="0"+numToPad}return numToPad.slice(-padBy)}isSCORM2004(){return this.scorm.version==="2004"}checkResponse(response,responseType){if(!response)return response;if(responseType!=="choice"&&responseType!=="matching")return response;response=response.split(/,|#/);const self=this;if(responseType==="choice"){response=response.map(checkIdentifier)}else{response=response.map(r=>{const identifiers=r.split(".");return checkIdentifier(identifiers[0])+"."+checkIdentifier(identifiers[1])})}function checkIdentifier(r){if(r.length===1&&r>="0"&&r<="9")return r;if(r.length===1&&r>="a"&&r<="z")return r;const i=parseInt(r);if(isNaN(i)||i<10||i>35){self.handleError(new ScormError$1(CLIENT_INVALID_CHOICE_VALUE))}return Number(i).toString(36)}return response.join(",")}getExitState(){const completionStatus=this.scorm.data.completionStatus;const isIncomplete=completionStatus==="incomplete"||completionStatus==="not attempted";const exitState=isIncomplete?this.exitStateIfIncomplete:this.exitStateIfComplete;if(exitState!=="auto")return exitState;if(this.isSCORM2004())return isIncomplete?"suspend":"normal";return""}}ScormWrapper.instance=null;var ScormWrapper$1=__AMD("extensions/adapt-contrib-spoor/js/scorm/wrapper",ScormWrapper);const LZMAWorker=window.LZMAFactory("./libraries/lzma_worker-min.js");const ZeroString={};function makeZeroString(length){ZeroString[length]=ZeroString[length]||new Array(length+1).join("0");return ZeroString[length]}for(let i=1,l=64;i<=l;i++){makeZeroString(i)}function zeroPadRightToLength(string,length){const padLength=length-string.length;if(padLength>0){string+=makeZeroString(padLength)}return string}function zeroPadLeftToLength(string,length){const padLength=length-string.length;if(padLength>0){string=makeZeroString(padLength)+string}return string}function zeroPadRightToMultiple(string,multiple){const padLength=multiple-string.length%multiple;if(padLength!==multiple){string+=makeZeroString(padLength)}return string}function binaryToUnsignedInteger(binary,binaryLength){if(binaryLength===0){return 0}binary=zeroPadLeftToLength(binary,binaryLength);const integer=parseInt(binary.slice(0,binaryLength),2);return integer}function shiftUnsignedIntegerFromBinary(binary,binaryLength){if(binaryLength===0){return[0,binary]}binary=zeroPadLeftToLength(binary,binaryLength);const integer=parseInt(binary.slice(0,binaryLength),2);binary=binary.slice(binaryLength);return[integer,binary]}function shiftBinary(binary,binaryLength){if(binaryLength===0){return["",binary]}binary=zeroPadLeftToLength(binary,binaryLength);const shifted=binary.slice(0,binaryLength);binary=binary.slice(binaryLength);return[shifted,binary]}function unsignedIntegerToBinary(integer,binaryLength){if(binaryLength===0){return""}let binary=Math.abs(integer).toString(2);if(typeof binaryLength==="undefined"){return binary}const length=binary.length;if(length>binaryLength){throw new Error(`Integer too big for specified binary length. integer: ${integer} binarylen: ${binaryLength}`)}binary=zeroPadLeftToLength(binary,binaryLength);return binary}function byteArrayToString(array){const arrayLength=array.length;let string=new Array(arrayLength);for(let i=0,l=arrayLength;i<l;i++){string[i]=String.fromCharCode(array[i])}string=string.join("");return string}function stringToByteArray(string){const stringLength=string.length;const array=new Array(stringLength);for(let i=0,l=stringLength;i<l;i++){array[i]=string.charCodeAt(i)}return array}const BYTE_BIT_LENGTH=8;function binaryToBase64(binary){binary=___default["default"].flatten(binary).join("");binary=zeroPadRightToMultiple(binary,BYTE_BIT_LENGTH);const bytesCount=binary.length/BYTE_BIT_LENGTH;const charCodes=new Array(bytesCount);for(let i=0,l=bytesCount;i<l;i++){[charCodes[i],binary]=shiftUnsignedIntegerFromBinary(binary,BYTE_BIT_LENGTH)}let base64=btoa(byteArrayToString(charCodes));base64=base64.replace(/=/g,"");base64=base64.replace(/\+/g,"-");return base64}function base64ToBinary(base64){base64=base64.replace(/-/g,"+");const charCodes=stringToByteArray(atob(base64));const bytesCount=charCodes.length;let binary=new Array(bytesCount);for(let i=0,l=bytesCount;i<l;i++){binary[i]=unsignedIntegerToBinary(charCodes[i],BYTE_BIT_LENGTH)}binary=binary.join("");return binary}const logs={usedTypes:{},typeLengths:{},binarySamples:{}};class AbstractValueType{constructor(options){Object.assign(this,options);this.binaryTypeLength=this.binaryType.length}log(binary){const name=this.name;logs.usedTypes[name]=logs.usedTypes[name]||0;logs.usedTypes[name]++;logs.binarySamples[name]=logs.binarySamples[name]||[];logs.binarySamples[name].push(binary)}}class FixedIntegerType extends AbstractValueType{constructor(options){super(options);this.esType="number";if(!this.valueBinaryLength){return}this.minValue=options.minValue||0;this.maxValue=options.maxValue||Math.pow(2,this.valueBinaryLength)-1}valueToBinary(integer){let logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;let binary=unsignedIntegerToBinary(integer,this.valueBinaryLength);if(logStats){this.log(binary)}binary=[binary];return binary}shiftValueFromBinary(binary){let integer;[integer,binary]=shiftUnsignedIntegerFromBinary(binary,this.valueBinaryLength);return[integer,binary]}}class FixedBooleanType extends FixedIntegerType{constructor(options){options.valueBinaryLength=1;super(options);this.esType="boolean"}shiftValueFromBinary(binary){const bool=binary[0]==="1";binary=binary.slice(1);return[bool,binary]}}class LengthAndValueBinary{constructor(parent,name,bitSizes){this.parent=parent;this.name=name;this.bitSizes=bitSizes;this.maxValues=___default["default"].flatten(this.bitSizes).map(value=>Math.pow(2,value)-1);this.maxValue=this.maxValues[this.maxValues.length-1];this.sizeBinaryLength=unsignedIntegerToBinary(this.bitSizes.length-1).length}valueToBinary(integer){let logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;const parentName=this.parent.name;const sizeIndex=this.maxValues.findIndex(maxValue=>integer<=maxValue);if(sizeIndex===-1){throw new Error(`Value is too large for type: ${parentName} value: ${integer} max: ${this.maxValue}`)}const sizeBinary=unsignedIntegerToBinary(sizeIndex,this.sizeBinaryLength);const valueLength=this.bitSizes[sizeIndex];const name=this.name;if(logStats){logs.typeLengths[parentName]=logs.typeLengths[parentName]||{};logs.typeLengths[parentName][name]=logs.typeLengths[parentName][name]||{};logs.typeLengths[parentName][name][valueLength]=logs.typeLengths[parentName][name][valueLength]||0;logs.typeLengths[parentName][name][valueLength]++}const integerBinary=unsignedIntegerToBinary(integer,valueLength);const binary=[sizeBinary,integerBinary];return binary}shiftValueFromBinary(binary){let sizeBinary;[sizeBinary,binary]=shiftBinary(binary,this.sizeBinaryLength);const sizeIndex=binaryToUnsignedInteger(sizeBinary);const valueLength=this.bitSizes[sizeIndex];let integer;[integer,binary]=shiftUnsignedIntegerFromBinary(binary,valueLength);return[integer,binary]}}class VariableIntegerType extends FixedIntegerType{constructor(options){super(options);this.isNegative=this.minValue<0&&this.maxValue===0;this.integer=new LengthAndValueBinary(this,"integer",options.integerBitSizes)}valueToBinary(integer){let logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;integer=integer.toFixed(0);const binary=this.integer.valueToBinary(Math.abs(integer),logStats);if(logStats){this.log(binary)}return binary}shiftValueFromBinary(binary){let integer;[integer,binary]=this.integer.shiftValueFromBinary(binary);if(this.isNegative){integer=-integer}return[integer,binary]}}class VariableArrayType extends VariableIntegerType{constructor(options){super(options);this.esType="array"}valueToBinary(array){let logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;const arrayLength=array.length;const binary=super.valueToBinary(arrayLength);if(arrayLength){const valueType=findValueTypeFromValues(array);binary.push(valueType.binaryType);binary.type=valueType.name;binary.push(array.map(value=>valueType.valueToBinary(value,logStats)))}if(logStats){this.log(binary)}return binary}shiftValueFromBinary(binary){let arrayLength;[arrayLength,binary]=super.shiftValueFromBinary(binary);const value=new Array(arrayLength);if(arrayLength){let valueType;[valueType,binary]=shiftValueTypeFromBinary(binary);for(let i=0,l=arrayLength;i<l;i++){[value[i],binary]=valueType.shiftValueFromBinary(binary)}}return[value,binary]}}class VariableSignedIntegerType extends VariableIntegerType{valueToBinary(integer){let logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;integer=integer.toFixed(0);const isNegative=integer<0;const signBinary=isNegative?"1":"0";const integerBinary=this.integer.valueToBinary(Math.abs(integer),logStats);const binary=[signBinary,integerBinary];if(logStats){this.log(binary)}return binary}shiftValueFromBinary(binary){let isNegative;[isNegative,binary]=shiftUnsignedIntegerFromBinary(binary,1);let integer;[integer,binary]=this.integer.shiftValueFromBinary(binary);if(isNegative){integer=-integer}return[integer,binary]}}class VariableDecimalType extends VariableIntegerType{constructor(options){super(options);this.isFloat=true;this.decimal=new LengthAndValueBinary(this,"decimal",options.decimalBitSizes)}valueToBinary(float){let logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;float=float.toFixed(2);const isNegative=float<0;float=Math.abs(float);const parts=String(float).split(".");const higherInteger=parseInt(parts[0]);const lowerInteger=parseInt(zeroPadRightToLength(parts[1]||0,2));const signBinary=isNegative?"1":"0";const integerValueBinary=this.integer.valueToBinary(higherInteger,logStats);const decimalValueBinary=this.decimal.valueToBinary(lowerInteger,logStats);const binary=[signBinary,integerValueBinary,decimalValueBinary];if(logStats){this.log(binary)}return binary}shiftValueFromBinary(binary){let isNegative;[isNegative,binary]=shiftUnsignedIntegerFromBinary(binary,1);let higherInteger;[higherInteger,binary]=this.integer.shiftValueFromBinary(binary);let lowerInteger;[lowerInteger,binary]=this.decimal.shiftValueFromBinary(binary);lowerInteger=zeroPadLeftToLength(String(lowerInteger),2);let float=parseFloat(higherInteger+"."+lowerInteger);if(isNegative){float=-float}return[float,binary]}}const arrayType=new VariableArrayType({name:"array",binaryType:"10",integerBitSizes:[4,16]});const booleanType=new FixedBooleanType({name:"boolean",binaryType:"0"});const integerTypes=[new FixedIntegerType({name:"uint3",binaryType:"1110",valueBinaryLength:3}),new VariableIntegerType({name:"vint8+",binaryType:"110",minValue:0,maxValue:255,integerBitSizes:[2,8]}),new VariableIntegerType({name:"vint8-",binaryType:"111100",minValue:-255,maxValue:0,integerBitSizes:[2,8]}),new VariableSignedIntegerType({name:"sint32",binaryType:"111110",minValue:-4294967295,maxValue:4294967295,integerBitSizes:[2,4,16,32]})];const decimalTypes=[new VariableDecimalType({name:"sdec15",binaryType:"111101",minValue:-255.99,maxValue:255.99,integerBitSizes:[2,8],decimalBitSizes:[0,7]}),new VariableDecimalType({name:"sdec39",binaryType:"111111",minValue:-4294967295.99,maxValue:4294967295.99,integerBitSizes:[2,4,16,32],decimalBitSizes:[0,7]})];const ValueTypes=[booleanType,arrayType].concat(integerTypes).concat(decimalTypes);ValueTypes.nameIndex={};ValueTypes.forEach(valueType=>ValueTypes.nameIndex[valueType.name]=valueType);function esTypeOf(value){if(Array.isArray(value)){return"array"}if(value===null){return"null"}return typeof value}function findValueTypeFromName(name){return ValueTypes.nameIndex[name.toLowerCase()]}function findValueTypeFromValue(value){const esType=esTypeOf(value);switch(esType){case"array":return arrayType;case"boolean":return booleanType;}value=value.toFixed(2);const isFloat=!Number.isInteger(value);const isValueInValueTypeRange=valueType=>value>=valueType.minValue&&value<=valueType.maxValue;const valueType=isFloat?decimalTypes.find(isValueInValueTypeRange):integerTypes.find(isValueInValueTypeRange);if(!valueType){throw new Error(`Cannot find type from value: ${value}`)}return valueType}function findValueTypeFromValues(values){if(!values.length){return}let minValue=0;let maxValue=0;let isFloat=false;const esTypes=values.map(value=>{const valueType=findValueTypeFromValue(value);if(valueType.esType==="number"){minValue=Math.min(value,minValue);maxValue=Math.max(value,maxValue);isFloat=isFloat||!Number.isInteger(value)}return valueType.esType});const uniqESTypes=[...new Set(esTypes)];if(uniqESTypes.length>1){throw new Error(`Cannot resolve array to one type: ${uniqESTypes.join()}`)}const esType=uniqESTypes[0];switch(esType){case"array":return arrayType;case"boolean":return booleanType;}const isRangeInValueTypeRange=valueType=>minValue>=valueType.minValue&&maxValue<=valueType.maxValue;const valueType=isFloat?decimalTypes.find(isRangeInValueTypeRange):integerTypes.find(isRangeInValueTypeRange);if(!valueType){throw new Error(`Cannot find type from value. min: ${minValue} max: ${maxValue} isfloat: ${isFloat}`)}return valueType}function shiftValueTypeFromBinary(binary){const valueType=ValueTypes.find(valueType=>{const binaryType=binary.slice(0,valueType.binaryTypeLength);return binaryType===valueType.binaryType});if(!valueType){throw new Error(`Cannot find type from binary: ${binary.slice(0,6)}...`)}binary=binary.slice(valueType.binaryTypeLength);return[valueType,binary]}function convertValuesToNumbers(value){const esType=esTypeOf(value);switch(esType){case"array":return value.map(convertValuesToNumbers);case"undefined":case"null":return value?1:0;case"boolean":case"number":return value;}throw new Error(`Cannot convert ${esType} to number. '${value}'`)}class Converter{getInvalidTypeError(value){try{value=convertValuesToNumbers(value);esTypeOf(value)==="array"?findValueTypeFromValues(value):findValueTypeFromValue(value);return}catch(err){return err}}valueToBinary(value){let typeName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;let logStats=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;this.clearLog();const hasInitialType=typeof typeName==="string";value=convertValuesToNumbers(value);const valueType=hasInitialType?findValueTypeFromName(typeName):findValueTypeFromValue(value);if(!valueType){throw new Error(`Could not find value type from ${hasInitialType?`name ${typeName}`:`value ${value}`} accepts: ${Object.keys(ValueTypes.nameIndex)}. Leave typeName empty for auto-detect.`)}const binary=valueType.valueToBinary(value,logStats);if(!hasInitialType){binary.unshift(valueType.binaryType)}if(logStats){this.printLog()}return binary}valueFromBinary(binary){let typeName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;binary=___default["default"].flatten(binary).join("");const hasInitialType=typeof typeName==="string";let valueType;if(hasInitialType){valueType=findValueTypeFromName(typeName)}else{[valueType,binary]=shiftValueTypeFromBinary(binary)}if(!valueType||!(valueType instanceof AbstractValueType)){throw new Error(`Could not find value type from ${hasInitialType?`name "${typeName}"`:`binary "${binary.slice(0,8)}"...`} accepts: ${Object.keys(ValueTypes.nameIndex)}. Leave typeName empty for auto-detect.`)}const[value]=valueType.shiftValueFromBinary(binary);return value}clearLog(){logs.usedTypes={};logs.typeLengths={};logs.binarySamples={}}printLog(){console.log("Types used count:",logs.usedTypes);console.log("Type lengths used count:",logs.typeLengths);console.log("Type binary samples:",logs.binarySamples)}serialize(value){let typeName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;let logStats=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;const binary=this.valueToBinary(value,typeName,logStats);const base64=binaryToBase64(binary);return base64}async serializeAsync(value){const binary=this.valueToBinary(value,null,null);const base64=binaryToBase64(binary);const isLargeArray=Array.isArray(value)&&value.length>10;if(isLargeArray){return new Promise(resolve=>{LZMAWorker.compress(JSON.stringify(value),1,data=>{const compressedBase64=`#${window.btoa(data.map(i=>String.fromCharCode(i+128)).join("")).replace(/=/g,"")}`;const isCompressedSmaller=compressedBase64.length<base64.length;if(isCompressedSmaller)return resolve(compressedBase64);return resolve(base64)})})}return base64}deserialize(base64){let typeName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;const isLZMACompressed=base64[0]==="#";if(isLZMACompressed)return JSON.parse(window.LZMA.decompress(window.atob(base64.slice(1)).split("").map(c=>c.charCodeAt(0)-128)));const binary=base64ToBinary(base64);const value=this.valueFromBinary(binary,typeName);return value}}var SCORMSuspendData=__AMD("extensions/adapt-contrib-spoor/js/serializers/SCORMSuspendData",window.SCORMSuspendData=new Converter);var ComponentSerializer=__AMD("extensions/adapt-contrib-spoor/js/serializers/ComponentSerializer",class ComponentSerializer extends Backbone.Controller{initialize(trackingIdType,shouldCompress){this.trackingIdType=trackingIdType;this.shouldCompress=shouldCompress}async serialize(shouldStoreResponses,shouldStoreAttempts){if(shouldStoreAttempts&&!shouldStoreResponses){logging$1.warnOnce("SPOOR configuration error, cannot use '_shouldStoreAttempts' without '_shouldStoreResponses'")}const states=[];data$1.each(model=>{if(model.get("_type")!==this.trackingIdType){return}const trackingId=model.get("_trackingId");if(typeof trackingId==="undefined"){return}const isContainer=model.hasManagedChildren;const components=isContainer?model.findDescendantModels("component"):[model];components.forEach((component,index)=>{if(component.get("_isTrackable")===false){return}if(!shouldStoreResponses){const state=[[trackingId,index],[component.get("_isComplete")]];states.push(state);return}let modelState=null;if(!component.getAttemptState){modelState=component.get("_isQuestionType")?[[component.get("_score")||0,component.get("_attemptsLeft")||0],[component.get("_isComplete")||false,component.get("_isInteractionComplete")||false,component.get("_isSubmitted")||false,component.get("_isCorrect")||false],[component.get("_userAnswer")]]:[[],[component.get("_isComplete")||false,component.get("_isInteractionComplete")||false],[component.get("_userAnswer")]]}else{modelState=component.getAttemptState()}const userAnswer=modelState[2][0];const hasUserAnswer=typeof userAnswer!=="undefined"&&userAnswer!==null;const isUserAnswerArray=Array.isArray(userAnswer);if(!hasUserAnswer){modelState[2][0]=[]}else if(!isUserAnswerArray){modelState[2][0]=[modelState[2][0]]}const attemptStates=component.get("_attemptStates");const hasAttemptStates=shouldStoreAttempts&&Array.isArray(attemptStates);if(hasAttemptStates){modelState[2][1]=attemptStates}const state=[[trackingId,index],[hasUserAnswer,isUserAnswerArray,hasAttemptStates],modelState];states.push(state)})});if(this.shouldCompress)return await SCORMSuspendData.serializeAsync(states);return SCORMSuspendData.serialize(states)}deserialize(binary){const trackingIdMap=data$1.toArray().reduce((trackingIdMap,model)=>{const trackingId=model.get("_trackingId");if(typeof trackingId==="undefined")return trackingIdMap;trackingIdMap[trackingId]=model;return trackingIdMap},{});const states=SCORMSuspendData.deserialize(binary);const shouldStoreResponses=states[0].length>2;states.forEach(state=>{const[trackingId,index]=state[0];const model=trackingIdMap[trackingId];if(!model){return}const isContainer=model.hasManagedChildren;const components=isContainer?model.findDescendantModels("component"):[model];const component=components[index];if(!component){logging$1.warn(`SPOOR could not restore tracking id: ${trackingId}, index: ${index}`);return}if(!shouldStoreResponses){const isComplete=state[1][0];component.set("_isComplete",isComplete);return}const[hasUserAnswer,isUserAnswerArray,hasAttemptStates]=state[1];const modelState=state[2];if(!hasUserAnswer){modelState[2][0]=null}else if(!isUserAnswerArray){modelState[2][0]=modelState[2][0][0]}if(!hasAttemptStates){modelState[2][1]=null}if(component.setAttemptObject){component.set("_attemptStates",modelState[2][1]);const attemptObject=component.getAttemptObject(modelState);component.setAttemptObject(attemptObject,false);return}component.get("_isQuestionType")?component.set({_score:modelState[0][0],_attemptsLeft:modelState[0][1],_isComplete:modelState[1][0],_isInteractionComplete:modelState[1][1],_isSubmitted:modelState[1][2],_isCorrect:modelState[1][3],_userAnswer:modelState[2][0],_attemptStates:modelState[2][1]}):component.set({_isComplete:modelState[1][0],_isInteractionComplete:modelState[1][1],_userAnswer:modelState[2][0],_attemptStates:modelState[2][1]})})}});var StatefulSession=__AMD("extensions/adapt-contrib-spoor/js/adapt-stateful-session",class StatefulSession extends Backbone.Controller{initialize(){_.bindAll(this,"beginSession","onVisibilityChange","endSession");this.debouncedSaveSession=_.debounce(this.saveSessionState.bind(this),1);this.scorm=ScormWrapper$1.getInstance();this._trackingIdType="block";this._componentSerializer=null;this._shouldCompress=false;this._shouldStoreResponses=true;this._shouldStoreAttempts=false;this._shouldRecordInteractions=true;this.beginSession()}beginSession(){this.listenTo(Adapt$1,"app:dataReady",this.restoreSession);this._trackingIdType=Adapt$1.build.get("trackingIdType")||"block";if(window.location.search.indexOf("nolmserrors")!==-1){this.scorm.suppressErrors=true}const config=Adapt$1.spoor.config;if(!config)return;const tracking=config._tracking;this._shouldStoreResponses=tracking&&tracking._shouldStoreResponses||false;this._shouldStoreAttempts=tracking&&tracking._shouldStoreAttempts||false;this._shouldCompress=tracking&&tracking._shouldCompress||false;this._componentSerializer=new ComponentSerializer(this._trackingIdType,this._shouldCompress);if(tracking?._shouldRecordInteractions===false){this._shouldRecordInteractions=false}const settings=config._advancedSettings;if(!settings){this.scorm.setVersion("1.2");this.scorm.initialize();return}if(settings._showDebugWindow){this.scorm.showDebugWindow()}this.scorm.setVersion(settings._scormVersion||"1.2");if(_.isBoolean(settings._suppressErrors)){this.scorm.suppressErrors=settings._suppressErrors}if(_.isBoolean(settings._commitOnStatusChange)){this.scorm.commitOnStatusChange=settings._commitOnStatusChange}if(_.isBoolean(settings._commitOnAnyChange)){this.scorm.commitOnAnyChange=settings._commitOnAnyChange}if(_.isFinite(settings._timedCommitFrequency)){this.scorm.timedCommitFrequency=settings._timedCommitFrequency}if(_.isFinite(settings._maxCommitRetries)){this.scorm.maxCommitRetries=settings._maxCommitRetries}if(_.isFinite(settings._commitRetryDelay)){this.scorm.commitRetryDelay=settings._commitRetryDelay}if("_exitStateIfIncomplete"in settings){this.scorm.exitStateIfIncomplete=settings._exitStateIfIncomplete}if("_exitStateIfComplete"in settings){this.scorm.exitStateIfComplete=settings._exitStateIfComplete}this.scorm.initialize()}restoreSession(){this.setupLearnerInfo();this.restoreSessionState();_.defer(this.setupEventListeners.bind(this))}setupLearnerInfo(){const globals=Adapt$1.course.get("_globals");if(!globals._learnerInfo){globals._learnerInfo={}}Object.assign(globals._learnerInfo,offlineStorage$1.get("learnerinfo"))}restoreSessionState(){const sessionPairs=offlineStorage$1.get();const hasNoPairs=!Object.keys(sessionPairs).length;if(hasNoPairs)return;if(sessionPairs.c){const[_isComplete,_isAssessmentPassed]=SCORMSuspendData.deserialize(sessionPairs.c);Adapt$1.course.set({_isComplete,_isAssessmentPassed})}if(!sessionPairs.q)return;this._componentSerializer?.deserialize(sessionPairs.q)}setupEventListeners(){this.removeEventListeners();this.listenTo(Adapt$1.components,"change:_isComplete",this.debouncedSaveSession);this.listenTo(Adapt$1.course,"change:_isComplete",this.debouncedSaveSession);if(this._shouldStoreResponses){this.listenTo(data$1,"change:_isSubmitted change:_userAnswer",this.debouncedSaveSession)}this.listenTo(Adapt$1,{"app:dataReady":this.restoreSession,"app:languageChanged":this.onLanguageChanged,"questionView:recordInteraction":this.onQuestionRecordInteraction,"tracking:complete":this.onTrackingComplete});const config=Adapt$1.spoor.config;const advancedSettings=config._advancedSettings;const shouldCommitOnVisibilityChange=!advancedSettings||advancedSettings._commitOnVisibilityChangeHidden!==false;if(shouldCommitOnVisibilityChange){document.addEventListener("visibilitychange",this.onVisibilityChange)}$(window).on("beforeunload unload",this.endSession)}async saveSessionState(){const isMidRender=!Adapt$1.parentView?.model.get("_isReady");if(isMidRender)return this.debouncedSaveSession();const courseState=SCORMSuspendData.serialize([Boolean(Adapt$1.course.get("_isComplete")),Boolean(Adapt$1.course.get("_isAssessmentPassed"))]);const componentStates=await this._componentSerializer?.serialize(this._shouldStoreResponses,this._shouldStoreAttempts);const sessionPairs={c:courseState,q:componentStates};offlineStorage$1.set(sessionPairs);this.printCompletionInformation(sessionPairs)}printCompletionInformation(suspendData){if(typeof suspendData==="string"){suspendData=JSON.parse(suspendData)}const courseState=SCORMSuspendData.deserialize(suspendData.c);const courseComplete=courseState[0];const assessmentPassed=courseState[1];const trackingIdModels=data$1.filter(model=>model.get("_type")===this._trackingIdType&&model.has("_trackingId"));const trackingIds=trackingIdModels.map(model=>model.get("_trackingId"));if(!trackingIds.length){logging$1.info(`course._isComplete: ${courseComplete}, course._isAssessmentPassed: ${assessmentPassed}, ${this._trackingIdType} completion: no tracking ids found`);return}const completionData=SCORMSuspendData.deserialize(suspendData.q);const max=Math.max(...completionData.map(item=>item[0][0]));const shouldStoreResponses=completionData[0].length===3;const completionString=completionData.reduce((markers,item)=>{const trackingId=item[0][0];const isComplete=shouldStoreResponses?item[2][1][0]:item[1][0];const mark=isComplete?"1":"0";markers[trackingId]=markers[trackingId]==="-"||markers[trackingId]==="1"?mark:"0";return markers},new Array(max+1).join("-").split("")).join("");logging$1.info(`course._isComplete: ${courseComplete}, course._isAssessmentPassed: ${assessmentPassed}, ${this._trackingIdType} completion: ${completionString}`)}onLanguageChanged(){const config=Adapt$1.spoor.config;if(config?._reporting?._resetStatusOnLanguageChange!==true)return;offlineStorage$1.set("status","incomplete")}onVisibilityChange(){if(document.visibilityState==="hidden")this.scorm.commit()}onQuestionRecordInteraction(questionView){if(!this._shouldRecordInteractions)return;const questionModel=questionView.model;const responseType=questionModel.getResponseType?questionModel.getResponseType():questionView.getResponseType();if(_.isEmpty(responseType))return;const id=questionModel.get("_id");const response=questionModel.getResponse?questionModel.getResponse():questionView.getResponse();const result=questionModel.isCorrect?questionModel.isCorrect():questionView.isCorrect();const latency=questionModel.getLatency?questionModel.getLatency():questionView.getLatency();offlineStorage$1.set("interaction",id,response,result,latency,responseType)}onTrackingComplete(completionData){const config=Adapt$1.spoor.config;this.saveSessionState();let completionStatus=completionData.status.asLowerCase;switch(completionData.status){case COMPLETION_STATE$1.COMPLETED:case COMPLETION_STATE$1.PASSED:{if(!config?._reporting?._onTrackingCriteriaMet){logging$1.warn(`No value defined for '_onTrackingCriteriaMet', so defaulting to '${completionStatus}'`)}else{completionStatus=config._reporting._onTrackingCriteriaMet}break}case COMPLETION_STATE$1.FAILED:{if(!config?._reporting?._onAssessmentFailure){logging$1.warn(`No value defined for '_onAssessmentFailure', so defaulting to '${completionStatus}'`)}else{completionStatus=config._reporting._onAssessmentFailure}}}offlineStorage$1.set("status",completionStatus)}endSession(){if(!this.scorm.finishCalled){this.scorm.finish()}this.removeEventListeners()}removeEventListeners(){$(window).off("beforeunload unload",this.endSession);document.removeEventListener("visibilitychange",this.onVisibilityChange);this.stopListening()}});var OfflineStorage=__AMD("extensions/adapt-contrib-spoor/js/adapt-offlineStorage-scorm",class OfflineStorageScorm extends Backbone.Controller{initialize(statefulSession){this.offlineStorage=offlineStorage$1;this.scorm=ScormWrapper$1.getInstance();this.statefulSession=statefulSession;this.temporaryStore={};this.suspendDataStore={};this.suspendDataRestored=false;offlineStorage$1.initialize(this)}save(){this.statefulSession.saveSessionState();this.scorm.commit()}serialize(){return SCORMSuspendData.serialize(...arguments)}deserialize(){return SCORMSuspendData.deserialize(...arguments)}get(name){if(name===undefined){if(this.useTemporaryStore())return this.temporaryStore;this.suspendDataStore=this.getCustomStates();const data=Object.assign(_.clone(this.suspendDataStore),{location:this.scorm.getLessonLocation(),score:this.scorm.getScore(),status:this.scorm.getStatus(),student:this.scorm.getStudentName(),learnerInfo:this.getLearnerInfo()});this.suspendDataRestored=true;return data}if(this.useTemporaryStore())return this.temporaryStore[name];let courseState;switch(name.toLowerCase()){case"location":return this.scorm.getLessonLocation();case"score":return this.scorm.getScore();case"status":return this.scorm.getStatus();case"student":return this.scorm.getStudentName();case"learnerinfo":return this.getLearnerInfo();case"coursestate":{courseState=this.getCustomState("c");const stateArray=courseState&&SCORMSuspendData.deserialize(courseState)||[];return{_isCourseComplete:Boolean(stateArray.slice(0,1).map(Number)[0]),_isAssessmentPassed:Boolean(stateArray.slice(1,2).map(Number)[0]),completion:stateArray.slice(2).map(Number).map(String).join("")||""}}case"completion":courseState=this.getCustomState("c");return courseState&&SCORMSuspendData.deserialize(courseState).slice(2).map(Number).map(String).join("")||"";case"_iscoursecomplete":courseState=this.getCustomState("c");return Boolean(courseState&&SCORMSuspendData.deserialize(courseState).slice(0,1).map(Number)[0]);case"_isassessmentpassed":courseState=this.getCustomState("c");return Boolean(courseState&&SCORMSuspendData.deserialize(courseState).slice(1,2).map(Number)[0]);case"questions":{const questionsState=this.getCustomState("q");return questionsState||""}default:return this.getCustomState(name);}}set(name,value){const args=[...arguments].slice(1);const isObject=typeof name==="object";if(isObject){value=name;name="suspendData"}if(this.useTemporaryStore()){if(isObject){Object.assign(this.temporaryStore,value)}else{this.temporaryStore[name]=value}return true}switch(name.toLowerCase()){case"interaction":return this.scorm.recordInteraction(...args);case"location":return this.scorm.setLessonLocation(...args);case"score":return this.scorm.setScore(...args);case"status":return this.scorm.setStatus(...args);case"student":case"learnerinfo":return false;case"lang":this.scorm.setLanguage(value);break;}if(isObject){Object.assign(this.suspendDataStore,value)}else{this.suspendDataStore[name]=value}const dataAsString=JSON.stringify(this.suspendDataStore);return this.suspendDataRestored?this.scorm.setSuspendData(dataAsString):false}clear(){this.temporaryStore={};this.suspendDataStore={};const dataAsString=JSON.stringify(this.suspendDataStore);this.scorm.setSuspendData(dataAsString)}getCustomStates(){const isSuspendDataStoreEmpty=_.isEmpty(this.suspendDataStore);if(!isSuspendDataStoreEmpty&&this.suspendDataRestored){return _.clone(this.suspendDataStore)}const dataAsString=this.scorm.getSuspendData();if(dataAsString===""||dataAsString===" "||dataAsString===undefined){return{}}const dataAsJSON=JSON.parse(dataAsString);if(!isSuspendDataStoreEmpty&&!this.suspendDataRestored){Object.assign(dataAsJSON,this.suspendDataStore)}return dataAsJSON}getCustomState(name){const dataAsJSON=this.getCustomStates();return dataAsJSON[name]}useTemporaryStore(){const cfg=Adapt$1.config.get("_spoor");if(!this.scorm.lmsConnected||cfg?._isEnabled===false)return true;return false}getLearnerInfo(){const id=this.scorm.getStudentId();let name=this.scorm.getStudentName();let firstname="";let lastname="";let hasName=name&&name!=="undefined";const isNameCommaSeparated=hasName&&name.includes(",");const isNameSpaceSeparated=hasName&&name.includes(" ");hasName=hasName&&(isNameCommaSeparated||isNameSpaceSeparated);if(!hasName){console.log("SPOOR: LMS learner_name not in 'lastname, firstname' or 'firstname lastname' format");return{id,name,firstname,lastname}}const separator=isNameCommaSeparated?",":" ";const nameParts=name.split(separator);if(isNameCommaSeparated){nameParts.reverse()}[firstname,lastname]=nameParts.map(part=>part.trim());name=`${firstname} ${lastname}`;return{id,name,firstname,lastname}}});class Spoor extends Backbone.Controller{initialize(){this.config=null;this.scorm=ScormWrapper$1.getInstance();this.listenToOnce(Adapt$1,"offlineStorage:prepare",this._prepare)}_prepare(){this.config=Adapt$1.config.get("_spoor");if(!this.isEnabled){offlineStorage$1.setReadyStatus();return}this.statefulSession=new StatefulSession;this.offlineStorage=new OfflineStorage(this.statefulSession);offlineStorage$1.get();offlineStorage$1.setReadyStatus();require(["libraries/jquery.keycombo"],()=>{$.onKeyCombo([68,69,86],()=>{Adapt$1.spoor.scorm.showDebugWindow()})})}get isEnabled(){return this.config&&this.config._isEnabled}}Adapt$1.spoor=new Spoor;__AMD("extensions/adapt-contrib-spoor/js/adapt-contrib-spoor",Adapt$1.spoor);function _deepDefaults(original){for(var _len=arguments.length,defaultObjects=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){defaultObjects[_key-1]=arguments[_key]}defaultObjects.reverse();defaultObjects.forEach(defaults=>{const keyValuePairs=Object.entries(defaults);keyValuePairs.forEach(_ref=>{let[key,defaultValue]=_ref;const isRecursiveObject=typeof defaultValue==="object"&&!Array.isArray(defaultValue)&&defaultValue!==null;if(isRecursiveObject){original[key]=_deepDefaults(original[key]||{},defaultValue);return}const isValueAlreadySet=Object.prototype.hasOwnProperty.call(original,key);if(isValueAlreadySet)return;original[key]=defaultValue})});return original}const configDefaults={_isEnabled:false,_isInherited:false,_autoScroll:true,_scrollTo:"@block +1",_onChildren:false,_button:{_isEnabled:true,_isFullWidth:true,_autoHide:false,_hasIcon:false,_styleBeforeCompletion:"hidden",_styleAfterClick:"hidden",_component:"trickle-button",_className:"",text:"Continue",ariaLabel:"",startText:"",startAriaLabel:"",finalText:"",finalAriaLabel:""},_stepLocking:{_isEnabled:true,_isCompletionRequired:true,_isLockedOnRevisit:false}};function isModelArticleWithOnChildren(model){const type=model.get("_type");const trickleConfig=model.get("_trickle");return type==="article"&&trickleConfig?._onChildren!==false}function isModelBlockWithArticleNotChildren(model){const type=model.get("_type");const parentTrickleConfig=model.getParent()?.get("_trickle");return type==="block"&&parentTrickleConfig?._isEnabled===true&&parentTrickleConfig?._onChildren===false}function getModelConfigDefaults(model){const type=model.get("_type");const config={};_deepDefaults(config,configDefaults,{_onChildren:type==="article"});if(config._onChildren){config._button.startText=config._button.startText??"Begin";config._button.startAriaLabel=config._button.startAriaLabel??"";config._button.finalText=config._button.finalText??"Finish";config._button.finalAriaLabel=config._button.finalAriaLabel??""}if(config._button._isFullWidth){config._stepLocking._isEnabled=true}return config}function getModelInheritanceChain(configModel){if(!data$1.isReady)throw new Error("Trickle cannot resolve inheritance chains until data is ready");const type=configModel.get("_type");if(type==="block"){const parentModel=configModel.getParent();const parentConfig=parentModel.get("_trickle");const blockConfig=configModel.get("_trickle");const isParentEnabledNotOnChildren=parentConfig?._isEnabled&&parentConfig._onChildren===false;const isNoChildConfig=!blockConfig?._isEnabled;if(isParentEnabledNotOnChildren&&isNoChildConfig){return null}return[configModel,parentModel].filter(ancestor=>{const config=ancestor.get("_trickle");return config&&!config._isInherited})}if(type==="article"){return[configModel]}return null}function getModelConfig(model){const inheritance=getModelInheritanceChain(model);if(!inheritance?.length||isModelArticleWithOnChildren(model)||isModelBlockWithArticleNotChildren(model))return null;const config=$.extend(true,{},...inheritance.reverse().map((inheritModel,index,arr)=>{const isLast=index===arr.length-1;const defaults=isLast?getModelConfigDefaults(inheritModel):null;return $.extend(true,{},defaults,inheritModel.get("_trickle"))}));if(!config._isEnabled)return null;return config}function getModelContainer(model){const inheritance=getModelInheritanceChain(model);return inheritance?.find(inheritModel=>{const defaults=getModelConfigDefaults(inheritModel);const config=$.extend(true,{},defaults,inheritModel.get("_trickle"));return config._onChildren})}function getCompletionAttribute(){let model=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return getModelConfig(model)?._completionAttribute||Adapt$1.config.get("_trickle")?._completionAttribute||"_isComplete"}function checkApplyLocks(model){if(!data$1.isReady)return;const completionAttribute=getCompletionAttribute(model);if(!Object.prototype.hasOwnProperty.call(model.changed,completionAttribute))return;debouncedApplyLocks()}function applyLocks(){if(!data$1.isReady)return;const locks={};const modelsById={};const TrickleButtonModel=components$1.getModelClass("trickle-button");Adapt$1.course.getAllDescendantModels(true).filter(model=>model.get("_isAvailable")).forEach(siteModel=>{const trickleConfig=getModelConfig(siteModel);if(!isEnabled(siteModel,{trickleConfig}))return;const isModelLocked=isLocked(siteModel,{trickleConfig});const id=siteModel.get("_id");modelsById[id]=siteModel;locks[id]=locks[id]||false;const subsequentLockingModels=_getAncestorNextSiblings(siteModel);subsequentLockingModels.forEach((model,index)=>{const id=model.get("_id");const isButtonModel=model instanceof TrickleButtonModel;model.set("_isTrickled",!isButtonModel);modelsById[id]=model;locks[id]=locks[id]||isModelLocked;if(model.get("_lockType"))return;model.getAllDescendantModels().forEach(descendant=>{const descendantId=descendant.get("_id");modelsById[descendantId]=descendant;locks[descendantId]=locks[id]})})});Object.entries(locks).forEach(_ref2=>{let[id,isModelLocked]=_ref2;const model=modelsById[id];const wasLocked=model.get("_isLocked");if(wasLocked===isModelLocked)return;model.set("_isLocked",isModelLocked)})}function isEnabled(model){let{trickleConfig=getModelConfig(model)}=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return trickleConfig?._isEnabled===true}function isLocked(model){let{trickleConfig=getModelConfig(model)}=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const isStepLocked=Boolean(trickleConfig?._stepLocking?._isEnabled);if(!isStepLocked)return false;const isCompletionRequired=Boolean(trickleConfig?._stepLocking?._isCompletionRequired);const completionAttribute=getCompletionAttribute(model);if(!isCompletionRequired){const TrickleModel=components$1.getModelClass("trickle-button");const trickleButton=model.getAvailableChildModels().find(model=>model instanceof TrickleModel);const isTrickleButtonComplete=Boolean(trickleButton?.get(completionAttribute));return!isTrickleButtonComplete}const isModelLocked=!model?.get(completionAttribute)&&!model?.get("_isOptional");return isModelLocked}const debouncedApplyLocks=_.debounce(applyLocks,1);function _getAncestorNextSiblings(fromModel){if(!fromModel)return[];const allSiblings=fromModel.getParent().getAvailableChildModels();const subsequentSiblings=allSiblings.slice(allSiblings.findIndex(sibling=>sibling===fromModel)+1);const allAncestors=fromModel.getAncestorModels();const inPageAncestors=allAncestors.slice(0,allAncestors.findIndex(parent=>parent instanceof ContentObjectModel)+1);const subsequentInPageAncestors=[];inPageAncestors.slice(1).forEach((grandParent,previousIndex)=>{const parent=inPageAncestors[previousIndex];const allGrandParentChildren=grandParent.getAvailableChildModels();const subsequentAncestorSiblings=allGrandParentChildren.slice(allGrandParentChildren.findIndex(child=>child===parent)+1);subsequentInPageAncestors.push(...subsequentAncestorSiblings)});const subsequentContentObjectDescendantModels=subsequentSiblings.concat(subsequentInPageAncestors);return subsequentContentObjectDescendantModels}function addButtonComponents(){const TrickleButtonModel=components$1.getModelClass("trickle-button");let uid=0;data$1.forEach(buttonModelSite=>{if(buttonModelSite instanceof CourseModel$1)return;const trickleConfig=getModelConfig(buttonModelSite);if(!trickleConfig||!trickleConfig?._isEnabled||buttonModelSite.get("_isTrickleSiteConfigured"))return;buttonModelSite.set("_isTrickleSiteConfigured",true);const parentId=buttonModelSite.get("_id");const trickleButtonModel=new TrickleButtonModel({_id:`trickle-${uid++}`,_type:"component",_component:"trickle-button",_parentId:parentId,_isAvailable:true,_layout:"full",_trickle:{_isEnabled:true},_renderPosition:"outer-append",_isTrackable:false});trickleButtonModel.setupModel();buttonModelSite.getChildren().add(trickleButtonModel)})}function logTrickleState(){if(logging$1._config?._level!=="debug")return;if(!Adapt$1.parentView?.model?.isTypeGroup("page")){logging$1.debug("TRICKLE GLOBAL STATE");Adapt$1.course.getAllDescendantModels(true).filter(model=>model.get("_isAvailable")).forEach(model=>{const isLocked=model.get("_isLocked");const isTrickled=model.get("_isTrickled");logging$1.debug(`${" ".repeat(model.getAncestorModels().length)}${model.get("_type")} ${model.get("_id")} isLocked: ${isLocked} isTrickled: ${isTrickled}`)});return}logging$1.debug("TRICKLE STATE");Adapt$1.parentView.model.getAllDescendantModels(true).filter(model=>model.get("_isAvailable")).forEach(model=>{const isLocked=model.get("_isLocked");const isTrickled=model.get("_isTrickled");logging$1.debug(`${" ".repeat(model.getAncestorModels().length)}${model.get("_type")} ${model.get("_id")} isLocked: ${isLocked} isTrickled: ${isTrickled}`)})}__AMD("extensions/adapt-contrib-trickle/js/models",{_deepDefaults,configDefaults,getModelConfigDefaults,getModelInheritanceChain,getModelConfig,getModelContainer,getCompletionAttribute,checkApplyLocks,applyLocks,debouncedApplyLocks,_getAncestorNextSiblings,addButtonComponents,logTrickleState});class TrickleController extends Backbone.Controller{initialize(){this.checkIsFinished=_.debounce(this.checkIsFinished,1);this.listenTo(data$1,{ready:this.onDataReady})}async onDataReady(){const trickleConfig=Adapt$1.config.get("_trickle");if(trickleConfig?._isEnabled===false)return;this.setUpEventListeners();wait$1.for(done=>{addButtonComponents();applyLocks();done()})}setUpEventListeners(){this.listenTo(data$1,{"change:_isInteractionComplete change:_isComplete change:_isAvailable add remove":checkApplyLocks,"change:_isLocked":this.checkIsFinished});this.listenTo(Adapt$1,{"assessments:reset":this.onAssessmentReset,"contentObjectView:preRender":this.reset,"view:addChild":this.onAddChildView,"trickle:kill":this.kill})}onAssessmentReset(){const isMidRender=!Adapt$1.parentView?.model.get("_isReady");if(isMidRender)return applyLocks();debouncedApplyLocks()}get isStarted(){return Boolean(Adapt$1.parentView?.model.get("_isTrickleStarted"))}set isStarted(value){if(!Adapt$1.parentView)return;Adapt$1.parentView.model.set("_isTrickleStarted",value);if(!value)return;Adapt$1.trigger("trickle:started")}onAddChildView(event){if(this.isKilled)return;if(event.hasRequestChild)applyLocks();const isManagedByTrickleAndLocked=event.model.get("_isTrickled")&&event.model.get("_isLocked");if(!isManagedByTrickleAndLocked)return;event.stop()}get isTrickling(){const isTrickling=Adapt$1.parentView.model.getAllDescendantModels().some(model=>{return model.get("_isAvailable")&&model.get("_isTrickled")&&model.get("_isLocked")});return isTrickling}async continue(){applyLocks();await Adapt$1.parentView.addChildren();await Adapt$1.parentView.whenReady()}async scroll(fromModel){const trickleConfig=getModelConfig(fromModel);if(!trickleConfig?._isEnabled)return false;if(isModelArticleWithOnChildren(fromModel))return false;const isAutoScrollOff=!trickleConfig._autoScroll;const hasTrickleButton=trickleConfig._button._isEnabled;if(isAutoScrollOff&&!hasTrickleButton){return}const getScrollToId=()=>{const scrollTo=trickleConfig._scrollTo;const firstCharacter=scrollTo.substr(0,1);switch(firstCharacter){case"@":{const relativeModel=fromModel.findRelativeModel(scrollTo,{filter:model=>model.get("_isAvailable")});if(relativeModel===undefined)return;return relativeModel.get("_id")}case".":return scrollTo.substr(1,scrollTo.length-1);default:return scrollTo;}};let scrollToId=getScrollToId();if(scrollToId==="")return;const isDescendant=Adapt$1.parentView.model.getAllDescendantModels().some(model=>{return model.get("_id")===scrollToId});if(!isDescendant){applyLocks();const model=data$1.findById(scrollToId);const contentObject=model.isTypeGroup("contentobject")?model:model.findAncestor("contentobject");await router$1.navigateToElement(contentObject.get("_id"));scrollToId=getScrollToId();await router$1.navigateToElement(scrollToId);return}await Adapt$1.parentView.renderTo(scrollToId);if(hasTrickleButton){a11y$1.focusFirst($("."+scrollToId),{preventScroll:true})}if(isAutoScrollOff)return false;const duration=trickleConfig._scrollDuration||500;router$1.navigateToElement("."+scrollToId,{duration})}get isFinished(){if(!Adapt$1.parentView)return false;return Boolean(!this.isStarted||Adapt$1.parentView.model.get("_isTrickleFinished")||this.isKilled)}set isFinished(value){if(!Adapt$1.parentView)return;Adapt$1.parentView.model.set("_isTrickleFinished",value);if(!value)return;Adapt$1.trigger("trickle:finished")}checkIsFinished(){if(!this.isStarted)return;if(this.isKilled||this.isFinished)return;if(this.isTrickling)return;this.isFinished=true}async kill(){const TrickleModel=components$1.getModelClass("trickle-button");this.isKilled=true;Adapt$1.parentView.model.getAllDescendantModels().forEach(model=>{const isButtonModel=model instanceof TrickleModel;if(isButtonModel){model.setCompletionStatus()}if(!model.get("_isTrickled"))return;model.set("_isLocked",false)});await this.continue()}get isKilled(){if(!Adapt$1.parentView)return false;return!this.isStarted||Adapt$1.parentView.model.get("_isTrickleKilled")}set isKilled(value){if(!Adapt$1.parentView)return;Adapt$1.parentView.model.set("_isTrickleKilled",value);if(!value)return;Adapt$1.trigger("trickle:killed")}reset(){this.isKilled=false;if(!this.isTrickling){this.isStarted=false;this.isFinished=false;return}this.isStarted=true;this.isFinished=false}}var controller=__AMD("extensions/adapt-contrib-trickle/js/controller",new TrickleController);class TrickleButtonView extends ComponentView$1{className(){const config=getModelConfig(this.model.getParent());return["trickle",this.model.get("_id"),config._button._component,config._button._isFullWidth&&"is-full-width",config._button._className].filter(Boolean).join(" ")}events(){return{"click .js-trickle-btn":"onButtonClick"}}initialize(){this.openPopupCount=0;this.isAwaitingPopupClose=false;this.wasButtonClicked=false;this.model.calculateButtonText();this.calculateButtonState();this.setupEventListeners();this.render();if(!this.model.isEnabled()){this.setCompletionStatus()}_.defer(this.setReadyStatus.bind(this))}calculateButtonState(){const isDisabledByPopups=this.openPopupCount>0;this.model.calculateButtonState(isDisabledByPopups,this.wasButtonClicked)}render(){const data=this.model.toJSON();data._globals=Adapt$1.course.get("_globals");data._trickle=getModelConfig(this.model.getParent());this.$el.html(Handlebars.templates[TrickleButtonView.template](data))}setupEventListeners(){this.tryButtonAutoHide=this.tryButtonAutoHide.bind(this);const onParentComplete=this.onParentComplete.bind(this);this.onParentComplete=function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _.delay(()=>onParentComplete(...args),100)};this.listenTo(Adapt$1.parentView,"postRemove",this.onRemove);this.listenTo(Adapt$1,"trickle:killed",this.updateButtonState);if(this.model.isStepUnlocked()&&this.model.isFinished()){return}this.$el.on("onscreen",this.tryButtonAutoHide);this.listenTo(Adapt$1,{"popup:opened":this.onPopupOpened,"popup:closed":this.onPopupClosed});const parentModel=this.model.getParent();const completionAttribute=getCompletionAttribute(parentModel);this.listenTo(parentModel,{"change:_requireCompletionOf":this.onStepUnlocked,[`bubble:change:${completionAttribute}`]:this.onStepUnlocked,[`change:${completionAttribute}`]:this.onParentComplete})}onPopupOpened(){this.openPopupCount++;const shouldUserInteractWithButton=this.model.isStepUnlocked()&&!this.model.isFinished();if(!shouldUserInteractWithButton)return;this.updateButtonState()}async onPopupClosed(){this.openPopupCount--;if(this.openPopupCount)return;if(this.isAwaitingPopupClose){return this.finish()}const shouldUserInteractWithButton=this.model.isStepUnlocked()&&!this.model.isFinished();if(!shouldUserInteractWithButton)return;this.updateButtonState();await Adapt$1.parentView.addChildren()}updateButtonState(){this.calculateButtonState();const isButtonHidden=!(this.model.get("_isButtonVisible")&&!this.model.get("_isButtonAutoHidden"));this.$(".js-trickle-btn-container").toggleClass("u-display-none",isButtonHidden);const isButtonDisabled=this.model.get("_isButtonDisabled");const $button=this.$(".js-trickle-btn");const $ariaLabel=this.$(".aria-label");a11y$1.toggleEnabled($button,!isButtonDisabled);if(!isButtonDisabled){if(document.activeElement instanceof HTMLElement&&document.activeElement.isSameNode($ariaLabel[0])){a11y$1.focusNext($ariaLabel)}a11y$1.toggleAccessibleEnabled($ariaLabel,false)}const $buttonText=this.$(".js-trickle-btn-text");const text=this.model.get("buttonText");const ariaLabel=this.model.get("buttonAriaLabel");$buttonText.html(text);$button.attr("aria-label",ariaLabel)}async onStepUnlocked(event){if(event.value===false)return;_.defer(this.updateButtonState.bind(this))}async onButtonClick(){const wasComplete=this.model.get("_isComplete");this.model.setCompletionStatus();this.wasButtonClicked=true;const isStepLockingCompletionRequired=this.model.isStepLockingCompletionRequired();if(isStepLockingCompletionRequired&&!wasComplete)return;await this.continue()}async onParentComplete(model,value){if(!value)return;const parentModel=this.model.getParent();const completionAttribute=getCompletionAttribute(parentModel);this.stopListening(parentModel,{[`bubble:change:${completionAttribute}`]:this.onStepUnlocked,[`change:${completionAttribute}`]:this.onParentComplete});if(controller.isKilled)return;if(this.openPopupCount>0){this.isAwaitingPopupClose=true;return}await this.finish()}async finish(){this.stopListening(Adapt$1,{"popup:opened":this.onPopupOpened,"popup:closed":this.onPopupClosed});this.updateButtonState();const isStepLockingCompletionRequired=this.model.isStepLockingCompletionRequired();if(!isStepLockingCompletionRequired)return;await this.continue()}async continue(){const parent=this.model.getParent();await controller.continue();await controller.scroll(parent)}tryButtonAutoHide(){if(!this.model.get("_isButtonVisible"))return;const trickleConfig=getModelConfig(this.model.getParent());if(!trickleConfig._button._autoHide){this.model.set("_isButtonAutoHidden",false);return}const measurements=this.$el.onscreen();const isJustOffscreen=measurements.bottom>-100;const isButtonAutoHidden=!measurements.onscreen&&!isJustOffscreen;this.model.set("_isButtonAutoHidden",isButtonAutoHidden);this.updateButtonState()}onRemove(){this.$el.off("onscreen",this.tryButtonAutoHide);this.remove()}}TrickleButtonView.template="trickle-button";var TrickleButtonView$1=__AMD("extensions/adapt-contrib-trickle/js/TrickleButtonView",TrickleButtonView);var TrickleButtonModel=__AMD("extensions/adapt-contrib-trickle/js/TrickleButtonModel",class TrickleButtonModel extends ComponentModel$1{init(){super.init();if(!this.isStepComplete())return;this.setCompletionStatus()}isEnabled(){const trickleConfig=getModelConfig(this.getParent());const isEnabled=trickleConfig._isEnabled&&trickleConfig._button?._isEnabled;return isEnabled}isStepLocking(){const config=getModelConfig(this.getParent());const isStepLocking=config._stepLocking?._isEnabled;return isStepLocking}isStepLockingCompletionRequired(){const config=getModelConfig(this.getParent());const isStepLockingCompletionRequired=config._stepLocking&&config._stepLocking._isEnabled&&config._stepLocking._isCompletionRequired;return isStepLockingCompletionRequired}isStepUnlocked(){const parentModel=this.getParent();const completionAttribute=getCompletionAttribute(parentModel);const isCompletionBlocked=parentModel.get("_requireCompletionOf")===Number.POSITIVE_INFINITY;if(isCompletionBlocked)return;return this.getSiblings().every(sibling=>{if(sibling===this){return true}return sibling.get(completionAttribute)||sibling.get("_isOptional")||!sibling.get("_isAvailable")})}isStepComplete(){const parentModel=this.getParent();const completionAttribute=getCompletionAttribute(parentModel);const isParentComplete=parentModel.get(completionAttribute);return isParentComplete}isStepLockedOnRevisit(){const trickleConfig=getModelConfig(this.getParent());return Boolean(trickleConfig._stepLocking._isLockedOnRevisit)}isFinished(){const isStepUnlocked=this.isStepUnlocked();const isStepLockingCompletionRequired=this.isStepLockingCompletionRequired();const isButtonComplete=this.get("_isComplete");const isFinished=(isStepUnlocked||!isStepLockingCompletionRequired)&&isButtonComplete;return isFinished}isLastInContentObject(){const contentObject=this.findAncestor("contentobject");const allDescendants=contentObject.getAllDescendantModels(true);const lastDescendant=allDescendants[allDescendants.length-1];return this===lastDescendant}calculateButtonText(){const parentModel=this.getParent();const trickleConfig=getModelConfig(parentModel);let isStart=false;let isFinal=false;if(trickleConfig._onChildren){const parentId=parentModel.get("_id");const trickleParent=getModelContainer(parentModel);const trickleSiblings=trickleParent.getAllDescendantModels(true).filter(model=>{return model.get("_isAvailable")&&model.get("_isTrickled")});const index=trickleSiblings.findIndex(model=>model.get("_id")===parentId);isStart=index===0;isFinal=index===trickleSiblings.length-1&&!trickleParent.get("_canRequestChild")}const text=isStart&&trickleConfig._button.startText?trickleConfig._button.startText:isFinal&&trickleConfig._button.finalText?trickleConfig._button.finalText:trickleConfig._button.text;const ariaLabel=isStart&&trickleConfig._button.startAriaLabel?trickleConfig._button.startAriaLabel:isFinal&&trickleConfig._button.finalAriaLabel?trickleConfig._button.finalAriaLabel:trickleConfig._button.ariaLabel;this.set({buttonText:text,buttonAriaLabel:ariaLabel})}checkIfResetOnRevisit(){if(this.isFinished()&&!this.isStepLockedOnRevisit())return;this.set({_isComplete:false,_isInteractionComplete:false});applyLocks()}calculateButtonState(){let isButtonDisableForced=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;let isButtonHiddenForced=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!this.isEnabled()){this.set({_isButtonVisible:false,_isButtonDisabled:!this.isStepUnlocked()});return}const trickleConfig=getModelConfig(this.getParent());if(this.isLastInContentObject()&&trickleConfig._button._showEndOfPage===false){return this.set({_isButtonVisible:false,_isButtonDisabled:true})}const isTrickleKilled=controller.isKilled;const isStepUnlocked=this.isStepUnlocked()||isTrickleKilled;const isFinished=this.isFinished()||isTrickleKilled;const isButtonVisibleBeforeCompletion=trickleConfig._button._styleBeforeCompletion!=="hidden";const isButtonVisibleAfterCompletion=trickleConfig._button._styleAfterClick!=="hidden"&&!trickleConfig._button._isFullWidth;const isStepLockingCompletionRequired=this.isStepLockingCompletionRequired();const isNoCompletionRequiredAndLockedVisible=!isStepLockingCompletionRequired&&!isFinished&&isButtonVisibleBeforeCompletion;const isNoCompletionRequiredAndUnlockedVisible=!isStepLockingCompletionRequired&&isStepUnlocked&&!isFinished;const isNoCompletionRequiredAndFinishedVisible=!isStepLockingCompletionRequired&&isFinished&&isButtonVisibleAfterCompletion;const isStepLockedAndVisibleBeforeCompletion=isStepLockingCompletionRequired&&!isStepUnlocked&&isButtonVisibleBeforeCompletion&&!isButtonHiddenForced;const isFinishedAndVisibleAfterCompletion=isStepLockingCompletionRequired&&isFinished&&isButtonVisibleAfterCompletion;const isStepUnlockedAndButtonIncomplete=isStepLockingCompletionRequired&&isStepUnlocked&&!isFinished;const isButtonVisible=isNoCompletionRequiredAndLockedVisible||isNoCompletionRequiredAndUnlockedVisible||isNoCompletionRequiredAndFinishedVisible||isStepLockedAndVisibleBeforeCompletion||isFinishedAndVisibleAfterCompletion||isStepUnlockedAndButtonIncomplete;const isButtonEnabledBeforeCompletion=trickleConfig._button._styleBeforeCompletion!=="disabled";const isButtonEnabledAfterCompletion=trickleConfig._button._styleAfterClick!=="disabled";const isNoCompletionRequiredAndLockedEnabled=!isStepLockingCompletionRequired&&!isFinished&&isButtonEnabledBeforeCompletion;const isNoCompletionRequiredAndUnlockedEnabled=!isStepLockingCompletionRequired&&isStepUnlocked&&!isFinished;const isNoCompletionRequiredAndFinishedEnabled=!isStepLockingCompletionRequired&&isFinished&&isButtonEnabledAfterCompletion;const isStepUnlockedAndButtonIncompleteWithoutButtonDisabledForced=isStepLockingCompletionRequired&&isStepUnlockedAndButtonIncomplete&&!isButtonDisableForced;const isFinishedAndEnabledAfterCompletion=isStepLockingCompletionRequired&&isFinished&&isButtonEnabledAfterCompletion;const isButtonEnabled=isNoCompletionRequiredAndLockedEnabled||isNoCompletionRequiredAndUnlockedEnabled||isNoCompletionRequiredAndFinishedEnabled||isStepUnlockedAndButtonIncompleteWithoutButtonDisabledForced||isFinishedAndEnabledAfterCompletion||false;this.set({_isButtonVisible:isButtonVisible,_isButtonDisabled:!isButtonEnabled})}});__AMD("extensions/adapt-contrib-trickle/js/trickleButton",components$1.register("trickle-button",{view:TrickleButtonView$1,model:TrickleButtonModel}));__AMD("extensions/adapt-contrib-trickle/js/adapt-contrib-trickle",Adapt$1.trickle=controller);class DownloadView extends Backbone.View{tagName(){return"span"}className(){let classes=["download"];return classes.join(" ")}events(){return{"click .js-download-tooltip":"onTooltipClick"}}initialize(){this.render()}render(){let template=Handlebars__default["default"].templates["ddDownload"];this.$el.html(new Handlebars__default["default"].SafeString(template(this.model.toJSON())).string)}onTooltipClick(){Adapt$1.createTooltip(this.$(".js-download-tooltip"),this.model.get("tooltip"))}}var DownloadView$1=__AMD("extensions/adapt-dd-download/js/downloadView",DownloadView);Adapt$1.on("router:page",()=>{Handlebars__default["default"].registerHelperEl("download",function(){let data=Handlebars__default["default"].getContextHash.apply(this,arguments);data._download=data.download;data._icon=data.icon||"download";if(Adapt$1.config.get("_isEpub")){var rAbsoluteURL=new RegExp("^(?:[a-z]+:)?//","i");if(!rAbsoluteURL.test(data.href)){let filePath;try{filePath=data.href.match(/^course[/\\](.+)?[/\\]downloads[/\\](.+)$/);filePath=filePath[2]}catch(err){throw"{{#download}} href property has invalid URL:\n\n"+data.href+"\n\nAll local downloadable files must be located in \"course/**/downloads/**."}const externalURL=Adapt$1.config.get("_download")?._externalMirrorURL;if(!externalURL)throw"config.json: _download._externalMirrorURL must be defined!";let pageModel=data.findById(location$1._currentId);let productionCode=pageModel.get("productionCode");let topicNum=pageModel.get("topicNum");if(productionCode===undefined)throw"\"productionCode\" must be defined in contentObjects.jsonsynt!";if(topicNum===undefined)throw"\"topicNum\" must be defined in contentObjects.jsonsynt!";data.href=externalURL+"/"+productionCode+"/"+productionCode+"."+topicNum+"/"+filePath;data._isExternal=true}}let modelJSON=_.extend({},data,{tooltip:data._isExternal?"Right-click and select \u2018Save link as...\u2019 to save this file to your device.":""});return new DownloadView$1({model:new Backbone.Model(modelJSON)}).$el})});class FigurePopupView extends Backbone.View{className(){let classes=["figure-popup",this.model.get("_classes")||""];return classes.join(" ")}events(){return{}}initialize(){this.setUpEventListeners();this.render()}setUpEventListeners(){this.listenToOnce(Adapt$1,"notify:opened",this.onOpened);this.listenToOnce(Adapt$1,"notify:closed",this.onClosed)}onOpened(){Adapt$1.scrollfix.disableA11yScroll()}onClosed(){this.$el.addClass("is-closed");Adapt$1.scrollfix.enableA11yScroll()}remove(){this.model.trigger("remove");super.remove()}render(){var data=this.model.toJSON();data.view=this;var template=Handlebars.templates["ddFigurePopup"];this.$el.html(template(data));_.delay(()=>{Handlebars.fixPlaceholders(this.$el)},50)}closePopup(){Adapt$1.trigger("notify:close")}}var FigurePopupView$1=__AMD("extensions/adapt-dd-figure/js/figurePopupView",FigurePopupView);const RESIZE_DEBOUNCE=100;class FigureItemView extends Backbone.View{events(){let e={};if(this.model.get("lightbox")){e["click"]="onLightboxClick"}return e}initialize(){this.render();this.setUpModelData();this.setupEventListeners();_.delay(this.postRender.bind(this),0);this.onResize=_.debounce(this.onResize.bind(this),RESIZE_DEBOUNCE)}setUpModelData(){this.setUpLightboxData();this.model.set("content",this.$(".js-figure-item-inner").html())}setupEventListeners(){this.$el.imageready(this.onResize.bind(this));this.listenTo(this.model,"change:_isTransformed",this.onTransformedChange)}onResize(){this.updateScaleDown();this.updateLightbox()}isLightboxEnabled(){return Boolean(this.model.get("lightbox")?._isEnabled)}isLightboxActive(){return Boolean(this.model.get("lightbox")?._isActive)}onTransformedChange(model,isTransformed){let lightbox=this.model.get("lightbox");if(!lightbox)return;lightbox._isActive=isTransformed;this.$el.toggleClass("lightbox-active",isTransformed)}setUpLightboxData(){let lightbox=this.model.get("lightbox");if(!lightbox)return;if(lightbox===true)lightbox={};this.model.set("lightbox",{_isEnabled:true,_width:!isNaN(lightbox)?lightbox:lightbox._width||"auto",_backgroundEnabled:lightbox.bg===false?false:true})}onLightboxClick(){if(!this.isLightboxActive())return;this.openLightbox()}openLightbox(){if(this._isPopupOpen)return;this._isPopupOpen=true;this.popupView=new FigurePopupView$1({model:this.model});Adapt$1.trigger("notify:popup",{_view:this.popupView,_isCancellable:true,_showCloseButton:true,_classes:"figure-lightbox dragscroll"});this.listenToOnce(Adapt$1,{"popup:closed":this.onLightboxClosed})}onLightboxClosed(){this._isPopupOpen=false}render(){let sizing=this.model.get("sizing");if(!sizing)return;if(typeof sizing=="string"&&/^\d+(\.\d+)?%$/.test(sizing)){this.$el.css("width",sizing);return}this.$el.addClass(Adapt$1.sizing.getSizingClass(sizing))}postRender(){if(!this.isLightboxEnabled()&&!this.model.get("scaleDown"))return;this._resizeObserver=new ResizeObserver(this.onResize.bind(this));this._resizeObserver.observe(this.$el[0])}updateScaleDown(){let scaleDown=this.model.get("scaleDown");if(!scaleDown)return;if(this.$el.is(":hidden"))return;let $item=this.$el;let $itemInner=this.$(".js-figure-item-inner");$item.css("height","");$itemInner.css("transform","");if(!isNaN(scaleDown)&scaleDown!==true){const maxContentWidth=Adapt$1.getMaxContentWidth();const w=maxContentWidth*((scaleDown||12)/12);$itemInner.css({"min-width":w})}let bb=$item[0].getBoundingClientRect();let bbInner=$itemInner[0].getBoundingClientRect();let xPadding=parseFloat($item.css("padding-left"),10)+parseFloat($item.css("padding-right"),10);let scale=(bb.width-xPadding)/bbInner.width;let isTransformed=scale<1;this.model.set("_isTransformed",isTransformed);this.$el.toggleClass("is-transformed",isTransformed);if(!isTransformed)return;$itemInner.css("transform",`scale(${scale})`);let yPadding=parseFloat($item.css("padding-top"),10)+parseFloat($item.css("padding-bottom"),10);$item.css("height",bbInner.height*scale+yPadding)}updateLightbox(){}}var FigureItemView$1=__AMD("extensions/adapt-dd-figure/js/figureItemView",FigureItemView);function renderFigureItem(){let data=Handlebars__default["default"].getContextHash.apply(this,arguments);if(data.scrolling===undefined)data.scrolling=false;if(data.scaledown||data.scaleDown){data.scrolling=false;data.scaleDown=data.scaledown||data.scaleDown}if(data.lightbox){data.scrolling=false;data.scaleDown=true;data.lightbox=data.lightbox}let d={scaleDown:data.scaleDown,lightbox:data.lightbox,scrolling:data.scrolling,caption:data.caption,sizing:data.sizing,stack:Boolean(data.stack)};data.data=JSON.stringify(d);let html=Handlebars__default["default"].templates["ddFigureItem"](data);return new Handlebars__default["default"].SafeString(html)}Handlebars__default["default"].registerHelper("item",renderFigureItem);Handlebars__default["default"].registerHelper("figureItem",renderFigureItem);Handlebars__default["default"].registerHelper("figureitem",renderFigureItem);function renderFigureText(){let data=Handlebars__default["default"].getContextHash.apply(this,arguments);if(data.sizing)data.sizing=Adapt$1.sizing.getSizingClass(data.sizing);let html=Handlebars__default["default"].templates["ddFigureText"](data);return new Handlebars__default["default"].SafeString(html)}Handlebars__default["default"].registerHelper("figureText",renderFigureText);Handlebars__default["default"].registerHelper("figuretext",renderFigureText);function renderBr(){let data=Handlebars__default["default"].getContextHash.apply(this,arguments);let html=Handlebars__default["default"].templates["ddFigureBr"](data);return new Handlebars__default["default"].SafeString(html)}Handlebars__default["default"].registerHelper("br",renderBr);class FigureView extends Backbone.View{className(){let classes=["figure",this.model.get("class")||"",this.model.get("reverse")?"is-reverse":"",this.model.get("align")?"align-"+this.model.get("align"):"",this.model.get("justify")?"justify-"+this.model.get("justify"):"",this.model.get("wrap")===false?"no-wrap":"",this.model.get("mode")?"is-mode-"+this.model.get("mode"):"",this.model.get("theme")?"theme-"+this.model.get("theme"):""];let direction=this.model.get("direction");if(direction===undefined){direction=this.model.get("column")?"column":"row"}classes.push(`is-${direction}`);return classes.join(" ")}tagName(){return"figure"}attributes(){let attr={};if(this.model.get("style"))attr.style=this.model.get("style");if(this.model.get("name"))attr.name=this.model.get("name");return attr}initialize(){this.render();this.setupEventListeners()}setupEventListeners(){}render(){let template=Handlebars__default["default"].templates["ddFigure"];this.$el.html(new Handlebars__default["default"].SafeString(template(this.model.toJSON())).string);this.$(".js-figure-item").each((i,e)=>{let modelData={};try{modelData=JSON.parse($(e).attr("data-model"));$(e).removeAttr("data-model")}catch(err){modelData={}}modelData=_.extend({sizing:this.model.get("sizing")||"auto"},modelData,{_parent:this.model,_index:i});$(e).attr("data-index",i);new FigureItemView$1({model:new Backbone.Model(modelData),el:e})})}}var FigureView$1=__AMD("extensions/adapt-dd-figure/js/figureView",FigureView);class FigureModel extends Backbone.Model{initialize(){this.initCaption()}initCaption(){if(!this.get("caption"))return;this.set(Adapt$1.figure.createCaptionData(this.get("caption"),this.get("content")))}}var FigureModel$1=__AMD("extensions/adapt-dd-figure/js/figureModel",FigureModel);class Figure extends Backbone.Controller{initialize(){Adapt$1.on("router:page",this.onRouterPage)}onRouterPage(){Handlebars__default["default"].registerHelperEl("figure",function(){let context=arguments[arguments.length-1];let modelJSON=_.extend({},context.hash,{_parent:Handlebars__default["default"].getComponentModelFromContext(context),content:context.fn(this)});return new FigureView$1({model:new FigureModel$1(modelJSON)}).$el})}}let figure=new Figure;Adapt$1.figure=figure;Adapt$1.isPDFMode=function(){return Boolean(Adapt$1.pdf?._isEnabled)};Adapt$1.isEpubMode=function(){return Boolean(Adapt$1.epub?._isEnabled)};Adapt$1.isDebugEnabled=function(){return Boolean(Adapt$1.ddDebug?._isEnabled)};Adapt$1.numToWord=function(num){const NUMBERS=["one","two","three","four","five","six","seven","eight","nine","ten"];if(num>0&&num<=10)return NUMBERS[num-1];else return num+""};Adapt$1.lerp=function(a,b,p){return a+(b-a)*p};Adapt$1.seededRandom=function(seed){if(!seed||isNaN(seed))throw"Adapt.seededRandom: first parameter must be of type 'number'.";let x=Math.sin(seed++)*10000;return x-Math.floor(x)};let $maxContentWidth=$("<div class='js-ddglobal-maxcontentwidth'>");$("body").append($maxContentWidth);const MAX_CONTENT_WIDTH=$maxContentWidth.width();$maxContentWidth.remove();Adapt$1.getMaxContentWidth=function(){if(!MAX_CONTENT_WIDTH)throw`adapt-dd-global.js: MAX_CONTENT_WIDTH incorrectly calculated to be 0px.`;return MAX_CONTENT_WIDTH};$.fn.onUnhidden=function(callback){const HIDDEN_OBSERVER_DEBOUNCE=10;let $el=$(this);let closestEl=$el.closest(".component")[0];if(!closestEl)closestEl=$el.closest(".notify")[0];if(!closestEl){Adapt$1.log.error("$.fn.onUnhidden: Could not set up MutationObserver (could not find closest parent).",$el);return this}let observerCallback=_.debounce(()=>{$el.each((i,e)=>{let $e=$(e);let isHidden=$e.is(":hidden");let isUnhidden=$e.data("_isUnhidden");if(isHidden===!isUnhidden)return;$e.data("_isUnhidden",!isHidden);if(isHidden)return;callback.apply($e)})},HIDDEN_OBSERVER_DEBOUNCE);let unhiddenObserver=new MutationObserver(observerCallback);unhiddenObserver.observe(closestEl,{attributes:true,attributeFilter:["style","hidden","aria-expanded","class"],subtree:true});return this};requirejs.onError=function(err){if(err.requireType==="timeout"){if(Adapt$1.ddLoading){Adapt$1.ddLoading.showError("Load timeout.")}throw err}else{throw err}};class Global extends Backbone.Controller{initialize(){Adapt$1.on({"app:dataReady":this.onDataReady})}onDataReady(){return}}new Global;const helperElAttr="data-registerhelperel-id";let helperElData={};Handlebars__default["default"].getContextHash=function(args){let context=arguments[arguments.length-1];context.hash=_.mapObject(context.hash,(val,key)=>{if(val===undefined)return false;if(val[0]=="{"&&val[val.length-1]=="}"){const SQUOT_PLACEHOLDER="@@!_S_!@@";const DQUOT_PLACEHOLDER="@@!_D_!@@";val=val.replace(/([^\\]\\(?:\\{2})*)(['"])/g,(match,$1,$2)=>{return $1+($2==="'"?SQUOT_PLACEHOLDER:DQUOT_PLACEHOLDER)});let regex=new RegExp(/(['"]?)([\w-]*)(\1)\s*?:\s*?((['"]).*?(\5)|(\w+))/g);val=val.replace(regex,(match,$1,$2,$3,$4)=>{if(!$1)return`'${$2}': ${$4}`;$4=$4.replace(new RegExp(SQUOT_PLACEHOLDER,"g"),"'");$4=$4.replace(new RegExp(DQUOT_PLACEHOLDER,"g"),"\"");return match})}if(val[0]=="{"&&val[val.length-1]=="}"||val[0]=="["&&val[val.length-1]=="]"){try{val=val.replace(/[']/g,"\"");return JSON.parse(val)}catch(err){throw"adapt-dd-helpers could not parse string as JSON: "+val}}return val});context.hash.content=context.fn?context.fn(this):"";return context.hash};var helpers$3={concat:function(){var arg=Array.prototype.slice.call(arguments,0);arg.pop();return arg.join("")},theme:function(themeStr){return Handlebars__default["default"].getThemeStr(themeStr)},error:function(){let data=Handlebars__default["default"].getContextHash.apply(this,arguments);Adapt$1.log.error(data.content);return`<span class='dd-error'><strong>ERROR:</strong> ${data.content}</span>`}};for(var name$3 in helpers$3){if(helpers$3.hasOwnProperty(name$3)){Handlebars__default["default"].registerHelper(name$3,helpers$3[name$3])}}let registeredHelperEls=[];function observePlaceholderRender(placeholderAttrId,el,callback){helperElData[placeholderAttrId]=el;let mutationObserver;const OBSERVER_TIMEOUT=1000;let observerTimeout=setTimeout(()=>{let $placeholder=$("["+helperElAttr+"='"+placeholderAttrId+"']");if($placeholder.length){Adapt$1.log.error("registerHelperEl: Could not be rendered into its placeholder element: ["+helperElAttr+"='"+placeholderAttrId+"']\nMutationObserver could not detect the placeholder being rendered.",$placeholder)}else{Adapt$1.log.warnOnce("registerHelperEl: One or more could not be rendered into their placeholder elements.\nThis was likely caused by the placeholder being incorrectly rendered as an attribute value.")}mutationObserver.disconnect()},OBSERVER_TIMEOUT);mutationObserver=new MutationObserver(mutations=>{_.each(mutations,mutation=>{if(mutation.type!="childList")return;_.find(mutation.addedNodes,node=>{if(!node)return;let placeholderEl;try{placeholderEl=node.querySelector("["+helperElAttr+"='"+placeholderAttrId+"']");if(!placeholderEl){if(node.getAttribute(helperElAttr)==placeholderAttrId){placeholderEl=node}}}catch(err){placeholderEl=false}if(placeholderEl){clearTimeout(observerTimeout);mutationObserver.disconnect();let $el=$(el);$(placeholderEl).replaceWith($el);if(callback){callback($el)}return true}})})});mutationObserver.observe($("body")[0],{childList:true,subtree:true})}Handlebars__default["default"].fixPlaceholders=$parentEl=>{let $placeholders=$parentEl.find(".registerhelperel__placeholder");$placeholders.each((i,e)=>{let id=$(e).data("registerhelperel-id");$(e).replaceWith(helperElData[id].clone())})};Handlebars__default["default"].registerHelperEl=(helperName,helperCallback,postRenderCallback)=>{if(_.includes(registeredHelperEls,helperName))return;if(!helperCallback)throw"helperCallback must be defined";Handlebars__default["default"].registerHelper(helperName,function(){let el=helperCallback.apply(this,Array.prototype.slice.call(arguments));if(typeof el==="string")return el;if(el instanceof Handlebars__default["default"].SafeString)return el;helperName=helperName.toLowerCase();let _uniqueId=_.uniqueId(helperName);let placeholderHTML=`<span class="registerhelperel__placeholder" ${helperElAttr}="${_uniqueId}">PLACEHOLDER(${helperName})</span>`;observePlaceholderRender(_uniqueId,el,postRenderCallback);return placeholderHTML})};Handlebars__default["default"].getComponentModelFromContext=helperContext=>{let componentData=helperContext.data.root;let model;let isComponentModel=m=>{try{if(m instanceof ComponentModel$1||m.get("_type")==="component"){return true}}catch(err){return false}return false};try{model=componentData.view.model;if(isComponentModel(model))return model}catch(err){model=componentData}const errMsg=`Could not find ComponentModel from provided Handlebars Helper context.
See the array below for the ancestors ("_parent"s) that were traversed.`;let path=[];do{try{path.push(model);if(model instanceof Backbone.Model){if(isComponentModel(model))break;model=model.getParent?.apply(model)||model.get("_parent")}else{if(isComponentModel(model.model)){model=model.model;break}model=model._parent}}catch{Adapt$1.log.error(errMsg,path);throw""}}while(Boolean(model));if(!model){Adapt$1.log.error(errMsg,path);throw""}return model};Handlebars__default["default"].getThemeStr=function(themeStr){if(!themeStr)return"";return themeStr.split(" ").map(classname=>{return`theme-${classname}`}).join(" ")};Handlebars__default["default"].getBlockModelFromContext=helperContext=>{let componentModel=Handlebars__default["default"].getComponentModelFromContext(helperContext);return componentModel.get("_parent")};var helpers$2={hyperlink:function(){let data=Handlebars__default["default"].getContextHash.apply(this,arguments);data.content=data.content.trim();const breakAll=Boolean(data.content.match(/[^\s]{20}/g));data._breakAll=breakAll;let html=Handlebars__default["default"].templates["ddHyperlink"](data);return new Handlebars__default["default"].SafeString(html)}};for(var name$2 in helpers$2){if(helpers$2.hasOwnProperty(name$2)){Handlebars__default["default"].registerHelper(name$2,helpers$2[name$2])}}class ImgPopupView extends Backbone.View{className(){let classes=["ddimg-popup",this.model.get("_classes")||""];return classes.join(" ")}events(){return{}}initialize(){this.setUpImgClasses();this.render();this.setUpEventListeners()}onClickNegative(event){if($(event.target).closest(this.$el[0]).length>0)return;this.closePopup()}setUpImgClasses(){let lightbox=this.model.get("lightbox");let classes=["ddimg-popup__img","ddimg-popup__size-"+lightbox._width,lightbox._backgroundEnabled?"has-bg":""];this.model.set("_imgClasses",classes.join(" "))}setUpEventListeners(){this.listenToOnce(Adapt$1,"notify:opened",this.onOpened);this.listenToOnce(Adapt$1,"notify:closed",this.onClosed);_.delay(()=>{this.$el.closest(".notify__popup").on("click",this.onClickNegative.bind(this))},0)}onOpened(){Adapt$1.scrollfix.disableA11yScroll()}onClosed(){this.$el.addClass("is-closed");Adapt$1.scrollfix.enableA11yScroll()}remove(){this.model.trigger("remove");super.remove()}render(){var data=this.model.toJSON();data.view=this;var template=Handlebars.templates["ddImgPopup"];this.$el.html(template(data))}closePopup(){Adapt$1.trigger("notify:close")}}var ImgPopupView$1=__AMD("extensions/adapt-dd-img/js/imgPopupView",ImgPopupView);class ImgView extends Backbone.View{className(){let classes=["ddimg",this.model.get("content").trim().length?"has-content":"",this.model.get("lightbox")?"has-lightbox":"",this.model.get("_widthAuto")?"is-auto-width":"",this.model.get("class")||"",this.model.get("sizing")||"",this.model.get("theme")||""];return classes.join(" ")}attributes(){return{id:this.model.get("_id"),name:this.model.get("name")||undefined,style:this.model.get("style")||undefined}}events(){let _events={};if(this.model.get("lightbox")){_events["click .js-ddimg-click"]="onImgClick"}return _events}initialize(){this.setUpModelData();this.render();this.setUpEventListeners()}setUpModelData(){this.setUpLightboxData()}setUpEventListeners(){let $img=this.$(".js-ddimg-img");$img.on("error",()=>{this.$el.addClass("has-error");$img.addClass("has-error")})}setUpLightboxData(){let lightbox=this.model.get("lightbox");if(!lightbox)return;this.model.set("lightbox",{_isEnabled:true,_width:!isNaN(lightbox)?lightbox:lightbox._width||"auto",_backgroundEnabled:Boolean(lightbox.bg)})}render(){let template=Handlebars__default["default"].templates["ddImg"];this.$el.html(new Handlebars__default["default"].SafeString(template(this.model.toJSON())).string)}onImgClick(event){event.stopPropagation();this.openLightbox()}openLightbox(){if(!this.model.get("lightbox"))return;if(this._isPopupOpen)return;this._isPopupOpen=true;this.popupView=new ImgPopupView$1({model:this.model});Adapt$1.trigger("notify:popup",{_view:this.popupView,_isCancellable:true,_showCloseButton:true,_classes:"ddimg-lightbox dragscroll"});this.listenToOnce(Adapt$1,{"popup:closed":this.onLightboxClosed})}onLightboxClosed(){this._isPopupOpen=false}}var ImgView$1=__AMD("extensions/adapt-dd-img/js/imgView",ImgView);const MAX_RESIZE_ATTEMPTS=5;const RESIZE_BUFFER=2;const RESIZE_OBSERVER_DEBOUNCE=100;class RespImgView extends ImgView$1{className(){let classes=super.className();return classes+" rimg"}initialize(){this.recalculate=_.debounce(this.recalculate.bind(this),RESIZE_OBSERVER_DEBOUNCE);this._fontSizeMulti=1;super.initialize()}_areItemsOverflowing(){let overflowing=false;let $items=this.$(".rimg__item");$items.each((i,e)=>{let $e=$(e);let bb=_.extend({},$e[0].getBoundingClientRect());let pTop=parseFloat($e.css("padding-top"),10);let pLeft=parseFloat($e.css("padding-left"),10);let pRight=parseFloat($e.css("padding-right"),10);let pBottom=parseFloat($e.css("padding-bottom"),10);bb.top+=pTop;bb.left+=pLeft;bb.width-=pLeft+pRight;bb.height-=pTop+pBottom;let bbInner=$e.find(".rimg__item-inner")[0].getBoundingClientRect();if(bb.top-bbInner.top>RESIZE_BUFFER||bb.left-bbInner.left>RESIZE_BUFFER||bbInner.bottom-bb.bottom>RESIZE_BUFFER||bbInner.right-bb.right>RESIZE_BUFFER){overflowing=$e;return false}});return overflowing}setUpRespImgEventListeners(){let observer=new MutationObserver(event=>{this._fontSizeMulti=1;this.recalculate();let attempts=MAX_RESIZE_ATTEMPTS;let $overflowingItem=null;do{$overflowingItem=this._areItemsOverflowing();if($overflowingItem){this._fontSizeMulti-=0.05;this.recalculate()}else{Adapt$1.log.info("RespImg: text resized after "+(MAX_RESIZE_ATTEMPTS-attempts)+" attempts.",this.$el);return}attempts--}while(attempts>0);Adapt$1.log.warn("RespImg: text resize was unsuccessful after "+MAX_RESIZE_ATTEMPTS+" attempts.",this.$el,$overflowingItem)});observer.observe(this.$(".rimg__inner")[0],{subtree:true,childList:true})}recalculate(){let width=this.$el.width();let svgWidth=this.model.get("_svgWidth")||1;let em=width/svgWidth*this._fontSizeMulti;this.$el.css("font-size",em+"px");$(".rimg__img").imageready(()=>{this.$el.addClass("is-ready")})}render(){let template=Handlebars__default["default"].templates["ddRespImg"];this.$el.html(new Handlebars__default["default"].SafeString(template(this.model.toJSON())).string);this.renderItems()}postRender(){let callback=this.recalculate.bind(this);this._resizeObserver=new ResizeObserver(callback);this._resizeObserver.observe(this.$el[0]);this.recalculate()}renderItems(){let jsonPath=this.model.get("src").replace(/\.svg$/,".json");$.ajax({dataType:"json",url:jsonPath,cache:true,success:data=>{this.model.set("_svgWidth",data._width);this.model.set("_svgHeight",data._height);let css=document.createElement("style");css.type="text/css";let styles="";_.each(data._styles,(props,className)=>{styles+="#"+this.model.get("_id")+" "+className+"{";_.each(props,(e,i)=>{styles+=i+":"+e+";"});styles+="} "});css.appendChild(document.createTextNode(styles));this.$el[0].appendChild(css);_.each(data._items,item=>{let $item=$("<div>");$item.addClass("rimg__item");$item.addClass("align-"+(item.align||"center"));$item.css({top:item.top+"%",left:item.left+"%",width:item.width+"%",height:item.height+"%",transform:item.transform});let $itemInner=$("<div>");$itemInner.attr("class",item.class).addClass("rimg__item-inner").html(item.html);this.$(".rimg__inner").append($item);$item.append($itemInner)});this.setUpRespImgEventListeners();this.postRender()},fail:()=>{throw"respImgView.js: Could not load \""+jsonPath+"\"."}})}}var RespImgView$1=__AMD("extensions/adapt-dd-img/js/respImgView",RespImgView);class ImgMapView extends Backbone.View{events(){let _events={};this.onClick=_.debounce(this.onClick.bind(this),0,true);this.onMouseMove=_.throttle(this.onMouseMove.bind(this),50);_events["click"]="onClick";{_events["mousemove"]="onMouseMove";_events["mouseleave"]="onMouseLeave"}return _events}initialize(){this.setUpModelData();this.render();this.setUpEventListeners()}setUpModelData(){}setUpEventListeners(){}render(){this.$el.addClass("ddimg-map");this.$(".btn-img").addClass("no-hover");this.$el.imageready(this.setupImgCanvas.bind(this))}_getContextBoundingBox(ctx,alphaThreshold){var w=ctx.canvas.width,h=ctx.canvas.height;var data=ctx.getImageData(0,0,w,h).data;let minX=w;let maxX=0;let minY=h;let maxY=0;for(let y=0;y<h;y++){for(let x=0;x<w;x++){if(data[y*w*4+x*4+3]){minX=Math.min(minX,x);maxX=Math.max(maxX,x);minY=Math.min(minY,y);maxY=y;x=maxX}}}return{x:minX,y:minY,maxX:maxX,maxY:maxY,w:maxX-minX,h:maxY-minY}}onCanvasPostRender($canvas,$img){let bb=this._getContextBoundingBox($canvas[0].getContext("2d"));$canvas.attr("data-bb",[bb.x,bb.y,bb.w,bb.h].join(","));let width=$img.width();let height=$img.height();$img.attr("data-bb",[bb.x/width,bb.y/height,bb.w/width,bb.h/height].join(","))}setupImgCanvas(){this._canvases={};let $imgs=this.$(".js-ddimg-img");$imgs.each((i,e)=>{let id=_.uniqueId("ddimg-map-");let $img=$(e);$img.attr("data-ddimg-map-id",id);let isSVG=$img.attr("src").split(".").pop().toLowerCase()==="svg";let width=$img.width();let height=$img.height();var $canvas=$("<canvas>");$canvas.attr("data-ddimg-map-id",id);$canvas.attr("width",width);$canvas.attr("height",height);this._canvases[id]=$canvas;var ctx=$canvas[0].getContext("2d");ctx.drawImage($img[0],0,0,width,height);if(isSVG){let src=$img.attr("src");require(["libraries/buffer/buffer.min"],Buffer=>{$.ajax({dataType:"xml",url:src,cache:true,success:data=>{let inlineSVG=data.getElementsByTagName("svg")[0];inlineSVG.setAttribute("width",width);inlineSVG.setAttribute("height",height);let str=new XMLSerializer().serializeToString(inlineSVG);let svg64=Buffer.Buffer.from(str,"utf8").toString("base64");let image64="data:image/svg+xml;base64,"+svg64;let img=new Image;img.src=image64;let _me=this;img.onload=function(){ctx.clearRect(0,0,width,height);ctx.drawImage(this,0,0,width,height);_me.onCanvasPostRender($canvas,$img)};img.onerror=function(err){console.log(err)}},error:(xhr,textStatus,errorThrown)=>{Adapt$1.log.error(xhr,textStatus,errorThrown)}})})}else{this.onCanvasPostRender($canvas,$img)}})}onClick(event){event.stopPropagation();event.preventDefault();let $img=this.$getImgAtPointer(event);if(!$img){return}$img.trigger("click")}onMouseMove(event){event.stopPropagation();event.preventDefault();let $img=this.$getImgAtPointer(event);if(!$img){this.$(".hover").removeClass("hover");this.$el.removeClass("hover");return}let $btnImg=$img.closest(".btn-img");$btnImg.addClass("hover");this.$el.addClass("hover");let $hover=this.$(".hover");$hover.each((i,e)=>{if(!$(e).is($btnImg))$(e).removeClass("hover")})}onMouseLeave(event){event.stopPropagation();event.preventDefault();this.$(".hover").removeClass("hover");this.$el.removeClass("hover")}$getImgAtPointer(event){let $imgs=this.$(".js-ddimg-img");let pageX=event.pageX||0;let pageY=event.pageY||0;pageX+=$(window).scrollLeft();pageY+=$(window).scrollTop();let $target=null;$imgs.each((i,e)=>{let $img=$(e);let id=$img.attr("data-ddimg-map-id");let x=pageX-$img.offset().left;let y=pageY-$img.offset().top;let width=$img.width();$img.height();var $canvas=this._canvases[id];let ratio=width/$canvas.attr("width");x/=ratio;y/=ratio;var ctx=$canvas[0].getContext("2d");let alpha=ctx.getImageData(x,y,1,1).data[3];if(Boolean(alpha)){$target=$img;return false}});return $target}}var ImgMapView$1=__AMD("extensions/adapt-dd-img/js/imgMapView",ImgMapView);class DDImg extends Backbone.Controller{initialize(){this.listenTo(Adapt$1,{"app:dataReady":this.onDataReady.bind(this)})}setupImgMap($container,options){new ImgMapView$1({model:new Backbone.Model(options),el:$container[0]})}getImgBoundingBox(imgEl){let bb=_.extend({},imgEl.getBoundingClientRect());let mapBB=$(imgEl).attr("data-bb");if(!mapBB){return bb}mapBB=mapBB.split(",").map(e=>{return parseFloat(e,10)});bb.left+=mapBB[0]*bb.width;bb.top+=mapBB[1]*bb.height;bb.width*=mapBB[2];bb.height*=mapBB[3];return bb}onDataReady(){Handlebars__default["default"].registerHelperEl("img",function(){let data=Handlebars__default["default"].getContextHash.apply(this,arguments);if(!data.src&&!data.body){throw`{{#img}}: either the "src" or "body" parameter must be defined.`}data._contain=data.contain===undefined?true:Boolean(data.contain);data.sizing=data.sizing?Adapt$1.sizing.getSizingClass(data.sizing):"";data.theme=(data.theme||"").split(" ").map(e=>{return"theme-"+e}).join(" ");data.mask=Boolean(data.mask);if(data.src){data.src=data.src.trim();data._widthAuto=Boolean(data.src.match(/\.svg$/i))?false:true;if(data.src.match(/--r\.svg$/)){let modelJSON=_.extend({},data,{_id:"rimg-"+_.uniqueId()});return new RespImgView$1({model:new Backbone.Model(modelJSON)}).$el}}let modelJSON=_.extend({},data,{_id:"ddimg-"+_.uniqueId()});return new ImgView$1({model:new Backbone.Model(modelJSON)}).$el})}}let ddImg=new DDImg;Adapt$1.ddImg=ddImg;const IDNAME="ddinput";class DDInputController extends Backbone.Controller{initialize(){this._views={};Adapt$1.on({"router:page":this.setupHelpers.bind(this)})}findViewByEl(el){return this._views[$(el).attr(`data-${IDNAME}-id`)]}findViewById(id){return this._views[id]}setupView(data){throw`ddInputController.js: setupView() must be implemented!`}getInputName(){throw`ddInputController.js: getInputName() must be implemented!`}setupHelpers(){let _this=this;Handlebars.registerHelperEl(this.getInputName(),function(){let context=arguments[arguments.length-1];let data=Handlebars.getContextHash.apply(this,arguments);let componentModel=Handlebars.getComponentModelFromContext(context);let id=___default["default"].uniqueId(IDNAME);data._id=id;data._parent=componentModel;let view=_this.setupView(data);if(_this._views[id]===undefined){_this._views[id]=view}else{Adapt$1.log.warning(`ddInputController: duplicate {{#${this.getInputName()}}} id detected: ${id}`)}view.$el.attr(`data-${IDNAME}-id`,id);return view.$el})}}var DDInputController$1=__AMD("extensions/adapt-dd-input/js/ddInputController",DDInputController);class DDInputModel extends Backbone__default["default"].Model{defaults(){return{_requireSubmit:true,_isCorrect:false,_isLocked:false,_isSubmitted:false}}submit(){throw`${this.constructor.name}: submit() must be implemented.`}showCorrectAnswer(){this.set("_isCorrectAnswerShown",true)}hideCorrectAnswer(){this.set("_isCorrectAnswerShown",false)}reset(){this.set("_isSubmitted",false);this.set("_isCorrect",false);this.set("_isLocked",false)}isCorrect(){return this.get("_isCorrect")}lock(){this.set("_isLocked",true)}unlock(){this.set("_isLocked",false)}enableRequireSubmit(){this.set("_requireSubmit",true)}isHintEnabled(){return!Adapt$1.quiz.isAssessmentMode()}syncProp(myPropName,syncModel,syncModelProp){let a=myPropName;let b=syncModelProp||myPropName;let logError=()=>{Adapt$1.log.error("ddInputModel.js: error when synchronizing property",`
this.get(${a}):         ${this.get(a)}
syncModel.get(${b}):    ${syncModel.get(b)}`)};this.listenTo(this,`change:${a}`,(model,propVal)=>{try{syncModel.set(b,propVal)}catch(err){logError();throw err}});this.listenTo(syncModel,`change:${b}`,(model,propVal)=>{try{this.set(a,propVal)}catch(err){logError();throw err}});this.set(a,syncModel.get(b))}}var DDInputModel$1=__AMD("extensions/adapt-dd-input/js/ddInputModel",DDInputModel);class InputBtnModel extends DDInputModel$1{defaults(){return{_isSelected:false,_shouldBeSelected:false,_isCorrect:false,_isLocked:false,_isSubmitted:false}}initialize(){this.setupEventListeners()}setupEventListeners(){this.listenTo(this,{"change:_isSelected":this.onSelectedChange})}onSelectedChange(model,isSelected){if(!isSelected)return;if(this.get("_type")!=="radio")return;this.get("_siblings").forEach(inputBtnModel=>{if(inputBtnModel!==this)inputBtnModel.toggle(false)})}toggle(val){if(val===undefined)this.set("_isSelected",!this.get("_isSelected"));else this.set("_isSelected",val)}submit(){this.set("_isCorrect",this.get("_isSelected")===this.get("_shouldBeSelected"));this.set("_isSubmitted",true);if(this.get("_isSelected"))this.set("_isVisited",true)}reset(){super.reset();this.set("_isSelected",false)}}var InputBtnModel$1=__AMD("extensions/adapt-dd-inputBtn/js/inputBtnModel",InputBtnModel);class DDInputView extends Backbone__default["default"].View{initialize(){this.listenTo(Adapt$1,"assessment:complete",this.updateState.bind(this));this.listenTo(this.model,{"change:_isCorrectAnswerShown":this.onCorrectAnswerShownChange})}updateState(){let isSubmitted=this.model.get("_isSubmitted");if(!isSubmitted){this.hideState();return}this.showState()}showState(){if(!this.model.get("_canShowFeedback")&&!Adapt$1.quiz.canShowFeedback(this.model.get("_parent")))return;let isCorrect=this.model.get("_isCorrect");let isIncorrect=this.model.get("_isIncorrect")===true||!isCorrect;this.$el.toggleClass("has-state",true).toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",isIncorrect)}hideState(){this.$el.removeClass("is-correct is-incorrect has-state")}onCorrectAnswerShownChange(model,isCorrectAnswerShown){const isCorrect=this.model.get("_isCorrect");this.$el.toggleClass("show-correct-answer",isCorrect?false:Boolean(isCorrectAnswerShown));if(isCorrectAnswerShown)this.showCorrectAnswer();else this.hideCorrectAnswer()}showCorrectAnswer(){throw`${this.constructor.name}: showCorrectAnswer() must be implemented.`}hideCorrectAnswer(){throw`${this.constructor.name}: hideCorrectAnswer() must be implemented.`}isCorrectAnswerShown(){return this.model.get("_isCorrectAnswerShown")}onInteractLocked(){let parent=this.model.get("_parent");if(!parent.get("_isQuestionType"))return;let parentView=data$1.findViewByModelId(parent.get("_id"));Adapt$1.trigger("questionView:interactLocked",parentView)}}var DDInputView$1=__AMD("extensions/adapt-dd-input/js/ddInputView",DDInputView);class InputBtnView extends DDInputView$1{className(){let className=["inputbtn",this.model.get("_class"),"js-ddstore-target"];return className.join(" ")}events(){return{"change .js-inputbtn-input":"onInputChange","click .js-inputbtn-label":"onLabelClick"}}initialize(){super.initialize();this.render();this.setupEventListeners()}render(){var data=this.model.toJSON();var template=Handlebars.templates["inputBtn"];this.$el.html(template(data))}setupEventListeners(){this.listenTo(this.model,{"change:_isSelected":this.onSelectedChange,"change:_isLocked":this.onLockedChange,"change:_isSubmitted":this.onSubmittedChange})}onSubmittedChange(model,isSubmitted){if(isSubmitted&&this.model.get("_isSelected")){this.model.set("_isVisited",true)}this.updateState()}showState(){if(this.model.get("_isVisited")){super.showState()}}onInputChange(event){if(this.isCorrectAnswerShown())return;let checked=$(event.currentTarget).is(":checked");this.model.set("_isSelected",checked)}onLabelClick(event){if(this.model.get("_isLocked")){this.onInteractLocked();return}return}toggle(val){if(val!==undefined)this.model.set("_isSelected",val);else this.model.set("_isSelected",!this.model.get("_isSelected"))}onSelectedChange(model,isSelected){this.$(".js-inputbtn-label").toggleClass("is-selected",isSelected);this.$(".js-inputbtn-input").prop("checked",isSelected);if(this.model.get("_isVisited")&&this.model.isHintEnabled()){this.showState()}}onLockedChange(model,isLocked){this.$el.toggleClass("is-locked",isLocked);this.$(".js-inputbtn-input").prop("disabled",isLocked)}showCorrectAnswer(){let $input=this.$(".js-inputbtn-input");$input.prop("disabled",true);if(this.model.get("_isSelected")){this.$el.removeClass("show-correct-answer")}const shouldBeSelected=this.model.get("_shouldBeSelected");this.$(".js-inputbtn-label").toggleClass("is-selected",shouldBeSelected);this.$el.toggleClass("is-correct",true).toggleClass("is-incorrect",false)}hideCorrectAnswer(){let $input=this.$(".js-inputfield-input");$input.prop("disabled",this.model.get("_isLocked"));this.$(".js-inputbtn-label").toggleClass("is-selected",this.model.get("_isSelected"));const isCorrect=this.model.get("_isCorrect");this.$el.toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",!isCorrect)}}var InputBtnView$1=__AMD("extensions/adapt-dd-inputBtn/js/inputBtnView",InputBtnView);class InputBtn extends DDInputController$1{initialize(){super.initialize();this._groups={}}getInputName(){return"inputBtn"}setupView(data){if(!data.name)throw`{{#${this.getInputName()}}}: "name" property must be defined!`;if(!data.type)throw`{{#${this.getInputName()}}}: "type" property must be defined!`;if(data.shouldBeSelected===undefined)data.shouldBeSelected=false;let name=`${data._parent.get("_id")}-${data.name}`;let modelJSON=___default["default"].extend({},data,{_name:name,_class:data.class,_type:data.type||"radio",key:data.key||undefined,_shouldBeSelected:data.shouldBeSelected,_isSelected:data.isSelected});let model=new InputBtnModel$1(modelJSON);if(this._groups[name]===undefined){this._groups[name]=[]}this._groups[name].push(model);model.set("_siblings",this._groups[name]);return new InputBtnView$1({model:model})}}let inputBtn=new InputBtn;Adapt$1.inputBtn=inputBtn;class DDDropdownModel extends DDInputModel$1{defaults(){return{_parent:null,_isRandom:false,_requireSubmit:true,_options:null,_optionsCorrect:null,_optionsSelected:null,placeholder:"",_isActive:false,_isCorrect:false,_isLocked:false,_isSubmitted:false}}initialize(){this.setupOptions();this.setupEventListeners()}setupOptions(){let optionsCorrect=this.get("_optionsCorrect");let options=[];this.get("_options").forEach((option,index)=>{options.push({text:option,_index:index,_isSelected:false,_shouldBeSelected:optionsCorrect.includes(index),_isVisited:false})});const isRandom=this.get("_isRandom");if(isRandom){if(isRandom===true)options=___default["default"].shuffle(options);else if(!isNaN(isRandom)){options.forEach((e,i)=>{e.__random=Adapt$1.seededRandom(isRandom+i)});options=___default["default"].sortBy(options,"__random")}}let collection=new Backbone__default["default"].Collection(options);this.set("_options",collection)}setupEventListeners(){this.listenTo(this.get("_options"),{"change:_isSelected":this.onOptionSelectedChange});this.listenTo(this,{"change:_optionsSelected":this.onMyOptionsSelectedChange})}getCorrectOption(){return this.get("_options").find(e=>{return e.get("_shouldBeSelected")})}getSelectedOption(){return this.get("_options").find(e=>{return e.get("_isSelected")})}onMyOptionsSelectedChange(model,optionsSelected){let options=this.get("_options");optionsSelected.forEach(optionIdx=>{let optionModel=options.find(e=>{return e.get("_index")===optionIdx});optionModel.set("_isSelected",true)})}onOptionSelectedChange(optionModel,isSelected){let optionsSelected=[];this.get("_options").forEach(optionModel=>{if(!optionModel.get("_isSelected"))return;optionsSelected.push(optionModel.get("_index"))});this.set("_optionsSelected",optionsSelected)}submit(){let incorrectCount=0;this.get("_options").forEach(optionModel=>{let isSelected=optionModel.get("_isSelected");let isCorrect=isSelected===optionModel.get("_shouldBeSelected");if(isSelected)optionModel.set("_isVisited",true);if(!isCorrect)incorrectCount++});this.set("_isCorrect",incorrectCount===0);this.set("_isSubmitted",true)}reset(){super.reset()}}var InputDropdownModel=__AMD("extensions/adapt-dd-inputDropdown/js/InputDropdownModel",DDDropdownModel);const CLICK_ANYWHERE_EVENTS="click touch mouseup touchend";class InputDropdownView extends DDInputView$1{className(){let className=["inputdropdown",this.model.get("_class"),this.model.get("_isAbsolute")?"is-absolute":"","js-ddstore-target"];return className.join(" ")}attributes(){return{}}events(){return{"click":"onClick","click .js-inputdropdown-dropdown-trigger":"onTriggerClick","click .js-inputdropdown-dropdown-option":"onOptionClick","change .js-inputdropdown-select":"onSelectChange"}}initialize(){super.initialize();this.render();this.setupEventListeners()}render(){var data=this.model.toJSON();data._options=data._options.toJSON();var template=Handlebars.templates["inputDropdown"];this.$el.html(template(data))}setupEventListeners(){this.listenTo(this.model,{"change:_isActive":this.onActiveChange,"change:_isLocked":this.onLockedChange,"change:_isSubmitted":this.onSubmittedChange});this.listenTo(this.model.get("_options"),{"change:_isSelected":this.onOptionSelectedChange})}onSubmittedChange(model,isSubmitted){this.updateState();if(isSubmitted&&this.model.isHintEnabled()){let options=this.model.get("_options");let $options=this.$(".js-inputdropdown-dropdown-option");options.each((optionModel,index)=>{if(!optionModel.get("_isVisited"))return;let shouldBeSelected=optionModel.get("_shouldBeSelected");let $option=$options.filter(`[data-value=${index}]`);$option.toggleClass("is-correct",shouldBeSelected).toggleClass("is-incorrect",!shouldBeSelected)})}}onLockedChange(model,isLocked){this.$el.toggleClass("is-locked",isLocked);let $select=this.$(".js-inputdropdown-select");if(isLocked)$select[0].disabled=true;else $select[0].disabled=false}onActiveChange(model,isActive){isActive=Boolean(isActive);this.$el.toggleClass("is-active",isActive);let $dropdown=this.$(".js-inputdropdown-dropdown");$dropdown.toggleClass("is-active",isActive);let $options=this.$(".js-inputdropdown-options");$(".page").first();let optionsBB=$options[0].getBoundingClientRect();$options.toggleClass("is-flipped-ver",optionsBB.top+optionsBB.height>window.innerHeight);$options.toggleClass("is-flipped-hoz",optionsBB.left+optionsBB.width>window.innerWidth);if(!isActive){$(document).off(CLICK_ANYWHERE_EVENTS,this.onClickAnywhereEvent);return}this.onClickAnywhereEvent=this.onClickAnywhere.bind(this);$(document).on(CLICK_ANYWHERE_EVENTS,this.onClickAnywhereEvent)}onTriggerClick(event){if(this.model.get("_isLocked")){return}this.model.set("_isActive",!this.model.get("_isActive"))}onClick(event){if(this.model.get("_isLocked")){this.onInteractLocked()}}onOptionClick(event){if(this.model.get("_isLocked")){return}let $option=$(event.currentTarget);let val=$option.attr("data-value");let options=this.model.get("_options");let optionModel=options.models[val];options.each(e=>{e.set("_isSelected",e==optionModel)});this.toggle(false)}onSelectChange(event){if(this.isCorrectAnswerShown())return;let index=parseInt($(event.currentTarget).val(),10);let options=this.model.get("_options");options.each((e,i)=>{e.set("_isSelected",i===index)})}toggle(isActive){if(isActive!==undefined)this.model.set("_isActive",isActive);else this.model.set("_isActive",!this.model.get("_isActive"))}updateMarking(){}onOptionSelectedChange(optionModel,isSelected){if(!isSelected)return;let index=this.model.get("_options").indexOf(optionModel);let $options=this.$(".js-inputdropdown-dropdown-option");let $option=$options.filter(`[data-value=${index}]`);$options.toggleClass("is-selected",false);$option.toggleClass("is-selected",true);let $triggerText=this.$(".js-inputdropdown-dropdown-trigger-text");$triggerText.html(optionModel.get("text")).attr("title",optionModel.get("text"));let $select=this.$(".js-inputdropdown-select");$select.val(index)}onClickAnywhere(event){if(event.target==this.el||$.contains(this.el,event.target))return;this.model.set("_isActive",false)}showCorrectAnswer(){let correctOption=this.model.getCorrectOption();let correctIndex=this.model.get("_options").indexOf(correctOption);let $select=this.$(".js-inputdropdown-select");let $triggerText=this.$(".js-inputdropdown-dropdown-trigger-text");$select.val(correctIndex).prop("disabled",true);$triggerText.html(correctOption.get("text")).attr("title",correctOption.get("text"));this.$el.toggleClass("is-correct",true).toggleClass("is-incorrect",false)}hideCorrectAnswer(){let selectedOption=this.model.getSelectedOption();let selectedIndex=this.model.get("_options").indexOf(selectedOption);let $select=this.$(".js-inputdropdown-select");let $triggerText=this.$(".js-inputdropdown-dropdown-trigger-text");$select.val(selectedIndex).prop("disabled",this.model.get("_isLocked"));$triggerText.html(selectedOption.get("text")).attr("title",selectedOption.get("text"));const isCorrect=this.model.get("_isCorrect");this.$el.toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",!isCorrect)}}var InputDropdownView$1=__AMD("extensions/adapt-dd-inputDropdown/js/InputDropdownView",InputDropdownView);class InputDropdown extends DDInputController$1{getInputName(){return"dropdown"}setupView(data){let modelJSON=___default["default"].extend({},data,{_class:data.class,placeholder:data.placeholder,_isRandom:data.isRandom,_isAbsolute:data.isAbsolute,_options:data.options,_optionsCorrect:data.optionsCorrect,_requireSubmit:data.requireSubmit||false});return new InputDropdownView$1({model:new InputDropdownModel(modelJSON)})}}let inputDropdown=new InputDropdown;Adapt$1.inputDropdown=inputDropdown;const SUBMIT_HINT_THRESHOLD=3;class InputFieldView extends DDInputView$1{className(){let classes=["inputfield",this.model.get("_showAnswer")?"show-answer":"",this.model.get("_val")?"has-val":"","js-ddstore-target"];return classes.join(" ")}attributes(){return{name:this.model.get("_name")}}events(){return{"click .js-inputfield-showanswer-btn":"onShowAnswerBtnClick","focus .js-inputfield-input":"onFocus","blur .js-inputfield-input":"onBlur","input .js-inputfield-input":"onInputInput","wheel .js-inputfield-input":"onInputWheel","click .js-inputfield-incorrect-icon":"onIncorrectIconClick","click .js-inputfield-hint-icon":"onHintIconClick","click":"onClick"}}initialize(){super.initialize();this.setUpInputAttributes();this.render();this.setUpEventListeners()}setUpInputAttributes(){let type=this.model.get("_type");let attr={};switch(type){case"number":attr.type="number";attr.step="any";attr.pattern="[-+]?[0-9]*[.,]?[0-9]+";break;case"text":attr.type="text";break;default:attr.type="text";Adapt$1.log.error(`{{#inputField}}: "${type}" is not a valid value for the "type" attribute of an <input> element! Defaulting to input type: "text".`);}this.model.set("_inputAttributes",attr)}setUpEventListeners(){this.listenTo(this.model,"change:_isSubmitted",this.onIsSubmittedChange);this.listenTo(this.model,"change:_isCorrect",this.onIsCorrectChange);this.listenTo(this.model,"change:_isLocked",this.onIsLockedChange);this.listenTo(this.model,"change:_isHintEnabled",this.onIsHintEnabledChange);this.listenTo(this.model,"change:_isFocused",this.onIsFocusedChange);this.listenTo(this.model,"change:_val",this.onValChange);this.listenTo(this.model,"change:_showAnswer",this.onShowAnswerChange)}onIsSubmittedChange(model,isSubmitted){this.updateState();if(!this.model.isHintEnabled())return;if(!isSubmitted)return;if(this.model.get("_canShowAnswer")&&this.model.get("_submitCount")>SUBMIT_HINT_THRESHOLD){this.model.set("_showAnswer",true)}}onShowAnswerChange(model,canShowAnswer){this.$el.toggleClass("show-answer",canShowAnswer)}onIsLockedChange(model,isLocked){this.$(".js-inputfield-input").prop("disabled",isLocked);this.$el.toggleClass("is-locked",isLocked)}onFocus(){this.model.set("_isFocused",true)}onBlur(){this.model.set("_isFocused",false)}onClick(){if(this.model.get("_isLocked"))this.onInteractLocked()}onShowAnswerBtnClick(){this.showAnswer()}onIsFocusedChange(model,isFocused){this.$el.toggleClass("is-focused",isFocused);if(!isFocused){this.$(".js-inputfield-input").val(this.model.get("_val"))}this.updateSuffix(this.model.get("_val"))}onValChange(model,val){this.$el.toggleClass("show-answer",this.model.get("_showAnswer"));this.$el.toggleClass("has-val",Boolean(val.toString().length));let $input=this.$(".js-inputfield-input");$input.attr("title",val);if(!this.model.get("_isFocused")){$input.val(val)}this.updateSuffix(val);if(this.model.isHintEnabled()&&!this.model.get("_isSubmitted")){if(val.trim().length&&this.model.checkAnswerInArray(this.model.get("_incorrectUserAnswers"),val)){this.model.set("_isCorrect",false);this.showState()}else{this.hideState()}}}onIsCorrectChange(model,isCorrect){if(!this.model.get("_isSubmitted"))return;this.$el.toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",!isCorrect)}onIncorrectIconClick(event){}onIsHintEnabledChange(model,isHintEnabled){this.$el.toggleClass("hint-enabled",isHintEnabled)}setupWidth(){const useRegExp=this.model.get("_useRegExp");let answerLength=2;let explicitWidth=this.model.get("_width");if(explicitWidth){answerLength=explicitWidth}else{let answers=this.model.get("_answers");let prefixWidth=this._getTextWidth(this._getTextContent(this.model.get("prefix")));let suffixWidth=this._getTextWidth(this._getTextContent(this.model.get("suffix")));let answerWidth=this._getTextWidth(this._getTextContent(this.model.get("placeholder")));_.find(answers,(a,idx)=>{if(useRegExp&&idx>0)return true;let s;try{s=a.toString()}catch(err){s="XXXX"}answerWidth=Math.max(answerWidth,this._getTextWidth(s));return false});answerLength=(prefixWidth+answerWidth+suffixWidth)/parseFloat(this._fontSize,10);answerLength+=1}let $placeholder=this.$(".js-inputfield-placeholder");$placeholder.css({"min-width":answerLength+"em"});let $input=this.$(".js-inputfield-input");$input.css({"padding-right":$input.outerWidth()-$placeholder.outerWidth()-parseInt($input.css("padding-left"),10)})}render(){var data=this.model.toJSON();var template=Handlebars.templates["inputField"];this.$el.html(template(data));_.delay(()=>{this.model.trigger("change:_val",this.model,this.model.get("_val"));this.setup();this.$el.on("dd-store:append",()=>{this.setup()})},0)}setup(){this.setupFont();this.setupWidth();this.setupPrefix();this.updateSuffix(this.model.get("_val"))}setupFont(){let compStyles=window.getComputedStyle(this.$el[0]);this._font=compStyles.getPropertyValue("font");this._fontSize=compStyles.getPropertyValue("font-size")}setupPrefix(){let prefix=this.model.get("prefix");if(!prefix)return;let width=this._getTextWidth(prefix);let $input=this.$(".js-inputfield-input");let $placeholder=this.$(".js-inputfield-placeholder");$input.css({"text-indent":`${width}px`});$placeholder.css({"text-indent":`${width}px`})}updateSuffix(val){let suffix=this.model.get("suffix");if(!suffix)return;let isFocused=this.model.get("_isFocused");let width=this._getTextWidth(isFocused?val:val||this._getTextContent(this.model.get("placeholder")));let $suffix=this.$(".js-inputfield-suffix");$suffix.css({"margin-left":width})}reset(){let $input=this.$(".js-inputfield-input");$input.val("");$input.trigger("change");this.model.reset()}onInputInput(event){if(this.isCorrectAnswerShown())return;let $input=this.$("input");this.model.set("_val",$input.val().toString())}onInputWheel(event){if(!this.model.get("_isFocused"))return;event.preventDefault()}onHintIconClick(){this.showAnswer()}showAnswer(){this.model.set("_val",this.model.getCorrectAnswer().toString());this.$el.removeClass("show-answer")}_getTextContent(htmlString){const div=document.createElement("div");div.innerHTML=htmlString;return div.textContent||div.innerText}_getTextWidth(text){let canvas=this._textWidthCanvas||(this._textWidthCanvas=document.createElement("canvas"));let ctx=canvas.getContext("2d");if(!this._font){return 0}ctx.font=this._font;var metrics=ctx.measureText(text);return metrics.width}showCorrectAnswer(){let $input=this.$(".js-inputfield-input");$input.val(this.model.getCorrectAnswer().toString()).prop("disabled",true);this.$el.toggleClass("hint-enabled",false);this.$el.toggleClass("is-correct",true).toggleClass("is-incorrect",false)}hideCorrectAnswer(){let $input=this.$(".js-inputfield-input");$input.val(this.model.get("_val")).prop("disabled",this.model.get("_isLocked"));this.$el.toggleClass("hint-enabled",this.model.get("_isHintEnabled"));const isCorrect=this.model.get("_isCorrect");this.$el.toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",!isCorrect)}}var InputFieldView$1=__AMD("extensions/adapt-dd-inputField/js/inputFieldView",InputFieldView);class InputFieldModel extends DDInputModel$1{defaults(){return{_answers:[],_requireSubmit:true,_canShowMarking:true,_canShowAnswer:false,_showAnswer:false,prefix:"",suffix:"",_allowsAnyCase:true,_allowsPunctuation:true,_width:undefined,_type:undefined,_decimals:undefined,_val:"",_isCorrect:false,_isLocked:false,_isFocused:false,_isSubmitted:false,_incorrectUserAnswers:[],_submitCount:0}}getAnswers(){return this.get("_answers")}initialize(){this.checkGroupError();this.setUpEventListeners()}checkGroupError(){if(!this.hasAnswers())return;_.delay(()=>{let groupItems=this.getGroupItems();if(!groupItems)return;if(groupItems.length>this.get("_answers").length){throw`{{#inputField}}: inputField in group "${this.get("_group")}" must have at least ${groupItems.length} possible answers (currently only has ${this.get("_answers").length}).`}},0)}setUpEventListeners(){this.listenTo(this,"change:_val",this.onValChange)}hasAnswers(){return Boolean(this.get("_answers").length)}onValChange(model,val){if(!this.hasAnswers())return;if(this.get("_requireSubmit"));else{this.submit()}}submit(){let val=this.get("_val");let isCorrect=this.checkAnswerInArray(this.get("_answers"),val);let isSubmitted=val!==""||isCorrect;if(isSubmitted){this.set("_submitCount",this.get("_submitCount")+1)}this.set("_isSubmitted",isSubmitted);this.set("_isCorrect",isCorrect);if(!isCorrect&&this.get("_requireSubmit")){if(val==="")return;let iua=this.get("_incorrectUserAnswers");iua.push(val);this.set("_incorrectUserAnswers",_.uniq(iua))}}reset(){super.reset()}canShowAnswer(){return this.get("_canShowAnswer")}enableRequireSubmit(){this.set("_requireSubmit",true)}getVal(){return this.get("_val")}isGrouped(){return this.get("_group")!==undefined}getAnswerIndex(){if(!this.isCorrect())return-1;const answers=this.get("_answers");let useRegExp=this.get("_useRegExp");if(this.getGroupItems()){if(answers.length!=_.uniq(answers).length){logging$1.error("inputFieldModel: having grouped items with multiple copies of the same answer is not implemented!",answers)}}let idx=-1;_.find(answers,(a,i)=>{let isCorrect=this.compareVals(this.getVal(),a,i===0?false:useRegExp);if(isCorrect)idx=i;return isCorrect});return idx}getNumber(){let val=this.get("_val");if(!val)return 0;if(!isNaN(val))return parseFloat(val);Adapt$1.log.error(`inputFieldModel.getNumber(): value "${val}" is not a number. Fallback value of "0" used.`);return 0}getGroupItems(){let group=this.get("_group");let groupItems=[this];if(group!==undefined&&group!==false){groupItems=this.get("_parent").get("_inputField")._items.filter(itemModel=>{return itemModel.get("_group")===group})}return groupItems}compareVals(userVal,correctVal,useRegExp){if(useRegExp){try{let regex=correctVal;if(regex[0]!=="^")regex="^"+regex;if(regex[regex.length-1]!=="$")regex=regex+"$";return userVal.trim().match(new RegExp(regex,this.get("_allowsAnyCase")?"i":""))}catch(err){}}let type=this.get("_type");let decimals=this.get("_decimals");let v1=this.cleanupUserAnswer(userVal);let v2=this.cleanupUserAnswer(correctVal);if(type=="number"){if(decimals!==undefined&&decimals!==false){if(typeof decimals==="number"&&decimals!==0){v2=parseFloat(v2).toFixed(decimals)}return v1.toString()==v2.toString()}let num1=parseFloat(v1);let num2=parseFloat(v2);return num1==num2}return v1==v2}checkAnswerInArray(arr,val){let useRegExp=this.get("_useRegExp");let group=this.get("_group");let groupItems=this.getGroupItems();var uAnswer=this.cleanupUserAnswer(val);var matched=arr.filter(function(cAnswer,idx){return this.compareVals(uAnswer,cAnswer,idx===0?false:useRegExp)},this);let answerIsCorrect=matched&&matched.length>0;if(answerIsCorrect&&group!==undefined){let maxCorrect=matched.length;_.find(groupItems,itemModel=>{if(itemModel==this)return true;if(this.compareVals(itemModel.getVal(),this.getVal(),useRegExp)){maxCorrect--;if(maxCorrect<=0){answerIsCorrect=false;return true}}})}if(answerIsCorrect)this.set("_isCorrect",true);return answerIsCorrect}getCorrectAnswer(){let answers=this.get("_answers");let group=this.get("_group");let useRegExp=this.get("_useRegExp");if(group===undefined){return answers?answers[0]:""}let groupItems=this.getGroupItems();return _.find(answers,(a,idx)=>{let matchingItem=_.find(groupItems,itemModel=>{if(itemModel===this)return false;return this.compareVals(itemModel.getVal(),a,idx===0?false:useRegExp)});if(!matchingItem)return true;groupItems.splice(groupItems.indexOf(matchingItem),1)})}cleanupUserAnswer(userAnswer){if(this.get("_type")==="text"){if(this.get("_allowsAnyCase")){userAnswer=userAnswer.toLowerCase()}if(this.get("_allowsPunctuation")){userAnswer=userAnswer.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g,"");userAnswer=userAnswer.replace(/(  +)+/g," ")}}return $.trim(userAnswer)}}var InputFieldModel$1=__AMD("extensions/adapt-dd-inputField/js/inputFieldModel",InputFieldModel);const FN_REGEX=new RegExp(/(\${([\w-]*?)})/g);class OutputFieldView extends Backbone.View{className(){let classes=["outputfield",this.model.get("_hasError")?"has-error":""];return classes.join(" ")}events(){return{}}initialize(){this.setUpModelData();this.render();this.setUpEventListeners();this.updateResult();this.updateValidationState()}setUpModelData(){let fn=this.model.get("fn");let allItems=this.model.get("_parent").get("_inputField")._items;let names=[];fn.replace(FN_REGEX,(match,$1,$2)=>{names.push($2);return match});let items=allItems.filter(item=>{return names.indexOf(item.get("_name"))>=0});this.model.set("_inputFields",new Backbone.Collection(items))}setUpEventListeners(){this.listenTo(this.model.get("_inputFields"),{"change:_val":this.onInputFieldValChange,"change:_isCorrect":this.onInputFieldStateChange});this.listenTo(this.model,"change:result",this.onResultChange);this.listenTo(this.model,"change:_hasError",this.onHasErrorChange);this.listenTo(this.model,"change:_isVisited",this.onIsVisitedChange)}onInputFieldValChange(inputFieldModel,val){this.updateResult();this.model.set("_isVisited",true)}onIsVisitedChange(model,isVisited){this.$el.toggleClass("is-visited",isVisited)}onInputFieldStateChange(inputFieldModel){this.updateValidationState()}updateValidationState(){let isAnyIncorrect=Boolean(this.model.get("_inputFields").find(inputField=>{return!inputField.get("_isCorrect")}));this.model.set("_isCorrect",!isAnyIncorrect);this.model.set("_isIncorrect",isAnyIncorrect);this.$el.toggleClass("is-incorrect",isAnyIncorrect).toggleClass("is-correct",!isAnyIncorrect)}updateResult(){let fn=this.model.get("fn");let eqn=fn.replace(FN_REGEX,(match,$1,$2)=>{let inputField=this.model.get("_inputFields").find(inputField=>{return inputField.get("_name")==$2});if(!inputField)throw`OutputFieldView: could not find inputField with name: "${$2}"!\n\nfn: ${fn}`;let val=inputField.getNumber();return val});let result=eval(eqn);if(isNaN(result)||!isFinite(result)){this.model.set("result","N/A");this.model.set("_hasError",true);return}this.model.set("result",result);this.model.set("_hasError",false)}onResultChange(model,result){let r=result;if(!isNaN(r))r=parseFloat(r.toFixed(this.model.get("decimals")||0));this.$(".js-outputfield-result").html(r);this.$(".js-outputfield-content").attr("title",`${this.model.get("prefix")||""}${result}${this.model.get("suffix")||""}`)}onHasErrorChange(model,hasError){this.$el.toggleClass("has-error",hasError)}render(){var data=this.model.toJSON();var template=Handlebars.templates["outputField"];this.$el.html(template(data))}}var OutputFieldView$1=__AMD("extensions/adapt-dd-inputField/js/outputFieldView",OutputFieldView);class InputFieldController extends DDInputController$1{initialize(){super.initialize(...arguments);Adapt$1.on("router:page",this.setupAdditionalHelpers.bind(this))}getInputName(){return"inputField"}setupView(data){data.answers=data.answers||data.correct;data.answers=data.answers===undefined?[]:Array.isArray(data.answers)?data.answers:[data.answers];let isHintEnabled=(data.showAnswer||data.hintEnabled)===undefined?Boolean(data.answers.length):data.hintEnabled;if(data.decimals&&isNaN(data.decimals))throw`{{#${this.getInputName()}}}: "decimals" property must be a number (value given: ${decimals}).`;let modelJSON=___default["default"].extend({},data,{_name:data.name,_group:data.group,_val:data.val||"",prefix:data.prefix||"",suffix:data.suffix||"",placeholder:data.content||data.placeholder||"?",_type:data.type||"number",_answers:data.answers,_width:data.width,_allowsAnyCase:data.allowsAnyCase||false,_allowsPunctuation:data.allowsPunctuation||false,_useRegExp:data.useRegExp||false,_decimals:data.decimals,_requireSubmit:false,_canShowAnswer:isHintEnabled});let model=new InputFieldModel$1(modelJSON);let componentModel=model.get("_parent");if(!componentModel.get("_inputField")){componentModel.set("_inputField",{_items:new Backbone.Collection(null,{model:InputFieldModel$1})})}let inputFieldCollection=componentModel.get("_inputField")._items;inputFieldCollection.push(model);if(data.name!==undefined){if(inputFieldCollection.filter(inputField=>{return inputField.get("_name")==data.name}).length>1){throw`{{#inputField}}: Duplicate names are not allowed ("${data.name}" name used more than once in block ${componentModel.getParent().get("_id")}.`}}return new InputFieldView$1({model:model})}setupAdditionalHelpers(){Adapt$1.stickyBlock?.addResetOnReRender("_inputField");Handlebars.registerHelperEl("outputField",function(){let context=arguments[arguments.length-1];let data=Handlebars.getContextHash.apply(this,arguments);if(!data.fn)throw"{{#outputField}}: \"fn\" property must be defined!";let componentModel=Handlebars.getComponentModelFromContext(context);data=___default["default"].extend({decimals:2},data,{_parent:componentModel});data._parent=componentModel;let model=new Backbone.Model(data);return new OutputFieldView$1({model:model}).$el})}}Adapt$1.inputField=new InputFieldController;class InputTextareaModel extends DDInputModel$1{defaults(){return{_allowsAnyCase:true,_allowsPunctuation:true,_isCorrect:false,_isLocked:false,_isSubmitted:false,_val:""}}initialize(){this.setupEventListeners()}setupEventListeners(){this.listenTo(this,{"change:_val":this.onValChange})}onValChange(model,val){}checkContainsTerms(terms){let cleanVal=this.getCleanString(this.get("_val"));let term=terms.find(term=>{let cleanTerm=this.getCleanString(term);return cleanVal.indexOf(cleanTerm)>=0});return term}getVal(){return this.get("_val")||""}getCleanString(str){return Adapt$1.inputTextarea.cleanString(str,{allowsAnyCase:this.get("_allowsAnyCase"),allowsPunctuation:this.get("_allowsPunctuation")})}submit(){this.set("_isSubmitted",true)}setCorrect(isCorrect){this.set("_isCorrect",isCorrect||isCorrect===undefined||false)}reset(){super.reset()}}var InputTextareaModel$1=__AMD("extensions/adapt-dd-inputTextarea/js/inputTextareaModel",InputTextareaModel);const ATTEMPTS_COUNT=3;class InputTextareaView extends DDInputView$1{className(){let className=["inputtextarea",this.model.get("_class"),this.model.get("_isLocked")?"is-locked":"","js-ddstore-target"];return className.join(" ")}events(){return{"input .js-inputtextarea-textarea":"onInput","keydown .js-inputtextarea-textarea":"onKeydown","click .js-inputtextarea-showanswer-btn":"onShowAnswerBtnClick","click":"onClick"}}initialize(){super.initialize();this.render();this.setupEventListeners()}onClick(){if(this.model.get("_isLocked")){this.onInteractLocked();return}}onInput(event){this.model.set("_val",this.$(".js-inputtextarea-textarea")[0].value)}onKeydown(event){if(event.keyCode===9||event.key=="Tab"){let $textarea=this.$(".js-inputtextarea-textarea");let ta=$textarea[0];event.preventDefault();let start=ta.selectionStart;let end=ta.selectionEnd;this.model.set("_val",ta.value.substring(0,start)+"\t"+ta.value.substring(end));ta.selectionStart=ta.selectionEnd=start+1}}render(){var data=this.model.toJSON();var template=Handlebars.templates["inputTextarea"];this.$el.html(template(data))}setupEventListeners(){this.incrementAttempts=_.debounce(this.incrementAttempts.bind(this),0);this.listenTo(this.model,{"change:_val":this.onValChange,"change:_isLocked":this.onLockedChange,"change:_isSubmitted":this.onSubmittedChange,"change:_isCorrect":this.onCorrectChange,"change:_showAnswer":this.onShowAnswerChange,"change:_attempts":this.onAttemptsChange});this.onValChange(this.model,this.model.get("_val"))}onValChange(model,val){if(val===undefined)val="";let $textarea=this.$(".js-inputtextarea-textarea");$textarea.val(val);this.$(".js-inputtextarea-counter").toggleClass("validation-error",val.length<=this.model.get("_minlength")||val.length>=this.model.get("_maxlength"));this.$(".js-inputtextarea-counter-cur").text(val.length);this.$el.toggleClass("has-scroll",$textarea[0].scrollHeight>$textarea[0].clientHeight)}onSubmittedChange(model,isSubmitted){if(isSubmitted)this.incrementAttempts();this.updateState()}incrementAttempts(){let attempts=this.model.get("_attempts")||0;attempts++;this.model.set("_attempts",attempts)}onAttemptsChange(model,attempts){if(attempts>=ATTEMPTS_COUNT)this.$el.addClass("show-answer")}onCorrectChange(model,isCorrect){this.updateState()}onShowAnswerBtnClick(){if(this.model.get("_isLocked"))return;this.model.set("_showAnswer",!Boolean(this.model.get("_showAnswer")))}onShowAnswerChange(model,showAnswer){let $answerContainer=this.$(".js-inputtextarea-answer-container");if(!showAnswer){$answerContainer.slideUp();return}var data=this.model.toJSON();var template=Handlebars.templates["inputTextareaAnswer"];$answerContainer.html(template(data));$answerContainer.hide(0).slideDown()}onLockedChange(model,isLocked){this.$el.toggleClass("is-locked",isLocked);this.$(".js-inputtextarea-textarea").prop("disabled",isLocked)}showCorrectAnswer(){this._wasShowingAnswer=this.model.get("_showAnswer");this.model.set("_showAnswer",true);this.$el.toggleClass("is-locked",true);this.$(".js-inputtextarea-textarea").prop("disabled",true)}hideCorrectAnswer(){this.model.set("_showAnswer",this._wasShowingAnswer);const isLocked=this.model.get("_isLocked");this.$el.toggleClass("is-locked",isLocked);this.$(".js-inputtextarea-textarea").prop("disabled",isLocked);this.$el.toggleClass("hint-enabled",this.model.get("_isHintEnabled"));const isCorrect=this.model.get("_isCorrect");this.$el.toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",!isCorrect)}}var InputTextareaView$1=__AMD("extensions/adapt-dd-inputTextarea/js/inputTextareaView",InputTextareaView);class InputTextarea extends DDInputController$1{initialize(){super.initialize()}getInputName(){return"inputTextarea"}cleanString(str,options){if(options?.allowsAnyCase){str=str.toLowerCase()}if(options?.allowsPunctuation){str=str.replace(/[\.,\/#!$%\^&\*;:{}=`~()]/g,"");str=str.replace(/[-\-_]/g," ");str=str.replace(/(  +)+/g," ")}return str.trim()}setupView(data){let modelJSON=___default["default"].extend({},data,{_class:data.class,_val:data.content||"",answer:data.answer||"",_rows:data.rows||5,_minlength:data.minlength||0,_maxlength:data.maxlength,placeholder:data.placeholder||"Type your answer here..."});let model=new InputTextareaModel$1(modelJSON);return new InputTextareaView$1({model:model})}}let inputTextarea=new InputTextarea;Adapt$1.inputTextarea=inputTextarea;const OPACITY=0.1;class DDLoadingModel extends Backbone.Model{defaults(){return{"_percentLoaded":0,"_hasLoaded":false,"_hasError":false,"text":""}}initialize(){this.initHelpers();this.set("_componentsReady",0);this.listenTo(Adapt$1.components,"change:_isReady",this.onComponentReadyChange.bind(this));this.listenTo(Adapt$1,"contentObjectView:postReady",this.onLoaded.bind(this))}initHelpers(){var helpers={loadingIcon:function(){let context=arguments[arguments.length-1];var template=Handlebars.templates["ddLoadingIcon"];return template(context.hash)}};for(var name in helpers){if(!helpers.hasOwnProperty(name))continue;Handlebars.registerHelper(name,helpers[name])}}onLoaded(contentObjectView){this.set("_hasLoaded",true);this.clearText()}onComponentReadyChange(componentModel,_isReady){let componentsReady=[];Adapt$1.components.each(componentModel=>{if(componentModel.get("_isReady")){componentsReady.push(componentModel)}});let percentage=componentsReady.length/Adapt$1.components.length*100;this.set("_percentLoaded",percentage);if(this._debugCommentEl){this._debugCommentEl.remove();this._debugCommentEl=null}let commentStr=``;Adapt$1.blocks.each(blockModel=>{commentStr+=blockModel.get("_id")+" --- ";let readyComponentCount=0;let waiting=[];blockModel.getChildren().each(componentModel=>{let isReady=componentModel.get("_isReady");if(isReady)readyComponentCount++;else waiting.push(componentModel.get("_id"))});commentStr+=`${readyComponentCount}/${blockModel.getChildren().length}${waiting.length?" ["+waiting.join(", ")+"]":""}
`});this._debugCommentEl=document.createComment(`
Components loaded
-----------------
${commentStr}
`);document.body.appendChild(this._debugCommentEl)}setText(text){this.set("text",text||"")}showError(errorText){$(".js-loading").show();var template=Handlebars.templates["ddLoadingErrorText"];this.set("text",template({text:errorText}));this.set("_hasError",true)}clearText(){this.set("text","")}show(){$(".js-loading").show()}hide(){$(".js-loading").hide()}}class DDLoadingView extends Backbone.View{initialize(){this.render();this.setUpEventListeners()}setUpEventListeners(){this.listenTo(this.model,"change:_percentLoaded",this.onPercentLoadedChange.bind(this));this.listenTo(this.model,"change:_hasLoaded",this.onHasLoadedChange.bind(this));this.listenTo(this.model,"change:_hasError",this.onHasErrorChange.bind(this));this.listenTo(this.model,"change:text",this.onTextChange.bind(this))}onHasErrorChange(model,hasError){this.$el.toggleClass("has-error",hasError)}onTextChange(model,text){this.$(".js-ddloading-text").html(text)}onHasLoadedChange(model,hasLoaded){this.$(".js-ddloading-graphic").toggleClass("is-idle",hasLoaded);this.$(".js-ddloading-img").css("opacity","")}onPercentLoadedChange(model,percentLoaded){const o=1-OPACITY;const graphicCount=16;const segment=100/graphicCount;let idx=Math.floor(percentLoaded/segment);let opacity=1-o+o*(percentLoaded%segment/segment);let $img=this.$(".js-ddloading-img").filter("[data-logo-index="+idx+"]");$img.css("opacity",opacity);for(let i=0;i<idx-1;i++){this.$(".js-ddloading-img").filter("[data-logo-index="+i+"]").css("opacity",1)}this.$(".js-ddloading-percent").html(Math.floor(percentLoaded)+"%")}render(){}}Adapt$1.on("router:page",()=>{let $loading=$(".js-loading").first();$loading.addClass("ddloading");let model=new DDLoadingModel;new DDLoadingView({model:model,el:$loading[0]});Adapt$1.ddLoading=model});function getMathHtml(templateName,context){let data=_.extend({},context.hash,{content:context.fn?context.fn(this):""});let html=Handlebars__default["default"].templates[templateName](data);return new Handlebars__default["default"].SafeString(html)}let helpers$1={"m-math":function(){let context=arguments[arguments.length-1];return getMathHtml.call(this,"ddMath",context)},"m-text":function(){let context=arguments[arguments.length-1];return getMathHtml.call(this,"ddMathText",context)},"m-a":function(){let context=arguments[arguments.length-1];if(context.hash.overline)context.hash.diac="-";return getMathHtml.call(this,"ddMathAlphanumeral",context)},"m-diac":function(){let context=arguments[arguments.length-1];let char=context.hash.char;let content;try{content=context.fn()}catch(err){throw"{{#m-diac}} helper cannot be empty (it must have content)."}if(!isNaN(content[content.length-1])){context.hash._useFallback=true}if(context.hash.fallback===true)context.hash._useFallback=true;let diac="";let name="";switch(char){case"^":diac="&#770;";name="circumflex-accent";break;case"V":case"v":diac="&#711;";name="caron";break;case".":diac="&#775;";name="dot-above";break;case"O":case"o":diac="&#730;";name="ring-above";break;case"~":diac="&#732;";name="tilde";break;case"U":case"u":diac="&#728;";name="breve";break;case"-":case true:case undefined:diac="&#773;";name="overline";break;default:diac=char;name="custom";}context.hash.diac=diac;context.hash.name=name;return getMathHtml.call(this,"ddMathDiacritic",context)},"m-frac":function(){let context=arguments[arguments.length-1];return getMathHtml.call(this,"ddMathFraction",context)},"m-num":function(){let context=arguments[arguments.length-1];return getMathHtml.call(this,"ddMathNumerator",context)},"m-den":function(){let context=arguments[arguments.length-1];return getMathHtml.call(this,"ddMathDenominator",context)},"m-sqrt":function(){let context=arguments[arguments.length-1];return getMathHtml.call(this,"ddMathSqrt",context)},"m-brac":function(){let context=arguments[arguments.length-1];return getMathHtml.call(this,"ddMathBrac",context)},"m-sigma":function(){let context=arguments[arguments.length-1];if(context.hash.upper===""&&context.hash.lower===""&&context.hash.index===""){context.hash._noLabels=true}context.hash=_.extend({},{upper:"n",index:"i",lower:1},context.hash);if(!context.hash.upper)context.hash.upper="n";if(context.hash.upper.length==1&&isNaN(context.hash.upper))context.hash.upper=`{{#m-a}}${context.hash.upper}{{/m-a}}`;return getMathHtml.call(this,"ddMathSigma",context)}};for(var name$1 in helpers$1){if(helpers$1.hasOwnProperty(name$1)){Handlebars__default["default"].registerHelper(name$1,helpers$1[name$1])}}class DDStoreView extends Backbone.View{className(){let classes=["dd-store","nocode"];return classes.join(" ")}attributes(){return{"for":this.model.get("for"),"data-id":this.model.get("_id")}}initialize(){this.render()}_findThisEl(){return $(`.dd-store[data-id=${this.model.get("_id")}]`)}_isInDOM(){return Boolean(jQuery.contains(document,this.$el[0]))}_waitOneFrame(frames){return new Promise(resolve=>{_.delay(resolve,frames||0)})}async render(){let componentId=this.model.get("_parent").get("_id");await this._waitOneFrame();let componentView=Adapt$1.findViewByModelId(componentId);if(!this._isInDOM()){this.$el=this._findThisEl();if(this.$el.length==0){logging$1.warnOnce("dd-storeView: did not move $target element (view is not in the DOM).");return}}if(this.$el.closest(".codebox.is-code").length){for(let i=0;i<2000;i++){await this._waitOneFrame();if(!this._isInDOM()){this.$el=this._findThisEl();Adapt$1.log.warn(`dd-storeView: re-attached ${this.model.get("_id")} to .codebox after ${i} attempts.`);break}}}let name=this.model.get("for");let $target=componentView.$(`[data-name="${name}"]`);let $figureItem=$target.closest(".js-dd-figure-group-item");if(!$target.length){throw`{{#store}}: could not find element with [data-name="${name}"]`}this.$el.append($target);this.$el.find(".js-ddstore-target").trigger("dd-store:append");$figureItem.hide()}}var DDStoreView$1=__AMD("extensions/adapt-dd-store/js/dd-storeView",DDStoreView);class DDStore extends Backbone.Controller{initialize(){this.listenTo(Adapt$1,{"router:page":this.onRouterPage})}onRouterPage(){Handlebars.registerHelperEl("store",function(){let context=arguments[arguments.length-1];let componentModel=Handlebars.getComponentModelFromContext(context);let modelJSON=_.extend({},context.hash,{_parent:componentModel,_id:_.uniqueId("ddstore")});return new DDStoreView$1({model:new Backbone.Model(modelJSON)}).$el})}}new DDStore;class HYBVideoModel extends Backbone.Model{defaults(){return{_fullscreenEnabled:true,_volumeEnabled:true,_volume:1,_volumeMuted:false,_ccEnabled:true,_isFullscreen:false,_isVisited:false,_isPlaying:false,_isEnded:false,_progress:0,_progressPercent:0,_isWaiting:false,_waitingStartTime:-1}}initialize(){this.set("_id",_.uniqueId("ddvideo-"))}play(){this.set("_isPlaying",true)}}var DDVideoModel=__AMD("extensions/adapt-dd-video/js/dd-videoModel",HYBVideoModel);class HYBTranscriptView extends Backbone.View{events(){return{}}className(){let classes=["hyb-transcript",this.model.get("class")||""];return classes.join(" ")}initialize(){this.render()}render(){let template=Handlebars.templates["hyb-transcript"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string)}}var HYBTranscriptView$1=__AMD("extensions/adapt-dd-video/js/hyb-transcriptView",HYBTranscriptView);const TIMESKIP=5;class DDVideoView extends Backbone.View{events(){return{"click .js-ddvc-play":"onPlayPauseClick","click .js-dd-video-video":"onPlayPauseClick","click .js-ddvc-audio":"onAudioBtnClick","click .js-ddvc-cc":"onCCBtnClick","dblclick .js-dd-video-video":"onFullscreenBtnClick","click .js-ddvc-fullscreen":"onFullscreenBtnClick","webkitfullscreenchange":"onFullscreenEvent","mozfullscreenchange":"onFullscreenEvent","MSFullscreenChange":"onFullscreenEvent","fullscreenchange":"onFullscreenEvent","mousemove":"onMouseMove","click .js-dd-video-transcript-btn":"onTranscriptBtnClick","click .js-dd-video-start":"onStartClick"}}className(){let classes=["dd-video","is-metadata-loading",this.model.get("_isFullscreen")?"is-fullscreen":"is-windowed",this.model.get("class")||""];return classes.join(" ")}attributes(){return{"data-adapt-id":this.model.get("_id")}}initialize(){this.render();this.setupTranscript();this.checkIsFullscreenSupported();this.setupEventListeners()}checkIsFullscreenSupported(){let video=this.$(".js-dd-video-video")[0];if(typeof video.webkitEnterFullscreen==="function")return true;if(typeof video.mozRequestFullScreen==="function")return true;Adapt$1.log.warn("The current browser does not support fullscreen.");this.set("_fullscreenEnabled",false);return false}setupEventListeners(){this.listenTo(this.model,{"change:_isPlaying":this.onIsPlayingChange,"change:_isFullscreen":this.onIsFullscreenChange,"change:_isWaiting":this.onIsWaitingChange});this.listenTo(Adapt$1,{"media:pause":this.onGlobalPause});this.onIsPlayingChange(this.model,this.model.get("_isPlaying"));this.onIsFullscreenChange(this.model,this.model.get("_isFullscreen"));this.getVideoEl().addEventListener("progress",this.updateProgressBuffer.bind(this));this.getVideoEl().addEventListener("load",this.updateProgressBuffer.bind(this));this.getVideoEl().addEventListener("loadedmetadata",this.onMetadataLoaded.bind(this));this.getVideoEl().addEventListener("waiting",this.onWaiting.bind(this))}render(){let template=Handlebars.templates["ddVideo"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string)}getVideoEl(){return this.$(".js-dd-video-video")[0]}onGlobalPause(){this.pause();if(this.transcript){this.transcript.toggle(false)}}onKeyDown(e){if(e.code==="Space"||e.keyCode==32){this.togglePlayPause()}let video=this.getVideoEl();let progressPercent=this.model.get("_progressPercent");let time=progressPercent*video.duration;if(e.keyCode==37){time-=TIMESKIP}if(e.keyCode==39){time+=TIMESKIP}if(time>video.duration-0.1){time=video.duration-0.1}else if(time<0){time=0}video.currentTime=time}_initJQueryUISlider($el,trackProp,options){const notches=$el.width();let data=_.extend({},{range:"min",value:0,min:0,max:notches,"ui-slider-handle":"ui-corner-all"},options);data.slide=(event,ui)=>{let percentValue=ui.value/notches;this.model.set(trackProp,percentValue);try{if(options.slide)options.slide(event,ui)}catch(err){}};this.listenTo(this.model,`change:${trackProp}`,(model,val)=>{$el.slider("value",val*notches)});$el.slider(data)}onMetadataLoaded(){this.setupCaptions();this.setupProgress();this.setupAudio();this.$el.removeClass("is-metadata-loading")}setupProgress(){let video=this.getVideoEl();let $slider=this.$(".js-ddvc-progress-slider");let wasPlaying;let isMax;this._initJQueryUISlider($slider,"_progressPercent",{start:()=>{wasPlaying=this.model.get("_isPlaying");this.pause()},slide:(event,ui)=>{let video=this.getVideoEl();let progressPercent=this.model.get("_progressPercent");let time=progressPercent*video.duration;if(time>video.duration-0.1){time=video.duration-0.1;isMax=true}else{isMax=false}video.currentTime=time},stop:()=>{if(wasPlaying||isMax){this.play()}}});video.addEventListener("timeupdate",this.onVideoTimeUpdate.bind(this),false);video.addEventListener("ended",this.onVideoEnded.bind(this));this.listenTo(this.model,{"change:_progress":this.onProgressChange,"change:_progressPercent":this.onProgressPercentChange,"change:_isEnded":this.onVideoEndedChange});this.updateTimecodeTotal();this.updateTimecodeCur()}onProgressChange(model,progress){let video=this.getVideoEl();let progressPercent=video.currentTime/video.duration;this.model.set("_progressPercent",progressPercent);this.updateTimecodeCur()}onVideoTimeUpdate(){let video=this.getVideoEl();this.model.set("_progress",video.currentTime);this.model.set("_isEnded",false);if(this.model.get("_isWaiting")){if(this.model.get("_progress")!=this.model.get("_waitingStartTime")){this.stopWaiting()}}}onVideoEnded(){this.model.set("_isEnded",true)}onVideoEndedChange(model,isEnded){if(isEnded){this.model.set("_isPlaying",false)}this.$el.toggleClass("is-ended",isEnded)}updateTimecodeTotal(){let video=this.getVideoEl();let width=this.$(".js-ddvc-duration-total").text(this._getMinutesSecondsString(video.duration)).width();this.$(".js-ddvc-duration-cur").width(width)}updateTimecodeCur(){let video=this.getVideoEl();this.$(".js-ddvc-duration-cur").text(this._getMinutesSecondsString(video.currentTime))}_getMinutesSecondsString(secondsNum){var date=new Date(null);date.setSeconds(Math.floor(secondsNum||0));var str=date.toISOString().substring(14,19);return str.trim()}async setupCaptions(){if(!this.model.get("cc")?.length)return;let $tracks=this.$(".js-dd-video-track");for(let i=0;i<$tracks.length;i++){let $track=$tracks.eq(i);let track=$track[0].track;let cues=track.cues;try{if(!cues.length){await Promise.race([new Promise(resolve=>{$track.on("load",resolve)}),new Promise(resolve=>{_.delay(resolve,5000)})])}}catch(err){Adapt$1.log.error(err)}_.each(cues,cue=>{cue.line=-3})}this.listenTo(this.model,"change:_ccEnabled",this.onCCEnabledChange);this.onCCEnabledChange(this.model,this.model.get("_ccEnabled"))}onCCBtnClick(event){event.preventDefault();this.model.set("_ccEnabled",!Boolean(this.model.get("_ccEnabled")))}onCCEnabledChange(model,isEnabled){let video=this.getVideoEl();let tracks=video.textTracks;_.each(tracks,track=>{track.mode=isEnabled?"showing":"hidden"});this.$(".js-ddvc-icon-cc").toggle(isEnabled);this.$(".js-ddvc-icon-cc-off").toggle(!isEnabled)}setupTranscript(){let transcript=this.model.get("_transcript");if(!transcript)return;if(transcript._isEnabled===undefined){transcript._isEnabled=Boolean(transcript.body)}if(!transcript._isEnabled)return;transcript.title=transcript.title||"Transcript";let view=new HYBTranscriptView$1({model:new Backbone.Model(transcript)});this.transcript=Adapt$1.hyb.drawer({_parent:this.model.get("_parent"),_view:view,_$target:this.$(".js-dd-video-container"),title:transcript.title})}onTranscriptBtnClick(){if(!this.transcript){throw"dd-videoView.js: transcript drawer not initialized."}this.transcript.toggle()}onFullscreenBtnClick(event){this.toggleFullscreen()}toggleFullscreen(isEnabled){this.model.set("_isFullscreen",isEnabled===undefined?!this.model.get("_isFullscreen"):Boolean(isEnabled))}onIsFullscreenChange(model,isFullscreen){let video=this.getVideoEl();let controls=this.$(".js-dd-video-container")[0];try{if(typeof video.webkitEnterFullscreen==="function"){if(isFullscreen){controls.webkitRequestFullScreen()}else{document.webkitCancelFullScreen()}}else if(typeof video.mozRequestFullScreen==="function"){if(isFullscreen){controls.mozRequestFullScreen()}else{document.mozCancelFullScreen()}}}catch(err){}this.$el.toggleClass("is-fullscreen",isFullscreen);this.$el.toggleClass("is-windowed",!isFullscreen);this.$(".js-ddvc-icon-fullscreen").toggle(!isFullscreen);this.$(".js-ddvc-icon-exit-fullscreen").toggle(isFullscreen)}exitFullscreen(){var isFullscreen=this.model.get("_isFullscreen");if(isFullscreen)this.toggleFullscreen()}onFullscreenEvent(event){let isFullscreen=document.fullscreenElement||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement;isFullscreen=Boolean(isFullscreen);this.toggleFullscreen(isFullscreen)}updateProgressBuffer(){const MERGE_GAP=1.5;let video=this.getVideoEl();this.$(".js-ddvc-buffer-item").remove();let $buffer=this.$(".js-ddvc-buffer");var bf=video.buffered;_.each(bf,(item,i)=>{let $item=$("<div>",{class:"ddvc__progress-buffer-item js-ddvc-buffer-item"});let start=bf.start(i);let end=bf.end(i);if(i>0){let endPrev=bf.end(i-1);if(start-endPrev<MERGE_GAP){start=endPrev}}let s=start/video.duration;let e=end/video.duration;$item.css({left:s*100+"%",width:(e-s)*100+"%"});$buffer.append($item)})}onWaiting(){this.model.set("_isWaiting",true);this.model.set("_waitingStartTime",this.model.get("_progress"))}stopWaiting(){this.model.set("_isWaiting",false);this.model.set("_waitingStartTime",-1)}onIsWaitingChange(model,isWaiting){this.$el.toggleClass("is-waiting",isWaiting)}onAudioBtnClick(event){event.preventDefault();this.model.set("_volumeMuted",!Boolean(this.model.get("_volumeMuted")))}refreshAudioControls(){let volume=this.model.get("_volume");let volumeMuted=this.model.get("_volumeMuted")||volume==0;this.$(".js-ddvc-icon-audio-mute").toggle(volumeMuted);this.$(".js-ddvc-icon-audio-half").toggle(!volumeMuted&&volume>0&&volume<=0.5);this.$(".js-ddvc-icon-audio-full").toggle(!volumeMuted&&volume>0.5)}onVolumeChange(model,volume){this.model.set("_volumeMuted",volume==0);let video=this.getVideoEl();video.volume=volume;this.refreshAudioControls()}onVolumeMutedChange(model,volumeMuted){if(this.model.get("_volume")==0&&!volumeMuted){this.model.set("_volume",0.5)}let video=this.getVideoEl();video.muted=volumeMuted;this.refreshAudioControls()}setupAudio(){let $slider=this.$(".js-ddvc-audio-slider");this._initJQueryUISlider($slider,"_volume");this.listenTo(this.model,"change:_volume",this.onVolumeChange);this.listenTo(this.model,"change:_volumeMuted",this.onVolumeMutedChange);let video=this.getVideoEl();let v=video.volume;this.model.set("_volume",0,{silent:true});this.model.set("_volume",v)}onPlayPauseClick(event){event.preventDefault();this.togglePlayPause()}isVideoPlaying(){let video=this.getVideoEl();return!!(video.currentTime>0&&!video.paused&&!video.ended&&video.readyState>2)}togglePlayPause(){var isPlaying=this.isVideoPlaying();if(isPlaying)this.pause();else this.play()}play(){let video=this.getVideoEl();var playPromise=video.play();if(playPromise!==undefined){playPromise.then(function(){this.model.set("_isPlaying",true)}.bind(this)).catch(function(err){this.pause()}.bind(this))}this.hideStart()}pause(){let video=this.getVideoEl();video.pause();this.model.set("_isPlaying",false)}onIsPlayingChange(model,isPlaying){this.$(".js-ddvc-icon-play").toggle(!isPlaying);this.$(".js-ddvc-icon-pause").toggle(isPlaying);if(isPlaying)this.play();else this.pause()}onStartClick(){this.play(0)}hideStart(){let $start=this.$(".js-dd-video-start");$start.fadeOut();$start.addClass("is-start-inactive")}}var DDVideoView$1=__AMD("extensions/adapt-dd-video/js/dd-videoView",DDVideoView);class DDVideo extends Backbone.Controller{initialize(){this.videos=new Backbone.Collection([],{model:DDVideoModel});this.pauseAllMedia=_.debounce(this.pauseAllMedia.bind(this),10);this.listenTo(Adapt$1,{"router:page":this.onRouterPage})}onRouterPage(){let me=this;Handlebars.registerHelperEl("video",function(){let context=arguments[arguments.length-1];let data=Handlebars.getContextHash.apply(this,arguments);console.log(data);data._parent=Handlebars.getComponentModelFromContext(context);if(!data.id&&(!data.src||!data.poster)){throw`{{#video}}: if "id" isn't being used, then "src" and "poster" must be defined (or vice-versa).`}if(Boolean(data.src)!=Boolean(data.poster)){throw`{{#video}}: both "src" and "poster" must be defined if "id" isn't being used.`}let model=new DDVideoModel(data);let view=new DDVideoView$1({model:model});me.videos.push(model);return view.$el})}getVideoModel($el){let id=$el.closest(".dd-video").attr("data-adapt-id");let videoModel=this.videos.find(model=>{return model.get("_id")==id});return videoModel}pauseAllMedia(){Adapt$1.trigger("media:pause")}}let ddVideo=new DDVideo;Adapt$1.ddVideo=ddVideo;Adapt$1.indexString=function(idxString,arr){let count=arr?arr.length:-1;let indexes=[];let selectors=idxString.split(",");_.each(selectors,selector=>{selector=selector.trim();let group=[];let isNegative=selector[0]==="!";if(isNegative){selector=selector.substring(1)}if(selector.includes("+")){if(count<0){throw`Adapt.indexString: cannot process "${selector}" if 'count' is undefined.`}let from=selector.split("+")[0];for(let i=parseInt(from);i<count;i++){group.push(i+"")}}else if(selector.includes("-")){let from=selector.split("-")[0];let to=selector.split("-")[1];for(let i=parseInt(from);i<=parseInt(to);i++){group.push(i+"")}}else{group.push(selector+"")}if(!isNegative){indexes=indexes.concat(group)}else{indexes=indexes.filter(index=>{return group.indexOf(index)<0})}});return _.uniq(indexes)};Adapt$1.blockString=function(idxString){if(idxString.startsWith("b-")){return[idxString.substring(2)]}let selectors=idxString.split(",");_.each(selectors,(selector,idx)=>{selector=selector.trim();let isNegative=selector[0]==="!";if(isNegative){selector=selector.substring(1)}let from,to=null;if(selector.includes("-")){from=selector.split("-")[0];to=selector.split("-")[1]}else if(selector.includes("+")){from=selector.split("+")[0];to=Adapt$1.blocks.last().get("_id").split("-")[1]}else if(selector==="r"){let recipeBlocks=Adapt$1.blocks.filter(blockModel=>{return blockModel.get("_isRecipe")});from=recipeBlocks[0].get("_id").split("-")[1];to=recipeBlocks[recipeBlocks.length-1].get("_id").split("-")[1]}else{return}let hasStarted=false;let indexes=[];Adapt$1.blocks.find(blockModel=>{let blockId=blockModel.get("_id").substring(2);if(!hasStarted){if(blockId==from)hasStarted=true;else return false}indexes.push((isNegative?"!":"")+blockId);if(blockId==to){return true}});selectors[idx]=indexes.join(",")});return Adapt$1.indexString(selectors.join(","),Adapt$1.blocks.models)};class Portfolio extends Backbone.Controller{initialize(){return}onRouterPage(pageModel){this._page=pageModel;console.log(`%c${this.isAssessmentMode()?"Assessment":"Activity"}`,`background: ${this.isAssessmentMode()?"red":"cornflowerblue"}; color: white; padding: 0.5em 1em;`);this.setupHelpers();$("html").toggleClass("is-assessment",this.isAssessmentMode());$("html").toggleClass("is-activity",!this.isAssessmentMode())}onPageViewPostRender(view){let article=view.model.getChildren().first();const blocks=article.getChildren();let firstBlock=blocks.find(block=>{return!block.get("_isWarn")});if(firstBlock){firstBlock.set("pageTitle",view.model.get("title"))}}onDataReady(){Adapt$1.components.each(componentModel=>{if(!componentModel.get("_isQuestionType"))return})}onComponentViewPreRender(componentView){let componentModel=componentView.model;if(!componentModel.get("_isQuestionType"))return;componentView.setupFeedback=function(){}}onComponentViewPostRender(componentView){let model=componentView.model;if(!model.get("_isQuestionType"))return;let $header=componentView.$(".component__header");$header.prepend(new QuizStateIconView({model:new Backbone.Model({_parent:model})}).$el)}onQuestionViewShowFeedback(questionView){}onQuestionViewInteractLocked(questionView){let questionModel=questionView.model;if(questionModel.get("_isComplete"))return;if(!questionModel.get("_isSubmitted"))return;let $btn=questionView.$(".js-btn-action");$btn.addClass("is-interactlocked").on("animationend webkitAnimationEnd oAnimationEnd",()=>{$btn.removeClass("is-interactlocked")})}isAssessmentMode(){try{const assessment=Adapt$1.assessment._assessments[0];if(!assessment)return false;const articleModel=Data.findById(assessment.get("_id"));const pageId=articleModel.getParent().get("_id");if(location$1._currentId===pageId)return true;return false}catch(err){return false}}canShowFeedback(componentModel){if(componentModel&&componentModel.get("_canShowFeedback"))return true;if(!Adapt$1.assessment)return true;let assessment=Adapt$1.assessment._getAssessmentByPageId(this._page.get("_id"));if(!assessment)return true;return assessment[0].getState().isComplete}getAssessment(){if(!Adapt$1.assessment)return undefined;let assessment=Adapt$1.assessment._getAssessmentByPageId(this._page.get("_id"));if(!assessment)return undefined;return assessment[0]}setupHelpers(){Handlebars.registerHelperEl("feedback",function(){let context=arguments[arguments.length-1];let data=Handlebars.getContextHash.apply(this,arguments);let componentModel=Handlebars.getComponentModelFromContext(context);let modelJSON=___default["default"].extend({},data,{_itemIndex:data.itemIndex,_feedback:___default["default"].extend({},data.feedback),_parent:componentModel});let view=new QuizFeedbackView({model:new QuizFeedbackModel(modelJSON)});return view.$el});const helpers={};for(const name in helpers){Handlebars.registerHelper(name,helpers[name])}}}let portfolio=new Portfolio;Adapt$1.portfolio=portfolio;const SCROLL_MARGIN=48;const SCROLL_DURATION=400;const SCROLL_ROUNDING=4;let isScrolling=false;let scrollPriority=-Infinity;class Scrollfix extends Backbone.Controller{initialize(){Adapt$1.on({"router:page":this.onRouterPage,"componentView:postRender":this.onComponentPostRender,"popup:opened":this.onPopupOpened})}onComponentPostRender(componentView){Adapt$1.scrollfix.setupSimpleBar(componentView.$el)}onPopupOpened(){Adapt$1.scrollfix.setupSimpleBar($(".notify"))}onRouterPage(){}setupSimpleBar(){_.delay(()=>{this._setupSimpleBar.apply(this,arguments)},0)}_setupSimpleBar($el){$el.find("[data-scroll]:not(.has-simplebar)").each((i,e)=>{let $e=$(e);let dataScroll=$e.attr("data-scroll");let scroll="";switch(dataScroll){case"visible":case"hidden":case"scroll":case"auto":scroll=dataScroll;break;default:scroll="auto";break;}let enableSimplebar=scroll==="scroll";if(scroll==="auto"){enableSimplebar=Math.abs($e[0].scrollHeight-$e.height())>SCROLL_ROUNDING}if(enableSimplebar){new SimpleBar__default["default"]($(e)[0],{autoHide:false});$e.addClass("has-simplebar")}$e.addClass("scrollfix-ready");if($e.parent().hasClass("js-hyb-figure-item")){$e.parent().addClass("contains-simplebar")}})}}let scrollfix=new Scrollfix;Adapt$1.scrollfix=scrollfix;Adapt$1.on("offlineStorage:prepare",()=>{if(/Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){Adapt$1.log.info("adapt-scrollfix.js: Mobile device detected.");$("html").addClass("device-mobile");return}});Adapt$1.on("app:dataReady",()=>{overrideNavigateToElement();overridePreventScroll();Adapt$1.navigateToRelOffset=navigateToRelOffset});let disableA11yPreventScroll=false;function overridePreventScroll(){let _preventScroll=Adapt$1.a11y._scroll._preventScroll;Adapt$1.a11y._scroll._preventScroll=function(){if(disableA11yPreventScroll)return;return _preventScroll.apply(Adapt$1.a11y._scroll,arguments)};Adapt$1.scrollfix.disableA11yScroll=function(){disableA11yPreventScroll=true};Adapt$1.scrollfix.enableA11yScroll=function(){disableA11yPreventScroll=false}}function navigateToRelOffset(offset,settings){let $target=$("<div class='scrollfix__target'>");$("#app").append($target);$target.offset({top:offset.top?$(window).scrollTop()+offset.top:undefined,left:offset.left?$(window).scrollLeft()+offset.left:undefined});let s=_.extend({offset:{top:0,left:0},ignoreNav:true},settings);Adapt$1.navigateToElement($target,s);$target.remove()}function overrideNavigateToElement(){let _navigateToElement=router$1.navigateToElement;router$1.navigateToElement=function(selector,settings){if(Adapt$1.isPDFMode())return;if(!settings)settings={};settings.priority=settings.priority||0;if(!isScrolling){scrollPriority=settings.priority}else{if(settings.priority<scrollPriority)return;scrollPriority=settings.priority}if(settings.duration===undefined)settings.duration=SCROLL_DURATION;if(settings.offset===undefined)settings.offset={top:-SCROLL_MARGIN,left:0};if(settings.fail===undefined)settings.fail=onScrollFail;if(settings.onAfter===undefined){settings.onAfter=onScrollAfter}else{let onAfter=settings.onAfter;settings.onAfter=function(){onAfter();onScrollAfter()}}if(!settings.ignoreNav&&Adapt$1.device.screenSize!=="large"){settings.offset.top-=$(".nav").height()}let $obj=$();let uniqueId=_.uniqueId("scrollfix");if(selector instanceof jQuery){$obj=selector.addClass(uniqueId);selector="."+uniqueId;arguments[0]=selector}let scrollNestedCallback=undefined;if(settings.scrollNested===true){let $scrollParent=$obj.scrollParent();let scrollParentId=$scrollParent.attr("id");if(scrollParentId!="adapt"&&scrollParentId!="app"&&!$scrollParent.hasClass("notify__popup")){let scrollTop=$scrollParent.scrollTop();$scrollParent.scrollTo($obj,{axis:"y",duration:0});scrollNestedCallback=()=>{let destScrollTop=$scrollParent.scrollTop();$scrollParent.scrollTop(scrollTop);$scrollParent.scrollTo(destScrollTop,{axis:"y",duration:SCROLL_DURATION})}}}let cleanup=()=>{if(scrollNestedCallback)scrollNestedCallback();$obj.removeClass(uniqueId)};if(settings.align=="inview"){let inview=getElementInview(selector,settings.offset);if(inview.inview===0){cleanup();onScrollAfter();return}$obj.removeClass(uniqueId);inview.$topObj.addClass(uniqueId);if(inview.inview===1){settings.offset.top=-Adapt$1.device.screenHeight+inview.height+SCROLL_MARGIN;if(_useIphoneFix()){settings.offset.top+=SCROLL_MARGIN*2}}}if($obj.closest(".notify").length&&settings.notifyEnabled===true){$(".notify__popup").scrollTo($obj,_.extend(settings,{axis:"y",duration:SCROLL_DURATION}))}else{_navigateToElement.apply(this,arguments)}isScrolling=true;cleanup()}}function onScrollFail(){isScrolling=false;scrollPriority=-Infinity}function onScrollAfter(){isScrolling=false;scrollPriority=-Infinity}function getScreenTop(){if(Adapt$1.device.screenSize==="small"){return SCROLL_MARGIN+$(".nav").height()}return SCROLL_MARGIN}function _useIphoneFix(){return $("html").hasClass("iphone")}function getScreenBottom(){if(_useIphoneFix()){return Adapt$1.device.screenHeight-SCROLL_MARGIN*3}return Adapt$1.device.screenHeight-SCROLL_MARGIN}function getElementInview(selector,offset){let $obj=$(selector);if(!$obj.length){Adapt$1.log.error("adapt-scrollfix.getElementInview() could not find any elements with the provided selector: "+selector);return}let bbs=[];$obj.each((i,e)=>{if($(e).hasClass("component")){let componentView=Adapt$1.findViewByModelId($(e).data("adapt-id"));if(componentView.getBoundingClientRect){let bb=componentView.getBoundingClientRect();bb.$obj=$(e);bbs.push(bb)}else{let bb=$(e)[0].getBoundingClientRect();bb.$obj=$(e);bbs.push(bb)}}else{let bb=$(e)[0].getBoundingClientRect();bb.$obj=$(e);bbs.push(bb)}});let minTop=Infinity;let maxBottom=-Infinity;let $topObj=$obj.first();_.each(bbs,bb=>{if(bb.top<minTop){minTop=bb.top;$topObj=bb.$obj}if(bb.bottom>maxBottom){maxBottom=bb.bottom}});let screenTop=getScreenTop()-1;let screenBottom=getScreenBottom()+1;let inview=0;let height=maxBottom-minTop;if(offset.height!==undefined){height=Math.max(height,offset.height)}if(maxBottom-minTop>screenBottom-screenTop){inview=-1}else{if(maxBottom>screenBottom)inview=1;if(minTop<screenTop)inview=-1}return{inview:inview,height:height,$topObj:$topObj}}class Sizing extends Backbone.Controller{initialize(){Adapt$1.on("componentView:postRender",this.componentViewPostRender.bind(this))}componentViewPostRender(componentView){let sizing=componentView.model.get("_sizing");if(!sizing||sizing._isEnabled===false)return;componentView.$el.addClass(this.getSizingClasses(sizing))}_validateProperty(sizingObj,propName,isBoolValid){let prop=sizingObj[propName];if(prop===undefined||prop===""||isBoolValid&&prop===false)return false;if(prop=="auto")return true;if(isNaN(prop)&&(isBoolValid?typeof prop!=="boolean":true)||prop<=0||prop>12){Adapt$1.log.error("Invalid value provided for _sizing."+propName+": "+prop+"\n(value must be: [1-12|\"auto\"]"+(isBoolValid?" | true | false":"")+").");return false}return true}_getSizingObj(sizing){if(!sizing)return{};if(Array.isArray(sizing))return{_width:sizing[0],_maxWidth:sizing[1]};if(typeof sizing==="object")return sizing;if(typeof sizing==="number")return{_width:sizing};if(typeof sizing==="string"){if(sizing.match(/^![0-9]+$/g)){sizing=sizing.substring(1);if(!isNaN(sizing))return{_width:parseInt(sizing),_maxWidth:false};else{Adapt$1.log.error("adapt-sizing: 'sizing' parameter provided does not match any of the accepted formats.\n\nSizing value provided: "+JSON.stringify(sizing))}}return{_width:isNaN(sizing)?sizing:parseInt(sizing)}}Adapt$1.log.error("adapt-sizing: 'sizing' parameter provided does not match any of the accepted formats.\n\nSizing value provided: "+JSON.stringify(sizing))}getSizingClasses(sizing){sizing=this._getSizingObj(sizing);let classNames=[];classNames.push("col");classNames.push(this._validateProperty(sizing,"_width",false)?"col-"+sizing._width:undefined);if(sizing._maxWidthInner!==undefined){classNames.push("col-maxwidth-inner");if(sizing._maxWidth===undefined||!isNaN(sizing._maxWidthInner)){sizing._maxWidth=sizing._maxWidthInner}}if(sizing._maxWidth===undefined){sizing._maxWidth=sizing._width=="auto"?false:sizing._width!==undefined}else if(sizing._maxWidth===true&&sizing._width===undefined){sizing._width=6}classNames.push(this._validateProperty(sizing,"_maxWidth",true)?"col-maxwidth"+(sizing._maxWidth===true?"":"-"+sizing._maxWidth):undefined);if(sizing._minWidth===undefined)sizing._minWidth=false;classNames.push(this._validateProperty(sizing,"_minWidth",true)?"col-minwidth"+(sizing._minWidth===true?"":"-"+sizing._minWidth):undefined);if(sizing._float){classNames.push("col-float");switch(sizing._float){case"left":classNames.push("col-float-left");break;default:classNames.push("col-float-right");}}return classNames.join(" ").trim()}getSizingGridClasses(sizing){let classNames=[];classNames.push(this._validateProperty(sizing,"_maxCols",false)?"sg-maxcols-"+sizing._maxCols:undefined);classNames.push(this._validateProperty(sizing,"_width",false)?"sg-cols-"+sizing._width:undefined);return classNames.join(" ").trim()}setUpGridListeners($grid){if(!$grid.length){Adapt$1.log.error("adapt-sizing: Could not initialize $grid listeners ($grid element not found).");return}Adapt$1.on("device:resize",()=>{this.updateGridEl($grid)});_.delay(()=>{this.updateGridEl($grid)})}updateGridEl($grid){let $items=$grid.children();$items.removeClass(function(idx,className){return(className.match(/(^|\s)sg-orphan-\S+/g)||[]).join(" ")});let columnGap=parseInt($grid.css("column-gap"),10);const THRESHOLD=columnGap/2;let gridWidth=$grid.outerWidth();let itemWidth=$items.first().outerWidth();let itemCount=$items.length;let w=-columnGap;let columnCount=0;while(Math.round(w)<gridWidth-THRESHOLD){w+=itemWidth+columnGap;columnCount++}let orphanCount=itemCount%columnCount;if(orphanCount==0)return;$items.eq(itemCount-orphanCount).addClass("sg-orphan-"+(columnCount-orphanCount))}getParentClasses(sizing){sizing=this._getSizingObj(sizing);let classNames=[];if(Boolean(sizing._float)){classNames.push("par-contains-float");classNames.push("u-clearfix")}else{classNames.push("par-contains-flex")}return classNames.join(" ").trim()}getSizingClass(){return this.getSizingClasses.apply(this,arguments)}hasFloatingChildren(sizing){return Boolean(sizing._float)}hasFloat(){return this.hasFloatingChildren.apply(this,arguments)}}let sizing=new Sizing;Adapt$1.sizing=sizing;class MenuItemView extends AdaptView$1{attributes(){return AdaptView$1.resultExtend("attributes",{"role":"listitem","aria-labelledby":this.model.get("_id")+"-heading"},this)}className(){return["menu-item",this.constructor.className,this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),this.model.get("_isVisited")?"is-visited":"",this.model.get("_isComplete")?"is-complete":"",this.model.get("_isLocked")?"is-locked":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}preRender(){this.model.checkCompletionStatus();this.model.checkInteractionCompletionStatus()}postRender(){this.$el.imageready(this.setReadyStatus.bind(this))}}MenuItemView.type="menuItem";var MenuItemView$1=__AMD("core/js/views/menuItemView",MenuItemView);class MenuView extends ContentObjectView{}Object.assign(MenuView,{childContainer:".js-children",childView:MenuItemView$1,type:"menu",template:"menu"});var MenuView$1=__AMD("core/js/views/menuView",MenuView);class BoxMenuItemView extends MenuItemView$1{className(){return`${super.className()} boxmenu-item`}events(){return{"click .js-btn-click":"onClickMenuItemButton"}}onClickMenuItemButton(event){if(event&&event.preventDefault)event.preventDefault();if(this.model.get("_isLocked"))return;router$1.navigateToElement(this.model.get("_id"))}}BoxMenuItemView.template="boxMenuItem";var BoxMenuItemView$1=__AMD("menu/adapt-contrib-boxMenu/js/BoxMenuItemView",BoxMenuItemView);class BoxMenuGroupView extends MenuItemView$1{className(){return`${super.className()} boxmenu-group`}postRender(){_.defer(this.addChildren.bind(this));this.$el.imageready(this.setReadyStatus.bind(this));this.$el.parents(".boxmenu__item-container").addClass("has-groups")}}BoxMenuGroupView.template="boxMenuGroup";BoxMenuGroupView.childContainer=".js-group-children";BoxMenuGroupView.childView=BoxMenuItemView$1;var BoxMenuGroupView$1=__AMD("menu/adapt-contrib-boxMenu/js/BoxMenuGroupView",BoxMenuGroupView);class BoxMenuView extends MenuView$1{className(){return`${super.className()} boxmenu`}initialize(){super.initialize();this.setStyles();this.listenTo(Adapt$1,"device:changed",this.onDeviceResize)}onDeviceResize(){this.setStyles()}addChildren(){let nthChild=0;const models=this.model.getChildren().models;const childViews=[];models.forEach(model=>{if(!model.get("_isAvailable"))return;if(model.get("_isHidden")){model.set("_isReady",true);return}nthChild++;model.set("_nthChild",nthChild);const ChildView=model.get("_type")==="menu"&&model.get("_boxMenu")&&model.get("_boxMenu")._renderAsGroup?BoxMenuGroupView$1:BoxMenuItemView$1;const $parentContainer=this.$(this.constructor.childContainer);const childView=new ChildView({model});childViews.push(childView);$parentContainer.append(childView.$el)});this.setChildViews(childViews)}setStyles(){this.setBackgroundImage();this.setBackgroundStyles();this.processHeader()}setBackgroundImage(){const config=this.model.get("_boxMenu");const backgroundImages=config?._backgroundImage;if(!backgroundImages)return;const backgroundImage=backgroundImages[`_${Adapt$1.device.screenSize}`]??backgroundImages._small;this.$el.toggleClass("has-bg-image",Boolean(backgroundImage)).css("background-image",backgroundImage?"url("+backgroundImage+")":"")}setBackgroundStyles(){const config=this.model.get("_boxMenu");const styles=config?._backgroundStyles;if(!styles)return;this.$el.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})}processHeader(){const config=this.model.get("_boxMenu");const header=config?._menuHeader;if(!header)return;const $header=this.$(".menu__header");this.setHeaderBackgroundImage(header,$header);this.setHeaderBackgroundStyles(header,$header);this.setHeaderMinimumHeight(header,$header)}setHeaderBackgroundImage(config,$header){const backgroundImages=config._backgroundImage;if(!backgroundImages)return;const backgroundImage=backgroundImages[`_${Adapt$1.device.screenSize}`]??backgroundImages._small;$header.toggleClass("has-bg-image",Boolean(backgroundImage)).css("background-image",backgroundImage?"url("+backgroundImage+")":"")}setHeaderBackgroundStyles(config,$header){const styles=config._backgroundStyles;if(!styles)return;$header.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})}setHeaderMinimumHeight(config,$header){const minimumHeights=config._minimumHeights;if(!minimumHeights)return;const minimumHeight=minimumHeights[`_${Adapt$1.device.screenSize}`]??minimumHeights._small;$header.toggleClass("has-min-height",Boolean(minimumHeight)).css("min-height",minimumHeight?minimumHeight+"px":"")}}BoxMenuView.template="boxMenu";var BoxMenuView$1=__AMD("menu/adapt-contrib-boxMenu/js/BoxMenuView",BoxMenuView);Adapt$1.register("course menu",{view:BoxMenuView$1});Adapt$1.register("boxMenu",{view:BoxMenuView$1,model:MenuModel$1.extend({})});var ThemeView=__AMD("theme/adapt-didasko/js/themeView",class ThemeView extends Backbone.View{className(){}initialize(){this.setStyles();this.listenTo(Adapt$1,{"device:changed":this.onDeviceResize,remove:this.remove})}onDeviceResize(){this.setStyles()}remove(){super.remove();this.onRemove()}setStyles(){this.setClasses();this.setBackgroundImage();this.setBackgroundStyles();this.setMinimumHeight();this.setResponsiveClasses();this.setCustomStyles()}setClasses(){this.$el.addClass(this.className())}setBackgroundImage(){const backgroundImages=this.model.get("_backgroundImage");if(!backgroundImages)return;let backgroundImage;switch(Adapt$1.device.screenSize){case"large":backgroundImage=backgroundImages._large;break;case"medium":backgroundImage=backgroundImages._medium;break;default:backgroundImage=backgroundImages._small;}if(backgroundImage){this.$el.addClass("has-bg-image").css("background-image","url("+backgroundImage+")");return}this.$el.removeClass("has-bg-image").css("background-image","")}setBackgroundStyles(){const styles=this.model.get("_backgroundStyles");if(!styles)return;this.$el.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})}setMinimumHeight(){const minimumHeights=this.model.get("_minimumHeights");if(!minimumHeights)return;let minimumHeight;switch(Adapt$1.device.screenSize){case"large":minimumHeight=minimumHeights._large;break;case"medium":minimumHeight=minimumHeights._medium;break;default:minimumHeight=minimumHeights._small;}if(minimumHeight){this.$el.addClass("has-min-height").css("min-height",minimumHeight+"px");return}this.$el.removeClass("has-min-height").css("min-height","")}setResponsiveClasses(){const responsiveClasses=this.model.get("_responsiveClasses");if(!responsiveClasses)return;this.$el.removeClass(Object.values(responsiveClasses)).addClass(responsiveClasses[`_${Adapt$1.device.screenSize}`])}setCustomStyles(){}onRemove(){}});var ThemePageView=__AMD("theme/adapt-didasko/js/themePageView",class ThemePageView extends ThemeView{className(){}setCustomStyles(){this.processHeader()}processHeader(){const header=this.model.get("_pageHeader");if(!header)return;const $header=this.$(".page__header");this.setHeaderBackgroundImage(header,$header);this.setHeaderBackgroundStyles(header,$header);this.setHeaderMinimumHeight(header,$header)}setHeaderBackgroundImage(config,$header){const backgroundImages=config._backgroundImage;if(!backgroundImages)return;let backgroundImage;switch(Adapt$1.device.screenSize){case"large":backgroundImage=backgroundImages._large;break;case"medium":backgroundImage=backgroundImages._medium;break;default:backgroundImage=backgroundImages._small;}if(backgroundImage){$header.addClass("has-bg-image").css("background-image","url("+backgroundImage+")");return}$header.removeClass("has-bg-image").css("background-image","")}setHeaderBackgroundStyles(config,$header){const styles=config._backgroundStyles;if(!styles)return;$header.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})}setHeaderMinimumHeight(config,$header){const minimumHeights=config._minimumHeights;if(!minimumHeights)return;let minimumHeight;switch(Adapt$1.device.screenSize){case"large":minimumHeight=minimumHeights._large;break;case"medium":minimumHeight=minimumHeights._medium;break;default:minimumHeight=minimumHeights._small;}if(minimumHeight){$header.addClass("has-min-height").css("min-height",minimumHeight+"px");return}$header.removeClass("has-min-height").css("min-height","")}onRemove(){}});var ThemeArticleView=__AMD("theme/adapt-didasko/js/themeArticleView",class ThemeArticleView extends ThemeView{className(){}setCustomStyles(){}onRemove(){}});var ThemeBlockView=__AMD("theme/adapt-didasko/js/themeBlockView",class ThemeBlockView extends ThemeView{className(){return this.model.get("_isDividerBlock")?"is-divider-block":""}setCustomStyles(){}onRemove(){}});class Theme extends Backbone.Controller{initialize(){this.listenTo(Adapt$1,{"app:dataReady":this.onDataReady,"pageView:postRender articleView:postRender blockView:postRender":this.onPostRender})}onDataReady(){$("html").addClass(Adapt$1.course.get("_courseStyle"))}onPostRender(view){const viewModel=view.model;const theme=viewModel.get("_vanilla");const model=new Backbone.Model(theme);const el=view.$el;if(!theme)return;switch(viewModel.get("_type")){case"page":new ThemePageView({model,el});break;case"article":new ThemeArticleView({model,el});break;case"block":new ThemeBlockView({model,el});break;default:new ThemeView({model,el});}}}__AMD("theme/adapt-didasko/js/theme",new Theme);var helpers={"c-example":function(){let context=arguments[arguments.length-1];let content=context.fn(this);let html=Handlebars.templates["c-example"](_.extend(context.hash,{content:content}));return new Handlebars.SafeString(html)}};for(var name in helpers){if(helpers.hasOwnProperty(name)){Handlebars.registerHelper(name,helpers[name])}}var partials={"c-partial":"<strong><u>Shortcut!</u></strong>","c-withParam":"<strong><u>{{./param}}</u></strong>"};for(var name in partials){Handlebars.registerPartial(name,partials[name])}register("header",function Header(props){const jsxHeading=React.useRef(null);const{_id,displayTitle,body,instruction,mobileInstruction,_type,_component,_disableAccessibilityState,_isA11yComponentDescriptionEnabled,classNamePrefixes=[_type&&_type.toLowerCase(),_component&&_component.toLowerCase()].filter(Boolean)}=props;const sizedInstruction=mobileInstruction&&device$1.screenSize!=="large"?mobileInstruction:instruction;const _globals=Adapt$1.course.get("_globals");const ariaRegion=_globals?._components?.[`_${_component}`]?.ariaRegion;const isSet=displayTitle||body||sizedInstruction;if(!isSet&&_isA11yComponentDescriptionEnabled&&ariaRegion){return React__default["default"].createElement("div",{className:"aria-label",dangerouslySetInnerHTML:{__html:compile(ariaRegion)}})}if(!isSet)return null;return React__default["default"].createElement("div",{id:`${_id}-header`,className:prefixClasses(classNamePrefixes,["__header"])},React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__header-inner"])},displayTitle&&React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__title"])},!_disableAccessibilityState&&React__default["default"].createElement("div",{className:"js-heading",ref:jsxHeading}),React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__title-inner"]),"aria-hidden":!_disableAccessibilityState,dangerouslySetInnerHTML:{__html:compile(displayTitle,props)}})),_isA11yComponentDescriptionEnabled&&ariaRegion&&React__default["default"].createElement("div",{className:"aria-label",dangerouslySetInnerHTML:{__html:compile(ariaRegion,props)}}),body&&React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__body"])},React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__body-inner"]),dangerouslySetInnerHTML:{__html:compile(body,props)}})),sizedInstruction&&React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__instruction"])},React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__instruction-inner"]),dangerouslySetInnerHTML:{__html:compile(sizedInstruction,props)}}))))});register("image",function Image(props){const hasMediumSetting=Object.prototype.hasOwnProperty.call(props,"_medium")||Object.prototype.hasOwnProperty.call(props,"medium");const screenSize=hasMediumSetting?device$1.screenSize:device$1.screenSize==="large"?"large":"small";const src=props[`_${screenSize}`]||props[`${screenSize}`]||props._src||props.src;const hasSource=Boolean(src);if(!hasSource)return null;const attributionClassNamePrefixes=props.attributionClassNamePrefixes||props.classNamePrefixes;return React__default["default"].createElement("div",{id:props.id,className:classes([prefixClasses(props.classNamePrefixes,["__image-container"]),props.classes,props.attribution&&"has-attribution"])},React__default["default"].createElement("img",{className:prefixClasses(props.classNamePrefixes,["__image"]),src:src,"aria-label":a11y$1.normalize(props.alt),"aria-hidden":!props.alt,loading:"eager","aria-describedby":props.longdescription?props.longDescriptionId:undefined}),props.attribution&&React__default["default"].createElement("div",{className:prefixClasses(attributionClassNamePrefixes,["__attribution"])},React__default["default"].createElement("div",{className:prefixClasses(attributionClassNamePrefixes,["__attribution-inner"])},html(props.attribution))))});function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}register("accordion",function Accordion(props){const{complete,incomplete}=Adapt$1.course.get("_globals")?._accessibility?._ariaLabels;const{_id,_ariaLevel,onClick}=props;const itemAriaLevel=_.isNumber(_ariaLevel)?_ariaLevel+1:_ariaLevel;return React__default["default"].createElement("div",{className:"component__inner accordion__inner"},React__default["default"].createElement(templates.header,props),React__default["default"].createElement("div",{className:"component__widget accordion__widget"},props._items.map((_ref,index)=>{let{_graphic,_classes,title,body,_index,_isVisited,_isActive}=_ref;return React__default["default"].createElement("div",{className:classes(["accordion-item","js-accordion-item",_graphic?.src&&"has-image",_classes]),key:_index,"data-index":_index},React__default["default"].createElement("div",{role:"heading","aria-level":a11y$1.ariaLevel("componentItem",itemAriaLevel)},React__default["default"].createElement("button",{id:`${_id}-${index}-accordion-button`,className:classes(["accordion-item__btn","js-toggle-item",_isVisited&&"is-visited",_isActive?"is-open is-selected":"is-closed"]),onClick:onClick,"aria-expanded":_isActive.toString(),"aria-controls":`${_id}-${index}-accordion-button-panel`},React__default["default"].createElement("span",{className:"accordion-item__btn-inner"},React__default["default"].createElement("span",{className:"accordion-item__icon"},React__default["default"].createElement("span",{className:"icon","aria-hidden":"true"})),React__default["default"].createElement("span",{className:"accordion-item__title"},React__default["default"].createElement("span",{className:"aria-label"},`${_isVisited?complete:incomplete} ${compile(title)}`),React__default["default"].createElement("span",{className:"accordion-item__title-inner","aria-hidden":"true",dangerouslySetInnerHTML:{__html:compile(title)}}))))),React__default["default"].createElement("div",{id:`${_id}-${index}-accordion-button-panel`,className:"accordion-item__content js-accordion-item-content",role:"region","aria-labelledby":`${_id}-${index}-accordion-button`},React__default["default"].createElement("div",{className:"accordion-item__content-inner"},body&&React__default["default"].createElement("div",{className:"accordion-item__body"},React__default["default"].createElement("div",{className:"accordion-item__body-inner",dangerouslySetInnerHTML:{__html:compile(body)}})),React__default["default"].createElement(templates.image,_extends({},_graphic,{classNamePrefixes:["component-item","accordion-item"],attributionClassNamePrefixes:["component","accordion"]})))))})))});register("gmcq",function Gmcq(props){const ariaLabels=Adapt$1.course.get("_globals")._accessibility._ariaLabels;const{_id,_isEnabled,_isInteractionComplete,_isCorrect,_isCorrectAnswerShown,_shouldShowMarking,_isRadio,_columns,displayTitle,body,instruction,ariaQuestion,onKeyPress,onItemSelect,onItemFocus,onItemBlur}=props;const screenSize=device$1.screenSize;return React__default["default"].createElement("div",{className:"component__inner gmcq__inner"},React__default["default"].createElement(templates.header,props),React__default["default"].createElement("div",{className:classes(["component__widget","gmcq__widget",!_isEnabled&&"is-disabled",_isInteractionComplete&&"is-complete is-submitted show-user-answer",_isCorrect&&"is-correct",_columns&&screenSize==="large"&&"has-column-layout"]),role:_isRadio?"radiogroup":"group","aria-labelledby":ariaQuestion?null:(displayTitle||body||instruction)&&`${_id}-header`,"aria-label":ariaQuestion||null},props._items.map((_ref,index)=>{let{text,_index,_isActive,_shouldBeSelected,_graphic}=_ref;return React__default["default"].createElement("div",{className:classes([`gmcq-item item-${index}`,_shouldShowMarking&&_shouldBeSelected?"is-correct":null,_shouldShowMarking&&!_shouldBeSelected?"is-incorrect":null]),style:_columns&&screenSize==="large"?{width:`${100/_columns}%`}:null,key:_index},React__default["default"].createElement("input",{className:"gmcq-item__input",id:`${_id}-${index}-input`,name:_isRadio?`${_id}-item`:null,type:_isRadio?"radio":"checkbox",disabled:!_isEnabled,defaultChecked:_isActive,"aria-label":!_shouldShowMarking?`${a11y$1.normalize(text)} ${_graphic?.alt||""}`:`${_shouldBeSelected?ariaLabels.correct:ariaLabels.incorrect}, ${_isActive?ariaLabels.selectedAnswer:ariaLabels.unselectedAnswer}. ${a11y$1.normalize(text)} ${_graphic?.alt||""}`,"data-adapt-index":_index,onKeyPress:onKeyPress,onChange:onItemSelect,onFocus:onItemFocus,onBlur:onItemBlur}),React__default["default"].createElement("label",{className:classes(["gmcq-item__label","js-item-label",!_isEnabled&&"is-disabled",(_isCorrectAnswerShown?_shouldBeSelected:_isActive)&&"is-selected"]),"aria-hidden":true,htmlFor:`${_id}-${index}-input`,"data-adapt-index":_index},React__default["default"].createElement(templates.image,_extends({},_graphic,{classNamePrefixes:["gmcq-item"],attributionClassNamePrefixes:["component","gmcq"]})),React__default["default"].createElement("div",{className:"gmcq-item__option"},React__default["default"].createElement("div",{className:"gmcq-item__state"},React__default["default"].createElement("div",{className:classes(["gmcq-item__icon","gmcq-item__answer-icon",_isRadio?"is-radio":"is-checkbox"])},React__default["default"].createElement("div",{className:"icon"})),React__default["default"].createElement("div",{className:"gmcq-item__icon gmcq-item__correct-icon"},React__default["default"].createElement("div",{className:"icon"})),React__default["default"].createElement("div",{className:"gmcq-item__icon gmcq-item__incorrect-icon"},React__default["default"].createElement("div",{className:"icon"}))),text&&React__default["default"].createElement("div",{className:"gmcq-item__text"},React__default["default"].createElement("div",{className:"gmcq-item__text-inner",dangerouslySetInnerHTML:{__html:compile(text)}})))))})),React__default["default"].createElement("div",{className:"btn__container"}))});const LinkWrapper=_ref=>{let{href,children,target,className,role}=_ref;return href?React__default["default"].createElement("a",{href:href,target:target,className:className,role:role},children):children};register("graphic",function Graphic(props){const{_graphic}=props;return React__default["default"].createElement("div",{className:"component__inner graphic__inner"},React__default["default"].createElement(templates.header,props),React__default["default"].createElement("div",{className:"component__widget graphic__widget"},React__default["default"].createElement(LinkWrapper,{href:_graphic._url,target:_graphic._target,className:"graphic__link js-graphic-link",role:"link"},React__default["default"].createElement(templates.image,_extends({},_graphic,{classNamePrefixes:["component","graphic"]})))))});register("matching",function Matching(props){const{_isEnabled,_isInteractionComplete,_isCorrect,_shouldShowMarking,_isCorrectAnswerShown,_items,_options}=props;const displayAsCorrect=_isInteractionComplete&&(_isCorrectAnswerShown||_isCorrect);return React__default["default"].createElement("div",{className:"component__inner matching__inner"},React__default["default"].createElement(templates.header,props),React__default["default"].createElement("div",{className:classes(["component__widget matching__widget",!_isEnabled&&"is-disabled",_isInteractionComplete&&"is-complete is-submitted show-user-answer",displayAsCorrect&&"is-correct"])},_items.map((_ref,index)=>{let{text,_index}=_ref;const activeOption=_options.find(option=>option._itemIndex===_index&&option._isActive);const displayItemAsCorrect=!_isEnabled&&_shouldShowMarking&&(_isCorrectAnswerShown||activeOption?._shouldBeSelected);return React__default["default"].createElement("div",{key:_index,className:classes(["matching-item","item",`item-${index}`,"js-matching-item",_shouldShowMarking&&(displayItemAsCorrect?"is-correct":"is-incorrect")])},text&&React__default["default"].createElement("div",{className:"matching-item__title"},React__default["default"].createElement("div",{className:"matching-item__title_inner",dangerouslySetInnerHTML:{__html:text}})),React__default["default"].createElement("div",{className:"matching-item__select-container js-matching-item-select-container"},React__default["default"].createElement(templates.matchingDropDown,_extends({},props,{_itemIndex:_index})),React__default["default"].createElement("div",{className:"matching-item__select-state"},React__default["default"].createElement("div",{className:"matching-item__select-icon matching-item__select-correct-icon"},React__default["default"].createElement("div",{className:"icon"})),React__default["default"].createElement("div",{className:"matching-item__select-icon matching-item__select-incorrect-icon"},React__default["default"].createElement("div",{className:"icon"})))))})),React__default["default"].createElement("div",{className:"btn__container"}))});register("matchingDropDown",function MatchingDropDown(props){const button=React.useRef(null);const list=React.useRef(null);const[wasOpen,setWasOpen]=React.useState(false);const[isOpen,setIsOpen]=React.useState(false);const[isShown,setIsShown]=React.useState(false);const[blurTimeoutHandle,setBlurTimeoutHandle]=React.useState(null);const[isListOffScreen,setIsListOffScreen]=React.useState(false);const[listHeight,setListHeight]=React.useState(null);const[buttonWidth,setButtonWidth]=React.useState(null);const[buttonOffsetLeft,setButtonOffsetLeft]=React.useState(null);const onStartInteraction=()=>setWasOpen(isOpen);const onButtonClick=()=>{if(wasOpen||isOpen){setIsOpen(false);return}if(blurTimeoutHandle){clearTimeout(blurTimeoutHandle);setBlurTimeoutHandle(null)}setIsShown(false);setIsOpen(true);setTimeout(()=>{const offset=list?.current.getBoundingClientRect();const height=$(list?.current).height();const windowHeight=$(window).height();setIsListOffScreen(offset.top+height>windowHeight);setListHeight(height);setButtonOffsetLeft(button?.current.offsetLeft);setButtonWidth($(button?.current).outerWidth());setIsShown(true);list?.current.focus();scrollToHighlightedListItem()},100)};const scrollToHighlightedListItem=()=>{if(!list?.current)return;const highlighted=$("li[aria-selected]",list.current)[0];if(!highlighted)return;const height=list.current.clientHeight;const pos=highlighted.offsetTop-height/2;list.current.scrollTop=pos};const onOptionClicked=event=>{const li=$(event.target).closest("li");const optionIndex=$(li).val();const option=options.find(option=>option._index===optionIndex);chooseOption(option)};const chooseOption=option=>{setActiveOption(option._index);button?.current.focus()};const onListBlur=()=>{if(!isOpen)return;const handleBlur=()=>{setIsShown(false);setIsOpen(false)};setBlurTimeoutHandle(setTimeout(handleBlur,100))};const onDocumentClick=event=>{if(!isOpen)return;const parents=[document.activeElement,...$(document.activeElement).parents().toArray()];if(parents.includes(list?.current))return;onListBlur()};const KEYCODE={UP:38,DOWN:40,ENTER:13,SPACE:32,ESCAPE:27};const validKeyCodes=Object.values(KEYCODE);const onDocumentKeyDown=event=>{if(!isOpen||!validKeyCodes.includes(event.keyCode))return;switch(event.keyCode){case KEYCODE.UP:{event.preventDefault();const option=getPreviousOption()||getLastOption();highlightOption(option);break}case KEYCODE.DOWN:{event.preventDefault();const option=getNextOption()||getFirstOption();highlightOption(option);break}case KEYCODE.ENTER:case KEYCODE.SPACE:event.preventDefault();chooseOption(highlightedOption);break;case KEYCODE.ESCAPE:event.preventDefault();button?.current.focus();}};const getCurrentOptionIndex=()=>options.findIndex(option=>option===highlightedOption);const getPreviousOption=()=>options[getCurrentOptionIndex()-1];const getLastOption=()=>options[options.length-1];const getNextOption=()=>options[getCurrentOptionIndex()+1];const getFirstOption=()=>options[0];const highlightOption=option=>{setHighlightedOption(option._index);scrollToHighlightedListItem()};React.useEffect(()=>{document.addEventListener("click",onDocumentClick,{capture:true});document.addEventListener("keydown",onDocumentKeyDown);return()=>{document.removeEventListener("click",onDocumentClick,{capture:true});document.removeEventListener("keydown",onDocumentKeyDown)}},[onDocumentKeyDown,onDocumentClick]);const{_id,_isEnabled,placeholder,_itemIndex,_options,_isCorrectAnswerShown,setActiveOption,setHighlightedOption}=props;const options=_options.filter(_ref=>{let{_itemIndex:itemIndex}=_ref;return itemIndex===_itemIndex||itemIndex===-1});const activeOption=options.find(option=>option._itemIndex===_itemIndex&&option._isActive)||{text:placeholder};const highlightedOption=options.find(option=>option._itemIndex===_itemIndex&&option._isHighlighted)||{text:placeholder};const correctActiveOption=activeOption?._shouldBeSelected?activeOption:options.find(option=>option._shouldBeSelected);const displayActiveOption=_isCorrectAnswerShown?correctActiveOption:activeOption;return React__default["default"].createElement("div",{className:"dropdown",disabled:!_isEnabled},React__default["default"].createElement("button",{disabled:!_isEnabled,className:classes(["dropdown__btn js-dropdown-btn",!_isEnabled&&"is-disabled"]),"aria-haspopup":"listbox","aria-expanded":isOpen,onMouseDown:onStartInteraction,onTouchStart:onStartInteraction,onClick:onButtonClick,ref:button},React__default["default"].createElement("div",{className:"dropdown__inner js-dropdown-inner",dangerouslySetInnerHTML:{__html:displayActiveOption?.text}}),React__default["default"].createElement("div",{className:"dropdown__icon"},React__default["default"].createElement("div",{className:"icon"}))),React__default["default"].createElement("ul",{className:classes(["dropdown__list js-dropdown-list",!isOpen&&"u-display-none",isOpen&&!isShown&&"u-visibility-hidden"]),style:{top:!isShown||!isListOffScreen?"":-listHeight,left:buttonOffsetLeft,width:buttonWidth},role:"listbox",tabIndex:"-1",onBlur:onListBlur,ref:list,disabled:!_isEnabled,"aria-activedescendant":highlightedOption&&`dropdown__item__${_id}__${_itemIndex}__${highlightedOption._index}`},options.map(_ref2=>{let{displayText,text,_index,_isHighlighted}=_ref2;return React__default["default"].createElement("li",{key:_index,id:`dropdown__item__${_id}__${_itemIndex}__${_index}`,className:"dropdown-item js-dropdown-list-item",role:"option",text:text,value:_index,"aria-selected":_isHighlighted||null,selected:_isHighlighted||null,onClick:onOptionClicked},React__default["default"].createElement("div",{className:"dropdown-item__inner js-dropdown-list-item-inner",dangerouslySetInnerHTML:{__html:displayText||text}}))})))});register("mcq",function Mcq(props){const ariaLabels=Adapt$1.course.get("_globals")._accessibility._ariaLabels;const{_id,_isEnabled,_isInteractionComplete,_isCorrect,_isCorrectAnswerShown,_shouldShowMarking,_isRadio,displayTitle,body,instruction,ariaQuestion,onKeyPress,onItemSelect,onItemFocus,onItemBlur}=props;return React__default["default"].createElement("div",{className:"component__inner mcq__inner"},React__default["default"].createElement(templates.header,props),React__default["default"].createElement("div",{className:classes(["component__widget","mcq__widget",!_isEnabled&&"is-disabled",_isInteractionComplete&&"is-complete is-submitted show-user-answer",_isCorrect&&"is-correct"]),role:_isRadio?"radiogroup":"group","aria-labelledby":ariaQuestion?null:(displayTitle||body||instruction)&&`${_id}-header`,"aria-label":ariaQuestion||null},props._items.map((_ref,index)=>{let{text,_index,_isActive,_shouldBeSelected,_isHighlighted}=_ref;return React__default["default"].createElement("div",{className:classes([`mcq-item item-${index}`,_shouldShowMarking&&_shouldBeSelected&&"is-correct",_shouldShowMarking&&!_shouldBeSelected&&"is-incorrect"]),key:_index},React__default["default"].createElement("input",{className:"mcq-item__input",id:`${_id}-${index}-input`,name:_isRadio?`${_id}-item`:null,type:_isRadio?"radio":"checkbox",disabled:!_isEnabled,defaultChecked:_isActive,"aria-label":!_shouldShowMarking?a11y$1.normalize(text):`${_shouldBeSelected?ariaLabels.correct:ariaLabels.incorrect}, ${_isActive?ariaLabels.selectedAnswer:ariaLabels.unselectedAnswer}. ${a11y$1.normalize(text)}`,"data-adapt-index":_index,onKeyPress:onKeyPress,onChange:onItemSelect,onFocus:onItemFocus,onBlur:onItemBlur}),React__default["default"].createElement("label",{className:classes(["mcq-item__label",!_isEnabled&&"is-disabled",_isHighlighted&&"is-highlighted",(_isCorrectAnswerShown?_shouldBeSelected:_isActive)&&"is-selected"]),"aria-hidden":true,htmlFor:`${_id}-${index}-input`,"data-adapt-index":_index},React__default["default"].createElement("div",{className:"mcq-item__state"},React__default["default"].createElement("div",{className:classes(["mcq-item__icon","mcq-item__answer-icon",_isRadio?"is-radio":"is-checkbox"])},React__default["default"].createElement("div",{className:"icon"})),React__default["default"].createElement("div",{className:"mcq-item__icon mcq-item__correct-icon"},React__default["default"].createElement("div",{className:"icon"})),React__default["default"].createElement("div",{className:"mcq-item__icon mcq-item__incorrect-icon"},React__default["default"].createElement("div",{className:"icon"}))),React__default["default"].createElement("div",{className:"mcq-item__text"},React__default["default"].createElement("div",{className:"mcq-item__text-inner",dangerouslySetInnerHTML:{__html:compile(text)}}))))})),React__default["default"].createElement("div",{className:"btn__container"}))});register("textinput",function TextInput(props){const{_isInteractionComplete,_id,_isEnabled,_isCorrect,_shouldShowMarking}=props;return React__default["default"].createElement("div",{className:"component__inner textinput__inner"},React__default["default"].createElement(templates.header,props),React__default["default"].createElement("div",{className:classes(["component__widget textinput__widget",!_isEnabled&&"is-disabled",_isInteractionComplete&&"is-complete is-submitted show-user-answer",_isCorrect&&"is-correct"])},props._items.map((_ref,index)=>{let{prefix,_index,input,placeholder,userAnswer,suffix}=_ref;return React__default["default"].createElement("div",{className:classes(["textinput-item js-textinput-item",_shouldShowMarking&&_isCorrect&&"is-correct",_shouldShowMarking&&!_isCorrect&&"is-incorrect"]),key:_index},prefix&&React__default["default"].createElement("div",{className:"textinput-item__prefix-container"},React__default["default"].createElement("label",{className:"textinput-item__prefix",id:`${_id}-${index}-aria`,htmlFor:`${_id}-${index}`,"aria-label":prefix},html(compile(prefix)))),React__default["default"].createElement("div",{className:"textinput-item__textbox-container"},React__default["default"].createElement("input",{className:"textinput-item__textbox js-textinput-textbox",type:"text",placeholder:placeholder,"data-id":`${input}-${index}`,id:`${_id}-${index}`,"aria-labelledby":prefix&&`${_id}-${index}-aria`,"aria-label":placeholder,defaultValue:userAnswer,disabled:!_isEnabled}),React__default["default"].createElement("div",{className:"textinput-item__state"},React__default["default"].createElement("div",{className:"textinput-item__icon textinput-item__correct-icon"},React__default["default"].createElement("div",{className:"icon"})),React__default["default"].createElement("div",{className:"textinput-item__icon textinput-item__incorrect-icon"},React__default["default"].createElement("div",{className:"icon"})))),suffix&&React__default["default"].createElement("div",{className:"textinput-item__suffix-container"},React__default["default"].createElement("label",{className:"textinput-item__suffix",id:`${_id}-${index}-aria`,htmlFor:`${_id}-${index}`,"aria-label":suffix},html(compile(suffix)))))})),React__default["default"].createElement("div",{className:"btn__container"}))});register("header",function Header(props){const jsxHeading=React.useRef(null);const{_id,title,body,instruction,mobileInstruction,_type,_component,_disableAccessibilityState,_isA11yComponentDescriptionEnabled,classNamePrefixes=[_type&&_type.toLowerCase(),_component&&_component.toLowerCase()].filter(Boolean)}=props;const sizedInstruction=mobileInstruction&&device$1.screenSize!=="large"?mobileInstruction:instruction;const _globals=Adapt$1.course.get("_globals");const ariaRegion=_globals?._components?.[`_${_component}`]?.ariaRegion;const isSet=title||body||sizedInstruction;if(!isSet&&_isA11yComponentDescriptionEnabled&&ariaRegion){return React__default["default"].createElement("div",{className:"aria-label",dangerouslySetInnerHTML:{__html:compile(ariaRegion)}})}if(!isSet)return null;return React__default["default"].createElement("div",{id:`${_id}-header`,className:prefixClasses(classNamePrefixes,["__header"])},React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__header-inner"])},title&&React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__title"])},!_disableAccessibilityState&&React__default["default"].createElement("div",{className:"js-heading",ref:jsxHeading}),React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__title-inner"]),"aria-hidden":!_disableAccessibilityState,dangerouslySetInnerHTML:{__html:compile(title,props)}})),_isA11yComponentDescriptionEnabled&&ariaRegion&&React__default["default"].createElement("div",{className:"aria-label",dangerouslySetInnerHTML:{__html:compile(ariaRegion,props)}}),body&&React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__body"])},React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__body-inner"]),dangerouslySetInnerHTML:{__html:compile(body,props)}})),sizedInstruction&&React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__instruction"])},React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__instruction-inner"]),dangerouslySetInnerHTML:{__html:compile(sizedInstruction,props)}}))))});$("body").append(Handlebars.templates.loading());data$1.on("ready",()=>{logging$1.debug("Calling Adapt.init");Adapt$1.init();Adapt$1.off("adaptCollection:dataLoaded courseModel:dataLoaded")}).init()});window.__AMD=function(id,value){window.define(id,function(){return value});window.require([id]);return value};
